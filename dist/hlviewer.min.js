/*!
 * The MIT License (MIT)
 * 
 * Copyright (c) 2018 Stefan StojkoviÄ‡
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HLViewer=t():e.HLViewer=t()}(window,function(){var e=Math.round,t=Math.min,n=Math.floor,r=Math.ceil,i=Math.sqrt,s=Math.pow,o=Math.cos,a=Math.sin,u=Math.abs,c=Math.PI,l=String.fromCharCode,d=Math.max;return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t,n){"use strict";function r(e){var t={},n="";for(var i in e){var s=e[i];if("$unique"==i)t[a.IS_UNIQUE]=s;else if("$nest"==i){var o=s;for(var u in o){var c=o[u];t[u]=r(c).result}}else"$debugName"==i?n=s:t[i]=s}return{result:t,debugName:n}}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.map(function(e){return e&&"object"==typeof e?Object.keys(e).map(function(t){return!!e[t]&&t}):[e]}).reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return!!e}).join(" ")}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n,r={},i=0,o=e;i<o.length;i++)if(null!=(n=o[i])&&!1!==n)for(var a in n){var u=n[a];(u||0===u)&&(r[a]="$nest"==a&&u?r.$nest?s(r.$nest,u):u:(-1!==a.indexOf("&")||0===a.indexOf("@media"))&&r[a]?s(r[a],u):u)}return r}function o(e){var t=new f({autoGenerateTag:!1});return e&&t.setStylesTarget(e),t}n.r(t);var a=n(6),u="undefined"==typeof requestAnimationFrame?function(e){return setTimeout(e)}:"undefined"==typeof window?requestAnimationFrame:requestAnimationFrame.bind(window),c=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=[];e.type&&r.push(e.type),e.orientation&&r.push("(orientation: "+e.orientation+")"),e.minWidth&&r.push("(min-width: "+l(e.minWidth)+")"),e.maxWidth&&r.push("(max-width: "+l(e.maxWidth)+")"),e.minHeight&&r.push("(min-height: "+l(e.minHeight)+")"),e.maxHeight&&r.push("(max-height: "+l(e.maxHeight)+")");var i,o="@media "+r.join(" and "),a={$nest:(i={},i[o]=s.apply(void 0,t),i)};return a},l=function(e){return"string"==typeof e?e:e+"px"},d=function(){return a.create(void 0,!0)},f=function(){function e(e){var t=e.autoGenerateTag,n=this;this.cssRaw=function(e){e&&(n._raw+=e||"",n._pendingRawChange=!0,n._styleUpdated())},this.cssRule=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=r(s.apply(void 0,t)).result;return n._freeStyle.registerRule(e,o),void n._styleUpdated()},this.forceRenderStyles=function(){var e=n._getTag();e&&(e.textContent=n.getStyles())},this.fontFace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r,i=n._freeStyle,s=0,o=e;s<o.length;s++)r=o[s],i.registerRule("@font-face",r);n._styleUpdated()},this.getStyles=function(){return(n._raw||"")+n._freeStyle.getStyles()},this.keyframes=function(e){var t=function(e){var t={$debugName:void 0,keyframes:{}};for(var n in e){var r=e[n];"$debugName"==n?t.$debugName=r:t.keyframes[n]=r}return t}(e),r=t.keyframes,i=t.$debugName,s=n._freeStyle.registerKeyframes(r,i);return n._styleUpdated(),s},this.reinit=function(){var e=d();n._freeStyle=e,n._lastFreeStyleChangeId=e.changeId,n._raw="",n._pendingRawChange=!1;var t=n._getTag();t&&(t.textContent="")},this.setStylesTarget=function(e){n._tag&&(n._tag.textContent=""),n._tag=e,n.forceRenderStyles()},this.stylesheet=function(e){for(var t={},r=0,i=Object.getOwnPropertyNames(e);r<i.length;r++){var s=i[r],o=e[s];o&&(o.$debugName=s,t[s]=n.style(o))}return t};var i=d();this._autoGenerateTag=t,this._freeStyle=i,this._lastFreeStyleChangeId=i.changeId,this._pending=0,this._pendingRawChange=!1,this._raw="",this._tag=void 0,this.style=this.style.bind(this)}return e.prototype._afterAllSync=function(e){var t=this;this._pending++;var n=this._pending;u(function(){n!==t._pending||e()})},e.prototype._getTag=function(){if(this._tag)return this._tag;if(this._autoGenerateTag){var e="undefined"==typeof window?{textContent:""}:document.createElement("style");return"undefined"!=typeof document&&document.head.appendChild(e),this._tag=e,e}},e.prototype._styleUpdated=function(){var e=this,t=this._freeStyle.changeId,n=this._lastFreeStyleChangeId;(this._pendingRawChange||t!==n)&&(this._lastFreeStyleChangeId=t,this._pendingRawChange=!1,this._afterAllSync(function(){return e.forceRenderStyles()}))},e.prototype.style=function(){var e=this._freeStyle,t=r(s.apply(void 0,arguments)),n=t.result,i=t.debugName,o=i?e.registerStyle(n,i):e.registerStyle(n);return this._styleUpdated(),o},e}(),h=n(15);n.d(t,"setStylesTarget",function(){return m}),n.d(t,"cssRaw",function(){return g}),n.d(t,"cssRule",function(){return y}),n.d(t,"forceRenderStyles",function(){return v}),n.d(t,"fontFace",function(){return b}),n.d(t,"getStyles",function(){return x}),n.d(t,"keyframes",function(){return E}),n.d(t,"reinit",function(){return T}),n.d(t,"style",function(){return S}),n.d(t,"stylesheet",function(){return w}),n.d(t,"createTypeStyle",function(){return o}),n.d(t,"TypeStyle",function(){return f}),n.d(t,"types",function(){return h}),n.d(t,"extend",function(){return s}),n.d(t,"classes",function(){return i}),n.d(t,"media",function(){return c});var p=new f({autoGenerateTag:!0}),m=p.setStylesTarget,g=p.cssRaw,y=p.cssRule,v=p.forceRenderStyles,b=p.fontFace,x=p.getStyles,E=p.keyframes,T=p.reinit,S=p.style,w=p.stylesheet},function(e,t){!function(e){"use strict";function t(e,t){var n,r,i,s,o=L;for(s=arguments.length;2<s--;)P.push(arguments[s]);for(t&&null!=t.children&&(!P.length&&P.push(t.children),delete t.children);P.length;)if((r=P.pop())&&void 0!==r.pop)for(s=r.length;s--;)P.push(r[s]);else"boolean"==typeof r&&(r=null),(i="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r+="":"string"!=typeof r&&(i=!1)),i&&n?o[o.length-1]+=r:o===L?o=[r]:o.push(r),n=i;var a=new I;return a.nodeName=e,a.children=o,a.attributes=null==t?void 0:t,a.key=null==t?void 0:t.key,void 0!==M.vnode&&M.vnode(a),a}function n(e,t){for(var n in t)e[n]=t[n];return e}function r(e,t){e&&("function"==typeof e?e(t):e.current=t)}function i(e,r){return t(e.nodeName,n(n({},e.attributes),r),2<arguments.length?[].slice.call(arguments,2):e.children)}function s(e){!e._dirty&&(e._dirty=!0)&&1==V.push(e)&&(M.debounceRendering||C)(o)}function o(){for(var e;e=V.pop();)e._dirty&&S(e)}function a(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&u(e,t.nodeName):n||e._componentConstructor===t.nodeName}function u(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function c(e){var t=n({},e.attributes);t.children=e.children;var r=e.nodeName.defaultProps;if(void 0!==r)for(var i in r)void 0===t[i]&&(t[i]=r[i]);return t}function l(e){var t=e.parentNode;t&&t.removeChild(e)}function d(e,t,n,i,s){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)r(n,null),r(i,e);else if("class"!==t||s)if("style"===t){if(i&&"string"!=typeof i&&"string"!=typeof n||(e.style.cssText=i||""),i&&"object"==typeof i){if("string"!=typeof n)for(var o in n)o in i||(e.style[o]="");for(var a in i)e.style[a]="number"==typeof i[a]&&!1===B.test(a)?i[a]+"px":i[a]}}else if("dangerouslySetInnerHTML"===t)i&&(e.innerHTML=i.__html||"");else if("o"==t[0]&&"n"==t[1]){var u=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),i?!n&&e.addEventListener(t,f,u):e.removeEventListener(t,f,u),(e._listeners||(e._listeners={}))[t]=i}else if("list"!==t&&"type"!==t&&!s&&t in e){try{e[t]=null==i?"":i}catch(t){}(null==i||!1===i)&&"spellcheck"!=t&&e.removeAttribute(t)}else{var c=s&&t!==(t=t.replace(/^xlink:?/,""));null==i||!1===i?c?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof i&&(c?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),i):e.setAttribute(t,i))}else e.className=i||""}function f(e){return this._listeners[e.type](M.event&&M.event(e)||e)}function h(){for(var e;e=G.shift();)M.afterMount&&M.afterMount(e),e.componentDidMount&&e.componentDidMount()}function p(e,t,n,r,i,s){j++||(X=null!=i&&void 0!==i.ownerSVGElement,W=null!=e&&!(U in e));var o=m(e,t,n,r,s);return i&&o.parentNode!==i&&i.appendChild(o),--j||(W=!1,!s&&h()),o}function m(e,t,n,r,i){var s=e,o=X;if((null==t||"boolean"==typeof t)&&(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||i)?e.nodeValue!=t&&(e.nodeValue=t):(s=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(s,e),y(e,!0))),s[U]=!0,s;var a=t.nodeName;if("function"==typeof a)return w(e,t,n,r);if(X="svg"===a||"foreignObject"!==a&&X,a+="",(!e||!u(e,a))&&(s=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}(a,X),e)){for(;e.firstChild;)s.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(s,e),y(e,!0)}var c=s.firstChild,l=s[U],d=t.children;if(null==l){l=s[U]={};for(var f=s.attributes,h=f.length;h--;)l[f[h].name]=f[h].value}return!W&&d&&1===d.length&&"string"==typeof d[0]&&null!=c&&void 0!==c.splitText&&null==c.nextSibling?c.nodeValue!=d[0]&&(c.nodeValue=d[0]):(d&&d.length||null!=c)&&g(s,d,n,r,W||null!=l.dangerouslySetInnerHTML),b(s,t.attributes,l),X=o,s}function g(e,t,n,r,i){var s,o,u,c,d,f=e.childNodes,h=[],p={},g=0,v=0,b=f.length,x=0,E=t?t.length:0;if(0!==b)for(var T=0;T<b;T++){var S=f[T],w=S[U],k=E&&w?S._component?S._component.__key:w.key:null;null==k?(w||(void 0===S.splitText?i:!i||S.nodeValue.trim()))&&(h[x++]=S):(g++,p[k]=S)}if(0!==E)for(var _=0;_<E;_++){d=null;var R=(c=t[_]).key;if(null!=R)g&&void 0!==p[R]&&(d=p[R],p[R]=void 0,g--);else if(v<x)for(s=v;s<x;s++)if(void 0!==h[s]&&a(o=h[s],c,i)){d=o,h[s]=void 0,s===x-1&&x--,s===v&&v++;break}d=m(d,c,n,r),u=f[_],d&&d!==e&&d!==u&&(null==u?e.appendChild(d):d===u.nextSibling?l(u):e.insertBefore(d,u))}if(g)for(var A in p)void 0!==p[A]&&y(p[A],!1);for(;v<=x;)void 0!==(d=h[x--])&&y(d,!1)}function y(e,t){var n=e._component;n?k(n):(null!=e[U]&&r(e[U].ref,null),(!1===t||null==e[U])&&l(e),v(e))}function v(e){for(e=e.lastChild;e;){var t=e.previousSibling;y(e,!0),e=t}}function b(e,t,n){for(var r in n)t&&null!=t[r]||null==n[r]||d(e,r,n[r],n[r]=void 0,X);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||d(e,r,n[r],n[r]=t[r],X)}function x(e,t,n){var r,i=H.length;for(e.prototype&&e.prototype.render?(r=new e(t,n),_.call(r,t,n)):((r=new _(t,n)).constructor=e,r.render=E);i--;)if(H[i].constructor===e)return r.nextBase=H[i].nextBase,H.splice(i,1),r;return r}function E(e,t,n){return this.constructor(e,n)}function T(e,t,n,i,o){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,i)),i&&i!==e.context&&(!e.prevContext&&(e.prevContext=e.context),e.context=i),!e.prevProps&&(e.prevProps=e.props),e.props=t,e._disable=!1,n!==D&&(n!==N&&!1===M.syncComponentUpdates&&e.base?s(e):S(e,N,o)),r(e.__ref,e))}function S(e,t,r,i){if(!e._disable){var s,o,a,u=e.props,l=e.state,d=e.context,f=e.prevProps||u,m=e.prevState||l,g=e.prevContext||d,v=e.base,b=e.nextBase,E=v||b,w=e._component,_=!1,R=g;if(e.constructor.getDerivedStateFromProps&&(l=n(n({},l),e.constructor.getDerivedStateFromProps(u,l)),e.state=l),v&&(e.props=f,e.state=m,e.context=g,t!==F&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(u,l,d)?_=!0:e.componentWillUpdate&&e.componentWillUpdate(u,l,d),e.props=u,e.state=l,e.context=d),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!_){s=e.render(u,l,d),e.getChildContext&&(d=n(n({},d),e.getChildContext())),v&&e.getSnapshotBeforeUpdate&&(R=e.getSnapshotBeforeUpdate(f,m));var A,I,P=s&&s.nodeName;if("function"==typeof P){var L=c(s);(o=w)&&o.constructor===P&&L.key==o.__key?T(o,L,N,d,!1):(A=o,e._component=o=x(P,L,d),o.nextBase=o.nextBase||b,o._parentComponent=e,T(o,L,D,d,!1),S(o,N,r,!0)),I=o.base}else a=E,(A=w)&&(a=e._component=null),(E||t===N)&&(a&&(a._component=null),I=p(a,s,d,r||!v,E&&E.parentNode,!0));if(E&&I!==E&&o!==w){var C=E.parentNode;C&&I!==C&&(C.replaceChild(I,E),!A&&(E._component=null,y(E,!1)))}if(A&&k(A),e.base=I,I&&!i){for(var O=e,U=e;U=U._parentComponent;)(O=U).base=I;I._component=O,I._componentConstructor=O.constructor}}for(!v||r?G.push(e):!_&&(e.componentDidUpdate&&e.componentDidUpdate(f,m,R),M.afterUpdate&&M.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);j||i||h()}}function w(e,t,n,r){for(var i=e&&e._component,s=i,o=e,a=i&&e._componentConstructor===t.nodeName,u=a,l=c(t);i&&!u&&(i=i._parentComponent);)u=i.constructor===t.nodeName;return i&&u&&(!r||i._component)?(T(i,l,O,n,r),e=i.base):(s&&!a&&(k(s),e=o=null),i=x(t.nodeName,l,n),e&&!i.nextBase&&(i.nextBase=e,o=null),T(i,l,N,n,r),e=i.base,o&&e!==o&&(o._component=null,y(o,!1))),e}function k(e){M.beforeUnmount&&M.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?k(n):t&&(null!=t[U]&&r(t[U].ref,null),e.nextBase=t,l(t),H.push(e),v(t)),r(e.__ref,null)}function _(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function R(e,t,n){return p(n,e,{},!1,t,!1)}function A(){return{}}var I=function(){},M={},P=[],L=[],C="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout,D=0,N=1,F=2,O=3,U="__preactattr_",B=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,V=[],G=[],j=0,X=!1,W=!1,H=[];n(_.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=n(n({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),s(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),S(this,F)},render:function(){}}),e.default={h:t,createElement:t,cloneElement:i,createRef:A,Component:_,render:R,rerender:o,options:M},e.h=t,e.createElement=t,e.cloneElement=i,e.createRef=A,e.Component=_,e.render=R,e.rerender=o,e.options=M,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.ControlsStyle=r.stylesheet({controls:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),controlsVisible:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"},{opacity:1}),buttons:{height:"100%",display:"flex",justifyContent:"space-between",marginBottom:"6px",alignItems:"center"},button:{width:"32px",height:"32px",padding:"7px",boxSizing:"border-box",cursor:"pointer"},left:{display:"flex",alignItems:"center",$nest:{"& .button":{marginRight:"8px"}}},right:{display:"flex",alignItems:"center",width:"70px",height:"100%",justifyContent:"space-between"}})},function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UByte=0]="UByte",e[e.Byte=1]="Byte",e[e.UShort=2]="UShort",e[e.Short=3]="Short",e[e.UInt=4]="UInt",e[e.Int=5]="Int",e[e.Float=6]="Float",e[e.Double=7]="Double",e[e.NString=8]="NString",e[e.String=9]="String"}(n=t.ReaderDataType||(t.ReaderDataType={})),t.Reader=class{constructor(e){this.data=new DataView(e),this.offset=0}length(){return this.data.byteLength}tell(){return this.offset}seek(e){this.offset=d(0,e)}skip(e){this.seek(this.tell()+e)}b(){const e=this.data.getInt8(this.offset);return this.skip(1),e}ub(){const e=this.data.getUint8(this.offset);return this.skip(1),e}s(e=!0){const t=this.data.getInt16(this.offset,e);return this.skip(2),t}us(e=!0){const t=this.data.getUint16(this.offset,e);return this.skip(2),t}i(e=!0){const t=this.data.getInt32(this.tell(),e);return this.skip(4),t}ui(e=!0){const t=this.data.getUint32(this.tell(),e);return this.skip(4),t}f(e=!0){const t=this.data.getFloat32(this.tell(),e);return this.skip(4),t}lf(e=!0){const t=this.data.getFloat64(this.tell(),e);return this.skip(8),t}str(){let e=this.ub(),t="";for(;0!==e;)t+=l(e),e=this.ub();return t}nstr(e){if(0>e)return"";let t="";for(;0<e;){e-=1;const n=this.ub();if(0===n)break;t+=l(n)}return 0!==e&&this.skip(e),t}arr(e,t){t.bind(this);const n=[];for(;0<e--;)n.push(t());return n}arrx(e,t,r=0){let i;switch(t){case n.UByte:i=new Uint8Array(this.data.buffer,this.tell(),e),this.skip(e);break;case n.Byte:i=new Int8Array(this.data.buffer,this.tell(),e),this.skip(e);break;case n.UShort:i=new Uint16Array(this.data.buffer,this.tell(),e),this.skip(2*e);break;case n.Short:i=new Int16Array(this.data.buffer,this.tell(),e),this.skip(2*e);break;case n.UInt:i=new Uint32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case n.Int:i=new Int32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case n.Float:i=new Float32Array(this.data.buffer,this.tell(),e),this.skip(4*e);break;case n.Double:i=new Float64Array(this.data.buffer,this.tell(),e),this.skip(8*e);break;case n.NString:for(i=[];0<e--;)i.push(i.nstr(r));break;case n.String:for(i=[];0<e--;)i.push(i.str())}return i}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.basename=function(e,t){return e.slice(e.lastIndexOf("/")+1).replace(t||"","")},t.extname=function(e){const t=e.lastIndexOf("/"),n=e.lastIndexOf(".");return t<n?e.slice(n):""},t.evt=function(e,t={}){return new CustomEvent(e,t||{})}},function(l,f,h){"use strict";function p(e){Fi=e}function m(e){return e*Ui}function g(e,t){return u(e-t)<=Ni*d(1,u(e),u(t))}function y(){var e=new Fi(4);return Fi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function v(e){var t=new Fi(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function x(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function E(e,t,n,r){var i=new Fi(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function T(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function S(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function w(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*s-i*r;return o?(o=1/o,e[0]=s*o,e[1]=-r*o,e[2]=-i*o,e[3]=n*o,e):null}function k(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function _(e){return e[0]*e[3]-e[2]*e[1]}function R(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*a+s*u,e[1]=i*a+o*u,e[2]=r*c+s*l,e[3]=i*c+o*l,e}function A(e,t,n){var r=t[0],i=t[1],s=t[2],u=t[3],c=a(n),l=o(n);return e[0]=r*l+s*c,e[1]=i*l+u*c,e[2]=r*-c+s*l,e[3]=i*-c+u*l,e}function I(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=n[0],u=n[1];return e[0]=r*a,e[1]=i*a,e[2]=s*u,e[3]=o*u,e}function M(e,t){var n=a(t),r=o(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e}function P(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function L(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function C(e){return i(s(e[0],2)+s(e[1],2)+s(e[2],2)+s(e[3],2))}function D(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]}function N(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function F(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function O(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function U(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=t[0],a=t[1],c=t[2],l=t[3];return u(n-o)<=Ni*d(1,u(n),u(o))&&u(r-a)<=Ni*d(1,u(r),u(a))&&u(i-c)<=Ni*d(1,u(i),u(c))&&u(s-l)<=Ni*d(1,u(s),u(l))}function B(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function V(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function G(){var e=new Fi(6);return Fi!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function j(e){var t=new Fi(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function X(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function W(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function H(e,t,n,r,i,s){var o=new Fi(6);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o[4]=i,o[5]=s,o}function q(e,t,n,r,i,s,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=o,e}function z(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=n*s-r*i;return u?(u=1/u,e[0]=s*u,e[1]=-r*u,e[2]=-i*u,e[3]=n*u,e[4]=(i*a-s*o)*u,e[5]=(r*o-n*a)*u,e):null}function Y(e){return e[0]*e[3]-e[1]*e[2]}function K(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],u=t[5],c=n[0],l=n[1],d=n[2],f=n[3],h=n[4],p=n[5];return e[0]=r*c+s*l,e[1]=i*c+o*l,e[2]=r*d+s*f,e[3]=i*d+o*f,e[4]=r*h+s*p+a,e[5]=i*h+o*p+u,e}function $(e,t,n){var r=t[0],i=t[1],s=t[2],u=t[3],c=t[4],l=t[5],d=a(n),f=o(n);return e[0]=r*f+s*d,e[1]=i*f+u*d,e[2]=r*-d+s*f,e[3]=i*-d+u*f,e[4]=c,e[5]=l,e}function Z(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],u=t[5],c=n[0],l=n[1];return e[0]=r*c,e[1]=i*c,e[2]=s*l,e[3]=o*l,e[4]=a,e[5]=u,e}function Q(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],u=t[5],c=n[0],l=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=r*c+s*l+a,e[5]=i*c+o*l+u,e}function J(e,t){var n=a(t),r=o(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function ee(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function te(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function ne(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function re(e){return i(s(e[0],2)+s(e[1],2)+s(e[2],2)+s(e[3],2)+s(e[4],2)+s(e[5],2)+1)}function ie(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function se(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function oe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function ae(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e}function ue(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function ce(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=t[0],l=t[1],f=t[2],h=t[3],p=t[4],m=t[5];return u(n-c)<=Ni*d(1,u(n),u(c))&&u(r-l)<=Ni*d(1,u(r),u(l))&&u(i-f)<=Ni*d(1,u(i),u(f))&&u(s-h)<=Ni*d(1,u(s),u(h))&&u(o-p)<=Ni*d(1,u(o),u(p))&&u(a-m)<=Ni*d(1,u(a),u(m))}function le(){var e=new Fi(9);return Fi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function de(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function fe(e){var t=new Fi(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function he(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function pe(e,t,n,r,i,s,o,a,u){var c=new Fi(9);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=i,c[5]=s,c[6]=o,c[7]=a,c[8]=u,c}function me(e,t,n,r,i,s,o,a,u,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=o,e[6]=a,e[7]=u,e[8]=c,e}function ge(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ye(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function ve(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],d=l*o-a*c,f=-l*s+a*u,h=c*s-o*u,p=n*d+r*f+i*h;return p?(p=1/p,e[0]=d*p,e[1]=(-l*r+i*c)*p,e[2]=(a*r-i*o)*p,e[3]=f*p,e[4]=(l*n-i*u)*p,e[5]=(-a*n+i*s)*p,e[6]=h*p,e[7]=(-c*n+r*u)*p,e[8]=(o*n-r*s)*p,e):null}function be(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8];return e[0]=o*l-a*c,e[1]=i*c-r*l,e[2]=r*a-i*o,e[3]=a*u-s*l,e[4]=n*l-i*u,e[5]=i*s-n*a,e[6]=s*c-o*u,e[7]=r*u-n*c,e[8]=n*o-r*s,e}function xe(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],u=e[7],c=e[8];return t*(c*s-o*u)+n*(-c*i+o*a)+r*(u*i-s*a)}function Ee(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=n[0],h=n[1],p=n[2],m=n[3],g=n[4],y=n[5],v=n[6],b=n[7],x=n[8];return e[0]=f*r+h*o+p*c,e[1]=f*i+h*a+p*l,e[2]=f*s+h*u+p*d,e[3]=m*r+g*o+y*c,e[4]=m*i+g*a+y*l,e[5]=m*s+g*u+y*d,e[6]=v*r+b*o+x*c,e[7]=v*i+b*a+x*l,e[8]=v*s+b*u+x*d,e}function Te(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=n[0],h=n[1];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=a,e[5]=u,e[6]=f*r+h*o+c,e[7]=f*i+h*a+l,e[8]=f*s+h*u+d,e}function Se(e,t,n){var r=t[0],i=t[1],s=t[2],u=t[3],c=t[4],l=t[5],d=t[6],f=t[7],h=t[8],p=a(n),m=o(n);return e[0]=m*r+p*u,e[1]=m*i+p*c,e[2]=m*s+p*l,e[3]=m*u-p*r,e[4]=m*c-p*i,e[5]=m*l-p*s,e[6]=d,e[7]=f,e[8]=h,e}function we(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ke(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function _e(e,t){var n=a(t),r=o(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Re(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Ae(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function Ie(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,a=r+r,u=i+i,c=n*o,l=r*o,d=r*a,f=i*o,h=i*a,p=i*u,m=s*o,g=s*a,y=s*u;return e[0]=1-d-p,e[3]=l-y,e[6]=f+g,e[1]=l+y,e[4]=1-c-p,e[7]=h-m,e[2]=f-g,e[5]=h+m,e[8]=1-c-d,e}function Me(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=n*a-r*o,b=n*u-i*o,x=n*c-s*o,E=r*u-i*a,T=r*c-s*a,S=i*c-s*u,w=l*m-d*p,k=l*g-f*p,_=l*y-h*p,R=d*g-f*m,A=d*y-h*m,I=f*y-h*g,M=v*I-b*A+x*R+E*_-T*k+S*w;return M?(M=1/M,e[0]=(a*I-u*A+c*R)*M,e[1]=(u*_-o*I-c*k)*M,e[2]=(o*A-a*_+c*w)*M,e[3]=(i*A-r*I-s*R)*M,e[4]=(n*I-i*_+s*k)*M,e[5]=(r*_-n*A-s*w)*M,e[6]=(m*S-g*T+y*E)*M,e[7]=(g*x-p*S-y*b)*M,e[8]=(p*T-m*x+y*v)*M,e):null}function Pe(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Le(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Ce(e){return i(s(e[0],2)+s(e[1],2)+s(e[2],2)+s(e[3],2)+s(e[4],2)+s(e[5],2)+s(e[6],2)+s(e[7],2)+s(e[8],2))}function De(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function Ne(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function Fe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function Oe(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function Ue(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Be(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],f=e[8],h=t[0],p=t[1],m=t[2],g=t[3],y=t[4],v=t[5],b=t[6],x=t[7],E=t[8];return u(n-h)<=Ni*d(1,u(n),u(h))&&u(r-p)<=Ni*d(1,u(r),u(p))&&u(i-m)<=Ni*d(1,u(i),u(m))&&u(s-g)<=Ni*d(1,u(s),u(g))&&u(o-y)<=Ni*d(1,u(o),u(y))&&u(a-v)<=Ni*d(1,u(a),u(v))&&u(c-b)<=Ni*d(1,u(c),u(b))&&u(l-x)<=Ni*d(1,u(l),u(x))&&u(f-E)<=Ni*d(1,u(f),u(E))}function Ve(){var e=new Fi(16);return Fi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ge(e){var t=new Fi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function je(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Xe(e,t,n,r,i,s,o,a,u,c,l,d,f,h,p,m){var g=new Fi(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=r,g[4]=i,g[5]=s,g[6]=o,g[7]=a,g[8]=u,g[9]=c,g[10]=l,g[11]=d,g[12]=f,g[13]=h,g[14]=p,g[15]=m,g}function We(e,t,n,r,i,s,o,a,u,c,l,d,f,h,p,m,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=o,e[6]=a,e[7]=u,e[8]=c,e[9]=l,e[10]=d,e[11]=f,e[12]=h,e[13]=p,e[14]=m,e[15]=g,e}function He(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qe(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ze(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],y=t[15],v=n*a-r*o,b=n*u-i*o,x=n*c-s*o,E=r*u-i*a,T=r*c-s*a,S=i*c-s*u,w=l*m-d*p,k=l*g-f*p,_=l*y-h*p,R=d*g-f*m,A=d*y-h*m,I=f*y-h*g,M=v*I-b*A+x*R+E*_-T*k+S*w;return M?(M=1/M,e[0]=(a*I-u*A+c*R)*M,e[1]=(i*A-r*I-s*R)*M,e[2]=(m*S-g*T+y*E)*M,e[3]=(f*T-d*S-h*E)*M,e[4]=(u*_-o*I-c*k)*M,e[5]=(n*I-i*_+s*k)*M,e[6]=(g*x-p*S-y*b)*M,e[7]=(l*S-f*x+h*b)*M,e[8]=(o*A-a*_+c*w)*M,e[9]=(r*_-n*A-s*w)*M,e[10]=(p*T-m*x+y*v)*M,e[11]=(d*x-l*T-h*v)*M,e[12]=(a*k-o*R-u*w)*M,e[13]=(n*R-r*k+i*w)*M,e[14]=(m*b-p*E-g*v)*M,e[15]=(l*E-d*b+f*v)*M,e):null}function Ye(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],a=t[5],u=t[6],c=t[7],l=t[8],d=t[9],f=t[10],h=t[11],p=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(f*y-h*g)-d*(u*y-c*g)+m*(u*h-c*f),e[1]=-(r*(f*y-h*g)-d*(i*y-s*g)+m*(i*h-s*f)),e[2]=r*(u*y-c*g)-a*(i*y-s*g)+m*(i*c-s*u),e[3]=-(r*(u*h-c*f)-a*(i*h-s*f)+d*(i*c-s*u)),e[4]=-(o*(f*y-h*g)-l*(u*y-c*g)+p*(u*h-c*f)),e[5]=n*(f*y-h*g)-l*(i*y-s*g)+p*(i*h-s*f),e[6]=-(n*(u*y-c*g)-o*(i*y-s*g)+p*(i*c-s*u)),e[7]=n*(u*h-c*f)-o*(i*h-s*f)+l*(i*c-s*u),e[8]=o*(d*y-h*m)-l*(a*y-c*m)+p*(a*h-c*d),e[9]=-(n*(d*y-h*m)-l*(r*y-s*m)+p*(r*h-s*d)),e[10]=n*(a*y-c*m)-o*(r*y-s*m)+p*(r*c-s*a),e[11]=-(n*(a*h-c*d)-o*(r*h-s*d)+l*(r*c-s*a)),e[12]=-(o*(d*g-f*m)-l*(a*g-u*m)+p*(a*f-u*d)),e[13]=n*(d*g-f*m)-l*(r*g-i*m)+p*(r*f-i*d),e[14]=-(n*(a*g-u*m)-o*(r*g-i*m)+p*(r*u-i*a)),e[15]=n*(a*f-u*d)-o*(r*f-i*d)+l*(r*u-i*a),e}function Ke(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],u=e[7],c=e[8],l=e[9],d=e[10],f=e[11],h=e[12],p=e[13],m=e[14],g=e[15];return(t*o-n*s)*(d*g-f*m)-(t*a-r*s)*(l*g-f*p)+(t*u-i*s)*(l*m-d*p)+(n*a-r*o)*(c*g-f*h)-(n*u-i*o)*(c*m-d*h)+(r*u-i*a)*(c*p-l*h)}function $e(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11],m=t[12],g=t[13],y=t[14],v=t[15],b=n[0],x=n[1],E=n[2],T=n[3];return e[0]=b*r+x*a+E*d+T*m,e[1]=b*i+x*u+E*f+T*g,e[2]=b*s+x*c+E*h+T*y,e[3]=b*o+x*l+E*p+T*v,b=n[4],x=n[5],E=n[6],T=n[7],e[4]=b*r+x*a+E*d+T*m,e[5]=b*i+x*u+E*f+T*g,e[6]=b*s+x*c+E*h+T*y,e[7]=b*o+x*l+E*p+T*v,b=n[8],x=n[9],E=n[10],T=n[11],e[8]=b*r+x*a+E*d+T*m,e[9]=b*i+x*u+E*f+T*g,e[10]=b*s+x*c+E*h+T*y,e[11]=b*o+x*l+E*p+T*v,b=n[12],x=n[13],E=n[14],T=n[15],e[12]=b*r+x*a+E*d+T*m,e[13]=b*i+x*u+E*f+T*g,e[14]=b*s+x*c+E*h+T*y,e[15]=b*o+x*l+E*p+T*v,e}function Ze(e,t,n){var r=n[0],i=n[1],s=n[2],o=void 0,a=void 0,u=void 0,c=void 0,l=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,y=void 0;return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*s+t[12],e[13]=t[1]*r+t[5]*i+t[9]*s+t[13],e[14]=t[2]*r+t[6]*i+t[10]*s+t[14],e[15]=t[3]*r+t[7]*i+t[11]*s+t[15]):(o=t[0],a=t[1],u=t[2],c=t[3],l=t[4],d=t[5],f=t[6],h=t[7],p=t[8],m=t[9],g=t[10],y=t[11],e[0]=o,e[1]=a,e[2]=u,e[3]=c,e[4]=l,e[5]=d,e[6]=f,e[7]=h,e[8]=p,e[9]=m,e[10]=g,e[11]=y,e[12]=o*r+l*i+p*s+t[12],e[13]=a*r+d*i+m*s+t[13],e[14]=u*r+f*i+g*s+t[14],e[15]=c*r+h*i+y*s+t[15]),e}function Qe(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Je(e,t,n,r){var s=r[0],u=r[1],c=r[2],l=i(s*s+u*u+c*c),d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,y=void 0,v=void 0,b=void 0,x=void 0,E=void 0,T=void 0,S=void 0,w=void 0,k=void 0,_=void 0,R=void 0,A=void 0,I=void 0,M=void 0,P=void 0,L=void 0,C=void 0,D=void 0;return l<Ni?null:(s*=l=1/l,u*=l,c*=l,d=a(n),h=1-(f=o(n)),p=t[0],m=t[1],g=t[2],y=t[3],v=t[4],b=t[5],x=t[6],E=t[7],T=t[8],S=t[9],w=t[10],k=t[11],_=s*s*h+f,R=u*s*h+c*d,A=c*s*h-u*d,I=s*u*h-c*d,M=u*u*h+f,P=c*u*h+s*d,L=s*c*h+u*d,C=u*c*h-s*d,D=c*c*h+f,e[0]=p*_+v*R+T*A,e[1]=m*_+b*R+S*A,e[2]=g*_+x*R+w*A,e[3]=y*_+E*R+k*A,e[4]=p*I+v*M+T*P,e[5]=m*I+b*M+S*P,e[6]=g*I+x*M+w*P,e[7]=y*I+E*M+k*P,e[8]=p*L+v*C+T*D,e[9]=m*L+b*C+S*D,e[10]=g*L+x*C+w*D,e[11]=y*L+E*C+k*D,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function et(e,t,n){var r=a(n),i=o(n),s=t[4],u=t[5],c=t[6],l=t[7],d=t[8],f=t[9],h=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+d*r,e[5]=u*i+f*r,e[6]=c*i+h*r,e[7]=l*i+p*r,e[8]=d*i-s*r,e[9]=f*i-u*r,e[10]=h*i-c*r,e[11]=p*i-l*r,e}function tt(e,t,n){var r=a(n),i=o(n),s=t[0],u=t[1],c=t[2],l=t[3],d=t[8],f=t[9],h=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-d*r,e[1]=u*i-f*r,e[2]=c*i-h*r,e[3]=l*i-p*r,e[8]=s*r+d*i,e[9]=u*r+f*i,e[10]=c*r+h*i,e[11]=l*r+p*i,e}function nt(e,t,n){var r=a(n),i=o(n),s=t[0],u=t[1],c=t[2],l=t[3],d=t[4],f=t[5],h=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+d*r,e[1]=u*i+f*r,e[2]=c*i+h*r,e[3]=l*i+p*r,e[4]=d*i-s*r,e[5]=f*i-u*r,e[6]=h*i-c*r,e[7]=p*i-l*r,e}function rt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function it(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function st(e,t,n){var r=n[0],s=n[1],u=n[2],c=i(r*r+s*s+u*u),l=void 0,d=void 0,f=void 0;return c<Ni?null:(r*=c=1/c,s*=c,u*=c,l=a(t),f=1-(d=o(t)),e[0]=r*r*f+d,e[1]=s*r*f+u*l,e[2]=u*r*f-s*l,e[3]=0,e[4]=r*s*f-u*l,e[5]=s*s*f+d,e[6]=u*s*f+r*l,e[7]=0,e[8]=r*u*f+s*l,e[9]=s*u*f-r*l,e[10]=u*u*f+d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ot(e,t){var n=a(t),r=o(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function at(e,t){var n=a(t),r=o(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ut(e,t){var n=a(t),r=o(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ct(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=r+r,u=i+i,c=s+s,l=r*a,d=r*u,f=r*c,h=i*u,p=i*c,m=s*c,g=o*a,y=o*u,v=o*c;return e[0]=1-(h+m),e[1]=d+v,e[2]=f-y,e[3]=0,e[4]=d-v,e[5]=1-(l+m),e[6]=p+g,e[7]=0,e[8]=f+y,e[9]=p-g,e[10]=1-(l+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function lt(e,t){var n=new Fi(3),r=-t[0],i=-t[1],s=-t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=r*r+i*i+s*s+o*o;return 0<d?(n[0]=2*(a*o+l*r+u*s-c*i)/d,n[1]=2*(u*o+l*i+c*r-a*s)/d,n[2]=2*(c*o+l*s+a*i-u*r)/d):(n[0]=2*(a*o+l*r+u*s-c*i),n[1]=2*(u*o+l*i+c*r-a*s),n[2]=2*(c*o+l*s+a*i-u*r)),ct(e,t,n),e}function dt(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function ft(e,t){var n=t[0],r=t[1],s=t[2],o=t[4],a=t[5],u=t[6],c=t[8],l=t[9],d=t[10];return e[0]=i(n*n+r*r+s*s),e[1]=i(o*o+a*a+u*u),e[2]=i(c*c+l*l+d*d),e}function ht(e,t){var n=t[0]+t[5]+t[10],r=0;return 0<n?(r=2*i(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*i(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*i(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*i(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function pt(e,t,n,r){var i=t[0],s=t[1],o=t[2],a=t[3],u=i+i,c=s+s,l=o+o,d=i*u,f=i*c,h=i*l,p=s*c,m=s*l,g=o*l,y=a*u,v=a*c,b=a*l,x=r[0],E=r[1],T=r[2];return e[0]=(1-(p+g))*x,e[1]=(f+b)*x,e[2]=(h-v)*x,e[3]=0,e[4]=(f-b)*E,e[5]=(1-(d+g))*E,e[6]=(m+y)*E,e[7]=0,e[8]=(h+v)*T,e[9]=(m-y)*T,e[10]=(1-(d+p))*T,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function mt(e,t,n,r,i){var s=t[0],o=t[1],a=t[2],u=t[3],c=s+s,l=o+o,d=a+a,f=s*c,h=s*l,p=s*d,m=o*l,g=o*d,y=a*d,v=u*c,b=u*l,x=u*d,E=r[0],T=r[1],S=r[2],w=i[0],k=i[1],_=i[2],R=(1-(m+y))*E,A=(h+x)*E,I=(p-b)*E,M=(h-x)*T,P=(1-(f+y))*T,L=(g+v)*T,C=(p+b)*S,D=(g-v)*S,N=(1-(f+m))*S;return e[0]=R,e[1]=A,e[2]=I,e[3]=0,e[4]=M,e[5]=P,e[6]=L,e[7]=0,e[8]=C,e[9]=D,e[10]=N,e[11]=0,e[12]=n[0]+w-(R*w+M*k+C*_),e[13]=n[1]+k-(A*w+P*k+D*_),e[14]=n[2]+_-(I*w+L*k+N*_),e[15]=1,e}function gt(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n+n,a=r+r,u=i+i,c=n*o,l=r*o,d=r*a,f=i*o,h=i*a,p=i*u,m=s*o,g=s*a,y=s*u;return e[0]=1-d-p,e[1]=l+y,e[2]=f-g,e[3]=0,e[4]=l-y,e[5]=1-c-p,e[6]=h+m,e[7]=0,e[8]=f+g,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yt(e,t,n,r,i,s,o){var a=1/(n-t),u=1/(i-r),c=1/(s-o);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*u,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(i+r)*u,e[10]=(o+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*c,e[15]=0,e}function vt(e,t,n,r,i){var s,o=1/wi(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(s=1/(r-i),e[10]=(i+r)*s,e[14]=2*i*r*s):(e[10]=-1,e[14]=-2*r),e}function bt(e,t,n,r){var i=wi(t.upDegrees*c/180),s=wi(t.downDegrees*c/180),o=wi(t.leftDegrees*c/180),a=wi(t.rightDegrees*c/180),u=2/(o+a),l=2/(i+s);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-a)*u*.5,e[9]=(i-s)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function xt(e,t,n,r,i,s,o){var a=1/(t-n),u=1/(r-i),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*u,e[14]=(o+s)*c,e[15]=1,e}function Et(e,t,n,r){var s=void 0,o=void 0,a=void 0,c=void 0,l=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=t[0],y=t[1],v=t[2],b=r[0],x=r[1],E=r[2],T=n[0],S=n[1],w=n[2];return u(g-T)<Ni&&u(y-S)<Ni&&u(v-w)<Ni?He(e):(m=1/i((f=g-T)*f+(h=y-S)*h+(p=v-w)*p),(m=i((s=x*(p*=m)-E*(h*=m))*s+(o=E*(f*=m)-b*p)*o+(a=b*h-x*f)*a))?(s*=m=1/m,o*=m,a*=m):(s=0,o=0,a=0),(m=i((c=h*a-p*o)*c+(l=p*s-f*a)*l+(d=f*o-h*s)*d))?(c*=m=1/m,l*=m,d*=m):(c=0,l=0,d=0),e[0]=s,e[1]=c,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=h,e[7]=0,e[8]=a,e[9]=d,e[10]=p,e[11]=0,e[12]=-(s*g+o*y+a*v),e[13]=-(c*g+l*y+d*v),e[14]=-(f*g+h*y+p*v),e[15]=1,e)}function Tt(e,t,n,r){var s=t[0],o=t[1],a=t[2],u=r[0],c=r[1],l=r[2],d=s-n[0],f=o-n[1],h=a-n[2],p=d*d+f*f+h*h;0<p&&(d*=p=1/i(p),f*=p,h*=p);var m=c*h-l*f,g=l*d-u*h,y=u*f-c*d;return 0<(p=m*m+g*g+y*y)&&(m*=p=1/i(p),g*=p,y*=p),e[0]=m,e[1]=g,e[2]=y,e[3]=0,e[4]=f*y-h*g,e[5]=h*m-d*y,e[6]=d*g-f*m,e[7]=0,e[8]=d,e[9]=f,e[10]=h,e[11]=0,e[12]=s,e[13]=o,e[14]=a,e[15]=1,e}function St(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function wt(e){return i(s(e[0],2)+s(e[1],2)+s(e[2],2)+s(e[3],2)+s(e[4],2)+s(e[5],2)+s(e[6],2)+s(e[7],2)+s(e[8],2)+s(e[9],2)+s(e[10],2)+s(e[11],2)+s(e[12],2)+s(e[13],2)+s(e[14],2)+s(e[15],2))}function kt(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function _t(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Rt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function At(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function It(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Mt(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],f=e[8],h=e[9],p=e[10],m=e[11],g=e[12],y=e[13],v=e[14],b=e[15],x=t[0],E=t[1],T=t[2],S=t[3],w=t[4],k=t[5],_=t[6],R=t[7],A=t[8],I=t[9],M=t[10],P=t[11],L=t[12],C=t[13],D=t[14],N=t[15];return u(n-x)<=Ni*d(1,u(n),u(x))&&u(r-E)<=Ni*d(1,u(r),u(E))&&u(i-T)<=Ni*d(1,u(i),u(T))&&u(s-S)<=Ni*d(1,u(s),u(S))&&u(o-w)<=Ni*d(1,u(o),u(w))&&u(a-k)<=Ni*d(1,u(a),u(k))&&u(c-_)<=Ni*d(1,u(c),u(_))&&u(l-R)<=Ni*d(1,u(l),u(R))&&u(f-A)<=Ni*d(1,u(f),u(A))&&u(h-I)<=Ni*d(1,u(h),u(I))&&u(p-M)<=Ni*d(1,u(p),u(M))&&u(m-P)<=Ni*d(1,u(m),u(P))&&u(g-L)<=Ni*d(1,u(g),u(L))&&u(y-C)<=Ni*d(1,u(y),u(C))&&u(v-D)<=Ni*d(1,u(v),u(D))&&u(b-N)<=Ni*d(1,u(b),u(N))}function Pt(){var e=new Fi(3);return Fi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Lt(e){var t=new Fi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ct(e){var t=e[0],n=e[1],r=e[2];return i(t*t+n*n+r*r)}function Dt(e,t,n){var r=new Fi(3);return r[0]=e,r[1]=t,r[2]=n,r}function Nt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Ft(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function Ot(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function Ut(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Bt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function Vt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function Gt(e,t){return e[0]=r(t[0]),e[1]=r(t[1]),e[2]=r(t[2]),e}function jt(e,t){return e[0]=n(t[0]),e[1]=n(t[1]),e[2]=n(t[2]),e}function Xt(e,n,r){return e[0]=t(n[0],r[0]),e[1]=t(n[1],r[1]),e[2]=t(n[2],r[2]),e}function Wt(e,t,n){return e[0]=d(t[0],n[0]),e[1]=d(t[1],n[1]),e[2]=d(t[2],n[2]),e}function Ht(t,n){return t[0]=e(n[0]),t[1]=e(n[1]),t[2]=e(n[2]),t}function qt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function zt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Yt(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i(n*n+r*r+s*s)}function Kt(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function $t(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Zt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Qt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Jt(e,t){var n=t[0],r=t[1],s=t[2],o=n*n+r*r+s*s;return 0<o&&(o=1/i(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function en(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function tn(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],a=n[1],u=n[2];return e[0]=i*u-s*a,e[1]=s*o-r*u,e[2]=r*a-i*o,e}function nn(e,t,n,r){var i=t[0],s=t[1],o=t[2];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e}function rn(e,t,n,r,i,s){var o=s*s,a=o*(2*s-3)+1,u=o*(s-2)+s,c=o*(s-1),l=o*(3-2*s);return e[0]=t[0]*a+n[0]*u+r[0]*c+i[0]*l,e[1]=t[1]*a+n[1]*u+r[1]*c+i[1]*l,e[2]=t[2]*a+n[2]*u+r[2]*c+i[2]*l,e}function sn(e,t,n,r,i,s){var o=1-s,a=o*o,u=s*s,c=a*o,l=3*s*a,d=3*u*o,f=u*s;return e[0]=t[0]*c+n[0]*l+r[0]*d+i[0]*f,e[1]=t[1]*c+n[1]*l+r[1]*d+i[1]*f,e[2]=t[2]*c+n[2]*l+r[2]*d+i[2]*f,e}function on(e,t){t=t||1;var n=2*Oi()*c,r=2*Oi()-1,s=i(1-r*r)*t;return e[0]=o(n)*s,e[1]=a(n)*s,e[2]=r*t,e}function an(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,e[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,e[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,e}function un(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e}function cn(e,t,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=t[0],u=t[1],c=t[2],l=i*c-s*u,d=s*a-r*c,f=r*u-i*a,h=i*f-s*d,p=s*l-r*f,m=r*d-i*l,g=2*o;return l*=g,d*=g,f*=g,h*=2,p*=2,m*=2,e[0]=a+l+h,e[1]=u+d+p,e[2]=c+f+m,e}function ln(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0],s[1]=i[1]*o(r)-i[2]*a(r),s[2]=i[1]*a(r)+i[2]*o(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function dn(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[2]*a(r)+i[0]*o(r),s[1]=i[1],s[2]=i[2]*o(r)-i[0]*a(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function fn(e,t,n,r){var i=[],s=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0]*o(r)-i[1]*a(r),s[1]=i[0]*a(r)+i[1]*o(r),s[2]=i[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2],e}function hn(e,t){var n=Dt(e[0],e[1],e[2]),r=Dt(t[0],t[1],t[2]);Jt(n,n),Jt(r,r);var i=en(n,r);return 1<i?0:-1>i?c:Si(i)}function pn(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function mn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function gn(e,t){var n=e[0],r=e[1],i=e[2],s=t[0],o=t[1],a=t[2];return u(n-s)<=Ni*d(1,u(n),u(s))&&u(r-o)<=Ni*d(1,u(r),u(o))&&u(i-a)<=Ni*d(1,u(i),u(a))}function yn(){var e=new Fi(4);return Fi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function vn(e){var t=new Fi(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function bn(e,t,n,r){var i=new Fi(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function xn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function En(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function Tn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Sn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function wn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function kn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function _n(e,t){return e[0]=r(t[0]),e[1]=r(t[1]),e[2]=r(t[2]),e[3]=r(t[3]),e}function Rn(e,t){return e[0]=n(t[0]),e[1]=n(t[1]),e[2]=n(t[2]),e[3]=n(t[3]),e}function An(e,n,r){return e[0]=t(n[0],r[0]),e[1]=t(n[1],r[1]),e[2]=t(n[2],r[2]),e[3]=t(n[3],r[3]),e}function In(e,t,n){return e[0]=d(t[0],n[0]),e[1]=d(t[1],n[1]),e[2]=d(t[2],n[2]),e[3]=d(t[3],n[3]),e}function Mn(t,n){return t[0]=e(n[0]),t[1]=e(n[1]),t[2]=e(n[2]),t[3]=e(n[3]),t}function Pn(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Ln(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function Cn(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],o=t[3]-e[3];return i(n*n+r*r+s*s+o*o)}function Dn(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],s=t[3]-e[3];return n*n+r*r+i*i+s*s}function Nn(e){var t=e[0],n=e[1],r=e[2],s=e[3];return i(t*t+n*n+r*r+s*s)}function Fn(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function On(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function Un(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function Bn(e,t){var n=t[0],r=t[1],s=t[2],o=t[3],a=n*n+r*r+s*s+o*o;return 0<a&&(a=1/i(a),e[0]=n*a,e[1]=r*a,e[2]=s*a,e[3]=o*a),e}function Vn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Gn(e,t,n,r){var i=t[0],s=t[1],o=t[2],a=t[3];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e[2]=o+r*(n[2]-o),e[3]=a+r*(n[3]-a),e}function jn(e,t){var n,r,s,o,a,u;t=t||1;do{a=(n=2*Oi()-1)*n+(r=2*Oi()-1)*r}while(1<=a);do{u=(s=2*Oi()-1)*s+(o=2*Oi()-1)*o}while(1<=u);var c=i((1-a)/u);return e[0]=t*n,e[1]=t*r,e[2]=t*s*c,e[3]=t*o*c,e}function Xn(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,e}function Wn(e,t,n){var r=t[0],i=t[1],s=t[2],o=n[0],a=n[1],u=n[2],c=n[3],l=c*r+a*s-u*i,d=c*i+u*r-o*s,f=c*s+o*i-a*r,h=-o*r-a*i-u*s;return e[0]=l*c+h*-o+d*-u-f*-a,e[1]=d*c+h*-a+f*-o-l*-u,e[2]=f*c+h*-u+l*-a-d*-o,e[3]=t[3],e}function Hn(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function qn(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function zn(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=t[0],a=t[1],c=t[2],l=t[3];return u(n-o)<=Ni*d(1,u(n),u(o))&&u(r-a)<=Ni*d(1,u(r),u(a))&&u(i-c)<=Ni*d(1,u(i),u(c))&&u(s-l)<=Ni*d(1,u(s),u(l))}function Yn(){var e=new Fi(4);return Fi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Kn(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function $n(e,t,n){var r=a(n*=.5);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=o(n),e}function Zn(e,t){var n=2*Si(t[3]),r=a(n/2);return r>Ni?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Qn(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+o*a+i*c-s*u,e[1]=i*l+o*u+s*a-r*c,e[2]=s*l+o*c+r*u-i*a,e[3]=o*l-r*a-i*u-s*c,e}function Jn(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],u=t[3],c=a(n),l=o(n);return e[0]=r*l+u*c,e[1]=i*l+s*c,e[2]=s*l-i*c,e[3]=u*l-r*c,e}function er(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],u=t[3],c=a(n),l=o(n);return e[0]=r*l-s*c,e[1]=i*l+u*c,e[2]=s*l+r*c,e[3]=u*l-i*c,e}function tr(e,t,n){n*=.5;var r=t[0],i=t[1],s=t[2],u=t[3],c=a(n),l=o(n);return e[0]=r*l+i*c,e[1]=i*l-r*c,e[2]=s*l+u*c,e[3]=u*l-s*c,e}function nr(e,t){var n=t[0],r=t[1],s=t[2];return e[0]=n,e[1]=r,e[2]=s,e[3]=i(u(1-n*n-r*r-s*s)),e}function rr(e,t,n,r){var i=t[0],s=t[1],o=t[2],u=t[3],c=n[0],l=n[1],d=n[2],f=n[3],h=void 0,p=void 0,m=void 0,g=void 0,y=void 0;return 0>(p=i*c+s*l+o*d+u*f)&&(p=-p,c=-c,l=-l,d=-d,f=-f),1-p>Ni?(h=Si(p),m=a(h),g=a((1-r)*h)/m,y=a(r*h)/m):(g=1-r,y=r),e[0]=g*i+y*c,e[1]=g*s+y*l,e[2]=g*o+y*d,e[3]=g*u+y*f,e}function ir(e){var t=Oi(),n=Oi(),r=Oi(),s=i(1-t),u=i(t);return e[0]=s*a(2*c*n),e[1]=s*o(2*c*n),e[2]=u*a(2*c*r),e[3]=u*o(2*c*r),e}function sr(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return e[0]=-n*a,e[1]=-r*a,e[2]=-i*a,e[3]=s*a,e}function or(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function ar(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(0<n)r=i(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);var o=(s+1)%3,a=(s+2)%3;r=i(t[3*s+s]-t[3*o+o]-t[3*a+a]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*o+a]-t[3*a+o])*r,e[o]=(t[3*o+s]+t[3*s+o])*r,e[a]=(t[3*a+s]+t[3*s+a])*r}return e}function ur(e,t,n,r){var i=.5*c/180;n*=i,r*=i;var s=a(t*=i),u=o(t),l=a(n),d=o(n),f=a(r),h=o(r);return e[0]=s*d*h-u*l*f,e[1]=u*l*h+s*d*f,e[2]=u*d*f-s*l*h,e[3]=u*d*h+s*l*f,e}function cr(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function lr(){var e=new Fi(8);return Fi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function dr(e){var t=new Fi(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function fr(e,t,n,r,i,s,o,a){var u=new Fi(8);return u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=i,u[5]=s,u[6]=o,u[7]=a,u}function hr(e,t,n,r,i,s,o){var a=new Fi(8);a[0]=e,a[1]=t,a[2]=n,a[3]=r;var u=.5*i,c=.5*s,l=.5*o;return a[4]=u*r+c*n-l*t,a[5]=c*r+l*e-u*n,a[6]=l*r+u*t-c*e,a[7]=-u*e-c*t-l*n,a}function pr(e,t,n){var r=.5*n[0],i=.5*n[1],s=.5*n[2],o=t[0],a=t[1],u=t[2],c=t[3];return e[0]=o,e[1]=a,e[2]=u,e[3]=c,e[4]=r*c+i*u-s*a,e[5]=i*c+s*o-r*u,e[6]=s*c+r*a-i*o,e[7]=-r*o-i*a-s*u,e}function mr(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e}function gr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function yr(e,t){var n=Yn();ht(n,t);var r=new Fi(3);return dt(r,t),pr(e,n,r),e}function vr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function br(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function xr(e,t,n,r,i,s,o,a,u){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=o,e[6]=a,e[7]=u,e}function Er(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}function Tr(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Sr(e,t){var n=t[4],r=t[5],i=t[6],s=t[7],o=-t[0],a=-t[1],u=-t[2],c=t[3];return e[0]=2*(n*c+s*o+r*u-i*a),e[1]=2*(r*c+s*a+i*o-n*u),e[2]=2*(i*c+s*u+n*a-r*o),e}function wr(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=.5*n[0],u=.5*n[1],c=.5*n[2],l=t[4],d=t[5],f=t[6],h=t[7];return e[0]=r,e[1]=i,e[2]=s,e[3]=o,e[4]=o*a+i*c-s*u+l,e[5]=o*u+s*a-r*c+d,e[6]=o*c+r*u-i*a+f,e[7]=-r*a-i*u-s*c+h,e}function kr(e,t,n){var r=-t[0],i=-t[1],s=-t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=a*o+l*r+u*s-c*i,f=u*o+l*i+c*r-a*s,h=c*o+l*s+a*i-u*r,p=l*o-a*r-u*i-c*s;return Jn(e,t,n),r=e[0],i=e[1],s=e[2],o=e[3],e[4]=d*o+p*r+f*s-h*i,e[5]=f*o+p*i+h*r-d*s,e[6]=h*o+p*s+d*i-f*r,e[7]=p*o-d*r-f*i-h*s,e}function _r(e,t,n){var r=-t[0],i=-t[1],s=-t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=a*o+l*r+u*s-c*i,f=u*o+l*i+c*r-a*s,h=c*o+l*s+a*i-u*r,p=l*o-a*r-u*i-c*s;return er(e,t,n),r=e[0],i=e[1],s=e[2],o=e[3],e[4]=d*o+p*r+f*s-h*i,e[5]=f*o+p*i+h*r-d*s,e[6]=h*o+p*s+d*i-f*r,e[7]=p*o-d*r-f*i-h*s,e}function Rr(e,t,n){var r=-t[0],i=-t[1],s=-t[2],o=t[3],a=t[4],u=t[5],c=t[6],l=t[7],d=a*o+l*r+u*s-c*i,f=u*o+l*i+c*r-a*s,h=c*o+l*s+a*i-u*r,p=l*o-a*r-u*i-c*s;return tr(e,t,n),r=e[0],i=e[1],s=e[2],o=e[3],e[4]=d*o+p*r+f*s-h*i,e[5]=f*o+p*i+h*r-d*s,e[6]=h*o+p*s+d*i-f*r,e[7]=p*o-d*r-f*i-h*s,e}function Ar(e,t,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=t[0],u=t[1],c=t[2],l=t[3];return e[0]=a*o+l*r+u*s-c*i,e[1]=u*o+l*i+c*r-a*s,e[2]=c*o+l*s+a*i-u*r,e[3]=l*o-a*r-u*i-c*s,a=t[4],u=t[5],c=t[6],l=t[7],e[4]=a*o+l*r+u*s-c*i,e[5]=u*o+l*i+c*r-a*s,e[6]=c*o+l*s+a*i-u*r,e[7]=l*o-a*r-u*i-c*s,e}function Ir(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=n[0],u=n[1],c=n[2],l=n[3];return e[0]=r*l+o*a+i*c-s*u,e[1]=i*l+o*u+s*a-r*c,e[2]=s*l+o*c+r*u-i*a,e[3]=o*l-r*a-i*u-s*c,a=n[4],u=n[5],c=n[6],l=n[7],e[4]=r*l+o*a+i*c-s*u,e[5]=i*l+o*u+s*a-r*c,e[6]=s*l+o*c+r*u-i*a,e[7]=o*l-r*a-i*u-s*c,e}function Mr(e,t,n,r){if(u(r)<Ni)return vr(e,t);var s=i(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),c=a(r*=.5),l=c*n[0]/s,d=c*n[1]/s,f=c*n[2]/s,h=o(r),p=t[0],m=t[1],g=t[2],y=t[3];e[0]=p*h+y*l+m*f-g*d,e[1]=m*h+y*d+g*l-p*f,e[2]=g*h+y*f+p*d-m*l,e[3]=y*h-p*l-m*d-g*f;var v=t[4],b=t[5],x=t[6],E=t[7];return e[4]=v*h+E*l+b*f-x*d,e[5]=b*h+E*d+x*l-v*f,e[6]=x*h+E*f+v*d-b*l,e[7]=E*h-v*l-b*d-x*f,e}function Pr(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function Lr(e,t,n){var r=t[0],i=t[1],s=t[2],o=t[3],a=n[4],u=n[5],c=n[6],l=n[7],d=t[4],f=t[5],h=t[6],p=t[7],m=n[0],g=n[1],y=n[2],v=n[3];return e[0]=r*v+o*m+i*y-s*g,e[1]=i*v+o*g+s*m-r*y,e[2]=s*v+o*y+r*g-i*m,e[3]=o*v-r*m-i*g-s*y,e[4]=r*l+o*a+i*c-s*u+d*v+p*m+f*y-h*g,e[5]=i*l+o*u+s*a-r*c+f*v+p*g+h*m-d*y,e[6]=s*l+o*c+r*u-i*a+h*v+p*y+d*g-f*m,e[7]=o*l-r*a-i*u-s*c+p*v-d*m-f*g-h*y,e}function Cr(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}function Dr(e,t,n,r){var i=1-r;return 0>Ps(t,n)&&(r=-r),e[0]=t[0]*i+n[0]*r,e[1]=t[1]*i+n[1]*r,e[2]=t[2]*i+n[2]*r,e[3]=t[3]*i+n[3]*r,e[4]=t[4]*i+n[4]*r,e[5]=t[5]*i+n[5]*r,e[6]=t[6]*i+n[6]*r,e[7]=t[7]*i+n[7]*r,e}function Nr(e,t){var n=Ds(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function Fr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}function Or(e,t){var n=Ds(t);if(0<n){n=i(n);var r=t[0]/n,s=t[1]/n,o=t[2]/n,a=t[3]/n,u=t[4],c=t[5],l=t[6],d=t[7],f=r*u+s*c+o*l+a*d;e[0]=r,e[1]=s,e[2]=o,e[3]=a,e[4]=(u-r*f)/n,e[5]=(c-s*f)/n,e[6]=(l-o*f)/n,e[7]=(d-a*f)/n}return e}function Ur(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function Br(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function Vr(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],l=e[7],f=t[0],h=t[1],p=t[2],m=t[3],g=t[4],y=t[5],v=t[6],b=t[7];return u(n-f)<=Ni*d(1,u(n),u(f))&&u(r-h)<=Ni*d(1,u(r),u(h))&&u(i-p)<=Ni*d(1,u(i),u(p))&&u(s-m)<=Ni*d(1,u(s),u(m))&&u(o-g)<=Ni*d(1,u(o),u(g))&&u(a-y)<=Ni*d(1,u(a),u(y))&&u(c-v)<=Ni*d(1,u(c),u(v))&&u(l-b)<=Ni*d(1,u(l),u(b))}function Gr(){var e=new Fi(2);return Fi!=Float32Array&&(e[0]=0,e[1]=0),e}function jr(e){var t=new Fi(2);return t[0]=e[0],t[1]=e[1],t}function Xr(e,t){var n=new Fi(2);return n[0]=e,n[1]=t,n}function Wr(e,t){return e[0]=t[0],e[1]=t[1],e}function Hr(e,t,n){return e[0]=t,e[1]=n,e}function qr(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function zr(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Yr(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function Kr(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function $r(e,t){return e[0]=r(t[0]),e[1]=r(t[1]),e}function Zr(e,t){return e[0]=n(t[0]),e[1]=n(t[1]),e}function Qr(e,n,r){return e[0]=t(n[0],r[0]),e[1]=t(n[1],r[1]),e}function Jr(e,t,n){return e[0]=d(t[0],n[0]),e[1]=d(t[1],n[1]),e}function ei(t,n){return t[0]=e(n[0]),t[1]=e(n[1]),t}function ti(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function ni(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function ri(e,t){var n=t[0]-e[0],r=t[1]-e[1];return i(n*n+r*r)}function ii(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function si(e){var t=e[0],n=e[1];return i(t*t+n*n)}function oi(e){var t=e[0],n=e[1];return t*t+n*n}function ai(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ui(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function ci(e,t){var n=t[0],r=t[1],s=n*n+r*r;return 0<s&&(s=1/i(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function li(e,t){return e[0]*t[0]+e[1]*t[1]}function di(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function fi(e,t,n,r){var i=t[0],s=t[1];return e[0]=i+r*(n[0]-i),e[1]=s+r*(n[1]-s),e}function hi(e,t){t=t||1;var n=2*Oi()*c;return e[0]=o(n)*t,e[1]=a(n)*t,e}function pi(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e}function mi(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e}function gi(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}function yi(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}function vi(e,t,n,r){var i=t[0]-n[0],s=t[1]-n[1],u=a(r),c=o(r);return e[0]=i*c-s*u+n[0],e[1]=i*u+s*c+n[1],e}function bi(e,t){var n=e[0],r=e[1],s=t[0],o=t[1],a=n*n+r*r;0<a&&(a=1/i(a));var u=s*s+o*o;0<u&&(u=1/i(u));var l=(n*s+r*o)*a*u;return 1<l?0:-1>l?c:Si(l)}function xi(e){return"vec2("+e[0]+", "+e[1]+")"}function Ei(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ti(e,t){var n=e[0],r=e[1],i=t[0],s=t[1];return u(n-i)<=Ni*d(1,u(n),u(i))&&u(r-s)<=Ni*d(1,u(r),u(s))}var Si=Math.acos,wi=Math.tan;h.r(f);var ki={};h.r(ki),h.d(ki,"EPSILON",function(){return Ni}),h.d(ki,"ARRAY_TYPE",function(){return Fi}),h.d(ki,"RANDOM",function(){return Oi}),h.d(ki,"setMatrixArrayType",function(){return p}),h.d(ki,"toRadian",function(){return m}),h.d(ki,"equals",function(){return g});var _i={};h.r(_i),h.d(_i,"create",function(){return y}),h.d(_i,"clone",function(){return v}),h.d(_i,"copy",function(){return b}),h.d(_i,"identity",function(){return x}),h.d(_i,"fromValues",function(){return E}),h.d(_i,"set",function(){return T}),h.d(_i,"transpose",function(){return S}),h.d(_i,"invert",function(){return w}),h.d(_i,"adjoint",function(){return k}),h.d(_i,"determinant",function(){return _}),h.d(_i,"multiply",function(){return R}),h.d(_i,"rotate",function(){return A}),h.d(_i,"scale",function(){return I}),h.d(_i,"fromRotation",function(){return M}),h.d(_i,"fromScaling",function(){return P}),h.d(_i,"str",function(){return L}),h.d(_i,"frob",function(){return C}),h.d(_i,"LDU",function(){return D}),h.d(_i,"add",function(){return N}),h.d(_i,"subtract",function(){return F}),h.d(_i,"exactEquals",function(){return O}),h.d(_i,"equals",function(){return U}),h.d(_i,"multiplyScalar",function(){return B}),h.d(_i,"multiplyScalarAndAdd",function(){return V}),h.d(_i,"mul",function(){return Bi}),h.d(_i,"sub",function(){return Vi});var Ri={};h.r(Ri),h.d(Ri,"create",function(){return G}),h.d(Ri,"clone",function(){return j}),h.d(Ri,"copy",function(){return X}),h.d(Ri,"identity",function(){return W}),h.d(Ri,"fromValues",function(){return H}),h.d(Ri,"set",function(){return q}),h.d(Ri,"invert",function(){return z}),h.d(Ri,"determinant",function(){return Y}),h.d(Ri,"multiply",function(){return K}),h.d(Ri,"rotate",function(){return $}),h.d(Ri,"scale",function(){return Z}),h.d(Ri,"translate",function(){return Q}),h.d(Ri,"fromRotation",function(){return J}),h.d(Ri,"fromScaling",function(){return ee}),h.d(Ri,"fromTranslation",function(){return te}),h.d(Ri,"str",function(){return ne}),h.d(Ri,"frob",function(){return re}),h.d(Ri,"add",function(){return ie}),h.d(Ri,"subtract",function(){return se}),h.d(Ri,"multiplyScalar",function(){return oe}),h.d(Ri,"multiplyScalarAndAdd",function(){return ae}),h.d(Ri,"exactEquals",function(){return ue}),h.d(Ri,"equals",function(){return ce}),h.d(Ri,"mul",function(){return Gi}),h.d(Ri,"sub",function(){return ji});var Ai={};h.r(Ai),h.d(Ai,"create",function(){return le}),h.d(Ai,"fromMat4",function(){return de}),h.d(Ai,"clone",function(){return fe}),h.d(Ai,"copy",function(){return he}),h.d(Ai,"fromValues",function(){return pe}),h.d(Ai,"set",function(){return me}),h.d(Ai,"identity",function(){return ge}),h.d(Ai,"transpose",function(){return ye}),h.d(Ai,"invert",function(){return ve}),h.d(Ai,"adjoint",function(){return be}),h.d(Ai,"determinant",function(){return xe}),h.d(Ai,"multiply",function(){return Ee}),h.d(Ai,"translate",function(){return Te}),h.d(Ai,"rotate",function(){return Se}),h.d(Ai,"scale",function(){return we}),h.d(Ai,"fromTranslation",function(){return ke}),h.d(Ai,"fromRotation",function(){return _e}),h.d(Ai,"fromScaling",function(){return Re}),h.d(Ai,"fromMat2d",function(){return Ae}),h.d(Ai,"fromQuat",function(){return Ie}),h.d(Ai,"normalFromMat4",function(){return Me}),h.d(Ai,"projection",function(){return Pe}),h.d(Ai,"str",function(){return Le}),h.d(Ai,"frob",function(){return Ce}),h.d(Ai,"add",function(){return De}),h.d(Ai,"subtract",function(){return Ne}),h.d(Ai,"multiplyScalar",function(){return Fe}),h.d(Ai,"multiplyScalarAndAdd",function(){return Oe}),h.d(Ai,"exactEquals",function(){return Ue}),h.d(Ai,"equals",function(){return Be}),h.d(Ai,"mul",function(){return Xi}),h.d(Ai,"sub",function(){return Wi});var Ii={};h.r(Ii),h.d(Ii,"create",function(){return Ve}),h.d(Ii,"clone",function(){return Ge}),h.d(Ii,"copy",function(){return je}),h.d(Ii,"fromValues",function(){return Xe}),h.d(Ii,"set",function(){return We}),h.d(Ii,"identity",function(){return He}),h.d(Ii,"transpose",function(){return qe}),h.d(Ii,"invert",function(){return ze}),h.d(Ii,"adjoint",function(){return Ye}),h.d(Ii,"determinant",function(){return Ke}),h.d(Ii,"multiply",function(){return $e}),h.d(Ii,"translate",function(){return Ze}),h.d(Ii,"scale",function(){return Qe}),h.d(Ii,"rotate",function(){return Je}),h.d(Ii,"rotateX",function(){return et}),h.d(Ii,"rotateY",function(){return tt}),h.d(Ii,"rotateZ",function(){return nt}),h.d(Ii,"fromTranslation",function(){return rt}),h.d(Ii,"fromScaling",function(){return it}),h.d(Ii,"fromRotation",function(){return st}),h.d(Ii,"fromXRotation",function(){return ot}),h.d(Ii,"fromYRotation",function(){return at}),h.d(Ii,"fromZRotation",function(){return ut}),h.d(Ii,"fromRotationTranslation",function(){return ct}),h.d(Ii,"fromQuat2",function(){return lt}),h.d(Ii,"getTranslation",function(){return dt}),h.d(Ii,"getScaling",function(){return ft}),h.d(Ii,"getRotation",function(){return ht}),h.d(Ii,"fromRotationTranslationScale",function(){return pt}),h.d(Ii,"fromRotationTranslationScaleOrigin",function(){return mt}),h.d(Ii,"fromQuat",function(){return gt}),h.d(Ii,"frustum",function(){return yt}),h.d(Ii,"perspective",function(){return vt}),h.d(Ii,"perspectiveFromFieldOfView",function(){return bt}),h.d(Ii,"ortho",function(){return xt}),h.d(Ii,"lookAt",function(){return Et}),h.d(Ii,"targetTo",function(){return Tt}),h.d(Ii,"str",function(){return St}),h.d(Ii,"frob",function(){return wt}),h.d(Ii,"add",function(){return kt}),h.d(Ii,"subtract",function(){return _t}),h.d(Ii,"multiplyScalar",function(){return Rt}),h.d(Ii,"multiplyScalarAndAdd",function(){return At}),h.d(Ii,"exactEquals",function(){return It}),h.d(Ii,"equals",function(){return Mt}),h.d(Ii,"mul",function(){return Hi}),h.d(Ii,"sub",function(){return qi});var Mi={};h.r(Mi),h.d(Mi,"create",function(){return Pt}),h.d(Mi,"clone",function(){return Lt}),h.d(Mi,"length",function(){return Ct}),h.d(Mi,"fromValues",function(){return Dt}),h.d(Mi,"copy",function(){return Nt}),h.d(Mi,"set",function(){return Ft}),h.d(Mi,"add",function(){return Ot}),h.d(Mi,"subtract",function(){return Ut}),h.d(Mi,"multiply",function(){return Bt}),h.d(Mi,"divide",function(){return Vt}),h.d(Mi,"ceil",function(){return Gt}),h.d(Mi,"floor",function(){return jt}),h.d(Mi,"min",function(){return Xt}),h.d(Mi,"max",function(){return Wt}),h.d(Mi,"round",function(){return Ht}),h.d(Mi,"scale",function(){return qt}),h.d(Mi,"scaleAndAdd",function(){return zt}),h.d(Mi,"distance",function(){return Yt}),h.d(Mi,"squaredDistance",function(){return Kt}),h.d(Mi,"squaredLength",function(){return $t}),h.d(Mi,"negate",function(){return Zt}),h.d(Mi,"inverse",function(){return Qt}),h.d(Mi,"normalize",function(){return Jt}),h.d(Mi,"dot",function(){return en}),h.d(Mi,"cross",function(){return tn}),h.d(Mi,"lerp",function(){return nn}),h.d(Mi,"hermite",function(){return rn}),h.d(Mi,"bezier",function(){return sn}),h.d(Mi,"random",function(){return on}),h.d(Mi,"transformMat4",function(){return an}),h.d(Mi,"transformMat3",function(){return un}),h.d(Mi,"transformQuat",function(){return cn}),h.d(Mi,"rotateX",function(){return ln}),h.d(Mi,"rotateY",function(){return dn}),h.d(Mi,"rotateZ",function(){return fn}),h.d(Mi,"angle",function(){return hn}),h.d(Mi,"str",function(){return pn}),h.d(Mi,"exactEquals",function(){return mn}),h.d(Mi,"equals",function(){return gn}),h.d(Mi,"sub",function(){return zi}),h.d(Mi,"mul",function(){return Yi}),h.d(Mi,"div",function(){return Ki}),h.d(Mi,"dist",function(){return $i}),h.d(Mi,"sqrDist",function(){return Zi}),h.d(Mi,"len",function(){return Qi}),h.d(Mi,"sqrLen",function(){return Ji}),h.d(Mi,"forEach",function(){return es});var Pi={};h.r(Pi),h.d(Pi,"create",function(){return yn}),h.d(Pi,"clone",function(){return vn}),h.d(Pi,"fromValues",function(){return bn}),h.d(Pi,"copy",function(){return xn}),h.d(Pi,"set",function(){return En}),h.d(Pi,"add",function(){return Tn}),h.d(Pi,"subtract",function(){return Sn}),h.d(Pi,"multiply",function(){return wn}),h.d(Pi,"divide",function(){return kn}),h.d(Pi,"ceil",function(){return _n}),h.d(Pi,"floor",function(){return Rn}),h.d(Pi,"min",function(){return An}),h.d(Pi,"max",function(){return In}),h.d(Pi,"round",function(){return Mn}),h.d(Pi,"scale",function(){return Pn}),h.d(Pi,"scaleAndAdd",function(){return Ln}),h.d(Pi,"distance",function(){return Cn}),h.d(Pi,"squaredDistance",function(){return Dn}),h.d(Pi,"length",function(){return Nn}),h.d(Pi,"squaredLength",function(){return Fn}),h.d(Pi,"negate",function(){return On}),h.d(Pi,"inverse",function(){return Un}),h.d(Pi,"normalize",function(){return Bn}),h.d(Pi,"dot",function(){return Vn}),h.d(Pi,"lerp",function(){return Gn}),h.d(Pi,"random",function(){return jn}),h.d(Pi,"transformMat4",function(){return Xn}),h.d(Pi,"transformQuat",function(){return Wn}),h.d(Pi,"str",function(){return Hn}),h.d(Pi,"exactEquals",function(){return qn}),h.d(Pi,"equals",function(){return zn}),h.d(Pi,"sub",function(){return ts}),h.d(Pi,"mul",function(){return ns}),h.d(Pi,"div",function(){return rs}),h.d(Pi,"dist",function(){return is}),h.d(Pi,"sqrDist",function(){return ss}),h.d(Pi,"len",function(){return os}),h.d(Pi,"sqrLen",function(){return as}),h.d(Pi,"forEach",function(){return us});var Li={};h.r(Li),h.d(Li,"create",function(){return Yn}),h.d(Li,"identity",function(){return Kn}),h.d(Li,"setAxisAngle",function(){return $n}),h.d(Li,"getAxisAngle",function(){return Zn}),h.d(Li,"multiply",function(){return Qn}),h.d(Li,"rotateX",function(){return Jn}),h.d(Li,"rotateY",function(){return er}),h.d(Li,"rotateZ",function(){return tr}),h.d(Li,"calculateW",function(){return nr}),h.d(Li,"slerp",function(){return rr}),h.d(Li,"random",function(){return ir}),h.d(Li,"invert",function(){return sr}),h.d(Li,"conjugate",function(){return or}),h.d(Li,"fromMat3",function(){return ar}),h.d(Li,"fromEuler",function(){return ur}),h.d(Li,"str",function(){return cr}),h.d(Li,"clone",function(){return cs}),h.d(Li,"fromValues",function(){return ls}),h.d(Li,"copy",function(){return ds}),h.d(Li,"set",function(){return fs}),h.d(Li,"add",function(){return hs}),h.d(Li,"mul",function(){return ps}),h.d(Li,"scale",function(){return ms}),h.d(Li,"dot",function(){return gs}),h.d(Li,"lerp",function(){return ys}),h.d(Li,"length",function(){return vs}),h.d(Li,"len",function(){return bs}),h.d(Li,"squaredLength",function(){return xs}),h.d(Li,"sqrLen",function(){return Es}),h.d(Li,"normalize",function(){return Ts}),h.d(Li,"exactEquals",function(){return Ss}),h.d(Li,"equals",function(){return ws}),h.d(Li,"rotationTo",function(){return ks}),h.d(Li,"sqlerp",function(){return _s}),h.d(Li,"setAxes",function(){return Rs});var Ci={};h.r(Ci),h.d(Ci,"create",function(){return lr}),h.d(Ci,"clone",function(){return dr}),h.d(Ci,"fromValues",function(){return fr}),h.d(Ci,"fromRotationTranslationValues",function(){return hr}),h.d(Ci,"fromRotationTranslation",function(){return pr}),h.d(Ci,"fromTranslation",function(){return mr}),h.d(Ci,"fromRotation",function(){return gr}),h.d(Ci,"fromMat4",function(){return yr}),h.d(Ci,"copy",function(){return vr}),h.d(Ci,"identity",function(){return br}),h.d(Ci,"set",function(){return xr}),h.d(Ci,"getReal",function(){return As}),h.d(Ci,"getDual",function(){return Er}),h.d(Ci,"setReal",function(){return Is}),h.d(Ci,"setDual",function(){return Tr}),h.d(Ci,"getTranslation",function(){return Sr}),h.d(Ci,"translate",function(){return wr}),h.d(Ci,"rotateX",function(){return kr}),h.d(Ci,"rotateY",function(){return _r}),h.d(Ci,"rotateZ",function(){return Rr}),h.d(Ci,"rotateByQuatAppend",function(){return Ar}),h.d(Ci,"rotateByQuatPrepend",function(){return Ir}),h.d(Ci,"rotateAroundAxis",function(){return Mr}),h.d(Ci,"add",function(){return Pr}),h.d(Ci,"multiply",function(){return Lr}),h.d(Ci,"mul",function(){return Ms}),h.d(Ci,"scale",function(){return Cr}),h.d(Ci,"dot",function(){return Ps}),h.d(Ci,"lerp",function(){return Dr}),h.d(Ci,"invert",function(){return Nr}),h.d(Ci,"conjugate",function(){return Fr}),h.d(Ci,"length",function(){return Ls}),h.d(Ci,"len",function(){return Cs}),h.d(Ci,"squaredLength",function(){return Ds}),h.d(Ci,"sqrLen",function(){return Ns}),h.d(Ci,"normalize",function(){return Or}),h.d(Ci,"str",function(){return Ur}),h.d(Ci,"exactEquals",function(){return Br}),h.d(Ci,"equals",function(){return Vr});var Di={};h.r(Di),h.d(Di,"create",function(){return Gr}),h.d(Di,"clone",function(){return jr}),h.d(Di,"fromValues",function(){return Xr}),h.d(Di,"copy",function(){return Wr}),h.d(Di,"set",function(){return Hr}),h.d(Di,"add",function(){return qr}),h.d(Di,"subtract",function(){return zr}),h.d(Di,"multiply",function(){return Yr}),h.d(Di,"divide",function(){return Kr}),h.d(Di,"ceil",function(){return $r}),h.d(Di,"floor",function(){return Zr}),h.d(Di,"min",function(){return Qr}),h.d(Di,"max",function(){return Jr}),h.d(Di,"round",function(){return ei}),h.d(Di,"scale",function(){return ti}),h.d(Di,"scaleAndAdd",function(){return ni}),h.d(Di,"distance",function(){return ri}),h.d(Di,"squaredDistance",function(){return ii}),h.d(Di,"length",function(){return si}),h.d(Di,"squaredLength",function(){return oi}),h.d(Di,"negate",function(){return ai}),h.d(Di,"inverse",function(){return ui}),h.d(Di,"normalize",function(){return ci}),h.d(Di,"dot",function(){return li}),h.d(Di,"cross",function(){return di}),h.d(Di,"lerp",function(){return fi}),h.d(Di,"random",function(){return hi}),h.d(Di,"transformMat2",function(){return pi}),h.d(Di,"transformMat2d",function(){return mi}),h.d(Di,"transformMat3",function(){return gi}),h.d(Di,"transformMat4",function(){return yi}),h.d(Di,"rotate",function(){return vi}),h.d(Di,"angle",function(){return bi}),h.d(Di,"str",function(){return xi}),h.d(Di,"exactEquals",function(){return Ei}),h.d(Di,"equals",function(){return Ti}),h.d(Di,"len",function(){return Fs}),h.d(Di,"sub",function(){return Os}),h.d(Di,"mul",function(){return Us}),h.d(Di,"div",function(){return Bs}),h.d(Di,"dist",function(){return Vs}),h.d(Di,"sqrDist",function(){return Gs}),h.d(Di,"sqrLen",function(){return js}),h.d(Di,"forEach",function(){return Xs});var Ni=1e-6,Fi="undefined"==typeof Float32Array?Array:Float32Array,Oi=Math.random,Ui=c/180,Bi=R,Vi=F,Gi=K,ji=se,Xi=Ee,Wi=Ne,Hi=$e,qi=_t,zi=Ut,Yi=Bt,Ki=Vt,$i=Yt,Zi=Kt,Qi=Ct,Ji=$t,es=function(){var e=Pt();return function(n,r,i,s,o,a){var u,c;for(r||(r=3),i||(i=0),c=s?t(s*r+i,n.length):n.length,u=i;u<c;u+=r)e[0]=n[u],e[1]=n[u+1],e[2]=n[u+2],o(e,e,a),n[u]=e[0],n[u+1]=e[1],n[u+2]=e[2];return n}}(),ts=Sn,ns=wn,rs=kn,is=Cn,ss=Dn,os=Nn,as=Fn,us=function(){var e=yn();return function(n,r,i,s,o,a){var u,c;for(r||(r=4),i||(i=0),c=s?t(s*r+i,n.length):n.length,u=i;u<c;u+=r)e[0]=n[u],e[1]=n[u+1],e[2]=n[u+2],e[3]=n[u+3],o(e,e,a),n[u]=e[0],n[u+1]=e[1],n[u+2]=e[2],n[u+3]=e[3];return n}}(),cs=vn,ls=bn,ds=xn,fs=En,hs=Tn,ps=Qn,ms=Pn,gs=Vn,ys=Gn,vs=Nn,bs=vs,xs=Fn,Es=xs,Ts=Bn,Ss=qn,ws=zn,ks=function(){var e=Pt(),t=Dt(1,0,0),n=Dt(0,1,0);return function(r,i,s){var o=en(i,s);return-.999999>o?(tn(e,t,i),1e-6>Qi(e)&&tn(e,n,i),Jt(e,e),$n(r,e,Math.PI),r):.999999<o?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(tn(e,i,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,Ts(r,r))}}(),_s=function(){var e=Yn(),t=Yn();return function(n,r,i,s,o,a){return rr(e,r,o,a),rr(t,i,s,a),rr(n,e,t,2*a*(1-a)),n}}(),Rs=function(){var e=le();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Ts(t,ar(t,e))}}(),As=ds,Is=ds,Ms=Lr,Ps=gs,Ls=vs,Cs=Ls,Ds=xs,Ns=Ds,Fs=si,Os=zr,Us=Yr,Bs=Kr,Vs=ri,Gs=ii,js=oi,Xs=function(){var e=Gr();return function(n,r,i,s,o,a){var u,c;for(r||(r=2),i||(i=0),c=s?t(s*r+i,n.length):n.length,u=i;u<c;u+=r)e[0]=n[u],e[1]=n[u+1],o(e,e,a),n[u]=e[0],n[u+1]=e[1];return n}}();h.d(f,"glMatrix",function(){return ki}),h.d(f,"mat2",function(){return _i}),h.d(f,"mat2d",function(){return Ri}),h.d(f,"mat3",function(){return Ai}),h.d(f,"mat4",function(){return Ii}),h.d(f,"quat",function(){return Li}),h.d(f,"quat2",function(){return Ci}),h.d(f,"vec2",function(){return Di}),h.d(f,"vec3",function(){return Mi}),h.d(f,"vec4",function(){return Pi})},function(e,t,n){"use strict";(function(e){function n(e){return e.replace(m,b).replace(g,"-ms-")}function r(e){for(var t=5381,n=e.length;n--;)t=33*t^e.charCodeAt(n);return(t>>>0).toString(36)}function i(e,t){return"number"!=typeof t||0===t||x.hasOwnProperty(e)?e+":"+t:e+":"+t+"px"}function s(e){return e.sort(function(e,t){return e[0]>t[0]?1:-1})}function o(e,r){for(var i=[],o=[],u=!1,c=0,l=Object.keys(e);c<l.length;c++){var d=l[c],f=e[d];null!=f&&(d===t.IS_UNIQUE?u=!0:"object"!=typeof f||Array.isArray(f)?i.push([n(d.trim()),f]):o.push([d.trim(),f]))}return{style:a(s(i)),nested:r?o:s(o),isUnique:u}}function a(e){return e.map(function(e){var t=e[0],n=e[1];return Array.isArray(n)?n.map(function(e){return i(t,e)}).join(";"):i(t,n)}).join(";")}function u(e,t){return-1===e.indexOf("&")?t+" "+e:e.replace(y,t)}function c(e,t,n,r,i){var s=o(t,""!==e),a=s.style,l=s.nested,d=s.isUnique,f=a;if(64===e.charCodeAt(0)){var h={selector:e,styles:[],rules:[],style:i?"":a};n.push(h),a&&i&&h.styles.push({selector:i,style:a,isUnique:d});for(var p=0,m=l;p<m.length;p++){var g=m[p];f+=(x=g[0])+c(x,g[1],h.rules,h.styles,i)}}else{var y=i?u(e,i):e;a&&r.push({selector:y,style:a,isUnique:d});for(var v=0,b=l;v<b.length;v++){var x,E=b[v];f+=(x=E[0])+c(x,E[1],n,r,y)}}return f}function l(e,t,n,r,i,s){for(var o=0,a=r;o<a.length;o++){var c=a[o],d=c.selector,f=c.style,p=c.isUnique,m=s?u(d,i):d,g=p?"u\0"+(++h).toString(36):"s\0"+t+"\0"+f;(b=new A(f,g)).add(new R(m,"k\0"+t+"\0"+m)),e.add(b)}for(var y=0,v=n;y<v.length;y++){var b,x=v[y],E=(d=x.selector,f=x.style,x.rules),T=x.styles;l(b=new I(d,f,"r\0"+t+"\0"+d+"\0"+f),t,E,T,i,s),e.add(b)}}function d(e){for(var t="",n=0;n<e.length;n++)t+=e[n];return t}var f=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var h=0;t.IS_UNIQUE="__DO_NOT_DEDUPE_STYLE__";for(var p,m=/[A-Z]/g,g=/^ms-/,y=/&/g,v=/[ !#$%&()*+,./;<=>?@[\]^`{|}~"'\\]/g,b=function(e){return"-"+e.toLowerCase()},x={"animation-iteration-count":!0,"border-image-outset":!0,"border-image-slice":!0,"border-image-width":!0,"box-flex":!0,"box-flex-group":!0,"box-ordinal-group":!0,"column-count":!0,columns:!0,"counter-increment":!0,"counter-reset":!0,flex:!0,"flex-grow":!0,"flex-positive":!0,"flex-shrink":!0,"flex-negative":!0,"flex-order":!0,"font-weight":!0,"grid-area":!0,"grid-column":!0,"grid-column-end":!0,"grid-column-span":!0,"grid-column-start":!0,"grid-row":!0,"grid-row-end":!0,"grid-row-span":!0,"grid-row-start":!0,"line-clamp":!0,"line-height":!0,opacity:!0,order:!0,orphans:!0,"tab-size":!0,widows:!0,"z-index":!0,zoom:!0,"fill-opacity":!0,"flood-opacity":!0,"stop-opacity":!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0},E=0,T=Object.keys(x);E<T.length;E++){p=T[E];for(var S=0,w=["-webkit-","-ms-","-moz-","-o-",""];S<w.length;S++)x[w[S]+p]=!0}t.escape=function(e){return e.replace(v,"\\$&")},t.hyphenate=n,t.stringHash=r;var k={add:function(){},change:function(){},remove:function(){}},_=function(){function e(e){void 0===e&&(e=k),this.changes=e,this.sheet=[],this.changeId=0,this._keys=[],this._children=Object.create(null),this._counters=Object.create(null)}return e.prototype.add=function(t){var n=this._counters[t.id]||0,r=this._children[t.id]||t.clone();if(this._counters[t.id]=n+1,0===n)this._children[r.id]=r,this._keys.push(r.id),this.sheet.push(r.getStyles()),this.changeId++,this.changes.add(r,this._keys.length-1);else if(r instanceof e&&t instanceof e){var i=this._keys.indexOf(t.id),s=r.changeId;r.merge(t),r.changeId!==s&&(this.sheet.splice(i,1,r.getStyles()),this.changeId++,this.changes.change(r,i,i))}return r},e.prototype.remove=function(t){var n=this._counters[t.id];if(void 0!==n&&0<n){this._counters[t.id]=n-1;var r=this._children[t.id],i=this._keys.indexOf(r.id);if(1===n)delete this._counters[t.id],delete this._children[t.id],this._keys.splice(i,1),this.sheet.splice(i,1),this.changeId++,this.changes.remove(r,i);else if(r instanceof e&&t instanceof e){var s=r.changeId;r.unmerge(t),r.changeId!==s&&(this.sheet.splice(i,1,r.getStyles()),this.changeId++,this.changes.change(r,i,i))}}},e.prototype.values=function(){var e=this;return this._keys.map(function(t){return e._children[t]})},e.prototype.merge=function(e){for(var t,n=0,r=e.values();n<r.length;n++)t=r[n],this.add(t);return this},e.prototype.unmerge=function(e){for(var t,n=0,r=e.values();n<r.length;n++)t=r[n],this.remove(t);return this},e.prototype.clone=function(){return(new e).merge(this)},e}();t.Cache=_;var R=function(){function e(e,t){this.selector=e,this.id=t}return e.prototype.getStyles=function(){return this.selector},e.prototype.clone=function(){return new e(this.selector,this.id)},e}();t.Selector=R;var A=function(e){function t(t,n){var r=e.call(this)||this;return r.style=t,r.id=n,r}return f(t,e),t.prototype.getStyles=function(){return this.sheet.join(",")+"{"+this.style+"}"},t.prototype.clone=function(){return new t(this.style,this.id).merge(this)},t}(_);t.Style=A;var I=function(e){function t(t,n,r){var i=e.call(this)||this;return i.rule=t,i.style=n,i.id=r,i}return f(t,e),t.prototype.getStyles=function(){return this.rule+"{"+this.style+d(this.sheet)+"}"},t.prototype.clone=function(){return new t(this.rule,this.style,this.id).merge(this)},t}(_);t.Rule=I;var M=function(e){function n(t,n,r,i){var s=e.call(this,i)||this;return s.hash=t,s.debug=n,s.id=r,s}return f(n,e),n.prototype.registerStyle=function(e,n){var r=[],i=[],s=c("&",e,r,i),o="f"+this.hash(s),a=this.debug&&n?n+"_"+o:o;return l(this,s,r,i,"."+t.escape(a),!0),a},n.prototype.registerKeyframes=function(e,t){return this.registerHashRule("@keyframes",e,t)},n.prototype.registerHashRule=function(e,n,r){var i=[],s=[],o=c("",n,i,s),a="f"+this.hash(o),u=this.debug&&r?r+"_"+a:a,d=new I(e+" "+t.escape(u),"","h\0"+o+"\0"+e);return l(d,o,i,s,"",!1),this.add(d),u},n.prototype.registerRule=function(e,t){var n=[],r=[];l(this,c(e,t,n,r),n,r,"",!1)},n.prototype.registerCss=function(e){return this.registerRule("",e)},n.prototype.getStyles=function(){return d(this.sheet)},n.prototype.clone=function(){return new n(this.hash,this.debug,this.id,this.changes).merge(this)},n}(_);t.FreeStyle=M,t.create=function(t,n,i){return void 0===t&&(t=r),void 0===n&&(n=void 0!==e&&!1),void 0===i&&(i=k),new M(t,n,"f"+(++h).toString(36),i)}}).call(this,n(53))},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=r(4),s=r(9),u=r(20),l=r(35),f=r(36),h=r(37),p=r(38),m=r(10),g=r(39),y=r(40),v=r(41),b=r(42),x=r(44);var E;!function(e){e[e.FREE=0]="FREE",e[e.REPLAY=1]="REPLAY"}(E=n.PlayerMode||(n.PlayerMode={}));class T extends EventTarget{constructor(e){super(),this.pauseTime=0,this.isPaused=!1,this.lastTime=0,this.accumTime=0,this.timeStep=1/60,this.title="",this.pointerLocked=!1,this.touch=new f.Touch,this.mouse=new l.Mouse,this.keyboard=new p.Keyboard,this.entities=[],this.onLoadAll=e=>{if(e&&e.replay&&(this.changeReplay(e.replay.data),this.changeMode(E.REPLAY)),!e.map||!e.map.data)return;const t=e.map.data,n=e.skies;let r=!0;n.forEach(e=>{r=r&&e.isDone()}),r&&n.forEach(e=>e.data?t.skies.push(e.data):0),Object.entries(e.sprites).forEach(([e,n])=>{n.data&&(t.sprites[e]=n.data)}),0<e.sounds.length&&e.sounds.forEach(e=>{e.data&&this.sounds.push(e.data)}),this.changeMap(t),this.dispatchEvent(i.evt("load",{detail:{item:e}}))},this.draw=()=>{requestAnimationFrame(this.draw);const e=this.canvas,t=e.parentElement;if(t){const n=t.clientWidth,r=t.clientHeight;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r,this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.context.gl.viewport(0,0,this.context.gl.drawingBufferWidth,this.context.gl.drawingBufferHeight)),(e.clientWidth!==e.width||e.clientHeight!==e.height)&&(e.width=e.clientWidth,e.height=e.clientHeight,this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.context.gl.viewport(0,0,this.context.gl.drawingBufferWidth,this.context.gl.drawingBufferHeight))}const n=s.now()/1e3,r=n-this.lastTime;for(this.accumTime+=r;this.accumTime>this.timeStep;)this.update(this.timeStep),this.accumTime-=this.timeStep;this.renderer.draw(),""!==this.mapName&&(this.skyScene.draw(this.camera),this.worldScene.draw(this.camera,this.entities)),this.lastTime=n},this.onTouchStart=e=>{const t=e.touches.item(0);t&&(this.touch.pressed=!0,this.touch.position[0]=t.clientX,this.touch.position[1]=t.clientY)},this.onTouchEnd=()=>{this.touch.pressed=!1,this.touch.delta[0]=0,this.touch.delta[1]=0},this.onTouchMove=e=>{const t=e.touches.item(0);t&&this.touch.pressed&&(this.touch.delta[0],this.touch.delta[0]=t.clientX-this.touch.position[0],this.touch.delta[1]=t.clientY-this.touch.position[1],this.touch.position[0]=t.clientX,this.touch.position[1]=t.clientY)},this.onMouseMove=e=>{this.pointerLocked&&(this.mouse.delta[0]=.5*e.movementX,this.mouse.delta[1]=.5*e.movementY,this.mouse.position[0]=e.pageX,this.mouse.position[1]=e.pageY)},this.keyDown=e=>(this.keyboard.keys[e.which]=1,!this.pointerLocked||(e.preventDefault(),!1)),this.keyUp=e=>(this.keyboard.keys[e.which]=0,!this.pointerLocked||(e.preventDefault(),!1)),this.onVisibilityChange=()=>{if(document.hidden){if(this.isPaused)return;this.pauseTime=s.now()/1e3,this.isPaused=!0}else{if(!this.isPaused)return;this.lastTime=s.now()/1e3-this.pauseTime+this.lastTime,this.isPaused=!1}},this.sounds=[],this.soundSystem=new m.SoundSystem,this.config=e.config,this.loader=new u.Loader(this.config),this.loader.addEventListener("loadAll",e=>{this.onLoadAll(e.detail.loader)}),document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchend",this.onTouchEnd,!1),document.addEventListener("touchcancel",this.onTouchEnd,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp),window.addEventListener("visibilitychange",this.onVisibilityChange),this.canvas=e.canvas,this.camera=h.Camera.init(this.canvas.width/this.canvas.height),this.context=e.context,this.renderer=e.renderer,this.worldScene=e.worldScene,this.skyScene=e.skyScene,this.mode=E.FREE,this.player=new y.ReplayPlayer(this),this.mapName=""}static init(e){if(!g.Context.checkWebGLSupport().hasSupport)return{status:"error",message:"No WebGL support!"};const t=document.createElement("canvas");if(!t)return{status:"error",message:"Failed to create <canvas> element!"};const n=g.Context.init(t);if(!n)return{status:"error",message:"Failed to initialize WebGL context"};const r=v.Renderer.init(n);if(!r)return{status:"error",message:"Failed to initialize renderer"};const i=x.WorldScene.init(n);if(!i)return{status:"error",message:"Failed to initialize world scene"};const s=b.SkyScene.init(n);return s?{status:"success",game:new T({canvas:t,config:e,context:n,renderer:r,worldScene:i,skyScene:s})}:{status:"error",message:"Failed to initialize sky scene"}}getCanvas(){return this.canvas}load(e){this.dispatchEvent(i.evt("loadstart")),this.loader.load(e)}changeMap(e){if(this.mapName.toLowerCase()!==e.name.toLowerCase()){this.mapName=e.name,this.worldScene.changeMap(e),this.skyScene.changeMap(e),this.entities=e.entities;const t=e.entities.find(e=>"info_player_start"===e.classname);t?(this.camera.position[0]=t.origin[0],this.camera.position[1]=t.origin[1],this.camera.position[2]=t.origin[2]):(this.camera.position[0]=0,this.camera.position[1]=0,this.camera.position[2]=0),this.camera.rotation[0]=0,this.camera.rotation[1]=0,this.camera.rotation[2]=0}}changeReplay(e){this.player.changeReplay(e)}changeMode(e){this.mode=e,this.dispatchEvent(i.evt("modechange"))}setTitle(e){this.title=e,this.dispatchEvent(i.evt("titlechange",{detail:{item:e}}))}getTitle(){return this.title}update(e){this.dispatchEvent(i.evt("preupdate",{detail:{item:this}}));const n=this.camera,r=this.keyboard,s=this.mouse,u=this.touch;if(this.mode===E.REPLAY)this.player.update(e);else if(this.mode===E.FREE){this.touch.pressed?(n.rotation[0]=t(d(n.rotation[0]+u.delta[1]/100,-c/2),c/2),n.rotation[1]-=u.delta[0]/100):(n.rotation[0]=t(d(n.rotation[0]+s.delta[1]/100,-c/2),c/2),n.rotation[1]-=s.delta[0]/100);const i=500*e,l=p.Keyboard.KEYS.W,f=p.Keyboard.KEYS.S,h=p.Keyboard.KEYS.A,m=p.Keyboard.KEYS.D,g=p.Keyboard.KEYS.C,y=p.Keyboard.KEYS.SPACE;r.keys[l]!==r.keys[f]&&(r.keys[l]?(n.position[1]-=o(n.rotation[1]+c/2)*i,n.position[0]+=a(n.rotation[1]+c/2)*i):r.keys[f]&&(n.position[1]-=o(n.rotation[1]-c/2)*i,n.position[0]+=a(n.rotation[1]-c/2)*i)),r.keys[h]!==r.keys[m]&&(r.keys[h]?(n.position[1]+=o(n.rotation[1])*i,n.position[0]-=a(n.rotation[1])*i):r.keys[m]&&(n.position[1]-=o(n.rotation[1])*i,n.position[0]+=a(n.rotation[1])*i)),r.keys[y]!==r.keys[g]&&(r.keys[y]?n.position[2]+=i:r.keys[g]&&(n.position[2]-=i))}s.delta[0]=0,s.delta[1]=0,this.dispatchEvent(i.evt("postupdate",{detail:{item:this}}))}on(e,t){return this.addEventListener(e,t)}off(e,t){return this.removeEventListener(e,t)}}n.Game=T},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.paletteToRGBA=function(e,t){const n=new Uint8Array(4*e.length),r=e.length;for(let i=0;i<r;++i)n[4*i]=t[3*e[i]],n[4*i+1]=t[3*e[i]+1],n[4*i+2]=t[3*e[i]+2],n[4*i+3]=255;return n},t.paletteWithLastTransToRGBA=function(e,t){const n=new Uint8Array(4*e.length),r=e.length;for(let i=0;i<r;++i)255===e[i]?n[4*i+3]=0:(n[4*i]=t[3*e[i]],n[4*i+1]=t[3*e[i]+1],n[4*i+2]=t[3*e[i]+2],n[4*i+3]=255);return n}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=window;let i;"undefined"!=typeof performance&&(performance.now?i=()=>r.performance.now():r.performance.mozNow?i=()=>r.performance.mozNow():r.performance.msNow?i=()=>r.performance.msNow():r.performance.oNow?i=()=>r.performance.oNow():r.performance.webkitNow?i=()=>r.performance.webkitNow():Date.now&&(i=()=>Date.now())),t.now=i||(()=>(new Date).getTime()),t.formatTime=e=>{const t=n(e/60),r=n(e-60*t);return(10>t?"0"+t:t.toString())+":"+(10>r?"0"+r:r.toString())}},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=r(4),s=window,o=new(s.AudioContext||s.webkitAudioContext);n.SoundSystem=class extends EventTarget{constructor(){super(),this.context=o;const e=parseFloat(localStorage.getItem("volume")||"0.3");localStorage.setItem("volume",e.toString()),this.channels=[],this.preMuteVolume=1,this.masterGain=this.context.createGain(),this.masterGain.gain.value=e,this.masterGain.connect(this.context.destination);for(let e=0;8>e;++e)this.channels.push({source:null,gain:this.context.createGain()}),this.channels[e].gain.connect(this.masterGain)}static getContext(){return o}play(e,n,r){this.stop(n);const i=this.channels[n].gain;i.gain.value=d(0,t(1,r));const s=this.context.createBufferSource();s.buffer=e.buffer,s.connect(i),s.start(0),this.channels[n].source=s}stop(e){const t=this.channels[e].source;t&&t.stop(0)}getVolume(){return this.masterGain.gain.value}setVolume(e){const t=this.masterGain.gain.value;0<t&&0===e&&(this.preMuteVolume=t),this.masterGain.gain.value=e,localStorage.setItem("volume",e.toString()),this.dispatchEvent(i.evt("volumeChange",{detail:{item:e}}))}toggleMute(){0===this.getVolume()?this.setVolume(this.preMuteVolume):this.setVolume(0)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(24),i=n(25),s=n(12),o=n(3),a=n(26),u=n(13),c=e=>{return"HLDEMO"===e.nstr(8)},l=e=>({demoProtocol:e.ui(),netProtocol:e.ui(),mapName:e.nstr(260),modName:e.nstr(260),mapCrc:e.i(),dirOffset:e.ui()}),d=(e,t)=>{e.seek(t);let n=e.ui(),r=[];for(let t=0;t<n;++t)r.push({id:e.ui(),name:e.nstr(64),flags:e.ui(),cdTrack:e.i(),time:e.f(),frames:e.ui(),offset:e.ui(),length:e.ui()});return r},f=(e,t,n)=>{let r={type:e.ub(),time:e.f(),tick:e.ui()};switch(r.type){case 0:case 1:e.skip(4),r.camera={position:[e.f(),e.f(),e.f()],orientation:[e.f(),e.f(),e.f()]},e.skip(436),r.data=((e,t,n)=>{let r=e.ui(),i=e.tell()+r,s=[];for(;e.tell()<i;){let r=e.ub();if(1===r)continue;if(64<=r){n[r]&&-1<n[r].size?e.skip(n[r].size):e.skip(e.ub());continue}let o=a.FrameDataReader.read(e,r,t);o?(39===r&&(n[o.index]=o),s.push({type:r,data:o})):e.seek(i)}return e.seek(i),s})(e,t,n);break;case 2:break;case 3:r.command=e.nstr(64);break;case 4:e.skip(32);break;case 5:break;case 6:e.skip(84);break;case 7:e.skip(8);break;case 8:r.sound={channel:e.i(),sample:e.nstr(e.ui()),attenuation:e.f(),volume:e.f(),flags:e.ui(),pitch:e.i()};break;case 9:e.skip(e.ui());break;default:r.error=!0}return r};class h{constructor(e,t){this.header=e,this.mapName=this.header.mapName,this.directories=t}static parseFromArrayBuffer(e){let t=new o.Reader(e);if("HLDEMO"!==t.nstr(8))throw new Error("Invalid replay format");let n={};n.demoProtocol=t.ui(),n.netProtocol=t.ui(),n.mapName=t.nstr(260),n.modName=t.nstr(260),n.mapCrc=t.i(),n.dirOffset=t.ui(),t.seek(n.dirOffset);let r=t.ui(),i=[];for(let e=0;e<r;++e)i.push({id:t.ui(),name:t.nstr(64),flags:t.ui(),cdTrack:t.i(),time:t.f(),frames:t.ui(),offset:t.ui(),length:t.ui(),macros:[]});for(let e=0;e<i.length;++e){t.seek(i[e].offset);for(let n=!1;!n;){let r={type:t.b(),time:t.f(),frame:t.ui()};switch(r.type){case 0:case 1:t.skip(4),r.camera={position:[t.f(),t.f(),t.f()],orientation:[t.f(),t.f(),t.f()]},t.skip(436),t.skip(t.ui());break;case 2:break;case 3:r.command=t.nstr(64);break;case 4:t.skip(32);break;case 5:n=!0;break;case 6:t.skip(84);break;case 7:t.skip(8);break;case 8:t.skip(4),t.skip(t.ui()+16);break;case 9:t.skip(t.ui());break;default:{const e=(+(t.tell()-9)).toString(16),n=[`Unexpected macro (${r.type})`,` at offset = ${e}.`].join("");throw new Error(n)}}i[e].macros.push(r)}}return new h(n,i)}static parseFullFromArrayBuffer(e){let t=new o.Reader(e);if("HLDEMO"!==t.nstr(8))throw new Error("Invalid replay format");let n={};n.demoProtocol=t.ui(),n.netProtocol=t.ui(),n.mapName=t.nstr(260),n.modName=t.nstr(260),n.mapCrc=t.i(),n.dirOffset=t.ui(),t.seek(n.dirOffset);let r=t.ui(),i=[];for(let e=0;e<r;++e)i.push({id:t.ui(),name:t.nstr(64),flags:t.ui(),cdTrack:t.i(),time:t.f(),frames:t.ui(),offset:t.ui(),length:t.ui(),macros:[]});let s=u.getInitialDeltaDecoders(),c=[];for(let e=0;e<i.length;++e){t.seek(i[e].offset);for(let n=!1;!n;){let r={type:t.b(),time:t.f(),frame:t.ui()};switch(r.type){case 0:case 1:{t.skip(4),r.camera={position:[t.f(),t.f(),t.f()],orientation:[t.f(),t.f(),t.f()],forward:[t.f(),t.f(),t.f()],right:[t.f(),t.f(),t.f()],up:[t.f(),t.f(),t.f()]},r.RefParams={frametime:t.f(),time:t.f(),intermission:t.i(),paused:t.i(),spectator:t.i(),onground:t.i(),waterlevel:t.i(),velocity:[t.f(),t.f(),t.f()],origin:[t.f(),t.f(),t.f()],viewHeight:[t.f(),t.f(),t.f()],idealPitch:t.f(),viewAngles:[t.f(),t.f(),t.f()],health:t.i(),crosshairAngle:[t.f(),t.f(),t.f()],viewSize:t.f(),punchAngle:[t.f(),t.f(),t.f()],maxClients:t.i(),viewEntity:t.i(),playerCount:t.i(),maxEntities:t.i(),demoPlayback:t.i(),hardware:t.i(),smoothing:t.i(),ptr_cmd:t.i(),ptr_movevars:t.i(),viewport:[t.i(),t.i(),t.i(),t.i()],nextView:t.i(),onlyClientDraw:t.i()},r.UserCmd={lerp_msec:t.s(),msec:t.ub(),UNUSED1:t.ub(),viewAngles:[t.f(),t.f(),t.f()],forwardMove:t.f(),sideMove:t.f(),upMove:t.f(),lightLevel:t.b(),UNUSED2:t.ub(),buttons:t.us(),impulse:t.b(),weaponSelect:t.b(),UNUSED:t.s(),impactIndex:t.i(),impactPosition:[t.f(),t.f(),t.f()]},r.MoveVars={gravity:t.f(),stopSpeed:t.f(),maxSpeed:t.f(),spectatorMaxSpeed:t.f(),acceleration:t.f(),airAcceleration:t.f(),waterAcceleration:t.f(),friction:t.f(),edgeFriction:t.f(),waterFriction:t.f(),entityGravity:t.f(),bounce:t.f(),stepSize:t.f(),maxVelocity:t.f(),zMax:t.f(),waveHeight:t.f(),footsteps:t.i(),skyName:t.nstr(32),rollAngle:t.f(),rollSpeed:t.f(),skyColor:[t.f(),t.f(),t.f()],skyVec:[t.f(),t.f(),t.f()]},r.view=[t.f(),t.f(),t.f()],r.viewModel=t.i(),r.incoming_sequence=t.i(),r.incoming_acknowledged=t.i(),r.incoming_reliable_acknowledged=t.i(),r.incoming_reliable_sequence=t.i(),r.outgoing_sequence=t.i(),r.reliable_sequence=t.i(),r.last_reliable_sequence=t.i();let e=t.ui()+t.tell();for(r.frameData=[];t.tell()<e;){let n=t.ub();if(1===n)continue;if(64<=n){c[n]&&-1<c[n].size?t.skip(c[n].size):t.skip(t.ub());continue}let i=a.FrameDataReader.read(t,n,s);i?(39===n&&(c[i.index]=i),r.frameData.push({type:n,frameData:i})):t.seek(e)}t.seek(e);break}case 2:break;case 3:r.command=t.nstr(64);break;case 4:r.clientData={position:[t.f(),t.f(),t.f()],rotation:[t.f(),t.f(),t.f()],weaponFlags:t.ui(),fov:t.f()};break;case 5:n=!0;break;case 6:r.event={flags:t.ui(),index:t.ui(),delay:t.f(),args:{flags:t.ui(),entityIndex:t.ui(),position:[t.f(),t.f(),t.f()],rotation:[t.f(),t.f(),t.f()],velocity:[t.f(),t.f(),t.f()],ducking:t.ui(),fparam1:t.f(),fparam2:t.f(),iparam1:t.i(),iparam2:t.i(),bparam1:t.i(),bparam2:t.i()}};break;case 7:r.weaponAnimation={animation:t.i(),body:t.i()};break;case 8:r.sound={channel:t.i(),sample:t.nstr(t.ui()),attenuation:t.f(),volume:t.f(),flags:t.ui(),pitch:t.i()};break;case 9:t.skip(t.ui());break;default:{const e=(+(t.tell()-9)).toString(16),n=`Unexpected macro (${r.type}) at offset = ${e}`;throw new Error(n)}}i[e].macros.push(r)}}return new h(n,i)}static parseIntoChunks(e){let t=new o.Reader(e);if(!c(t))throw new Error("Invalid replay file format");let n,h,p,m,g,y=[],v=u.getInitialDeltaDecoders(),b=[],x=l(t),E=d(t,x.dirOffset),T=new s.ReplayState;for(g=E[0].offset+E[0].length,t.seek(E[0].offset);t.tell()<g;){let e=f(t,v,b);if(T.feedFrame(e),e.error)throw new Error("Encountered error while reading replay");if(2>e.type){let t=e.data.find(e=>e.type===a.FrameDataReader.SVC.SERVERINFO);t&&(n=new r.ReplayMap(t.data.mapFileName),y.push(n));let i=e.data.find(e=>e.type===a.FrameDataReader.SVC.RESOURCELIST);i&&n&&n.setResources(i.data)}}if(!(n instanceof r.ReplayMap))throw new Error("Error while parsing replay.");for(m=t.tell(),h=new i.ReplayChunk(T,0),n.addChunk(h),g=E[1].offset+E[1].length,t.seek(E[1].offset);;){let e=t.tell();if(e>=g){let n=p.time-h.startTime;h.timeLength=n;let r=e-m;t.seek(m),h.setData(t.arrx(r,o.ReaderDataType.UByte)),t.seek(e);break}let s=f(t,v,b);if(T.feedFrame(s),p=s,s.error)throw new Error("Encountered error while reading replay");if(2>s.type){let u=s.data.find(e=>e.type===a.FrameDataReader.SVC.SERVERINFO);if(u){n=new r.ReplayMap(u.data.mapFileName),y.push(n);let a=p.time-h.startTime;h.timeLength=a;let c=e-m,l=t.tell();t.seek(m),h.setData(t.arrx(c,o.ReaderDataType.UByte)),t.seek(l),m=e,h=new i.ReplayChunk(T,s.time),n.addChunk(h)}let c=s.data.find(e=>e.type===a.FrameDataReader.SVC.RESOURCELIST);if(c&&n.setResources(c.data),u)continue;for(let e,t=0;t<s.data.length;++t)if((e=s.data[t]).type===a.FrameDataReader.SVC.SOUND||e.type===a.FrameDataReader.SVC.SPAWNSTATICSOUND){let t=n.resources.sounds.find(t=>t.index===e.data.soundIndex);t&&(t.used=!0)}else if(e.type===a.FrameDataReader.SVC.STUFFTEXT){let t=n.resources.sounds,r=e.data.commands;for(let e=0;e<r.length;++e){let n=r[e],i=n.func;if(("speak"===i||"spk"===i)&&1===n.params.length){let e=n.params[0]+".wav",r=t.find(t=>t.name===e);r&&(r.used=!0)}}}}else if(8===s.type){let e=n.resources.sounds.find(e=>e.name===s.sound.sample);e&&(e.used=!0)}if(h.startTime+10<s.time){let r=e-m,a=t.tell();t.seek(m),h.setData(t.arrx(r,o.ReaderDataType.UByte)),t.seek(a),m=e,h=new i.ReplayChunk(T,s.time),n.addChunk(h)}}return{length:E[1].time,maps:y,deltaDecoders:v,customMessages:b}}static readHeader(e){return l(e)}static readDirectories(e,t){return d(e,t)}static readFrame(e,t,n){return f(e,t,n)}static readFrameData(e,t,n){return f(e,t,n)}}t.Replay=h},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e=null){e?(this.cameraPos=JSON.parse(JSON.stringify(e.cameraPos)),this.cameraRot=JSON.parse(JSON.stringify(e.cameraRot)),this.entities=JSON.parse(JSON.stringify(e.entities))):(this.cameraPos=[0,0,0],this.cameraRot=[0,0,0],this.entities=[])}feedFrame(e){switch(e.type){case 0:case 1:this.cameraPos[0]=e.camera.position[0],this.cameraPos[1]=e.camera.position[1],this.cameraPos[2]=e.camera.position[2],this.cameraRot[0]=e.camera.orientation[0],this.cameraRot[1]=e.camera.orientation[1],this.cameraRot[2]=e.camera.orientation[2]}}clone(){return new n(this)}}t.ReplayState=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(28);t.readDelta=function(e,t){let n={},i=e.readBits(3),s=[];for(let t=0;t<i;++t)s.push(e.readBits(8));let o=!1;for(let a=0;a<i;++a){for(let i,u=0;8>u;++u){if((i=u+8*a)===t.length){o=!0;break}if(s[a]&1<<u)if(t[i].flags&r.DeltaType.DT_BYTE)if(t[i].flags&r.DeltaType.DT_SIGNED){let r=e.readBits(1)?-1:1,s=e.readBits(t[i].bits-1),o=t[i].divisor;n[t[i].name]=r*s/o}else{let r=e.readBits(t[i].bits),s=t[i].divisor;n[t[i].name]=r/s}else if(t[i].flags&r.DeltaType.DT_SHORT)if(t[i].flags&r.DeltaType.DT_SIGNED){let r=e.readBits(1)?-1:1,s=e.readBits(t[i].bits-1),o=t[i].divisor;n[t[i].name]=r*s/o}else{let r=e.readBits(t[i].bits),s=t[i].divisor;n[t[i].name]=r/s}else if(t[i].flags&r.DeltaType.DT_INTEGER)if(t[i].flags&r.DeltaType.DT_SIGNED){let r=e.readBits(1)?-1:1,s=e.readBits(t[i].bits-1),o=t[i].divisor;n[t[i].name]=r*s/o}else{let r=e.readBits(t[i].bits),s=t[i].divisor;n[t[i].name]=r/s}else if(t[i].flags&r.DeltaType.DT_FLOAT||t[i].flags&r.DeltaType.DT_TIMEWINDOW_8||t[i].flags&r.DeltaType.DT_TIMEWINDOW_BIG)if(t[i].flags&r.DeltaType.DT_SIGNED){let r=e.readBits(1)?-1:1,s=e.readBits(t[i].bits-1),o=t[i].divisor;n[t[i].name]=r*s/o}else{let r=e.readBits(t[i].bits),s=t[i].divisor;n[t[i].name]=r/s}else if(t[i].flags&r.DeltaType.DT_ANGLE){let r=e.readBits(t[i].bits),s=360/(1<<t[i].bits);n[t[i].name]=r*s}else t[i].flags&r.DeltaType.DT_STRING&&(n[t[i].name]=e.readString())}if(o)break}return n};const i={delta_description_t:[{name:"flags",bits:32,divisor:1,flags:r.DeltaType.DT_INTEGER},{name:"name",bits:8,divisor:1,flags:r.DeltaType.DT_STRING},{name:"offset",bits:16,divisor:1,flags:r.DeltaType.DT_INTEGER},{name:"size",bits:8,divisor:1,flags:r.DeltaType.DT_INTEGER},{name:"bits",bits:8,divisor:1,flags:r.DeltaType.DT_INTEGER},{name:"divisor",bits:32,divisor:4e3,flags:r.DeltaType.DT_FLOAT},{name:"preMultiplier",bits:32,divisor:4e3,flags:r.DeltaType.DT_FLOAT}]};t.getInitialDeltaDecoders=()=>Object.assign({},i)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),i=n(8);var s;!function(e){e[e.VP_PARALLEL_UPRIGHT=0]="VP_PARALLEL_UPRIGHT",e[e.FACING_UPRIGHT=1]="FACING_UPRIGHT",e[e.VP_PARALLEL=2]="VP_PARALLEL",e[e.ORIENTED=3]="ORIENTED",e[e.VP_PARALLEL_ORIENTED=4]="VP_PARALLEL_ORIENTED"}(t.SpriteType||(t.SpriteType={})),function(e){e[e.SPR_NORMAL=0]="SPR_NORMAL",e[e.SPR_ADDITIVE=1]="SPR_ADDITIVE",e[e.SPR_INDEXALPHA=2]="SPR_INDEXALPHA",e[e.SPR_ALPHTEST=3]="SPR_ALPHTEST"}(s=t.SpriteAlphaType||(t.SpriteAlphaType={})),function(e){e[e.SYNCHRONIZED=0]="SYNCHRONIZED",e[e.RANDOM=1]="RANDOM"}(t.SpriteSyncType||(t.SpriteSyncType={}));class o{constructor(e,t){this.header=e,this.frames=t}static parse(e){const t=new r.Reader(e);if("IDSP"!==t.nstr(4))throw new Error("Invalid sprite file format");const n={version:t.i(),type:t.i(),alphaType:t.i(),radius:t.f(),width:t.i(),height:t.i(),frameCount:t.i(),beamLength:t.f(),syncType:t.i()},a=t.s(),u=t.arrx(3*a,r.ReaderDataType.UByte),c=[];for(let e=0;e<n.frameCount;++e){const e={group:t.i(),position:[t.i(),t.i()],width:t.i(),height:t.i(),data:new Uint8Array(n.width*n.height*4)},o=t.arrx(n.width*n.height,r.ReaderDataType.UByte);e.data=n.alphaType===s.SPR_ALPHTEST?i.paletteWithLastTransToRGBA(o,u):i.paletteToRGBA(o,u),c.push(e)}return new o(n,c)}}t.Sprite=o},function(){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),s=n(7),o=n(56),a=n(2);t.SettingsButton=class extends r.Component{constructor(){super(...arguments),this.onFreeModeClick=()=>{this.props.game.mode===s.PlayerMode.FREE||(this.props.game.changeMode(s.PlayerMode.FREE),this.props.game.player.pause())},this.onReplayModeClick=()=>{this.props.game.mode===s.PlayerMode.REPLAY||this.props.game.changeMode(s.PlayerMode.REPLAY)},this.toggleMenu=()=>{this.setState({isOpen:!this.state.isOpen})}}render(){const e=!!this.props.game.player.replay;return r.h("div",{class:o.SettingsButtonStyle.settings},r.h("div",{class:i.classes(a.ControlsStyle.button,o.SettingsButtonStyle.button),onClick:this.toggleMenu},r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},r.h("path",{"fill-rule":"evenodd","clip-rule":"evenodd",fill:"#ffffff",d:"M23.9 10.7c0-0.3-0.4-0.6-0.8-0.6 -1.1 0-2.1-0.6-2.5-1.6 -0.4-1-0.1-2.2 0.7-3 0.3-0.2 0.3-0.6 0.1-0.9 -0.6-0.7-1.2-1.4-1.9-1.9 -0.3-0.2-0.7-0.2-0.9 0.1 -0.7 0.8-2 1.1-3 0.7 -1-0.4-1.7-1.5-1.6-2.6 0-0.4-0.2-0.7-0.6-0.7 -0.9-0.1-1.8-0.1-2.7 0C10.4 0.1 10.1 0.4 10.1 0.8 10.1 1.9 9.5 2.9 8.5 3.3 7.5 3.7 6.2 3.4 5.5 2.6c-0.2-0.3-0.6-0.3-0.9-0.1 -0.7 0.6-1.4 1.2-1.9 1.9C2.4 4.8 2.5 5.2 2.7 5.4c0.8 0.8 1.1 2 0.7 3 -0.4 1-1.4 1.6-2.6 1.6 -0.4 0-0.7 0.2-0.7 0.6 -0.1 0.9-0.1 1.8 0 2.7 0 0.3 0.4 0.6 0.8 0.6 1 0 2 0.6 2.5 1.6 0.4 1 0.2 2.2-0.7 3 -0.3 0.2-0.3 0.6-0.1 0.9 0.6 0.7 1.2 1.4 1.9 1.9 0.3 0.2 0.7 0.2 0.9-0.1 0.7-0.8 2-1.1 3-0.7 1 0.4 1.7 1.5 1.6 2.6 0 0.4 0.2 0.7 0.6 0.7C11.1 24 11.5 24 12 24c0.4 0 0.9 0 1.3-0.1 0.3 0 0.6-0.3 0.6-0.7 0-1.1 0.6-2.1 1.6-2.6 1-0.4 2.3-0.1 3 0.7 0.2 0.3 0.6 0.3 0.9 0.1 0.7-0.6 1.4-1.2 1.9-1.9 0.2-0.3 0.2-0.7-0.1-0.9 -0.8-0.8-1.1-2-0.7-3 0.4-1 1.4-1.6 2.5-1.6l0.1 0c0.3 0 0.7-0.2 0.7-0.6C24 12.5 24 11.6 23.9 10.7zM12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6c3.3 0 6 2.7 6 6S15.3 18 12 18zM12 16"}))),r.h("div",{class:this.state.isOpen?o.SettingsButtonStyle.menuOpen:o.SettingsButtonStyle.menu},r.h("span",{class:o.SettingsButtonStyle.menuItemTitle},"Mode"),e?r.h("span",{class:this.props.game.mode===s.PlayerMode.REPLAY?o.SettingsButtonStyle.menuItemSelected:o.SettingsButtonStyle.menuItem,onClick:this.onReplayModeClick},"Replay"):r.h("span",null),r.h("span",{class:this.props.game.mode===s.PlayerMode.FREE?o.SettingsButtonStyle.menuItemSelected:o.SettingsButtonStyle.menuItem,onClick:this.onFreeModeClick},"Free")))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),s=n(18),o=n(57),a=n(2);t.FullscreenButton=class extends r.Component{constructor(){super(...arguments),this.state={isInFullscreen:!1},this.onClick=()=>{s.Fullscreen.isInFullscreen()?s.Fullscreen.exit():s.Fullscreen.enter(this.props.root)},this.onFullscreen=()=>{this.setState({isInFullscreen:s.Fullscreen.isInFullscreen()})}}componentDidMount(){s.Fullscreen.onChange(this.onFullscreen)}componentWillUnmount(){s.Fullscreen.onChangeRemove(this.onFullscreen)}render(){return r.h("div",{class:i.classes(a.ControlsStyle.button,o.FullscreenButtonStyle.button),onClick:this.onClick},this.state.isInFullscreen?r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},r.h("path",{d:"M0 22 L22 22 L22 0 L14 0 L14 14 L0 14 M42 0 L42 22 L64 22 L64 14 L50 14 L50 0 M14 50 L0 50 L0 42 L22 42 L22 64 L14 64 M42 64 L42 42 L64 42 L64 50 L50 50 L50 64 Z"})):r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},r.h("path",{d:"M0 22 L8 22 L8 8 L22 8 L22 0 L0 0 M42 0 L42 8 L56 8 L56 22 L64 22 L64 0 M0 64 L0 42 L8 42 L8 56 L22 56 L22 64 M64 64 L42 64 L42 56 L56 56 L56 42 L64 42 Z"})))}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=[{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",change:"fullscreenchange",error:"fullscreenerror"},{enabled:"mozFullScreenEnabled",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",change:"mozfullscreenchange",error:"mozfullscreenerror"},{enabled:"webkitFullscreenEnabled",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",change:"webkitfullscreenchange",error:"webkitfullscreenerror"},{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",change:"MSFullscreenChange",error:"MSFullscreenError"}];let r=0;const i=document;for(let e=0;e<n.length;++e)if(void 0!==i[n[e].enabled]){r=e;break}class s{static element(){return i[n[r].element]}static enabled(){return i[n[r].enabled]}static isInFullscreen(){return null!==s.element()}static enter(e){e[n[r].request]()}static exit(){i[n[r].exit]()}static onChange(e){return window.addEventListener(n[r].change,e)}static onChangeRemove(e){window.removeEventListener(n[r].change,e)}static onError(e){return window.addEventListener(n[r].error,e)}}t.Fullscreen=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(7),i=n(48),s=n(49);class o{constructor(e){this.game=e}load(e){this.game.load(e)}setTitle(e){this.game.setTitle(e)}getTitle(){return this.game.getTitle()}}var a;o.VERSION="1",(a||(a={})).init=function(e,t){const n=document.querySelector(e);if(!n)return null;const a=i.Config.init(t),u=r.Game.init(a);if("success"===u.status){const e=u.game;return new s.PlayerInterface(e,n).draw(),e.draw(),new o(e)}return null},t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const i=n(21),s=n(22),o=n(23),a=n(4),u=n(11),c=n(14),l=n(30),d=n(31);var f;!function(e){e[e.Loading=1]="Loading",e[e.Skipped=2]="Skipped",e[e.Error=3]="Error",e[e.Done=4]="Done"}(f||(f={}));class h{constructor(e){this.name=e,this.progress=0,this.status=f.Loading,this.data=null}isLoading(){return this.status===f.Loading}skip(){this.status=f.Skipped}isSkipped(){return this.status===f.Skipped}error(){this.status=f.Error}isError(){return this.status===f.Error}done(e){this.status=f.Done,this.data=e}isDone(){return this.status===f.Done}}class p extends h{constructor(){super(...arguments),this.type="replay"}}class m extends h{constructor(){super(...arguments),this.type="bsp"}}class g extends h{constructor(){super(...arguments),this.type="sky"}}class y extends h{constructor(){super(...arguments),this.type="wad"}}class v extends h{constructor(){super(...arguments),this.type="sound"}}class b extends h{constructor(){super(...arguments),this.type="sprite"}}t.Loader=class extends EventTarget{constructor(e){super(),this.sprites={},this.config=e,this.replay=void 0,this.map=void 0,this.skies=[],this.wads=[],this.sounds=[]}clear(){this.replay=void 0,this.map=void 0,this.skies.length=0,this.wads.length=0,this.sounds.length=0,this.sprites={}}checkStatus(){if((!this.replay||this.replay.isDone())&&(!this.map||this.map.isDone())){for(let e=0;e<this.skies.length;++e)if(this.skies[e].isLoading())return;for(let e=0;e<this.wads.length;++e)if(this.wads[e].isLoading())return;for(let e=0;e<this.sounds.length;++e)if(this.sounds[e].isLoading())return;const e=Object.entries(this.sprites);for(let t=0;t<e.length;++t)if(e[t][1].isLoading())return;this.dispatchEvent(a.evt("loadAll",{detail:{loader:this}}))}}load(e){const t=a.extname(e);".dem"===t?this.loadReplay(e):".bsp"===t?this.loadMap(e):console.error("Invalid file extension",e)}loadReplay(e){return r(this,void 0,void 0,function*(){this.replay=new p(e),this.dispatchEvent(a.evt("loadstart",{detail:{item:this.replay}}));const t=this.config.getReplaysPath(),n=yield l.xhr(`${t}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{this.replay&&(this.replay.progress=t),this.dispatchEvent(a.evt("progress",{detail:{item:this.replay}}))}}).catch(e=>{this.replay&&this.replay.error(),console.error(e,this.replay)});if(!this.replay.isError()){const e=yield u.Replay.parseIntoChunks(n);this.replay.done(e),this.loadMap(e.maps[0].name+".bsp"),e.maps[0].resources.sounds.forEach(e=>{e.used&&this.loadSound(e.name,e.index)}),this.dispatchEvent(a.evt("load",{detail:{item:this.replay}})),this.checkStatus()}})}loadMap(e){return r(this,void 0,void 0,function*(){this.map=new m(e),this.dispatchEvent(a.evt("loadstart",{detail:{item:this.map}}));const t=this.config.getMapsPath(),n=yield l.xhr(`${t}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{this.map&&(this.map.progress=t),this.dispatchEvent(a.evt("progress",{detail:{item:this.map}}))}}).catch(e=>{this.map&&this.map.error(),console.error(e,this.map)});if(this.map.isError())return;const r=yield d.BspParser.parse(e,n);this.map.done(r),r.entities.map(e=>"string"==typeof e.model&&-1<e.model.indexOf(".spr")?e.model:void 0).filter((e,t,n)=>e&&n.indexOf(e)===t).forEach(e=>e&&this.loadSprite(e));const i=r.entities[0].skyname;if(i&&["bk","dn","ft","lf","rt","up"].map(e=>`${i}${e}`).forEach(e=>this.loadSky(e)),r.textures.find(e=>e.isExternal)){const e=r.entities[0].wad.map(e=>this.loadWad(e));yield Promise.all(e)}this.dispatchEvent(a.evt("load",{detail:{item:this.map}})),this.checkStatus()})}loadSprite(e){return r(this,void 0,void 0,function*(){const t=new b(e);this.sprites[e]=t,this.dispatchEvent(a.evt("loadstart",{detail:{item:t}}));const n=yield l.xhr(`${this.config.getBasePath()}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,n)=>{t.progress=n,this.dispatchEvent(a.evt("progress",{detail:{item:t}}))}}).catch(e=>{t.error(),console.error(e,t),this.checkStatus()});if(!t.isError()){const e=c.Sprite.parse(n);t.done(e),this.dispatchEvent(a.evt("load",{detail:{item:t}})),this.checkStatus()}})}loadSky(e){return r(this,void 0,void 0,function*(){const t=new g(e);this.skies.push(t),this.dispatchEvent(a.evt("loadstart",{detail:{item:t}}));const n=this.config.getSkiesPath(),r=yield l.xhr(`${n}/${e}.tga`,{method:"GET",isBinary:!0,progressCallback:(e,n)=>{t.progress=n,this.dispatchEvent(a.evt("progress",{detail:{item:t}}))}}).catch(e=>{t.error(),console.error(e,t),this.checkStatus()});if(!t.isError()){const n=s.Tga.parse(r,e);t.done(n),this.dispatchEvent(a.evt("load",{detail:{item:t}})),this.checkStatus()}})}loadWad(e){return r(this,void 0,void 0,function*(){const t=new y(e);this.wads.push(t),this.dispatchEvent(a.evt("loadstart",{detail:{item:t}}));const n=this.config.getWadsPath(),r=yield l.xhr(`${n}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,n)=>{t.progress=n,this.dispatchEvent(a.evt("progress",{detail:{item:t}}))}}).catch(e=>{t.error(),console.error(e,t),this.checkStatus()});if(t.isError())return;const i=yield o.Wad.parse(r);if(t.done(i),!this.map||!this.map.data)return;const s=this.map.data;i.entries.forEach(e=>{"texture"!==e.type||s.textures.forEach(t=>{((e,t)=>e.toLowerCase()===t.toLowerCase())(e.name,t.name)&&(t.width=e.width,t.height=e.height,t.data=e.data)})}),this.dispatchEvent(a.evt("loadstart",{detail:{item:t}})),this.checkStatus()})}loadSound(e,t){return r(this,void 0,void 0,function*(){const n=new v(e);this.sounds.push(n),this.dispatchEvent(a.evt("loadstart",{detail:{item:n}}));const r=this.config.getSoundsPath(),s=yield l.xhr(`${r}/${e}`,{method:"GET",isBinary:!0,progressCallback:(e,t)=>{n.progress=t,this.dispatchEvent(a.evt("loadstart",{detail:{item:n}}))}}).catch(e=>{n.error(),console.error(e,n),this.checkStatus()});if(!n.isError()){const r=yield i.Sound.create(s).catch(e=>{n.error(),console.error(e,n),this.checkStatus()});!r||n.isError()||(r.index=t,r.name=e,n.done(r),this.dispatchEvent(a.evt("loadstart",{detail:{item:n}})),this.checkStatus())}})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(10);class i{constructor(e){this.index=-1,this.name="",this.buffer=e}static create(e){return new Promise((t,n)=>{r.SoundSystem.getContext().decodeAudioData(e,e=>{t(new i(e))},e=>{n(e)})})}}t.Sound=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3);class i{constructor(e,t,n,r){this.name=e,this.width=t,this.height=n,this.data=r}static parse(e,t){let n=new r.Reader(e),s={idLength:n.ub(),colorMapType:n.ub(),imageType:n.ub(),colorMap:{firstEntryIndex:n.us(),length:n.us(),size:n.ub()},image:{xOrigin:n.us(),yOrigin:n.us(),width:n.us(),height:n.us(),depth:n.ub(),descriptor:n.ub()}};if(s.idLength&&n.arrx(s.idLength,r.ReaderDataType.UByte),s.colorMapType)throw new Error("Not implemented");let o,a=s.image.width,u=s.image.height,c=a*u;if(2===s.imageType){let e=c*s.image.depth/8;if(o=n.arrx(e,r.ReaderDataType.UByte),24===s.image.depth){let e=new Uint8Array(4*c);for(let t=0;t<u;++t)for(let n,r=0;r<a;++r)e[4*(n=(u-1-t)*a+r)]=o[3*(t*a+r)+2],e[4*n+1]=o[3*(t*a+r)+1],e[4*n+2]=o[3*(t*a+r)],e[4*n+3]=255;o=e}else if(32===s.image.depth){let e=new Uint8Array(4*c);for(let t=0;t<u;++t)for(let n,r=0;r<a;++r)e[4*(n=(u-1-t)*a+r)]=o[4*(t*a+r)+2],e[4*n+1]=o[4*(t*a+r)+1],e[4*n+2]=o[4*(t*a+r)],e[4*n+3]=255;o=e}}else if(10===s.imageType&&(o=new Uint8Array(4*c),24===s.image.depth))for(let e=0;e<u;++e)for(let t,r=0;r<a;)if(128&(t=n.ub())){t=1+(127&t);for(let i,s=n.ub(),c=n.ub(),l=n.ub();r<a&&t;)o[4*(i=(u-1-e)*a+r)]=l,o[4*i+1]=c,o[4*i+2]=s,o[4*i+3]=255,++r,--t}else for(t=1+(127&t);r<a&&t;){let i=(u-1-e)*a+r;o[4*i+2]=n.ub(),o[4*i+1]=n.ub(),o[4*i]=n.ub(),o[4*i+3]=255,++r,--t}return new i(t,s.image.width,s.image.height,o)}}t.Tga=i},function(e,t,r){"use strict";function i(e,t){const r=e.ui()&&256,i=e.ui(),s=e.ui(),u=e.ui(),c=[];for(let t=0;256>t;++t){const t=e.us(),i=e.us();c.push({x:t%r,y:n(t/r)/u*u,width:i,height:u})}const l=e.arrx(r*i,o.ReaderDataType.UByte);e.skip(2);const d=e.arrx(768,o.ReaderDataType.UByte);return{type:"font",name:t.name,width:r,height:i,rowCount:s,rowHeight:u,glyphs:c,data:a.paletteWithLastTransToRGBA(l,d)}}function s(e,t){switch(e.seek(t.offset),t.type){case 64:return function(e){const t=e.nstr(16),n=e.ui(),r=e.ui();e.skip(16);const i=n*r,s=e.arrx(i,o.ReaderDataType.UByte);e.skip(i/64*21),e.skip(2);const u=e.arrx(768,o.ReaderDataType.UByte);return{type:"decal",name:t,width:n,height:r,data:"{"===t[0]?a.paletteWithLastTransToRGBA(s,u):a.paletteToRGBA(s,u)}}(e);case 66:return u(e,t);case 67:return function(e){const t=e.nstr(16),n=e.ui(),r=e.ui();e.skip(16);const i=n*r,s=e.arrx(i,o.ReaderDataType.UByte);e.skip(i/64*21),e.skip(2);const u=e.arrx(768,o.ReaderDataType.UByte);return{type:"texture",name:t,width:n,height:r,data:"{"===t[0]?a.paletteWithLastTransToRGBA(s,u):a.paletteToRGBA(s,u)}}(e);case 70:return i(e,t);default:return c(e,t)}}Object.defineProperty(t,"__esModule",{value:!0});const o=r(3),a=r(8),u=(e,t)=>({type:"cache",name:t.name}),c=(e,t)=>({type:"unknown",name:t.name,data:e.arrx(t.length,o.ReaderDataType.UByte)});class l{constructor(e){this.entries=e}static parse(e){const t=new o.Reader(e);if("WAD3"!==t.nstr(4))throw new Error("Invalid WAD file format");const n=t.ui(),r=t.ui();t.seek(r);const i=[];for(let e=0;e<n;++e){const e={offset:t.ui(),diskLength:t.ui(),length:t.ui(),type:t.b(),isCompressed:t.b(),name:""};t.skip(2),e.name=t.nstr(16),i.push(e)}const a=i.map(e=>s(t,e));return new l(a)}}t.Wad=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReplayMap=class{constructor(e){this.name=e.split("/").reverse()[0].split(".")[0],this.chunks=[],this.resources={sounds:[],skins:[],models:[],decals:[],custom:[],events:[]}}setResources(e){e.forEach(e=>{switch(e.type){case 0:e.used=!1,this.resources.sounds.push(e);break;case 1:this.resources.skins.push(e);break;case 2:this.resources.models.push(e);break;case 3:this.resources.decals.push(e);break;case 4:this.resources.custom.push(e);break;case 5:this.resources.events.push(e)}})}addChunk(e){this.chunks.push(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(3);t.ReplayChunk=class{constructor(e,t){this.state=e.clone(),this.startTime=t,this.timeLength=10,this.data=null,this.reader=null}setData(e){this.data=new Uint8Array(e.length);for(let t=0;t<e.length;++t)this.data[t]=e[t];this.reader=new r.Reader(this.data.buffer)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(27),s=r(13),o=r(29),a=r(3);class u{static bad(){throw new Error("Invalid message type")}static nop(){return null}static disconnect(e){return{reason:e.str()}}static event(e,t){let r=new o.BitStream(e.data.buffer);r.index=8*e.tell();let i=[],a=r.readBits(5);for(let e=0;e<a;++e){let e={index:r.readBits(10)};if(r.readBits(1)){e.packetIndex=r.readBits(11),r.readBits(1)&&(e.delta=s.readDelta(r,t.event_t))}r.readBits(1)&&(e.fireTime=r.readBits(16)),i.push(e)}return 0<r.index%8?e.seek(n(r.index/8)+1):e.seek(r.index/8),{events:i}}static version(e){return{version:e.ui()}}static setView(e){return{entityIndex:e.s()}}static sound(e){let t=new o.BitStream(e.data.buffer);t.index=8*e.tell();let r=t.readBits(9),s=1;0!=(1&r)&&(s=t.readBits(8)/255);let a=1;0!=(2&r)&&(a=t.readBits(8)/64);let u,c=t.readBits(3),l=t.readBits(11);u=0==(4&r)?t.readBits(8):t.readBits(16);let d,f,h,p=t.readBits(1),m=t.readBits(1),g=t.readBits(1);p&&(d=i.readCoord(t)),m&&(f=i.readCoord(t)),g&&(h=i.readCoord(t));let y=1;return 0!=(8&r)&&(y=t.readBits(8)),0<t.index%8?e.seek(n(t.index/8)+1):e.seek(t.index/8),{flags:r,volume:s,attenuation:a,channel:c,entityIndex:l,soundIndex:u,xPosition:d,yPosition:f,zPosition:h,pitch:y}}static time(e){return{time:e.f()}}static print(e){return{message:e.str()}}static stuffText(e){return{commands:e.str().split(";").map(e=>{let t=e.split(/\s*("[^"]+"|[^\s"]+)/).map(e=>e.replace(/^"(.*)"$/,"$1").trim()).filter(e=>e);return{func:t[0],params:t.slice(1)}})}}static setAngle(e){return{pitch:e.s(),yaw:e.s(),roll:e.s()}}static serverInfo(e){let t={protocol:e.i(),spawnCount:e.i(),mapCrc:e.i(),clientDllHash:e.arrx(16,a.ReaderDataType.UByte),maxPlayers:e.ub(),playerIndex:e.ub(),isDeathmatch:e.ub(),gameDir:e.str(),hostName:e.str(),mapFileName:e.str(),mapCycle:e.str()};return e.skip(1),t}static lightStyle(e){return{index:e.ub(),lightInfo:e.str()}}static updateUserInfo(e){return{clientIndex:e.ub(),clientUserId:e.ui(),clientUserInfo:e.str(),clientCdKeyHash:e.arrx(16,a.ReaderDataType.UByte)}}static deltaDescription(e,t){let r={name:e.str(),fields:[]},i=new o.BitStream(e.data.buffer),a=e.us();i.index=8*e.tell();for(let e=0;e<a;++e)r.fields.push(s.readDelta(i,t.delta_description_t));return t[r.name]=r.fields,0<i.index%8?e.seek(n(i.index/8)+1):e.seek(i.index/8),r}static clientData(e,t){let r=new o.BitStream(e.data.buffer);r.index=8*e.tell(),r.readBits(1)&&(r.index+=8);let i=t.clientdata_t,a=s.readDelta(r,i),u=t.weapon_data_t;for(;r.readBits(1);)r.index+=6,s.readDelta(r,u);return 0<r.index%8?e.seek(n(r.index/8)+1):e.seek(r.index/8),{clientData:a}}static stopSound(e){return{entityIndex:e.s()}}static pings(e){let t=new o.BitStream(e.data.buffer);t.index=8*e.tell();let r=[];for(;t.readBits(1);)r.push({slot:t.readBits(8),ping:t.readBits(8),loss:t.readBits(8)});return 0<t.index%8?e.seek(n(t.index/8)+1):e.seek(t.index/8),r}static particle(e){return{position:[e.s()/8,e.s()/8,e.s()/8],direction:[e.b(),e.b(),e.b()],count:e.ub(),color:e.ub()}}static damage(){return null}static spawnStatic(e){let t={modelIndex:e.s(),sequence:e.b(),frame:e.b(),colorMap:e.s(),skin:e.b(),position:[],rotation:[]};return t.position[0]=e.s()/8,t.rotation[0]=1.40625*e.b(),t.position[1]=e.s()/8,t.rotation[1]=1.40625*e.b(),t.position[2]=e.s()/8,t.rotation[2]=1.40625*e.b(),t.renderMode=e.b(),t.renderMode&&(t.renderAmt=e.b(),t.renderColor=[e.ub(),e.ub(),e.ub()],t.renderFx=e.b()),t}static eventReliable(e,t){let r=new o.BitStream(e.data.buffer);r.index=8*e.tell();let i,a=r.readBits(10),u=s.readDelta(r,t.event_t),c=r.readBits(1);return c&&(i=r.readBits(16)),0<r.index%8?e.seek(n(r.index/8)+1):e.seek(r.index/8),{eventIndex:a,eventData:u,delayBit:c,delay:i}}static spawnBaseLine(e,t){let r=new o.BitStream(e.data.buffer);r.index=8*e.tell();let i=[];for(;;){let e,n=r.readBits(11);if(2047===n)break;e=1&r.readBits(2)?0<n&&32>=n?"entity_state_player_t":"entity_state_t":"custom_entity_state_t",i[n]=s.readDelta(r,t[e])}if(31!==r.readBits(5))throw new Error("Bad spawnbaseline");let a=r.readBits(6),u=[];for(let e=0;e<a;++e)u.push(s.readDelta(r,t.entity_state_t));return 0<r.index%8?e.seek(n(r.index/8)+1):e.seek(r.index/8),{entities:i,extraData:u}}static tempEntity(e){let t={};switch(e.ub()){case 0:e.skip(24);break;case 1:e.skip(20);break;case 2:e.skip(6);break;case 3:e.skip(11);break;case 4:e.skip(6);break;case 5:e.skip(10);break;case 6:e.skip(12);break;case 7:e.skip(17);break;case 8:e.skip(16);break;case 9:case 10:case 11:e.skip(6);break;case 12:e.skip(8);break;case 13:e.skip(8),e.s()&&e.skip(2);break;case 14:e.skip(9);break;case 15:e.skip(19);break;case 17:e.skip(10);break;case 18:e.skip(16);break;case 19:case 20:case 21:e.skip(24);break;case 22:e.skip(10);break;case 23:e.skip(11);break;case 24:e.skip(16);break;case 25:e.skip(19);break;case 27:e.skip(12);break;case 28:e.skip(16);break;case 29:t.channel=e.b(),t.x=e.s(),t.y=e.s(),t.effect=e.b(),t.textColor=[e.ub(),e.ub(),e.ub(),e.ub()],t.effectColor=[e.ub(),e.ub(),e.ub(),e.ub()],t.fadeInTime=e.s(),t.fadeOutTime=e.s(),t.holdTime=e.s(),t.effect&&(t.effectTime=e.s()),t.message=e.str();break;case 30:case 31:e.skip(17);break;case 99:e.skip(2);break;case 100:e.skip(10);break;case 101:e.skip(14);break;case 102:e.skip(12);break;case 103:e.skip(14);break;case 104:e.skip(9);break;case 105:e.skip(5);break;case 106:e.skip(17);break;case 107:e.skip(13);break;case 108:e.skip(24);break;case 109:e.skip(9);break;case 110:e.skip(17);break;case 111:e.skip(7);break;case 112:e.skip(10);break;case 113:case 114:e.skip(19);break;case 115:e.skip(12);break;case 116:case 117:e.skip(7);break;case 118:e.skip(9);break;case 119:e.skip(16);break;case 120:e.skip(18);break;case 121:e.skip(5);break;case 122:e.skip(10);break;case 123:e.skip(9);break;case 124:e.skip(7);break;case 125:e.skip(1);break;case 126:e.skip(18);break;case 127:e.skip(15);break;default:throw new Error("Unknown temp entity type")}return t}static setPause(e){return{isPaused:e.b()}}static signOnNum(e){return{sign:e.b()}}static centerPrint(e){return{message:e.str()}}static killedMonster(){return null}static foundSecret(){return null}static spawnStaticSound(e){return{position:[e.s()/8,e.s()/8,e.s()/8],soundIndex:e.us(),volume:e.ub()/255,attenuation:e.ub()/64,entityIndex:e.us(),pitch:e.ub(),flags:e.ub()}}static intermission(){return null}static finale(e){return{text:e.str()}}static cdTrack(e){return{track:e.b(),loopTrack:e.b()}}static restore(e){let t=e.str(),n=e.ub(),r=[];for(let t=0;t<n;++t)r.push(e.str());return{saveName:t,maps:r}}static cutscene(e){return{text:e.str()}}static weaponAnim(e){return{sequenceNumber:e.b(),weaponModelBodyGroup:e.b()}}static decalName(e){return{positionIndex:e.ub(),decalName:e.str()}}static roomType(e){return{type:e.us()}}static addAngle(e){return{angleToAdd:e.s()/(360/65536)}}static newUserMsg(e){return{index:e.ub(),size:e.b(),name:e.nstr(16)}}static packetEntities(e,t){let r=new o.BitStream(e.data.buffer);r.index=8*e.tell();let i=[];r.readBits(16);for(let e,n=0;0!==(e=r.readBits(16));){if(r.index-=16,r.readBits(1))n++;else{r.readBits(1)?n=r.readBits(11):n+=r.readBits(6)}let e=r.readBits(1);r.readBits(1)&&(r.index+=6);let o="entity_state_t";0<n&&32>=n?o="entity_state_player_t":e&&(o="custom_entity_state_t"),i.push(s.readDelta(r,t[o]))}return 0<r.index%8?e.seek(n(r.index/8)+1):e.seek(r.index/8),{entityStates:i}}static deltaPacketEntities(e,t){let r=new o.BitStream(e.data.buffer);r.index=8*e.tell(),r.readBits(16),r.index+=8;let i=[],a=0;for(;;){if(0===r.readBits(16))break;r.index-=16;let e=r.readBits(1);if(r.readBits(1)?a=r.readBits(11):a+=r.readBits(6),e)continue;let n=r.readBits(1),o="entity_state_t";0<a&&32>a?o="entity_state_player_t":n&&(o="custom_entity_state_t"),i[a]=s.readDelta(r,t[o])}return 0<r.index%8?e.seek(n(r.index/8)+1):e.seek(r.index/8),{entityStates:i}}static choke(){return null}static resourceList(e){let t=new o.BitStream(e.data.buffer);t.index=8*e.tell();let r=[],i=t.readBits(12);for(let e,n=0;n<i;++n){(e={}).type=t.readBits(4),e.name=t.readString(),e.index=t.readBits(12),e.size=t.readBits(24),4&t.readBits(3)&&(t.index+=128),t.readBits(1)&&(t.index+=256),r.push(e)}if(t.readBits(1))for(;t.readBits(1);){let e=t.readBits(1)?5:10;t.index+=e}return 0<t.index%8?e.seek(n(t.index/8)+1):e.seek(t.index/8),r}static newMoveVars(e){return{gravity:e.f(),stopSpeed:e.f(),maxSpeed:e.f(),spectatorMaxSpeed:e.f(),acceleration:e.f(),airAcceleration:e.f(),waterAcceleration:e.f(),friction:e.f(),edgeFriction:e.f(),waterFriction:e.f(),entityGravity:e.f(),bounce:e.f(),stepSize:e.f(),maxVelocity:e.f(),zMax:e.f(),waveHeight:e.f(),footsteps:e.b(),rollAngle:e.f(),rollSpeed:e.f(),skyColor:[e.f(),e.f(),e.f()],skyVec:[e.f(),e.f(),e.f()],skyName:e.str()}}static resourceRequest(e){let t={spawnCount:e.i()};return e.skip(4),t}static customization(e){let t,n=e.ub(),r=e.ub(),i=e.str(),s=e.us(),o=e.ui(),a=e.ub();return 4&a&&(t=[e.i(),e.i(),e.i(),e.i()]),{playerIndex:n,type:r,name:i,index:s,downloadSize:o,flags:a,md5hash:t}}static crosshairAngle(e){return{pitch:e.b(),yaw:e.b()}}static soundFade(e){return{initialPercent:e.ub(),holdTime:e.ub(),fadeOutTime:e.ub(),fadeInTime:e.ub()}}static fileTxferFailed(e){return{filename:e.str()}}static hltv(e){return{mode:e.ub()}}static director(e){let t=e.ub();return{flag:e.ub(),message:e.nstr(t-1)}}static voiceInit(e){return{codecName:e.str(),quality:e.b()}}static voiceData(e){let t=e.ub(),n=e.us();return{playerIndex:t,data:e.arrx(n,a.ReaderDataType.UByte)}}static sendExtraInfo(e){return{fallbackDir:e.str(),canCheat:e.ub()}}static timeScale(e){return{timeScale:e.f()}}static resourceLocation(e){return{url:e.str()}}static sendCvarValue(e){return{name:e.str()}}static sendCvarValue2(e){return{requestId:e.ui(),name:e.str()}}static read(e,t,n){if(0===t)return null;const r=u.handlers[t];return r?r(e,n):null}}u.handlers=[u.bad,u.nop,u.disconnect,u.event,u.version,u.setView,u.sound,u.time,u.print,u.stuffText,u.setAngle,u.serverInfo,u.lightStyle,u.updateUserInfo,u.deltaDescription,u.clientData,u.stopSound,u.pings,u.particle,u.damage,u.spawnStatic,u.eventReliable,u.spawnBaseLine,u.tempEntity,u.setPause,u.signOnNum,u.centerPrint,u.killedMonster,u.foundSecret,u.spawnStaticSound,u.intermission,u.finale,u.cdTrack,u.restore,u.cutscene,u.weaponAnim,u.decalName,u.roomType,u.addAngle,u.newUserMsg,u.packetEntities,u.deltaPacketEntities,u.choke,u.resourceList,u.newMoveVars,u.resourceRequest,u.customization,u.crosshairAngle,u.soundFade,u.fileTxferFailed,u.hltv,u.director,u.voiceInit,u.voiceData,u.sendExtraInfo,u.timeScale,u.resourceLocation,u.sendCvarValue,u.sendCvarValue2],t.FrameDataReader=u,function(e){let t;!function(e){e[e.BAD=0]="BAD",e[e.NOP=1]="NOP",e[e.DISCONNECT=2]="DISCONNECT",e[e.EVENT=3]="EVENT",e[e.VERSION=4]="VERSION",e[e.SETVIEW=5]="SETVIEW",e[e.SOUND=6]="SOUND",e[e.TIME=7]="TIME",e[e.PRINT=8]="PRINT",e[e.STUFFTEXT=9]="STUFFTEXT",e[e.SETANGLE=10]="SETANGLE",e[e.SERVERINFO=11]="SERVERINFO",e[e.LIGHTSTYLE=12]="LIGHTSTYLE",e[e.UPDATEUSERINFO=13]="UPDATEUSERINFO",e[e.DELTADESCRIPTION=14]="DELTADESCRIPTION",e[e.CLIENTDATA=15]="CLIENTDATA",e[e.STOPSOUND=16]="STOPSOUND",e[e.PINGS=17]="PINGS",e[e.PARTICLE=18]="PARTICLE",e[e.DAMAGE=19]="DAMAGE",e[e.SPAWNSTATIC=20]="SPAWNSTATIC",e[e.EVENT_RELIABLE=21]="EVENT_RELIABLE",e[e.SPAWNBASELINE=22]="SPAWNBASELINE",e[e.TEMPENTITY=23]="TEMPENTITY",e[e.SETPAUSE=24]="SETPAUSE",e[e.SIGNONNUM=25]="SIGNONNUM",e[e.CENTERPRINT=26]="CENTERPRINT",e[e.KILLEDMONSTER=27]="KILLEDMONSTER",e[e.FOUNDSECRET=28]="FOUNDSECRET",e[e.SPAWNSTATICSOUND=29]="SPAWNSTATICSOUND",e[e.INTERMISSION=30]="INTERMISSION",e[e.FINALE=31]="FINALE",e[e.CDTRACK=32]="CDTRACK",e[e.RESTORE=33]="RESTORE",e[e.CUTSCENE=34]="CUTSCENE",e[e.WEAPONANIM=35]="WEAPONANIM",e[e.DECALNAME=36]="DECALNAME",e[e.ROOMTYPE=37]="ROOMTYPE",e[e.ADDANGLE=38]="ADDANGLE",e[e.NEWUSERMSG=39]="NEWUSERMSG",e[e.PACKETENTITIES=40]="PACKETENTITIES",e[e.DELTAPACKETENTITIES=41]="DELTAPACKETENTITIES",e[e.CHOKE=42]="CHOKE",e[e.RESOURCELIST=43]="RESOURCELIST",e[e.NEWMOVEVARS=44]="NEWMOVEVARS",e[e.RESOURCEREQUEST=45]="RESOURCEREQUEST",e[e.CUSTOMIZATION=46]="CUSTOMIZATION",e[e.CROSSHAIRANGLE=47]="CROSSHAIRANGLE",e[e.SOUNDFADE=48]="SOUNDFADE",e[e.FILETXFERFAILED=49]="FILETXFERFAILED",e[e.HLTV=50]="HLTV",e[e.DIRECTOR=51]="DIRECTOR",e[e.VOICEINIT=52]="VOICEINIT",e[e.VOICEDATA=53]="VOICEDATA",e[e.SENDEXTRAINFO=54]="SENDEXTRAINFO",e[e.TIMESCALE=55]="TIMESCALE",e[e.RESOURCELOCATION=56]="RESOURCELOCATION",e[e.SENDCVARVALUE=57]="SENDCVARVALUE",e[e.SENDCVARVALUE2=58]="SENDCVARVALUE2"}(t=e.SVC||(e.SVC={}))}(u=t.FrameDataReader||(t.FrameDataReader={}))},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readCoord=function(e){let t=e.readBits(1),n=e.readBits(1);if(!t&&!n)return 0;let r=e.readBits(1),i=0,s=0;t&&(i=e.readBits(12)),n&&(s=e.readBits(3));let o=i+s/32;return r&&(o=-o),o}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.DT_BYTE=1]="DT_BYTE",e[e.DT_SHORT=2]="DT_SHORT",e[e.DT_FLOAT=4]="DT_FLOAT",e[e.DT_INTEGER=8]="DT_INTEGER",e[e.DT_ANGLE=16]="DT_ANGLE",e[e.DT_TIMEWINDOW_8=32]="DT_TIMEWINDOW_8",e[e.DT_TIMEWINDOW_BIG=64]="DT_TIMEWINDOW_BIG",e[e.DT_STRING=128]="DT_STRING",e[e.DT_SIGNED=-2147483648]="DT_SIGNED"}(t.DeltaType||(t.DeltaType={}))},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});class r{constructor(e){this.view=new Uint8Array(e,0,e.byteLength)}getBits(e,n,r=!1){if(n>8*this.view.length-e)throw new Error("Bits out of bounds");let i=0;for(let r=0;r<n;){const s=n-r,o=7&e,a=this.view[e>>3],u=t(s,8-o);i|=(a>>o&(1<<u)-1)<<r,e+=u,r+=u}return r?(32!==n&&i&1<<n-1&&(i|=-1^(1<<n)-1),i):i>>>0}getInt8(e){return this.getBits(e,8,!0)}getUint8(e){return this.getBits(e,8,!1)}getInt16(e){return this.getBits(e,16,!0)}getUint16(e){return this.getBits(e,16,!1)}getInt32(e){return this.getBits(e,32,!0)}getUint32(e){return this.getBits(e,32,!1)}getFloat32(e){return r.scratch.setUint32(0,this.getUint32(e)),r.scratch.getFloat32(0)}getFloat64(e){return r.scratch.setUint32(0,this.getUint32(e)),r.scratch.setUint32(4,this.getUint32(e+32)),r.scratch.getFloat64(0)}}r.scratch=new DataView(new ArrayBuffer(8)),n.BitView=r,n.BitStream=class{constructor(e){this.view=new r(e),this.index=0}readBits(e,t=!1){const n=this.view.getBits(this.index,e,t);return this.index+=e,n}readInt8(){const e=this.view.getInt8(this.index);return this.index+=8,e}readUint8(){const e=this.view.getUint8(this.index);return this.index+=8,e}readInt16(){const e=this.view.getInt16(this.index);return this.index+=16,e}readUint16(){const e=this.view.getUint16(this.index);return this.index+=16,e}readInt32(){const e=this.view.getInt32(this.index);return this.index+=32,e}readUint32(){const e=this.view.getUint32(this.index);return this.index+=32,e}readFloat32(){const e=this.view.getFloat32(this.index);return this.index+=32,e}readFloat64(){const e=this.view.getFloat64(this.index);return this.index+=64,e}readString(e=0,t=!1){let n=0;const r=[];for(let t=!0;!e||e&&n<e;){const i=this.readUint8();if(0===i&&(t=!1,!e))break;t&&r.push(i),n++}const i=l.apply(null,r);if(!t)return i;try{return decodeURIComponent(i)}catch(t){return i}}}},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.xhr=function(e,n){let r=n.method||"GET",i=n.isBinary,s=n.progressCallback;if(!e)throw new Error("Url parameter missing");return new Promise((n,o)=>{let a=new XMLHttpRequest;i&&(a.responseType="arraybuffer"),i&&s&&a.addEventListener("progress",e=>{if(e.lengthComputable)s(a,e.loaded/e.total);else{let n=a.getResponseHeader("content-length"),r=0;n&&(r=parseFloat(n));let i=a.getResponseHeader("content-encoding");if(r&&i&&-1<i.indexOf("gzip")){r*=4;let n=t(.99,e.loaded/r);s(a,n)}else s(a,0)}}),a.addEventListener("readystatechange",e=>{4!==e.target.readyState||(200===e.target.status?(s&&s(a,1),n(e.target.response)):o({status:e.target.status}))}),a.open(r,e,!0),a.send()})}},function(e,t,n){"use strict";function r(e,t,n,r,i,s,o,a){const c=[];for(let l=0;l<e.length;++l){const d=e[l],f=[],h=new Float32Array(3),p=new Float32Array(3),m=new Float32Array(3),g=new Float32Array(2),y=new Float32Array(2),v=new Float32Array(2),b=new Float32Array(2),x=new Float32Array(2),E=new Float32Array(2);let T=0===l?[0,0,0]:[0,0,0].map((e,t)=>(d.maxs[t]-d.mins[t])/2+d.mins[t]);for(let e=d.firstFace;e<d.firstFace+d.faceCount;++e){const c={buffer:new Float32Array(21*(t[e].edgeCount-2)),textureIndex:-1},l=s[t[e].textureInfo],d=o[l.textureIndex],S=r.slice(t[e].firstEdge,t[e].firstEdge+t[e].edgeCount),w=n[u(S[0])][0<S[0]?0:1];h[0]=i[w][0],h[1]=i[w][1],h[2]=i[w][2],g[0]=h[0]*l.s[0]+h[1]*l.s[1]+h[2]*l.s[2]+l.sShift,g[1]=h[0]*l.t[0]+h[1]*l.t[1]+h[2]*l.t[2]+l.tShift,b[0]=0,b[1]=0;const k=n[u(S[1])][0<S[1]?0:1];p[0]=i[k][0],p[1]=i[k][1],p[2]=i[k][2],y[0]=p[0]*l.s[0]+p[1]*l.s[1]+p[2]*l.s[2]+l.sShift,y[1]=p[0]*l.t[0]+p[1]*l.t[1]+p[2]*l.t[2]+l.tShift,x[0]=0,x[1]=.999;let _=0;for(let r=2;r<t[e].edgeCount;++r){const e=n[u(S[r])][0<S[r]?0:1];m[0]=i[e][0],m[1]=i[e][1],m[2]=i[e][2],v[0]=m[0]*l.s[0]+m[1]*l.s[1]+m[2]*l.s[2]+l.sShift,v[1]=m[0]*l.t[0]+m[1]*l.t[1]+m[2]*l.t[2]+l.tShift,E[0]=.999,E[1]=.999,c.buffer[_++]=h[0],c.buffer[_++]=h[1],c.buffer[_++]=h[2],c.buffer[_++]=g[0],c.buffer[_++]=g[1],c.buffer[_++]=b[0],c.buffer[_++]=b[1],c.buffer[_++]=p[0],c.buffer[_++]=p[1],c.buffer[_++]=p[2],c.buffer[_++]=y[0],c.buffer[_++]=y[1],c.buffer[_++]=x[0],c.buffer[_++]=x[1],c.buffer[_++]=m[0],c.buffer[_++]=m[1],c.buffer[_++]=m[2],c.buffer[_++]=v[0],c.buffer[_++]=v[1],c.buffer[_++]=E[0],c.buffer[_++]=E[1],p[0]=m[0],p[1]=m[1],p[2]=m[2],y[0]=v[0],y[1]=v[1],x[0]=E[0],x[1]=E[1]}(0===l.flags||-65536===l.flags)&&a.processFace(c.buffer,l,t[e].lightmapOffset),c.textureIndex=l.textureIndex;for(let e=0;e<c.buffer.length/7;++e)c.buffer[7*e]-=T[0],c.buffer[7*e+1]-=T[1],c.buffer[7*e+2]-=T[2],c.buffer[7*e+3]/=d.width,c.buffer[7*e+4]/=d.height;f.push(c)}c.push({origin:T,faces:f})}return c}Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),s=n(32),o=n(33),a=n(3),c=n(34),l=n(8);var d;t.parseModels=r,function(e){e[e.Entities=0]="Entities",e[e.Planes=1]="Planes",e[e.Textures=2]="Textures",e[e.Vertices=3]="Vertices",e[e.Visibility=4]="Visibility",e[e.Nodes=5]="Nodes",e[e.TexInfo=6]="TexInfo",e[e.Faces=7]="Faces",e[e.Lighting=8]="Lighting",e[e.ClipNodes=9]="ClipNodes",e[e.Leaves=10]="Leaves",e[e.MarkSurfaces=11]="MarkSurfaces",e[e.Edges=12]="Edges",e[e.SurfEdges=13]="SurfEdges",e[e.Models=14]="Models"}(d=t.BspLumpIndex||(t.BspLumpIndex={})),t.BspParser=class{static parse(e,t){const n=new a.Reader(t);if(30!==n.ui())throw new Error("Invalid map version");const i=[];for(let e=0;15>e;++e)i.push({offset:n.ui(),length:n.ui()});const s=this.loadEntities(n,i[d.Entities].offset,i[d.Entities].length),u=this.loadTextures(n,i[d.Textures].offset),l=this.loadModels(n,i[d.Models].offset,i[d.Models].length),f=this.loadFaces(n,i[d.Faces].offset,i[d.Faces].length),h=this.loadEdges(n,i[d.Edges].offset,i[d.Edges].length),p=this.loadSurfEdges(n,i[d.SurfEdges].offset,i[d.SurfEdges].length),m=this.loadVertices(n,i[d.Vertices].offset,i[d.Vertices].length),g=this.loadTexInfo(n,i[d.TexInfo].offset,i[d.TexInfo].length),y=this.loadLightmap(n,i[d.Lighting].offset,i[d.Lighting].length),v=c.BspLightmapParser.init(y),b=r(l,f,h,p,m,g,u,v);return new o.Bsp(e,s,u,b,{width:c.BspLightmapParser.TEXTURE_SIZE,height:c.BspLightmapParser.TEXTURE_SIZE,data:v.getTexture()})}static loadFaces(e,t,n){e.seek(t);const r=[];for(let t=0;t<n/20;++t)r.push({plane:e.us(),planeSide:e.us(),firstEdge:e.ui(),edgeCount:e.us(),textureInfo:e.us(),styles:[e.ub(),e.ub(),e.ub(),e.ub()],lightmapOffset:e.ui()});return r}static loadModels(e,t,n){e.seek(t);const r=[];for(let t=0;t<n/64;++t)r.push({mins:[e.f(),e.f(),e.f()],maxs:[e.f(),e.f(),e.f()],origin:[e.f(),e.f(),e.f()],headNodes:[e.i(),e.i(),e.i(),e.i()],visLeaves:e.i(),firstFace:e.i(),faceCount:e.i()});return r}static loadEdges(e,t,n){e.seek(t);const r=[];for(let t=0;t<n/4;++t)r.push([e.us(),e.us()]);return r}static loadSurfEdges(e,t,n){e.seek(t);const r=[];for(let t=0;t<n/4;++t)r.push(e.i());return r}static loadVertices(e,t,n){e.seek(t);const r=[];for(let t=0;t<n/12;++t)r.push([e.f(),e.f(),e.f()]);return r}static loadTexInfo(e,t,n){e.seek(t);const r=[];for(let t=0;t<n/40;++t)r.push({s:[e.f(),e.f(),e.f()],sShift:e.f(),t:[e.f(),e.f(),e.f()],tShift:e.f(),textureIndex:e.i(),flags:e.i()});return r}static loadLightmap(e,t,n){return e.seek(t),e.arrx(n,a.ReaderDataType.UByte)}static loadTextureData(e){const t=e.nstr(16),n=e.ui(),r=e.ui(),i=!e.ui();if(i){const e=new Uint8Array(4);return e[0]=e[1]=e[2]=e[3]=255,{name:t,width:n,height:r,data:e,isExternal:i}}{e.skip(12);const s=n*r,o=e.arrx(s,a.ReaderDataType.UByte);e.skip(s/64*21),e.skip(2);const u=e.arrx(768,a.ReaderDataType.UByte);return{name:t,width:n,height:r,data:"{"===t[0]?l.paletteWithLastTransToRGBA(o,u):l.paletteToRGBA(o,u),isExternal:i}}}static loadTextures(e,t){e.seek(t);const n=e.ui(),r=[];for(let t=0;t<n;++t)r.push(e.ui());const i=[];for(let s=0;s<n;++s)4294967295===r[s]?i.push({name:"ERROR404",width:1,height:1,data:new Uint8Array([0,255,0,255]),isExternal:!1}):(e.seek(t+r[s]),i.push(this.loadTextureData(e)));return i}static loadEntities(e,t,n){e.seek(t);const r=s.vdf(e.nstr(n)),o=["origin","angles","_diffuse_light","_light","rendercolor","avelocity"],a=["renderamt","rendermode","scale"],u=r[0];return"worldspawn"===u.classname&&(u.model="*0",u.wad=u.wad||"",u.wad=u.wad.split(";").filter(e=>e.length).map(e=>e.replace(/\\/g,"/")).map(e=>i.basename(e))),r.forEach(e=>{var t=Number.parseFloat;e.model&&(void 0===e.renderamt&&(e.renderamt=0),void 0===e.rendermode&&(e.rendermode=0),void 0===e.renderfx&&(e.renderfx=0),void 0===e.rendercolor&&(e.rendercolor="0 0 0")),o.forEach(n=>{e[n]&&(e[n]=e[n].split(" ").map(e=>t(e)))}),a.forEach(n=>{e[n]&&(e[n]=t(e[n]))})}),r}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vdf=function(e){let t=0,n="",r="";const i=[];for(let s=0;s<e.length;++s){const o=e[s];switch(t){case 0:if(/\s/.test(o))continue;if("{"!==o)return[];i.push({}),t=1;break;case 1:if(/\s/.test(o))continue;if("}"===o)t=0;else{if('"'!==o)return[];n="",t=2}break;case 2:'"'===o?t=3:n+=o;break;case 3:if(/\s/.test(o))continue;'"'===o&&(r="",t=4);break;case 4:'"'===o?(i[i.length-1][n]=r,t=1):r+=o}}return i}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Bsp=class{constructor(e,t,n,r,i){this.skies=[],this.sprites={},this.name=e,this.entities=t,this.textures=n,this.models=r,this.lightmap=i}}},function(e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});class s{constructor(e){this.block=new Uint16Array(s.TEXTURE_SIZE),this.lightmap=e,this.texture=new Uint8Array(s.TEXTURE_SIZE*s.TEXTURE_SIZE*4),this.texture[this.texture.length-4]=255,this.texture[this.texture.length-3]=255,this.texture[this.texture.length-2]=255,this.texture[this.texture.length-1]=255}static init(e){return new s(e)}getTexture(){return this.texture}processFace(e,t,n){const r=this.getDimensions(e),i=this.readLightmap(n,r.width,r.height);if(i)for(let n,o=0;o<e.length/7;++o){n=e[7*o]*t.s[0]+e[7*o+1]*t.s[1]+e[7*o+2]*t.s[2]+t.sShift-r.minU,n+=16*i.x+8,n/=16*s.TEXTURE_SIZE;let a=e[7*o]*t.t[0]+e[7*o+1]*t.t[1]+e[7*o+2]*t.t[2]+t.tShift-r.minV;a+=16*i.y+8,a/=16*s.TEXTURE_SIZE,e[7*o+5]=n,e[7*o+6]=a}}getDimensions(e){let t=n(e[3]),i=n(e[4]),s=n(e[3]),o=n(e[4]);for(let r=1;r<e.length/7;++r)n(e[7*r+3])<t&&(t=n(e[7*r+3])),n(e[7*r+4])<i&&(i=n(e[7*r+4])),n(e[7*r+3])>s&&(s=n(e[7*r+3])),n(e[7*r+4])>o&&(o=n(e[7*r+4]));return{width:r(s/16)-n(t/16)+1,height:r(o/16)-n(i/16)+1,minU:n(t),minV:n(i)}}readLightmap(e,r,i){if(0>=i||0>=r)return null;const o=this.findFreeSpace(r,i);if(o){const a=[o.x,o.y],u=[r,i],c=[s.TEXTURE_SIZE,s.TEXTURE_SIZE];for(let s=0;s<r*i;++s){const r=a[1]*c[0]+a[0]+c[0]*n(s/u[0])+s%u[0];this.texture[4*r]=t(255,2*this.lightmap[e+3*s]),this.texture[4*r+1]=t(255,2*this.lightmap[e+3*s+1]),this.texture[4*r+2]=t(255,2*this.lightmap[e+3*s+2]),this.texture[4*r+3]=255}}return o}findFreeSpace(e,t){let n=0,r=0,i=s.TEXTURE_SIZE;for(let t=0;t<this.block.length-e;++t){let s,o=0;for(s=0;s<e&&!(this.block[t+s]>=i);++s)this.block[t+s]>o&&(o=this.block[t+s]);s===e&&(n=t,r=i=o)}if(i+t>s.TEXTURE_SIZE)return null;for(let r=0;r<e;++r)this.block[n+r]=i+t;return{x:n,y:r}}}s.TEXTURE_SIZE=1024,i.BspLightmapParser=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);t.Mouse=class{constructor(){this.click=!1,this.leftClick=!1,this.rightClick=!1,this.position=r.vec2.create(),this.delta=r.vec2.create()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);t.Touch=class{constructor(){this.pressed=!1,this.position=r.vec2.create(),this.delta=r.vec2.create()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5);class i{constructor(e){this.projectionMatrix=r.mat4.create(),this.fov=r.glMatrix.toRadian(60),this.near=1,this.far=8192,this.viewMatrix=r.mat4.create(),this.position=r.vec3.create(),this.rotation=r.vec3.create(),this.aspect=e,this.updateProjectionMatrix()}static init(e){return new i(e)}updateProjectionMatrix(){r.mat4.perspective(this.projectionMatrix,this.fov,this.aspect,this.near,this.far)}updateViewMatrix(){r.mat4.identity(this.viewMatrix),r.mat4.rotateX(this.viewMatrix,this.viewMatrix,this.rotation[0]-c/2),r.mat4.rotateZ(this.viewMatrix,this.viewMatrix,c/2-this.rotation[1]),r.mat4.translate(this.viewMatrix,this.viewMatrix,[-this.position[0],-this.position[1],-this.position[2]])}}t.Camera=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.keys=new Uint8Array(256);for(let e=0;256>e;++e)this.keys[0]=0}}t.Keyboard=n,function(e){let t;!function(e){e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.SPACE=32]="SPACE"}(t=e.KEYS||(e.KEYS={}))}(n=t.Keyboard||(t.Keyboard={}))},function(e,t){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.VERTEX=0]="VERTEX",e[e.FRAGMENT=1]="FRAGMENT"}(n=t.ShaderType||(t.ShaderType={}));class r{static init(e){const t=e.getContext("webgl",{alpha:!1});return t?new r(t):(console.error("Failed to get WebGL context"),null)}static checkWebGLSupport(){const e="Your browser does not seem to support WebGL",t="Your graphics card does not seem to support WebGL";if(!window.WebGLRenderingContext)return{hasSupport:!1,message:e};const n=document.createElement("canvas");try{return n.getContext("webgl")||n.getContext("experimental-webgl")?{hasSupport:!0,message:""}:{hasSupport:!1,message:t}}catch(e){return{hasSupport:!1,message:t}}}constructor(e){this.gl=e}createProgram(e){const t=this.gl;var r=t.createProgram();if(!r)return console.error("Failed to create WebGL program"),null;const i=this.createShader({source:e.vertexShaderSrc,type:n.VERTEX});if(!i)return console.error("Failed to compile vertex shader"),null;const s=this.createShader({source:e.fragmentShaderSrc,type:n.FRAGMENT});if(!s)return console.error("Failed to compile fragment shader"),null;if(t.attachShader(r,i),t.attachShader(r,s),t.linkProgram(r),t.validateProgram(r),!t.getProgramParameter(r,t.LINK_STATUS)){t.deleteProgram(r),t.deleteShader(i),t.deleteShader(s);const e=t.getProgramInfoLog(r);return console.error(`Could not initialize shader: ${e}`),null}if(!t.getProgramParameter(r,t.VALIDATE_STATUS)){t.deleteProgram(r),t.deleteShader(i),t.deleteShader(s);const e=t.getProgramInfoLog(r);return console.error(`Could not initialize shader: ${e}`),null}t.useProgram(r);const o={};for(let n=0;n<e.attributeNames.length;++n){const i=e.attributeNames[n],s=t.getAttribLocation(r,i);if(-1===s)return console.error(`gl.getAttribLocation failed for attrib named "${i}"`),t.deleteProgram(r),null;o[i]=s}const a={};for(let n=0;n<e.uniformNames.length;++n){const i=e.uniformNames[n],s=t.getUniformLocation(r,i);if(null===s)return console.error(`gl.getUniformLocation failed for uniform named "${i}"`),t.deleteProgram(r),null;a[i]=s}return{handle:r,attributes:o,uniforms:a}}createShader(e){const t=this.gl,r=e.type===n.VERTEX?t.createShader(t.VERTEX_SHADER):t.createShader(t.FRAGMENT_SHADER);return r?(t.shaderSource(r,e.source),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),t.deleteShader(r),null)):(console.error("Failed to create shader program"),null)}getAnisotropyExtension(){return this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}getMaxAnisotropy(e){return this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}}t.Context=r},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=r(4),s=r(5),o=r(11),a=r(12),u=(e,t)=>{e.camera.position[0]=t.cameraPos[0],e.camera.position[1]=t.cameraPos[1],e.camera.position[2]=t.cameraPos[2],e.camera.rotation[0]=s.glMatrix.toRadian(t.cameraRot[0]),e.camera.rotation[1]=s.glMatrix.toRadian(t.cameraRot[1]),e.camera.rotation[2]=s.glMatrix.toRadian(t.cameraRot[2])};n.ReplayPlayer=class extends EventTarget{constructor(e){super(),this.currentMap=0,this.currentChunk=0,this.currentTime=0,this.currentTick=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.reset(),this.game=e,this.state=new a.ReplayState,this.replay=null}reset(){if(this.currentMap=0,this.currentChunk=0,this.currentTime=0,this.currentTick=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.replay){let e=this.replay.maps[0].chunks[0];e.reader.seek(0),this.state=e.state.clone()}}on(e,t){return this.addEventListener(e,t)}off(e,t){this.removeEventListener(e,t)}changeReplay(e){this.replay=e,this.reset()}play(){this.isPlaying?this.isPaused&&(this.isPaused=!1):this.isPlaying=!0,this.dispatchEvent(i.evt("play"))}pause(){this.isPlaying&&(this.isPaused=!0),this.dispatchEvent(i.evt("pause"))}stop(){this.reset(),this.dispatchEvent(i.evt("stop"))}speedUp(){this.speed=t(2*this.speed,4)}speedDown(){this.speed=d(this.speed/2,.25)}seek(e){let n=d(0,t(this.replay.length,e)),r=this.replay.maps;for(let e,t=0;t<r.length;++t){e=r[t].chunks;for(let r=0;r<e.length;++r){let i=e[r],s=i.startTime,a=s+i.timeLength;if(n>=s&&n<a){this.currentMap=t,this.currentChunk=r,this.currentTime=n,this.state=i.state.clone();let e=this.replay.deltaDecoders,s=this.replay.customMessages,a=i.reader;for(a.seek(0);;){let t=a.tell(),r=o.Replay.readFrame(a,e,s);if(!(r.time<=n)){a.seek(t);break}this.state.feedFrame(r),this.currentTick=r.tick}return void u(this.game,this.state)}}}}seekByPercent(e){e=d(0,t(e,100))/100,e*=this.replay.length,this.seek(e)}update(e){if(!this.isPlaying||this.isPaused)return;let t=this.replay.deltaDecoders,n=this.replay.customMessages,r=this.replay.maps[this.currentMap],i=r.chunks[this.currentChunk],s=i.reader,a=this.currentTime+e*this.speed,c=!1;for(;;){let e=s.tell();if(e>=i.data.length){if(this.currentChunk!==r.chunks.length-1)this.currentChunk++,i=r.chunks[this.currentChunk];else{if(this.currentMap===this.replay.maps.length-1){c=!0;break}this.currentChunk=0,this.currentMap++,i=(r=this.replay.maps[this.currentMap]).chunks[this.currentChunk]}(s=i.reader).seek(0),e=0;continue}let u=this.game.sounds,l=o.Replay.readFrame(s,t,n);if(2>l.type)for(let e,t=0;t<l.data.length;++t)if(6===(e=l.data[t]).type){let t=e.data,n=u.find(e=>e.index===t.soundIndex);if(n&&"common/null.wav"!==n.name){let e=t.channel,r=t.volume;this.game.soundSystem.play(n,e,r)}}else if(29===e.type){let t=e.data,n=u.find(e=>e.index===t.soundIndex);n&&n.name}else 9===e.type&&e.data.commands.forEach(e=>{switch(e.func){case"speak":case"spk":case"play":{let t=e.params[0]+".wav",n=u.find(e=>e.name===t);if(!n)return;this.game.soundSystem.play(n,1,.7);break}case"playvol":{let t,n=e.params[0]+".wav";t=isNaN(e.params[1])?1:parseFloat(e.params[1]);let r=u.find(e=>e.name===n);if(!r)return;this.game.soundSystem.play(r,1,t);break}}});else if(8===l.type){let e=l.sound.sample,t=u.find(t=>t.name===e);if(t&&"common/null.wav"!==t.name){let e=l.sound.channel,n=l.sound.volume;this.game.soundSystem.play(t,e,n)}}if(!(l.time<=a)){s.seek(e);break}this.state.feedFrame(l),this.currentTick=l.tick}u(this.game,this.state),this.currentTime=a,c&&this.stop()}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e){this.draw=()=>{const e=this.context.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},this.context=e.context}static init(e){const t=e.gl;return t.clearColor(0,0,0,1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),new n({context:e})}}t.Renderer=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(43);class i{constructor(e){this.vertexBuffer=null,this.indexBuffer=null,this.texture=null,this.isReady=!1,this.context=e.context,this.shader=e.shader}static init(e){const t=r.SkyShader.init(e);return t?new i({context:e,shader:t}):(console.error("skyscenen't"),null)}changeMap(e){if(6!==e.skies.length)return void(this.isReady=!1);const t=this.context.gl,n=t.createBuffer(),r=t.createBuffer(),i=t.createTexture();if(!n||!r||!i)throw new Error("shouldnt happen");const s=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),o=new Float32Array([-1,-1,1,.499,.001,1,-1,1,.499,.249,1,1,1,.001,.249,-1,1,1,.001,.001,-1,-1,-1,.499,.749,-1,1,-1,.001,.749,1,1,-1,.001,.501,1,-1,-1,.499,.501,-1,1,-1,.501,.749,-1,1,1,.501,.501,1,1,1,.999,.501,1,1,-1,.999,.749,-1,-1,-1,.999,.249,1,-1,-1,.501,.249,1,-1,1,.501,.001,-1,-1,1,.999,.001,1,-1,-1,.499,.499,1,1,-1,.001,.499,1,1,1,.001,.251,1,-1,1,.499,.251,-1,-1,-1,.501,.499,-1,-1,1,.501,.251,-1,1,1,.999,.251,-1,1,-1,.999,.499].map((e,t)=>3>t%5?4096*e:e));t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW);const a=document.createElement("canvas");a.width=512,a.height=1024;const u=a.getContext("2d");if(!u)throw new Error("sky ctx fail");const c={up:[0,0],rt:[0,256],dn:[0,512],ft:[256,0],lf:[256,256],bk:[256,512]};e.skies.forEach(e=>{const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("Runtime error.");t.width=e.width,t.height=e.height;const r=n.getImageData(0,0,t.width,t.height);for(let t=0;t<e.data.length;++t)r.data[t]=e.data[t];n.putImageData(r,0,0);const i=e.name.slice(-2),s=c[i]?c[i]:[];if(!u)throw new Error("Runtime error.");u.drawImage(t,s[0],s[1])});const l=u.getImageData(0,0,512,1024).data;t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,512,1024,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(l)),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameterf(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);const d=this.context.getAnisotropyExtension();d&&t.texParameteri(t.TEXTURE_2D,d.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(d)),this.vertexBuffer=n,this.indexBuffer=r,this.texture=i,this.isReady=!0}draw(e){if(this.isReady){const t=this.context.gl,n=this.shader;n.useProgram(t),t.bindTexture(t.TEXTURE_2D,this.texture),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n.enableVertexAttribs(t),n.setVertexAttribPointers(t),n.setDiffuse(t,0);const r=e.position[0],i=e.position[1],s=e.position[2];e.position[0]=0,e.position[1]=0,e.position[2]=0,e.updateViewMatrix(),e.position[0]=r,e.position[1]=i,e.position[2]=s,n.setViewMatrix(t,e.viewMatrix),n.setProjectionMatrix(t,e.projectionMatrix),t.drawElements(t.TRIANGLES,36,t.UNSIGNED_BYTE,0),t.clear(t.DEPTH_BUFFER_BIT)}}}t.SkyScene=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n="#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  gl_FragColor = vec4(diffuseColor.rgb, 1.0);\n}",r="#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  gl_Position = projectionMatrix * viewMatrix * vec4(position, 1);\n}";class i{static init(e){const t=e.createProgram({vertexShaderSrc:r,fragmentShaderSrc:n,attributeNames:["position","texCoord"],uniformNames:["viewMatrix","projectionMatrix","diffuse"]});return t?new i(t):(console.error("Failed to create sky shader program"),null)}constructor(e){this.program=e.handle,this.aPosition=e.attributes.position,this.aTexCoord=e.attributes.texCoord,this.uViewMx=e.uniforms.viewMatrix,this.uProjectionMx=e.uniforms.projectionMatrix,this.uDiffuse=e.uniforms.diffuse}useProgram(e){e.useProgram(this.program)}setViewMatrix(e,t){e.uniformMatrix4fv(this.uViewMx,!1,t)}setProjectionMatrix(e,t){e.uniformMatrix4fv(this.uProjectionMx,!1,t)}setDiffuse(e,t){e.uniform1i(this.uDiffuse,t)}enableVertexAttribs(e){e.enableVertexAttribArray(this.aPosition),e.enableVertexAttribArray(this.aTexCoord)}setVertexAttribPointers(e){e.vertexAttribPointer(this.aPosition,3,e.FLOAT,!1,20,0),e.vertexAttribPointer(this.aTexCoord,2,e.FLOAT,!1,20,12)}}t.SkyShader=i},function(e,t,n){"use strict";var r=Math.atan2;Object.defineProperty(t,"__esModule",{value:!0});const o=n(5),a=n(45),u=n(46),l=n(14),d=n(47);class f{constructor(e){this.modelMatrix=o.mat4.create(),this.sceneInfo={length:0,data:new Float32Array(0),models:[]},this.bsp=null,this.textures=[],this.sprites={},this.lightmap=null,this.buffer=e.buffer,this.context=e.context,this.shader=e.shader}static init(e){const t=a.MainShader.init(e);if(!t)return console.error("Failed to init MainShader"),null;t.useProgram(e.gl);const n=e.gl.createBuffer();return n?new f({buffer:n,context:e,shader:t}):(console.error("Failed to create WebGL buffer"),null)}changeMap(e){this.fillBuffer(e),this.loadTextures(e),this.loadSpriteTextures(e),this.loadLightmap(e),this.bsp=e}fillBuffer(e){const t=this.context.gl,n=e.models,r=["aaatrigger","clip","null","hint","nodraw","invisible","skip","trigger","sky","fog"];let i=0;for(let t=0;t<n.length;++t){const s=n[t];for(let t=0;t<s.faces.length;++t){const n=e.textures[s.faces[t].textureIndex];-1<r.indexOf(n.name)||(i+=s.faces[t].buffer.length)}}const s={length:i+=42,data:new Float32Array(i),models:[]};let o=0;for(let t=0;t<e.models.length;++t){const n=e.models[t],i={origin:n.origin,offset:o,length:0,isTransparent:!1,faces:[]};for(let t=0;t<n.faces.length;++t){const a=e.textures[n.faces[t].textureIndex];if(-1<r.indexOf(a.name))continue;const u={offset:o,length:0,textureIndex:-1};for(let e=0;e<n.faces[t].buffer.length;++e)s.data[o++]=n.faces[t].buffer[e];i.isTransparent||"{"!==e.textures[n.faces[t].textureIndex].name[0]||(i.isTransparent=!0),u.textureIndex=n.faces[t].textureIndex,u.length=o-u.offset,i.faces.push(u)}i.length=o-i.offset,s.models.push(i)}s.models.push({origin:[0,0,0],offset:o,length:4,isTransparent:!1,faces:[{offset:o,length:4,textureIndex:0}]}),s.data[o++]=-.5,s.data[o++]=0,s.data[o++]=-.5,s.data[o++]=1,s.data[o++]=1,s.data[o++]=0,s.data[o++]=0,s.data[o++]=.5,s.data[o++]=0,s.data[o++]=.5,s.data[o++]=0,s.data[o++]=0,s.data[o++]=0,s.data[o++]=0,s.data[o++]=-.5,s.data[o++]=0,s.data[o++]=.5,s.data[o++]=1,s.data[o++]=0,s.data[o++]=0,s.data[o++]=0,s.data[o++]=-.5,s.data[o++]=0,s.data[o++]=-.5,s.data[o++]=1,s.data[o++]=1,s.data[o++]=0,s.data[o++]=0,s.data[o++]=.5,s.data[o++]=0,s.data[o++]=-.5,s.data[o++]=0,s.data[o++]=1,s.data[o++]=0,s.data[o++]=0,s.data[o++]=.5,s.data[o++]=0,s.data[o++]=.5,s.data[o++]=0,s.data[o++]=0,s.data[o++]=0,s.data[o++]=0,o=0;const a={data:new Float32Array(s.data),length:s.length,models:s.models.map(e=>({origin:[...e.origin],offset:e.offset,length:e.length,isTransparent:e.isTransparent,faces:e.faces.map(e=>({offset:e.offset,length:e.length,textureIndex:e.textureIndex}))}))};for(let e=0;e<a.models.length;++e){const t=a.models[e];t.faces.sort((e,t)=>e.textureIndex-t.textureIndex);for(let e=0;e<t.faces.length;++e){const n=t.faces[e],r=o;for(let e=0;e<n.length;++e)a.data[o]=s.data[n.offset+e],o+=1;n.offset=r}const n=[];let r=-1;for(let e=0;e<t.faces.length;++e){const i=t.faces[e];i.textureIndex===r?n[n.length-1].length+=i.length:(n.push({offset:i.offset,length:i.length,textureIndex:i.textureIndex}),r=i.textureIndex)}t.faces=n}this.sceneInfo=a,t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.sceneInfo.data,t.STATIC_DRAW)}loadTextures(e){const t=this.context.gl;for(let n=0;n<e.textures.length;++n){const r=t.createTexture();if(!r)throw new Error("fatal error");const i=e.textures[n];if(!d.isPowerOfTwo(i.width)||!d.isPowerOfTwo(i.height)){const e=i.width,t=i.height,n=d.nextPowerOfTwo(i.width),r=d.nextPowerOfTwo(i.height);i.data=d.resizeTexture(i.data,e,t,n,r),i.width=n,i.height=r}t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i.width,i.height,0,t.RGBA,t.UNSIGNED_BYTE,i.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D);const s=this.context.getAnisotropyExtension();s&&t.texParameteri(t.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(s)),this.textures.push({name:i.name,width:i.width,height:i.height,data:i.data,handle:r})}}loadSpriteTextures(e){const t=this.context.gl;for(const[n,r]of Object.entries(e.sprites)){const e=t.createTexture();if(!e)throw new Error("fatal error");const i=r.frames[0];if(!d.isPowerOfTwo(i.width)||!d.isPowerOfTwo(i.height)){const e=i.width,t=i.height,n=d.nextPowerOfTwo(i.width),r=d.nextPowerOfTwo(i.height);i.data=d.resizeTexture(i.data,e,t,n,r),i.width=n,i.height=r}t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,i.width,i.height,0,t.RGBA,t.UNSIGNED_BYTE,i.data),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.generateMipmap(t.TEXTURE_2D);const s=this.context.getAnisotropyExtension();s&&t.texParameteri(t.TEXTURE_2D,s.TEXTURE_MAX_ANISOTROPY_EXT,this.context.getMaxAnisotropy(s)),this.textures.push({name:n,width:i.width,height:i.height,data:i.data,handle:e}),this.sprites[n]=r}}loadLightmap(e){const t=this.context.gl,n=t.createTexture();if(!n)throw new Error("fatal error");t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.lightmap.width,e.lightmap.height,0,t.RGBA,t.UNSIGNED_BYTE,e.lightmap.data),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),this.lightmap={data:e.lightmap.data,handle:n}}draw(e,t){if(this.bsp&&this.lightmap){const n=this.context.gl,r=this.shader;r.useProgram(n),e.updateProjectionMatrix(),e.updateViewMatrix(),r.setViewMatrix(n,e.viewMatrix),r.setProjectionMatrix(n,e.projectionMatrix),n.bindBuffer(n.ARRAY_BUFFER,this.buffer),r.enableVertexAttribs(n),r.setVertexAttribPointers(n),r.setDiffuse(n,0),r.setLightmap(n,1),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this.lightmap.handle),n.activeTexture(n.TEXTURE0);const i=[],s=[];for(let e=1;e<t.length;++e){const n=t[e];if(n.model)if(n.rendermode&&n.rendermode!=u.RenderMode.Normal&&n.rendermode!=u.RenderMode.Solid)n.rendermode,u.RenderMode.Additive,s.push(n);else{if("*"===n.model[0]){if(this.sceneInfo.models[parseInt(n.model.substr(1))].isTransparent){s.push(n);continue}}else if(-1<n.model.indexOf(".spr")){s.push(n);continue}i.push(n)}}r.setOpacity(n,1),this.renderWorldSpawn(),this.renderOpaqueEntities(e,i),s.length&&(n.depthMask(!1),this.renderTransparentEntities(s,e),n.depthMask(!0))}}renderWorldSpawn(){const e=this.sceneInfo.models[0],t=this.context.gl;o.mat4.identity(this.modelMatrix),this.shader.setModelMatrix(t,this.modelMatrix);for(let n=0;n<e.faces.length;++n){const r=e.faces[n];t.bindTexture(t.TEXTURE_2D,this.textures[r.textureIndex].handle),t.drawArrays(t.TRIANGLES,r.offset/7,r.length/7)}}renderOpaqueEntities(e,t){const n=this.context.gl,a=this.shader,d=this.modelMatrix;for(let f=0;f<t.length;++f){const h=t[f],p=parseInt(h.model.substr(1)),m=this.sceneInfo.models[p];if(m){const e=h.angles||[0,0,0],t=h.origin?o.vec3.fromValues(h.origin[0],h.origin[1],h.origin[2]):o.vec3.create();o.vec3.add(t,t,m.origin),o.mat4.identity(d),o.mat4.translate(d,d,t),o.mat4.rotateZ(d,d,e[1]*c/180),o.mat4.rotateX(this.modelMatrix,this.modelMatrix,e[2]*c/180),a.setModelMatrix(n,this.modelMatrix);for(let e=0;e<m.faces.length;++e){const t=m.faces[e];n.bindTexture(n.TEXTURE_2D,this.textures[t.textureIndex].handle),n.drawArrays(n.TRIANGLES,t.offset/7,t.length/7)}}else if(-1<h.model.indexOf(".spr")){const t=this.textures.find(e=>e.name===h.model),f=this.sprites[h.model];if(t&&f){const p=h.origin?o.vec3.fromValues(h.origin[0],h.origin[1],h.origin[2]):o.vec3.create(),m=o.vec3.fromValues(t.width,1,t.height),g=h.angles?o.vec3.fromValues(h.angles[0],h.angles[2],h.angles[1]):o.vec3.create();switch(o.vec3.scale(m,m,h.scale||1),o.mat4.identity(d),o.mat4.translate(d,d,p),f.header.type){case l.SpriteType.VP_PARALLEL_UPRIGHT:case l.SpriteType.FACING_UPRIGHT:o.mat4.rotateZ(d,d,e.rotation[1]+c/2);break;case l.SpriteType.VP_PARALLEL:o.mat4.rotateZ(d,d,r(p[1]-e.position[1],p[0]-e.position[0])+c/2),o.mat4.rotateX(d,d,r(e.position[2]-p[2],i(s(e.position[0]-p[0],2)+s(e.position[1]-p[1],2))));break;case l.SpriteType.ORIENTED:o.mat4.rotateY(d,d,g[0]*c/180+c),o.mat4.rotateZ(d,d,g[1]*c/180+c),o.mat4.rotateX(d,d,g[2]*c/180-c/2);break;case l.SpriteType.VP_PARALLEL_ORIENTED:o.mat4.rotateY(d,d,g[0]*c/180+c),o.mat4.rotateZ(d,d,g[1]*c/180+c);break;default:throw new Error("Invalid sprite type")}switch(o.mat4.scale(d,d,m),a.setModelMatrix(n,d),a.setOpacity(n,(h.renderamt||255)/255),h.rendermode||u.RenderMode.Normal){case u.RenderMode.Normal:a.setOpacity(n,1),n.bindTexture(n.TEXTURE_2D,t.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case u.RenderMode.Color:case u.RenderMode.Texture:a.setOpacity(n,(h.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,t.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case u.RenderMode.Glow:n.blendFunc(n.SRC_ALPHA,n.DST_ALPHA),a.setOpacity(n,(h.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,t.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);break;case u.RenderMode.Solid:a.setOpacity(n,(h.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,t.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case u.RenderMode.Additive:n.blendFunc(n.SRC_ALPHA,n.DST_ALPHA),a.setOpacity(n,(h.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,t.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)}}}}}renderTransparentEntities(e,t){const n=this.context.gl,a=this.shader,d=this.modelMatrix,f=e.map((e,n)=>({index:n,distance:o.vec3.dist(t.position,e.origin||[0,0,0])})).sort((e,t)=>e.distance-t.distance);for(let h=0;h<f.length;++h){const p=e[f[h].index],m=parseInt(p.model.substr(1)),g=this.sceneInfo.models[m];if(g){const e=p.angles||[0,0,0],t=p.origin||[0,0,0];switch(t[0]+=g.origin[0],t[1]+=g.origin[1],t[2]+=g.origin[2],o.mat4.identity(d),o.mat4.translate(d,d,t),o.mat4.rotateZ(d,d,e[1]*c/180),o.mat4.rotateX(this.modelMatrix,this.modelMatrix,e[2]*c/180),a.setModelMatrix(n,this.modelMatrix),p.rendermode||u.RenderMode.Normal){case u.RenderMode.Normal:a.setOpacity(n,1);for(let e=0;e<g.faces.length;++e){const t=g.faces[e];n.bindTexture(n.TEXTURE_2D,this.textures[t.textureIndex].handle),n.drawArrays(n.TRIANGLES,t.offset/7,t.length/7)}break;case u.RenderMode.Color:case u.RenderMode.Texture:case u.RenderMode.Glow:case u.RenderMode.Solid:a.setOpacity(n,(p.renderamt||255)/255);for(let e=0;e<g.faces.length;++e){const t=g.faces[e];n.bindTexture(n.TEXTURE_2D,this.textures[t.textureIndex].handle),n.drawArrays(n.TRIANGLES,t.offset/7,t.length/7)}break;case u.RenderMode.Additive:n.blendFunc(n.SRC_ALPHA,n.DST_ALPHA),a.setOpacity(n,(p.renderamt||255)/255);for(let e=0;e<g.faces.length;++e){const t=g.faces[e];n.bindTexture(n.TEXTURE_2D,this.textures[t.textureIndex].handle),n.drawArrays(n.TRIANGLES,t.offset/7,t.length/7)}n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)}}else if(-1<p.model.indexOf(".spr")){const e=this.textures.find(e=>e.name===p.model),f=this.sprites[p.model];if(e&&f){const h=p.origin?o.vec3.fromValues(p.origin[0],p.origin[1],p.origin[2]):o.vec3.create(),m=o.vec3.fromValues(e.width,1,e.height),g=p.angles?o.vec3.fromValues(p.angles[0],p.angles[2],p.angles[1]):o.vec3.create();switch(o.vec3.scale(m,m,p.scale||1),o.mat4.identity(d),o.mat4.translate(d,d,h),f.header.type){case l.SpriteType.VP_PARALLEL_UPRIGHT:case l.SpriteType.FACING_UPRIGHT:o.mat4.rotateZ(d,d,t.rotation[1]+c/2);break;case l.SpriteType.VP_PARALLEL:o.mat4.rotateZ(d,d,r(h[1]-t.position[1],h[0]-t.position[0])+c/2),o.mat4.rotateX(d,d,r(t.position[2]-h[2],i(s(t.position[0]-h[0],2)+s(t.position[1]-h[1],2))));break;case l.SpriteType.ORIENTED:o.mat4.rotateY(d,d,g[0]*c/180+c),o.mat4.rotateZ(d,d,g[1]*c/180+c),o.mat4.rotateX(d,d,g[2]*c/180-c/2);break;case l.SpriteType.VP_PARALLEL_ORIENTED:o.mat4.rotateY(d,d,g[0]*c/180+c),o.mat4.rotateZ(d,d,g[1]*c/180+c);break;default:throw new Error("Invalid sprite type")}switch(o.mat4.scale(d,d,m),a.setModelMatrix(n,d),a.setOpacity(n,(p.renderamt||255)/255),p.rendermode||u.RenderMode.Normal){case u.RenderMode.Normal:a.setOpacity(n,1),n.bindTexture(n.TEXTURE_2D,e.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case u.RenderMode.Color:case u.RenderMode.Texture:a.setOpacity(n,(p.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,e.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case u.RenderMode.Glow:n.blendFunc(n.SRC_ALPHA,n.DST_ALPHA),a.setOpacity(n,(p.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,e.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);break;case u.RenderMode.Solid:a.setOpacity(n,(p.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,e.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6);break;case u.RenderMode.Additive:n.blendFunc(n.SRC_ALPHA,n.DST_ALPHA),a.setOpacity(n,(p.renderamt||255)/255),n.bindTexture(n.TEXTURE_2D,e.handle),n.drawArrays(n.TRIANGLES,this.sceneInfo.models[this.sceneInfo.models.length-1].offset/7,6),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)}}}}}}t.WorldScene=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n="#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\nuniform sampler2D lightmap;\nuniform float opacity;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  vec4 lightColor = texture2D(lightmap, vLightmapCoord);\n\n  gl_FragColor = vec4(diffuseColor.rgb * lightColor.rgb, diffuseColor.a * opacity);\n}",r="#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\nattribute vec2 texCoord2;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  vLightmapCoord = texCoord2;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1);\n}";class i{static init(e){const t=e.createProgram({vertexShaderSrc:r,fragmentShaderSrc:n,attributeNames:["position","texCoord","texCoord2"],uniformNames:["modelMatrix","viewMatrix","projectionMatrix","diffuse","lightmap","opacity"]});return t?new i(t):(console.error("Failed to create MainShader program"),null)}constructor(e){this.program=e.handle,this.aPosition=e.attributes.position,this.aTexCoord=e.attributes.texCoord,this.aTexCoord2=e.attributes.texCoord2,this.uModelMx=e.uniforms.modelMatrix,this.uViewMx=e.uniforms.viewMatrix,this.uProjectionMx=e.uniforms.projectionMatrix,this.uDiffuse=e.uniforms.diffuse,this.uLightmap=e.uniforms.lightmap,this.uOpacity=e.uniforms.opacity}useProgram(e){e.useProgram(this.program)}setModelMatrix(e,t){e.uniformMatrix4fv(this.uModelMx,!1,t)}setViewMatrix(e,t){e.uniformMatrix4fv(this.uViewMx,!1,t)}setProjectionMatrix(e,t){e.uniformMatrix4fv(this.uProjectionMx,!1,t)}setDiffuse(e,t){e.uniform1i(this.uDiffuse,t)}setLightmap(e,t){e.uniform1i(this.uLightmap,t)}setOpacity(e,t){e.uniform1f(this.uOpacity,t)}enableVertexAttribs(e){e.enableVertexAttribArray(this.aPosition),e.enableVertexAttribArray(this.aTexCoord),e.enableVertexAttribArray(this.aTexCoord2)}setVertexAttribPointers(e){e.vertexAttribPointer(this.aPosition,3,e.FLOAT,!1,28,0),e.vertexAttribPointer(this.aTexCoord,2,e.FLOAT,!1,28,12),e.vertexAttribPointer(this.aTexCoord2,2,e.FLOAT,!1,28,20)}}t.MainShader=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(t.WorldSpawnStartDark||(t.WorldSpawnStartDark={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(t.WorldSpawnGameTitle||(t.WorldSpawnGameTitle={})),function(e){e[e.No=0]="No",e[e.Yes=1]="Yes"}(t.WorldSpawnNewUnit||(t.WorldSpawnNewUnit={})),function(e){e[e.FewestPlayers=0]="FewestPlayers",e[e.FirstTeam=1]="FirstTeam"}(t.WorldSpawnDefaultTeam||(t.WorldSpawnDefaultTeam={})),function(e){e[e.No=0]="No",e[e.Walk=1]="Walk",e[e.Run=2]="Run",e[e.Instantaneous=4]="Instantaneous",e[e.No_TurnToFace=5]="No_TurnToFace"}(t.AiScriptedSequenceMoveTo||(t.AiScriptedSequenceMoveTo={})),function(e){e[e.DefaultAI=0]="DefaultAI",e[e.Ambush=1]="Ambush"}(t.AiScriptedSequenceFinishSchedule||(t.AiScriptedSequenceFinishSchedule={})),function(e){e[e.Repeatable=4]="Repeatable",e[e.LeaveCorpse=8]="LeaveCorpse"}(t.AiScriptedSequenceSpawnflags||(t.AiScriptedSequenceSpawnflags={})),function(e){e[e.None=0]="None",e[e.HugeMachine=1]="HugeMachine",e[e.BigMachine=2]="BigMachine",e[e.Machine=3]="Machine",e[e.SlowFadeIn=4]="SlowFadeIn",e[e.FadeIn=5]="FadeIn",e[e.QuickFadeIn=6]="QuickFadeIn",e[e.SlowPulse=7]="SlowPulse",e[e.Pulse=8]="Pulse",e[e.QuickPulse=9]="QuickPulse",e[e.SlowOscillator=10]="SlowOscillator",e[e.Oscillator=11]="Oscillator",e[e.QuickOscillator=12]="QuickOscillator",e[e.GrungePitch=13]="GrungePitch",e[e.VeryLowPitch=14]="VeryLowPitch",e[e.LowPitch=15]="LowPitch",e[e.HighPitch=16]="HighPitch",e[e.VeryHighPitch=17]="VeryHighPitch",e[e.ScreamingPitch=18]="ScreamingPitch",e[e.OscillateSpinUpDown=19]="OscillateSpinUpDown",e[e.PulseSpinUpDown=20]="PulseSpinUpDown",e[e.RandomPitch=21]="RandomPitch",e[e.RandomPitchFast=22]="RandomPitchFast",e[e.IncrementalSpinup=23]="IncrementalSpinup",e[e.Alien=24]="Alien",e[e.Bizzare=25]="Bizzare",e[e.PlanetX=26]="PlanetX",e[e.Haunted=27]="Haunted"}(t.AmbientGenericPreset||(t.AmbientGenericPreset={})),function(e){e[e.PlayEverywhere=1]="PlayEverywhere",e[e.SmallRadius=2]="SmallRadius",e[e.MediumRadius=4]="MediumRadius",e[e.LargeRadius=8]="LargeRadius",e[e.StartSilent=16]="StartSilent",e[e.NotToggled=32]="NotToggled"}(t.AmbientGenericSpawnFlags||(t.AmbientGenericSpawnFlags={})),function(e){e[e.UseActivates=1]="UseActivates",e[e.StartOn=2]="StartOn"}(t.ButtonTargetSpawnFlags||(t.ButtonTargetSpawnFlags={})),function(e){e[e.NoTrigger=0]="NoTrigger",e[e.SeePlayerMadAtPlayer=1]="SeePlayerMadAtPlayer",e[e.TakeDamage=2]="TakeDamage",e[e.HalfHealthRemaining=3]="HalfHealthRemaining",e[e.Death=4]="Death",e[e.HearWorld=7]="HearWorld",e[e.HearPlayer=8]="HearPlayer",e[e.HearCombat=9]="HearCombat",e[e.SeePlayerUnconditional=10]="SeePlayerUnconditional",e[e.SeePlayerNotInCombat=11]="SeePlayerNotInCombat"}(t.CyclerWeaponTriggerCondition||(t.CyclerWeaponTriggerCondition={})),function(e){e[e.StartOn=1]="StartOn",e[e.Toggle=2]="Toggle",e[e.RandomStrike=4]="RandomStrike",e[e.Ring=8]="Ring",e[e.StartSparks=16]="StartSparks",e[e.EndSparks=32]="EndSparks",e[e.DecalEnd=64]="DecalEnd",e[e.FadeStart=128]="FadeStart",e[e.FadeEnd=256]="FadeEnd"}(t.EnvBeamSpawnFlags||(t.EnvBeamSpawnFlags={})),function(e){e[e.Normal=0]="Normal",e[e.EmbeddedFix=1]="EmbeddedFix",e[e.OpaqueBlockLight=2]="OpaqueBlockLight",e[e.OpaqueEmbeddedFix=3]="OpaqueEmbeddedFix",e[e.OpaqueConcaveFix=6]="OpaqueConcaveFix"}(t.ZHLTLightFlags||(t.ZHLTLightFlags={})),function(e){e[e.Normal=0]="Normal",e[e.SlowPulse=1]="SlowPulse",e[e.FastPulse=2]="FastPulse",e[e.SlowWidePulse=3]="SlowWidePulse",e[e.FastWidePulse=4]="FastWidePulse",e[e.SlowFadeAway=5]="SlowFadeAway",e[e.FastFadeAway=6]="FastFadeAway",e[e.SlowBecomeSolid=7]="SlowBecomeSolid",e[e.FastBecomeSolid=8]="FastBecomeSolid",e[e.SlowStrobe=9]="SlowStrobe",e[e.FastStrobe=10]="FastStrobe",e[e.FasterStrobe=11]="FasterStrobe",e[e.SlowFlicker=12]="SlowFlicker",e[e.FastFlicker=13]="FastFlicker",e[e.ConstantGlow=14]="ConstantGlow",e[e.DistortModels=15]="DistortModels",e[e.HologramDistort=16]="HologramDistort"}(t.RenderEffect||(t.RenderEffect={})),function(e){e[e.Normal=0]="Normal",e[e.Color=1]="Color",e[e.Texture=2]="Texture",e[e.Glow=3]="Glow",e[e.Solid=4]="Solid",e[e.Additive=5]="Additive"}(t.RenderMode||(t.RenderMode={}));const n=e=>e.split(" ").map(e=>parseFloat(e)),r={worldspawn:e=>({classname:"worldspawn",wad:e.wad.split(";").filter(e=>e.length).map(e=>e.replace(/\\/g,"/")),mapversion:parseInt(e.mapversion),skyname:e.skyname,maxRange:parseFloat(e.MaxRange)||8192,message:e.message||"",sounds:parseInt(e.sounds)||0,light:parseInt(e.light)||0,waveHeight:parseFloat(e.WaveHeight)||0,startDark:parseInt(e.startdark)||0,newUnit:parseInt(e.newunit)||0,defaultTeam:parseInt(e.defaultteam)||0,gameTitle:parseInt(e.gametitle)||0}),aiscripted_sequence:e=>({classname:"aiscripted_sequence",spawnflags:parseInt(e.spawnflags),m_iszEntity:e.m_iszEntity,m_iszPlay:e.m_iszPlay||"",m_flRadius:parseInt(e.m_flRadius)||512,m_flRepeat:parseInt(e.m_flRepeat)||0,m_fMoveTo:parseInt(e.m_fMoveTo)||0,m_iFinishSchedule:parseInt(e.m_iFinishSchedule)||0}),ambient_generic:e=>({classname:"ambient_generic",origin:n(e.origin),targetName:e.targetname,message:e.message,health:parseInt(e.health)||10,preset:parseInt(e.preset)||0,startVolume:parseInt(e.volstart)||0,fadeIn:parseInt(e.fadein),fadeOut:parseInt(e.fadeout),pitch:parseInt(e.pitch),pitchStart:parseInt(e.pitchstart),spinUp:parseInt(e.spinup),spinDown:parseInt(e.spindown),lfoType:parseInt(e.lfotype),lfoRate:parseInt(e.lforate),lfoModPitch:parseInt(e.lfomodpitch),lfoModVolume:parseInt(e.lfomodvolume),cSpinUp:parseInt(e.cspinup),spawnFlags:parseInt(e.spawnflags)}),ammo_357:e=>({classname:"ammo_357",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmAR:e=>({classname:"ammo_9mmAR",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmbox:e=>({classname:"ammo_9mmbox",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_9mmclip:e=>({classname:"ammo_9mmclip",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_ARgrenades:e=>({classname:"ammo_ARgrenades",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_buckshot:e=>({classname:"ammo_buckshot",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_crossbow:e=>({classname:"ammo_crossbow",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_gaussclip:e=>({classname:"ammo_gaussclip",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),ammo_rpgclip:e=>({classname:"ammo_rpgclip",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname||"",delay:parseInt(e.delay)||0,killTarget:e.killtarget||"",spawnFlags:e.spawnflags||0}),button_target:e=>({classname:"button_target",target:e.target,master:e.master,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:n(e.rendercolor||"0 0 0"),zhltLightFlags:parseInt(e.zhlt_lightflags)||0,lightOrigin:e.light_origin,spawnFlags:parseInt(e.spawnflags)||1}),cycler:e=>({classname:"cycler",origin:n(e.origin),angles:n(e.angles),targetName:e.targetname,model:e.model,sequence:e.sequence||"",renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:n(e.rendercolor||"0 0 0")}),cycler_sprite:e=>({classname:"cycler_sprite",origin:n(e.origin),angles:n(e.angles),targetName:e.targetname,model:e.model,framerate:parseInt(e.framerate||"10"),renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:n(e.rendercolor||"0 0 0")}),cyclear_weapon:e=>({classname:"cycler_weapon",origin:n(e.origin),angles:n(e.angles),target:e.target,targetName:e.targetname,triggerTarget:e.TriggerTarget||"",triggerCondition:parseInt(e.TriggerCondition)||0,model:e.model,sequence:e.sequence,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:n(e.rendercolor||"0 0 0")}),cyclear_wreckage:e=>({classname:"cycler_wreckage",origin:n(e.origin),angles:n(e.angles),targetName:e.targetname,model:e.model,framerate:parseInt(e.framerate)||10,scale:parseFloat(e.scale)||1,renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:n(e.rendercolor||"0 0 0")}),env_beam:e=>({classname:"env_beam",renderEffect:parseInt(e.renderfx)||0,renderMode:parseInt(e.rendermode)||0,renderAmmount:parseInt(e.renderamt)||255,renderColor:n(e.rendercolor||"0 0 0"),radius:parseFloat(e.Radius)||256,life:parseInt(e.life)||1,boltWidth:parseInt(e.BoltWidth)||20,noiseAmplitude:parseInt(e.NoiseAmplitude)||0,texture:e.texture||"sprites/laserbeam.spr",textureScroll:parseInt(e.TextureScroll)||35,frameRate:parseInt(e.framerate)||0,frameStart:parseInt(e.framestart)||0,strikeTime:parseInt(e.StrikeTime)||1,damage:parseInt(e.damage)||1,spawnFlags:parseInt(e.spawnflags)})};t.BspEntityParser=class{static parse(e){const t=[];for(let n=0;n<e.length;++n){const i=e[n];i.classname||t.push({classname:"!",data:i}),r[i.classname]?t.push(r[i.classname](i)):t.push({classname:"?",originalClassname:i.classname,data:i})}return t}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resizeTexture=(e,t,n,r,i)=>{const s=document.createElement("canvas"),o=s.getContext("2d");if(!o)throw new Error("Runtime error.");s.width=t,s.height=n;const a=document.createElement("canvas"),u=a.getContext("2d");if(!u)throw new Error("Runtime error.");a.width=r,a.height=i;const c=o.createImageData(t,n);for(let r=0;r<t*n*4;r+=4)c.data[r]=e[r],c.data[r+1]=e[r+1],c.data[r+2]=e[r+2],c.data[r+3]=e[r+3];return o.putImageData(c,0,0),u.drawImage(s,0,0,r,i),new Uint8Array(u.getImageData(0,0,r,i).data)},t.isPowerOfTwo=e=>0==(e&e-1),t.nextPowerOfTwo=e=>{--e;for(let t=1;32>t;t<<=1)e|=e>>t;return e+1}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static init(e){return new n("string"==typeof e?{paths:{base:e,replays:`${e}/replays`,maps:`${e}/maps`,wads:`${e}/wads`,skies:`${e}/skies`,sounds:`${e}/sounds`}}:{paths:{base:e&&e.paths&&e.paths.base||"",replays:e&&e.paths&&e.paths.replays||"/demos",maps:e&&e.paths&&e.paths.maps||"/maps",wads:e&&e.paths&&e.paths.wads||"/wads",skies:e&&e.paths&&e.paths.skies||"/skies",sounds:e&&e.paths&&e.paths.sounds||"/sounds"}})}constructor(e){this.paths=Object.assign({},e.paths)}getBasePath(){return this.paths.base}getReplaysPath(){return this.paths.replays}getMapsPath(){return this.paths.maps}getWadsPath(){return this.paths.wads}getSkiesPath(){return this.paths.skies}getSoundsPath(){return this.paths.sounds}}t.Config=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(50);t.PlayerInterface=class{constructor(e,t){this.game=e,this.rootNode=t}getRootNode(){return this.rootNode}draw(){r.render(r.h(i.Root,{game:this.game,root:this.rootNode}),this.rootNode)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(51),s=n(54),o=n(58),a=n(18),u=n(7),c=n(72);t.Root=class extends r.Component{constructor(e){super(e),this.node=null,this.fadeOut=0,this.onPointerLockChange=()=>{this.props.game.pointerLocked=!(document.pointerLockElement!==this.props.root)},this.onContextMenu=e=>{e.preventDefault()},this.onWindowClick=()=>{this.setState({isActive:!1})},this.onRootClick=e=>{e.stopPropagation(),this.setState({isActive:!0}),this.fadeReset()},this.onKeyDown=e=>{if(this.state.isActive){const t=this.props.game;switch(e.which){case 70:a.Fullscreen.isInFullscreen()?a.Fullscreen.exit():a.Fullscreen.enter(this.props.root),this.fadeReset();break;case 77:t.soundSystem.toggleMute(),this.fadeReset();break;case 38:t.soundSystem.setVolume(t.soundSystem.getVolume()+.05),this.fadeReset();break;case 40:t.soundSystem.setVolume(t.soundSystem.getVolume()-.05),this.fadeReset();break;case 74:case 37:t.player.seek(t.player.currentTime-5),this.fadeReset();break;case 76:case 39:t.player.seek(t.player.currentTime+5),this.fadeReset();break;case 75:case 32:if(this.props.game.mode!==u.PlayerMode.REPLAY)return;!t.player.isPlaying||t.player.isPaused?t.player.play():t.player.pause()}}},this.onModeChange=()=>{this.forceUpdate()},this.onLoadStart=()=>{this.setState({isLoading:!0})},this.onLoadEnd=()=>{this.setState({isLoading:!1})},this.onTitleChange=e=>{this.setState({title:e})},this.onMouseEnter=()=>{this.setState({isMouseOver:!0}),this.fadeReset()},this.onMouseMove=()=>{this.state.isMouseOver&&!a.Fullscreen.isInFullscreen()&&this.fadeReset()},this.onMouseLeave=()=>{this.setState({isMouseOver:!1,isVisible:!1}),clearTimeout(this.fadeOut),this.fadeOut=0},this.fadeReset=()=>{this.state.isVisible||this.setState({isVisible:!0}),clearTimeout(this.fadeOut),this.fadeOut=setTimeout(()=>{this.setState({isVisible:!1}),this.fadeOut=0},5e3)},this.onScreenClick=()=>{switch(this.props.game.mode){case u.PlayerMode.REPLAY:{const e=this.props.game.player;!e.isPlaying||e.isPaused?e.play():e.pause();break}case u.PlayerMode.FREE:this.props.root.requestPointerLock()}},this.onScreenDblClick=()=>{a.Fullscreen.isInFullscreen()?a.Fullscreen.exit():a.Fullscreen.enter(this.props.root)},this.state={title:e.game.title,isActive:!1,isLoading:!1,isMouseOver:!1,isVisible:!1}}componentDidMount(){if(this.node){const e=this.props.game,t=this.props.root;this.node.appendChild(e.getCanvas()),e.on("loadstart",this.onLoadStart),e.on("load",this.onLoadEnd),e.on("modechange",this.onModeChange),e.on("titlechange",this.onTitleChange),t.addEventListener("click",this.onRootClick),window.addEventListener("click",this.onWindowClick),window.addEventListener("keydown",this.onKeyDown),document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),t.addEventListener("mouseover",this.onMouseEnter),t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mouseout",this.onMouseLeave),t.addEventListener("contextmenu",this.onContextMenu)}}componentWillUnmount(){const e=this.props.game,t=this.props.root;e.off("loadstart",this.onLoadStart),e.off("load",this.onLoadEnd),e.off("modechange",this.onModeChange),e.off("titlechange",this.onTitleChange),t.removeEventListener("click",this.onRootClick),window.removeEventListener("click",this.onWindowClick),window.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),t.removeEventListener("mouseover",this.onMouseEnter),t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mouseout",this.onMouseLeave),t.removeEventListener("contextmenu",this.onContextMenu)}render(){const e=this.props.game,t=this.state.isVisible;return r.h("div",{class:t?c.RootStyle.rootVisible:c.RootStyle.root},r.h("div",{class:t?c.RootStyle.titleVisible:c.RootStyle.title},this.state.title),r.h(i.Loading,{game:e,visible:this.state.isLoading}),r.h("div",{class:c.RootStyle.screen,ref:e=>this.node=e,onClick:this.onScreenClick,onDblClick:this.onScreenDblClick}),e.mode===u.PlayerMode.FREE?r.h(s.FreeMode,{class:t?c.RootStyle.controlsVisible:c.RootStyle.controls,game:e,root:this.props.root}):r.h(o.ReplayMode,{class:t?c.RootStyle.controlsVisible:c.RootStyle.controls,game:e,root:this.props.root,visible:this.state.isMouseOver}))}}},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=r(1),s=r(52),o={replay:"Replay",bsp:"Map",sound:"Sounds",sky:"Skybox",sprite:"Sprites",wad:"Wads"};n.Loading=class extends i.Component{constructor(){super(...arguments),this.state={items:{}},this.onItemLoad=e=>{const t=this.state.items[e.type]?this.state.items[e.type]:[];for(let n=0;n<t.length;++n)if(t[n]===e)return;t.push({name:e.name,progress:0}),this.setState({items:Object.assign({},this.state.items,{[e.type]:t})})},this.onItemProgress=e=>{if(this.state.items[e.type]){const t=this.state.items[e.type];for(let n=0;n<t.length;++n)if(t[n].name===e.name){t[n].progress=e.progress;break}this.forceUpdate()}}}componentDidMount(){const e=this.props.game.loader;e.addEventListener("loadstart",e=>{this.onItemLoad(e.detail.item)}),e.addEventListener("progress",e=>{this.onItemProgress(e.detail.item)})}componentWillUnmount(){const e=this.props.game.loader;e.removeEventListener("loadstart",this.onItemLoad),e.removeEventListener("progress",this.onItemProgress)}formatItem(t,n){t=o[t];const r=e(100*n)+"%";let i=29-t.length-r.length;return 2>i&&(i=9-r.length),`${t}${Array(i).join(".")}${r}`}render(){return i.h("div",{class:this.props.visible?s.LoadingStyle.loading:s.LoadingStyle.loadingHidden},i.h("div",{class:s.LoadingStyle.spinner},i.h("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"80px",height:"80px",viewBox:"0 0 80 80",xmlSpace:"preserve"},i.h("path",{fill:"#ffffff",width:"10px",d:"M40,72C22.4,72,8,57.6,8,40C8,22.4,22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z"}))),i.h("ul",{class:s.LoadingStyle.log},Object.entries(this.state.items).map(([e,t])=>i.h("li",{key:e,class:s.LoadingStyle.logItem},this.formatItem(e,t.reduce((e,t)=>e+t.progress,0)/t.length)))))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.LoadingStyle=r.stylesheet({loading:Object.assign({},{position:"relative",width:"100%",height:"100%",opacity:1,transition:"opacity 2s ease, z-index 1s linear",zIndex:30}),loadingHidden:Object.assign({},{position:"relative",width:"100%",height:"100%",opacity:1,transition:"opacity 2s ease, z-index 1s linear",zIndex:30},{opacity:0,userSelect:"none",zIndex:0}),spinner:{position:"absolute",left:"50%",top:"50%",marginLeft:"-40px",marginTop:"-40px",animation:"rotate 1s linear 0s infinite",height:"80px",width:"80px",animationName:r.keyframes({from:{transform:"rotate(0deg)"},to:{transform:"rotate(360deg)"}})},log:{position:"absolute",background:"rgba(0,0,0,0.4)",padding:"10px",fontFamily:"monospace",margin:"0",top:"16px",right:0,paddingLeft:"16px",listStyle:"none"},logItem:{display:"block"}})},function(e){function t(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===t||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function i(){h&&d&&(h=!1,d.length?f=d.concat(f):p=-1,f.length&&s())}function s(){if(!h){var e=r(i);h=!0;for(var t=f.length;t;){for(d=f,f=[];++p<t;)d&&d[p].run();p=-1,t=f.length}d=null,h=!1,function(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var u,c,l=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:t}catch(e){u=t}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var d,f=[],h=!1,p=-1;l.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new o(e,t)),1!==f.length||h||r(s)},o.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=a,l.addListener=a,l.once=a,l.off=a,l.removeListener=a,l.removeAllListeners=a,l.emit=a,l.prependListener=a,l.prependOnceListener=a,l.listeners=function(){return[]},l.binding=function(){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),s=n(55),o=n(2),a=n(16),u=n(17);t.FreeMode=function(e){return r.h("div",{class:i.classes(e.class,s.FreeModeStyle.controls)},r.h("div",{class:o.ControlsStyle.buttons},r.h("div",{class:o.ControlsStyle.left}),r.h("div",{class:o.ControlsStyle.right},r.h(a.SettingsButton,{game:e.game}),r.h(u.FullscreenButton,{active:!1,root:e.root}))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.FreeModeStyle=r.stylesheet({controls:{height:"44px"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.SettingsButtonStyle=r.stylesheet({settings:{position:"relative"},menu:Object.assign({},{display:"none",position:"absolute",left:"-38px",bottom:"48px",padding:"2px 6px",fontSize:"14px",backgroundColor:"rgba(0, 0, 0, 0.4)",flexFlow:"column",minWidth:"100px"}),menuOpen:Object.assign({},{display:"none",position:"absolute",left:"-38px",bottom:"48px",padding:"2px 6px",fontSize:"14px",backgroundColor:"rgba(0, 0, 0, 0.4)",flexFlow:"column",minWidth:"100px"},{display:"flex"}),menuItemTitle:{padding:"6px 4px",borderBottom:"1px solid white",fontWeight:"bold"},menuItem:Object.assign({},{cursor:"pointer",margin:"4px 0",padding:"4px",$nest:{"&:last-child":{marginTop:0},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}),menuItemSelected:Object.assign({},{cursor:"pointer",margin:"4px 0",padding:"4px",$nest:{"&:last-child":{marginTop:0},"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}},{backgroundColor:"rgba(255, 255, 255, 0.2) !important"}),button:{width:"32px",height:"32px",padding:"5px"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.FullscreenButtonStyle=r.stylesheet({button:{width:"30px",minWidth:"30px",height:"30px",padding:"5px"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(59),s=n(61),o=n(63),a=n(65),u=n(66),c=n(67),l=n(69),d=n(70),f=n(16),h=n(17),p=n(2);t.ReplayMode=class extends r.Component{constructor(){super(...arguments),this.onPlayClick=()=>{this.props.game.player.play()},this.onPauseClick=()=>{this.props.game.player.pause()},this.onSpeedDown=()=>{this.props.game.player.speedDown()},this.onSpeedUp=()=>{this.props.game.player.speedUp()},this.onVolumeClick=()=>{this.props.game.soundSystem.toggleMute()},this.onPlayStateChange=()=>{this.forceUpdate()}}componentDidMount(){this.props.game.player.on("play",this.onPlayStateChange),this.props.game.player.on("pause",this.onPlayStateChange),this.props.game.player.on("stop",this.onPlayStateChange)}componentWillUnmount(){this.props.game.player.off("play",this.onPlayStateChange),this.props.game.player.off("pause",this.onPlayStateChange),this.props.game.player.off("stop",this.onPlayStateChange)}render(){const e=this.props.game,t=e.player,n=t.isPlaying,m=t.isPaused;return r.h("div",{class:this.props.class},r.h(s.TimeLine,{game:e}),r.h("div",{class:p.ControlsStyle.buttons},r.h("div",{class:p.ControlsStyle.left},r.h(d.SpeedDownButton,{onClick:this.onSpeedDown}),m||!n?r.h(a.PlayButton,{onClick:this.onPlayClick}):r.h(u.PauseButton,{onClick:this.onPauseClick}),r.h(l.SpeedUpButton,{onClick:this.onSpeedUp}),r.h(c.VolumeButton,{onClick:this.onVolumeClick}),r.h(o.VolumeControl,{game:e}),r.h(i.Time,{player:t})),r.h("div",{class:p.ControlsStyle.right},r.h(f.SettingsButton,{game:e}),r.h(h.FullscreenButton,{active:!0,root:this.props.root}))))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(9),s=n(60);t.Time=class extends r.Component{constructor(){super(...arguments),this.onPlay=()=>{this.setState({isPlaying:!0},this.update)},this.onPauseOrStop=()=>{this.setState({isPlaying:!1})},this.update=()=>{this.state.isPlaying&&(this.forceUpdate(),setTimeout(this.update,100))}}componentDidMount(){this.props.player.on("play",this.onPlay),this.props.player.on("pause",this.onPauseOrStop),this.props.player.on("stop",this.onPauseOrStop)}componentWillUnmount(){this.props.player.off("play",this.onPlay),this.props.player.off("pause",this.onPauseOrStop),this.props.player.off("stop",this.onPauseOrStop)}render(){const e=i.formatTime(this.props.player.currentTime),t=i.formatTime(this.props.player.replay.length);return r.h("div",{class:s.Time.time},e," / ",t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.Time=r.stylesheet({time:{fontFamily:"'Roboto', Arial, Helvetica, sans-serif",fontSize:"10pt"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(62);t.TimeLine=class extends r.Component{constructor(e){super(e),this.onPostUpdate=()=>{const e=this.props.game.player;this.setState({progress:e.currentTime/e.replay.length})},this.onClick=e=>{const t=e.currentTarget.getClientRects()[0],n=1-(t.right-e.pageX)/(t.right-t.left);this.props.game.player.seekByPercent(100*n),this.props.game.player.pause()},this.onMouseEnter=()=>{this.setState({ghostKnobActive:!0})},this.onMouseMove=e=>{if(this.state.ghostKnobActive){const t=e.currentTarget.getClientRects()[0],n=1-(t.right-e.pageX)/(t.right-t.left);this.setState({ghostKnobPos:100*n+"%"})}},this.onMouseLeave=()=>{this.setState({ghostKnobActive:!1})},this.state={progress:0,ghostKnobActive:!1,ghostKnobPos:"0%"}}componentDidMount(){this.props.game.on("postupdate",this.onPostUpdate)}componentWillUnmount(){this.props.game.off("postupdate",this.onPostUpdate)}render(){const e=100*this.state.progress;return r.h("div",{class:i.TimeLine.timeline,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},r.h("div",{class:i.TimeLine.ghostLine}),r.h("div",{class:i.TimeLine.line,style:{right:100-e+"%"}}),r.h("div",{class:i.TimeLine.knob,style:{left:e+"%"}}),r.h("div",{class:i.TimeLine.ghostKnob,style:{left:this.state.ghostKnobPos}}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.TimeLine=r.stylesheet({timeline:{display:"flex",alignItems:"center",position:"relative",height:"26px",cursor:"pointer"},line:{height:"4px",backgroundColor:"#fff",position:"absolute",left:"0",right:"0",borderRadius:"2px"},ghostLine:{height:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",left:"0",right:"0",borderRadius:"2px"},knob:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#fff",borderRadius:"6px",left:"100%",marginLeft:"-6px"},ghostKnob:{position:"absolute",width:"8px",height:"8px",backgroundColor:"#fff",boxSizing:"border-box",borderRadius:"8px",left:"0",marginLeft:"-4px",display:"none",$nest:{"&:hover":{display:"block"}}}})},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const i=r(1),s=r(64);n.VolumeControl=class extends i.Component{constructor(e){super(e),this.onVolumeChange=()=>{this.setState({volume:this.props.game.soundSystem.getVolume()})},this.onClick=e=>{const t=e.currentTarget.getClientRects()[0],n=1-(t.right-e.pageX)/(t.right-t.left);this.props.game.soundSystem.setVolume(n)},this.onMouseEnter=()=>{this.setState({ghostKnobActive:!0})},this.onMouseMove=e=>{if(this.state.ghostKnobActive){const n=e.currentTarget.getClientRects()[0],r=1-(n.right-e.pageX)/(n.right-n.left),i=t(95,d(5,100*r))+"%";this.setState({ghostKnobPos:i})}},this.onMouseLeave=()=>{this.setState({ghostKnobActive:!1})},this.state={volume:e.game.soundSystem.getVolume(),ghostKnobActive:!1,ghostKnobPos:"5%"}}componentDidMount(){this.props.game.soundSystem.addEventListener("volumeChange",()=>{this.onVolumeChange()})}componentWillUnmount(){this.props.game.soundSystem.removeEventListener("volumeChange",this.onVolumeChange)}render(){const e=100*this.state.volume,n=t(95,d(5,e))+"%",r=t(95,d(5,100-e))+"%";return i.h("div",{class:s.VolumeControl.control,onClick:this.onClick,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave},i.h("div",{class:s.VolumeControl.ghostLine}),i.h("div",{class:s.VolumeControl.line,style:{right:r}}),i.h("div",{class:s.VolumeControl.knob,style:{left:n}}),i.h("div",{class:s.VolumeControl.ghostKnob,style:{left:this.state.ghostKnobPos}}))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.VolumeControl=r.stylesheet({control:{display:"flex",alignItems:"center",position:"relative",width:"80px",height:"26px",marginLeft:"6px",marginRight:"14px",cursor:"pointer"},line:{height:"4px",backgroundColor:"#fff",position:"absolute",left:"0",right:"0",borderRadius:"2px"},ghostLine:{height:"4px",backgroundColor:"rgba(255, 255, 255, 0.5)",position:"absolute",left:"0",right:"0",borderRadius:"2px"},knob:{position:"absolute",width:"12px",height:"12px",backgroundColor:"#fff",borderRadius:"6px",left:"100%",marginLeft:"-6px"},ghostKnob:{position:"absolute",width:"8px",height:"8px",backgroundColor:"#fff",boxSizing:"border-box",borderRadius:"8px",left:"0",marginLeft:"-4px",display:"none",$nest:{"&:hover":{display:"block"}}}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(2);t.PlayButton=function(e){return r.h("div",{class:i.ControlsStyle.button,onClick:e.onClick},r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},r.h("path",{d:"M0 0 L0 64 L64 32 Z"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(2);t.PauseButton=function(e){return r.h("div",{class:i.ControlsStyle.button,onClick:e.onClick},r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},r.h("path",{d:"M0 0 L0 64 L20 64 L20 0 M44 0 L64 0 L64 64 L44 64 Z"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),s=n(68),o=n(2);t.VolumeButton=function(e){return r.h("div",{class:i.classes(o.ControlsStyle.button,s.VolumeButton.button),onClick:e.onClick},r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",fill:"currentcolor"},r.h("path",{d:"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.VolumeButton=r.stylesheet({button:{width:"28px",height:"28px",padding:"2px",marginRight:"5px"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(2);t.SpeedUpButton=function(e){return r.h("div",{class:i.ControlsStyle.button,onClick:e.onClick},r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},r.h("path",{d:"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),i=n(0),s=n(71),o=n(2);t.SpeedDownButton=function(e){return r.h("div",{class:i.classes(o.ControlsStyle.button,s.SpeedDownButtonStyle.button),onClick:e.onClick},r.h("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",fill:"currentcolor"},r.h("path",{d:"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.SpeedDownButtonStyle=r.stylesheet({button:{transform:"rotate(180deg)"}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.RootStyle=r.stylesheet({root:Object.assign({},{position:"relative",color:"white",width:"100%",height:"100%",cursor:"none",userSelect:"none"}),rootVisible:Object.assign({},{position:"relative",color:"white",width:"100%",height:"100%",cursor:"none",userSelect:"none"},{cursor:"default"}),title:Object.assign({},{position:"absolute",top:"20px",left:"0",zIndex:20,padding:"10px 10px 10px 20px",backgroundColor:"rgba(0, 0, 0, 0.4)",fontSize:"13pt",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:0,transition:"opacity 0.2s"}),titleVisible:Object.assign({},{position:"absolute",top:"20px",left:"0",zIndex:20,padding:"10px 10px 10px 20px",backgroundColor:"rgba(0, 0, 0, 0.4)",fontSize:"13pt",fontFamily:"'Roboto', Arial, Helvetica, sans-serif",opacity:0,transition:"opacity 0.2s"},{opacity:1}),controls:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"}),controlsVisible:Object.assign({},{zIndex:30,position:"absolute",width:"100%",bottom:0,padding:"0 16px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, 0.4)",userSelect:"none",opacity:0,transition:"opacity 0.2s"},{opacity:1}),screen:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10}})}])});
//# sourceMappingURL=hlviewer.min.js.map