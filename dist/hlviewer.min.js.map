{"version":3,"sources":["webpack://HLViewer/webpack/universalModuleDefinition","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/vec3.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat2.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/common.js","webpack://HLViewer/./src/Reader.ts","webpack://HLViewer/webpack/bootstrap","webpack://HLViewer/./node_modules/typestyle/lib.es2015/internal/formatting.js","webpack://HLViewer/./node_modules/typestyle/lib.es2015/internal/utilities.js","webpack://HLViewer/./node_modules/typestyle/lib.es2015/index.js","webpack://HLViewer/./node_modules/typestyle/lib.es2015/internal/typestyle.js","webpack://HLViewer/./node_modules/preact/dist/preact.umd.js","webpack://HLViewer/./src/PlayerInterface/Controls.style.ts","webpack://HLViewer/./src/Util.ts","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat2d.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat3.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/mat4.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/vec4.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/quat.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/quat2.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix/vec2.js","webpack://HLViewer/./node_modules/gl-matrix/lib/gl-matrix.js","webpack://HLViewer/./node_modules/free-style/dist/free-style.js","webpack://HLViewer/./src/Game.ts","webpack://HLViewer/./src/Parsers/Util.ts","webpack://HLViewer/./src/Time.ts","webpack://HLViewer/./src/SoundSystem.ts","webpack://HLViewer/./src/Replay/Replay.ts","webpack://HLViewer/./src/Replay/ReplayState.ts","webpack://HLViewer/./src/Replay/readDelta.ts","webpack://HLViewer/./src/Parsers/Sprite.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/SettingsButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/FullscreenButton/index.tsx","webpack://HLViewer/./src/Fullscreen.ts","webpack://HLViewer/./src/index.ts","webpack://HLViewer/./src/Loader.ts","webpack://HLViewer/./src/Sound.ts","webpack://HLViewer/./src/Parsers/Tga.ts","webpack://HLViewer/./src/Parsers/Wad.ts","webpack://HLViewer/./src/Replay/ReplayMap.ts","webpack://HLViewer/./src/Replay/ReplayChunk.ts","webpack://HLViewer/./src/Replay/FrameDataReader.ts","webpack://HLViewer/./src/Replay/readCoord.ts","webpack://HLViewer/./src/Replay/DeltaType.ts","webpack://HLViewer/./src/BitReader.ts","webpack://HLViewer/./src/Xhr.ts","webpack://HLViewer/./src/Parsers/BspParser.ts","webpack://HLViewer/./src/Parsers/Vdf.ts","webpack://HLViewer/./src/Bsp.ts","webpack://HLViewer/./src/Parsers/BspLightmapParser.ts","webpack://HLViewer/./src/Input/Mouse.ts","webpack://HLViewer/./src/Input/Touch.ts","webpack://HLViewer/./src/Graphics/Camera.ts","webpack://HLViewer/./src/Input/Keyboard.ts","webpack://HLViewer/./src/Graphics/Context.ts","webpack://HLViewer/./src/ReplayPlayer.ts","webpack://HLViewer/./src/Graphics/Renderer.ts","webpack://HLViewer/./src/Graphics/SkyScene.ts","webpack://HLViewer/./src/Graphics/SkyShader/SkyShader.ts","webpack://HLViewer/./src/Graphics/WorldScene.ts","webpack://HLViewer/./src/Graphics/WorldShader/WorldShader.ts","webpack://HLViewer/./src/Parsers/BspEntityParser.ts","webpack://HLViewer/./src/Graphics/Util.ts","webpack://HLViewer/./src/Config.ts","webpack://HLViewer/./src/PlayerInterface/index.tsx","webpack://HLViewer/./src/PlayerInterface/Root.tsx","webpack://HLViewer/./src/PlayerInterface/Loading/index.tsx","webpack://HLViewer/./src/PlayerInterface/Loading/style.ts","webpack://HLViewer/./node_modules/process/browser.js","webpack://HLViewer/./src/PlayerInterface/FreeMode/index.tsx","webpack://HLViewer/./src/PlayerInterface/FreeMode/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/SettingsButton/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/FullscreenButton/style.ts","webpack://HLViewer/./src/PlayerInterface/ReplayMode/index.tsx","webpack://HLViewer/./src/PlayerInterface/Time/index.tsx","webpack://HLViewer/./src/PlayerInterface/Time/style.ts","webpack://HLViewer/./src/PlayerInterface/TimeLine/index.tsx","webpack://HLViewer/./src/PlayerInterface/TimeLine/style.ts","webpack://HLViewer/./src/PlayerInterface/VolumeControl/index.tsx","webpack://HLViewer/./src/PlayerInterface/VolumeControl/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/PlayButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/PauseButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/VolumeButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/VolumeButton/style.ts","webpack://HLViewer/./src/PlayerInterface/Buttons/SpeedUpButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/SpeedDownButton/index.tsx","webpack://HLViewer/./src/PlayerInterface/Buttons/SpeedDownButton/style.ts","webpack://HLViewer/./src/PlayerInterface/Root.style.ts"],"names":["String","fromCharCode","Math","max","e","i","v","ControlsStyle","stylesheet","controls","zIndex","position","width","bottom","padding","boxSizing","backgroundColor","userSelect","opacity","transition","controlsVisible","buttons","height","display","justifyContent","marginBottom","alignItems","button","cursor","left","$nest","marginRight","right","UByte","Byte","UShort","Short","UInt","Int","Float","Double","NString","ReaderDataType","this","data","DataView","offset","byteLength","seek","tell","getInt8","skip","getUint8","getInt16","getUint16","getInt32","getUint32","getFloat32","getFloat64","ub","bind","push","Uint8Array","buffer","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","Float32Array","Float64Array","nstr","str","slice","lastIndexOf","replace","CustomEvent","f","o","fr","n","Object","defineProperty","FREE","REPLAY","PlayerMode","EventTarget","super","pauseTime","isPaused","lastTime","accumTime","timeStep","title","pointerLocked","touch","Touch","mouse","Mouse","keyboard","Keyboard","entities","onLoadAll","replay","changeReplay","changeMode","map","skies","forEach","isDone","entries","sprites","sounds","length","changeMap","t","dispatchEvent","evt","detail","item","draw","requestAnimationFrame","canvas","parentElement","clientWidth","clientHeight","camera","aspect","updateProjectionMatrix","context","gl","viewport","drawingBufferWidth","drawingBufferHeight","now","update","renderer","mapName","skyScene","worldScene","onTouchStart","touches","pressed","clientX","clientY","onTouchEnd","delta","onTouchMove","onMouseMove","movementX","movementY","pageX","pageY","keyDown","keys","which","preventDefault","keyUp","onVisibilityChange","document","hidden","soundSystem","SoundSystem","config","loader","Loader","addEventListener","window","Camera","init","mode","player","ReplayPlayer","Context","checkWebGLSupport","hasSupport","status","message","createElement","Renderer","WorldScene","s","SkyScene","game","load","toLowerCase","name","find","origin","rotation","KEYS","W","S","A","D","C","SPACE","removeEventListener","performance","mozNow","msNow","oNow","webkitNow","Date","getTime","formatTime","toString","AudioContext","webkitAudioContext","parseFloat","localStorage","getItem","setItem","channels","preMuteVolume","masterGain","createGain","gain","value","connect","destination","source","stop","createBufferSource","start","getVolume","setVolume","demoProtocol","ui","netProtocol","modName","mapCrc","dirOffset","id","flags","cdTrack","time","frames","type","tick","orientation","r","size","FrameDataReader","read","index","command","sound","channel","sample","attenuation","volume","pitch","error","header","directories","Reader","Error","macros","b","frame","join","getInitialDeltaDecoders","forward","up","RefParams","frametime","intermission","paused","spectator","onground","waterlevel","velocity","viewHeight","idealPitch","viewAngles","health","crosshairAngle","viewSize","punchAngle","maxClients","viewEntity","playerCount","maxEntities","demoPlayback","hardware","smoothing","ptr_cmd","ptr_movevars","nextView","onlyClientDraw","UserCmd","lerp_msec","msec","UNUSED1","forwardMove","sideMove","upMove","lightLevel","UNUSED2","us","impulse","weaponSelect","UNUSED","impactIndex","impactPosition","MoveVars","gravity","stopSpeed","maxSpeed","spectatorMaxSpeed","acceleration","airAcceleration","waterAcceleration","friction","edgeFriction","waterFriction","entityGravity","bounce","stepSize","maxVelocity","zMax","waveHeight","footsteps","skyName","rollAngle","rollSpeed","skyColor","skyVec","view","viewModel","incoming_sequence","incoming_acknowledged","incoming_reliable_acknowledged","incoming_reliable_sequence","outgoing_sequence","reliable_sequence","last_reliable_sequence","frameData","clientData","weaponFlags","fov","event","delay","args","entityIndex","ducking","fparam1","fparam2","iparam1","iparam2","bparam1","bparam2","weaponAnimation","animation","body","ReplayState","feedFrame","SVC","SERVERINFO","ReplayMap","mapFileName","RESOURCELIST","setResources","ReplayChunk","addChunk","startTime","timeLength","setData","arrx","l","SOUND","SPAWNSTATICSOUND","resources","soundIndex","used","STUFFTEXT","commands","func","params","maps","deltaDecoders","customMessages","cameraPos","JSON","parse","stringify","cameraRot","readBits","DeltaType","DT_BYTE","DT_SIGNED","bits","divisor","DT_SHORT","DT_INTEGER","DT_FLOAT","DT_TIMEWINDOW_8","DT_TIMEWINDOW_BIG","DT_ANGLE","DT_STRING","readString","delta_description_t","VP_PARALLEL_UPRIGHT","FACING_UPRIGHT","VP_PARALLEL","ORIENTED","VP_PARALLEL_ORIENTED","SpriteType","SPR_NORMAL","SPR_ADDITIVE","SPR_INDEXALPHA","SPR_ALPHTEST","SpriteAlphaType","SYNCHRONIZED","RANDOM","SpriteSyncType","version","alphaType","radius","frameCount","beamLength","syncType","group","paletteWithLastTransToRGBA","paletteToRGBA","Component","onFreeModeClick","props","pause","onReplayModeClick","toggleMenu","setState","isOpen","state","class","settings","classes","onClick","xmlns","viewBox","fill","d","menuOpen","menu","menuItemTitle","menuItemSelected","menuItem","isInFullscreen","Fullscreen","exit","enter","root","onFullscreen","onChange","onChangeRemove","a","enabled","element","request","change","setTitle","getTitle","VERSION","querySelector","Config","Game","PlayerInterface","Loading","Skipped","Done","progress","wads","isLoading","extname","loadReplay","loadMap","console","getReplaysPath","xhr","method","isBinary","progressCallback","catch","isError","Replay","parseIntoChunks","done","loadSound","checkStatus","getMapsPath","BspParser","model","indexOf","filter","loadSprite","skyname","loadSky","textures","isExternal","wad","loadWad","Promise","all","getBasePath","Sprite","getSkiesPath","Tga","getWadsPath","Wad","getSoundsPath","Sound","create","getContext","decodeAudioData","idLength","colorMapType","imageType","colorMap","firstEntryIndex","image","xOrigin","yOrigin","depth","descriptor","x","y","p","rowCount","rowHeight","glyphs","diskLength","isCompressed","split","reverse","chunks","skins","models","decals","custom","events","clone","reader","reason","BitStream","packetIndex","readDelta","fireTime","readCoord","xPosition","yPosition","zPosition","trim","yaw","roll","protocol","spawnCount","clientDllHash","maxPlayers","playerIndex","isDeathmatch","gameDir","hostName","mapCycle","lightInfo","clientIndex","clientUserId","clientUserInfo","clientCdKeyHash","fields","slot","ping","loss","direction","count","color","modelIndex","sequence","skin","renderMode","renderAmt","renderColor","renderFx","eventIndex","eventData","delayBit","extraData","effect","textColor","effectColor","fadeInTime","fadeOutTime","holdTime","effectTime","sign","text","track","loopTrack","saveName","sequenceNumber","weaponModelBodyGroup","positionIndex","decalName","angleToAdd","entityStates","downloadSize","md5hash","initialPercent","filename","flag","codecName","quality","fallbackDir","canCheat","timeScale","url","requestId","handlers","bad","nop","disconnect","setView","print","stuffText","setAngle","serverInfo","lightStyle","updateUserInfo","deltaDescription","stopSound","pings","particle","damage","spawnStatic","eventReliable","spawnBaseLine","tempEntity","setPause","signOnNum","centerPrint","killedMonster","foundSecret","spawnStaticSound","finale","restore","cutscene","weaponAnim","roomType","addAngle","newUserMsg","packetEntities","deltaPacketEntities","choke","resourceList","newMoveVars","resourceRequest","customization","soundFade","fileTxferFailed","hltv","director","voiceInit","voiceData","sendExtraInfo","resourceLocation","sendCvarValue","sendCvarValue2","BAD","NOP","DISCONNECT","EVENT","SETVIEW","TIME","PRINT","SETANGLE","LIGHTSTYLE","UPDATEUSERINFO","DELTADESCRIPTION","CLIENTDATA","STOPSOUND","PINGS","PARTICLE","DAMAGE","SPAWNSTATIC","EVENT_RELIABLE","SPAWNBASELINE","TEMPENTITY","SETPAUSE","SIGNONNUM","CENTERPRINT","KILLEDMONSTER","FOUNDSECRET","INTERMISSION","FINALE","CDTRACK","RESTORE","CUTSCENE","WEAPONANIM","DECALNAME","ROOMTYPE","ADDANGLE","NEWUSERMSG","PACKETENTITIES","DELTAPACKETENTITIES","CHOKE","NEWMOVEVARS","RESOURCEREQUEST","CUSTOMIZATION","CROSSHAIRANGLE","SOUNDFADE","FILETXFERFAILED","HLTV","DIRECTOR","VOICEINIT","VOICEDATA","SENDEXTRAINFO","TIMESCALE","RESOURCELOCATION","SENDCVARVALUE","SENDCVARVALUE2","getBits","scratch","setUint32","ArrayBuffer","readUint8","apply","decodeURIComponent","XMLHttpRequest","responseType","lengthComputable","loaded","total","getResponseHeader","target","readyState","response","open","send","maxs","mins","firstFace","faceCount","edgeCount","textureIndex","textureInfo","firstEdge","sShift","tShift","processFace","lightmapOffset","faces","Entities","Planes","Textures","Vertices","Visibility","Nodes","TexInfo","Faces","Lighting","ClipNodes","Leaves","MarkSurfaces","Edges","SurfEdges","Models","BspLumpIndex","loadEntities","loadTextures","loadModels","loadFaces","loadEdges","loadSurfEdges","loadVertices","loadTexInfo","loadLightmap","BspLightmapParser","Bsp","TEXTURE_SIZE","getTexture","plane","planeSide","styles","headNodes","visLeaves","loadTextureData","vdf","classname","basename","Number","renderamt","rendermode","renderfx","rendercolor","test","lightmap","block","texture","getDimensions","readLightmap","minU","minV","findFreeSpace","click","leftClick","rightClick","vec2","projectionMatrix","mat4","glMatrix","toRadian","near","far","viewMatrix","vec3","perspective","identity","rotateX","rotateZ","translate","B","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","T","U","V","X","Y","Z","CTRL","ALT","VERTEX","FRAGMENT","ShaderType","alpha","WebGLRenderingContext","createProgram","createShader","vertexShaderSrc","fragmentShaderSrc","attachShader","linkProgram","validateProgram","getProgramParameter","LINK_STATUS","deleteProgram","deleteShader","getProgramInfoLog","VALIDATE_STATUS","useProgram","attributeNames","getAttribLocation","uniformNames","getUniformLocation","handle","attributes","uniforms","VERTEX_SHADER","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","getExtension","getParameter","MAX_TEXTURE_MAX_ANISOTROPY_EXT","currentMap","currentChunk","currentTime","currentTick","isPlaying","speed","reset","readFrame","play","isNaN","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","clearColor","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","CULL_FACE","cullFace","FRONT","vertexBuffer","indexBuffer","isReady","shader","SkyShader","createBuffer","createTexture","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","ELEMENT_ARRAY_BUFFER","rt","dn","ft","lf","bk","getImageData","putImageData","drawImage","bindTexture","TEXTURE_2D","texImage2D","RGBA","UNSIGNED_BYTE","generateMipmap","texParameteri","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","texParameterf","TEXTURE_MAG_FILTER","LINEAR","getAnisotropyExtension","TEXTURE_MAX_ANISOTROPY_EXT","getMaxAnisotropy","enableVertexAttribs","setVertexAttribPointers","setDiffuse","updateViewMatrix","setViewMatrix","setProjectionMatrix","drawElements","TRIANGLES","program","aPosition","aTexCoord","uViewMx","uProjectionMx","uDiffuse","uniformMatrix4fv","uniform1i","vertexAttribPointer","FLOAT","atan2","modelMatrix","sceneInfo","bsp","MainShader","fillBuffer","loadSpriteTextures","isTransparent","sort","isPowerOfTwo","nextPowerOfTwo","resizeTexture","setLightmap","activeTexture","TEXTURE1","TEXTURE0","RenderMode","Normal","Solid","Additive","parseInt","substr","setOpacity","renderWorldSpawn","renderOpaqueEntities","depthMask","renderTransparentEntities","setModelMatrix","drawArrays","angles","fromValues","add","scale","rotateY","Color","Texture","Glow","DST_ALPHA","distance","dist","m","aTexCoord2","uModelMx","uLightmap","uOpacity","uniform1f","No","Yes","WorldSpawnStartDark","WorldSpawnGameTitle","WorldSpawnNewUnit","FewestPlayers","FirstTeam","WorldSpawnDefaultTeam","Walk","Run","Instantaneous","No_TurnToFace","AiScriptedSequenceMoveTo","DefaultAI","Ambush","AiScriptedSequenceFinishSchedule","Repeatable","LeaveCorpse","AiScriptedSequenceSpawnflags","None","HugeMachine","BigMachine","Machine","SlowFadeIn","FadeIn","QuickFadeIn","SlowPulse","Pulse","QuickPulse","SlowOscillator","Oscillator","QuickOscillator","GrungePitch","VeryLowPitch","LowPitch","HighPitch","VeryHighPitch","ScreamingPitch","OscillateSpinUpDown","PulseSpinUpDown","RandomPitch","RandomPitchFast","IncrementalSpinup","Alien","Bizzare","PlanetX","Haunted","AmbientGenericPreset","PlayEverywhere","SmallRadius","MediumRadius","LargeRadius","StartSilent","NotToggled","AmbientGenericSpawnFlags","UseActivates","StartOn","ButtonTargetSpawnFlags","NoTrigger","SeePlayerMadAtPlayer","TakeDamage","HalfHealthRemaining","Death","HearWorld","HearPlayer","HearCombat","SeePlayerUnconditional","SeePlayerNotInCombat","CyclerWeaponTriggerCondition","Toggle","RandomStrike","Ring","StartSparks","EndSparks","DecalEnd","FadeStart","FadeEnd","EnvBeamSpawnFlags","EmbeddedFix","OpaqueBlockLight","OpaqueEmbeddedFix","OpaqueConcaveFix","ZHLTLightFlags","FastPulse","SlowWidePulse","FastWidePulse","SlowFadeAway","FastFadeAway","SlowBecomeSolid","FastBecomeSolid","SlowStrobe","FastStrobe","FasterStrobe","SlowFlicker","FastFlicker","ConstantGlow","DistortModels","HologramDistort","RenderEffect","worldspawn","mapversion","maxRange","MaxRange","light","WaveHeight","startDark","startdark","newUnit","newunit","defaultTeam","defaultteam","gameTitle","gametitle","aiscripted_sequence","spawnflags","m_iszEntity","m_iszPlay","m_flRadius","m_flRepeat","m_fMoveTo","m_iFinishSchedule","ambient_generic","targetName","targetname","preset","startVolume","volstart","fadeIn","fadein","fadeOut","fadeout","pitchStart","pitchstart","spinUp","spinup","spinDown","spindown","lfoType","lfotype","lfoRate","lforate","lfoModPitch","lfomodpitch","lfoModVolume","lfomodvolume","cSpinUp","cspinup","spawnFlags","ammo_357","killTarget","killtarget","ammo_9mmAR","ammo_9mmbox","ammo_9mmclip","ammo_ARgrenades","ammo_buckshot","ammo_crossbow","ammo_gaussclip","ammo_rpgclip","button_target","master","renderEffect","renderAmmount","zhltLightFlags","zhlt_lightflags","lightOrigin","light_origin","cycler","cycler_sprite","framerate","cyclear_weapon","triggerTarget","TriggerTarget","triggerCondition","TriggerCondition","cyclear_wreckage","env_beam","Radius","life","boltWidth","BoltWidth","noiseAmplitude","NoiseAmplitude","textureScroll","TextureScroll","frameRate","frameStart","framestart","strikeTime","StrikeTime","originalClassname","createImageData","paths","base","replays","rootNode","render","Root","node","onPointerLockChange","pointerLockElement","onContextMenu","onWindowClick","isActive","onRootClick","stopPropagation","fadeReset","onKeyDown","toggleMute","onModeChange","forceUpdate","onLoadStart","onLoadEnd","onTitleChange","onMouseEnter","isMouseOver","onMouseLeave","isVisible","clearTimeout","setTimeout","onScreenClick","requestPointerLock","onScreenDblClick","appendChild","getCanvas","on","off","rootVisible","titleVisible","visible","screen","ref","onDblClick","FreeMode","ReplayMode","sky","sprite","items","onItemLoad","onItemProgress","Array","loading","loadingHidden","spinner","xmlSpace","log","key","logItem","formatItem","reduce","LoadingStyle","top","marginLeft","marginTop","animationName","keyframes","from","transform","to","background","fontFamily","margin","paddingLeft","listStyle","SettingsButton","FullscreenButton","active","FreeModeStyle","SettingsButtonStyle","fontSize","flexFlow","minWidth","borderBottom","fontWeight","FullscreenButtonStyle","onPlayClick","onPauseClick","onSpeedDown","speedDown","onSpeedUp","speedUp","onVolumeClick","onPlayStateChange","TimeLine","SpeedDownButton","PlayButton","PauseButton","SpeedUpButton","VolumeButton","VolumeControl","Time","onPlay","onPauseOrStop","onPostUpdate","currentTarget","getClientRects","seekByPercent","ghostKnobActive","ghostKnobPos","timeline","ghostLine","line","style","knob","ghostKnob","borderRadius","onVolumeChange","control","SpeedDownButtonStyle","RootStyle"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;CAAA,cACA,kDACA,mBACA,sCACA,aACA,yBACA,qBAEA,eARA,CASC,wBCoND,WDpNC,ECuLD,SDvLC,ECwKD,WDxKC,EC0JD,UD1JC,EE4SD,UF5SC,EE4SD,SF5SC,EEqND,SFrNC,EEoND,SFpNC,EG+BD,SH/BC,EGUD,QHVC,EIiFUA,OAAOC,aJjFjB,EIsBiBC,KAAKC,IJrBvB,O,YKNA,cAGA,QACA,oBAGA,YACA,IACA,KACA,YAUA,OANC,EAAD,iCAGA,OAGA,UAvBA,SAiFA,OArDC,EAAD,IAGA,MAGA,oBACA,UACA,2BAA0C,uBAK1C,gBACA,gDACA,4CAAwD,iBAExD,sCAAiD,YAQjD,kBAEA,GADA,cACA,aACA,qDACA,0BAGA,GAFA,OACA,mCAAyC,wBACzC,2DAAgH,aAAqB,UAArI,IACA,UAIA,gBACA,sBACA,WAA2B,kBAC3B,WAAiC,UAEjC,OADC,EAAD,WACA,GAIA,kBAAsD,kDAGtD,OAIA,U,+BC3EO,SAAS,EAAT,OAEN,EAAD,GACA,KACA,gBAEA,WAEA,gBACA,EAAmB,aAAnB,OAEC,GAAD,YACA,QACA,gBACA,WACA,sBAGA,gBACA,IAGA,OAGA,OAAY,sBCfL,SAAS,IAEhB,QADC,EAAD,GACA,IAAoB,mBAAuB,IAC3C,kBAEA,SACA,gBAA2B,4DAAwE,kBAA0B,MAC7H,qBAAyC,oBAA8B,IACvE,mBAA8B,YAC9B,UAMO,SAAS,IAEhB,QADC,EAAD,GACA,IAAoB,mBAAuB,IAC3C,kBAIA,UADC,EAAD,GACA,QAAyC,WAAuB,IAEhE,YADA,QACA,MAGA,gBAEA,YACA,YAKA,KADA,cACA,yBAEA,8CACA,eAXA,GAkBA,SCIO,SAAS,EAAT,GACP,YAAgC,CAAE,qBAIlC,UAFA,qBAEA,E,kBDtEO,4CAKP,YAAqB,sBAKrB,2BACA,sBACA,mCA2DO,cAEP,QADC,EAAD,GACA,IAAoB,mBAAuB,IAC3C,oBAEA,SACA,QACA,eACA,eACA,2CACA,YACA,yCACA,YACA,yCACA,aACA,2CACA,aACA,2CAjBO,IAyBP,EAPC,EAAD,0BACA,GACA,YACA,uBADA,IAIA,UAGA,cACA,mCE9FA,aAAmC,OAAQ,qBAQvC,EAAS,WACb,kBACC,EAAD,kBACA,OAOA,4BAIA,cACA,uBACA,oBAKA,yBAEA,QADC,EAAD,GACA,IAA4B,mBAAuB,IACnD,oBAEA,MAAyB,EAAgB,EAAM,aAAN,IAAM,OAG/C,OAFC,EAAD,kCACC,EAAD,iBAQA,kCACA,kBADA,IAKA,8BAKA,yBAEA,QADC,EAAD,GACA,IAA4B,mBAAuB,IACnD,kBAGA,UADC,EAAD,aACA,QAA2C,WAAgB,IAA3D,EACA,KACA,+BAEA,mBAMA,0BACA,6CAKA,+BACC,EHhDM,YACP,OAAkB,gCAClB,gBACA,WACA,gBACA,eAGA,iBAGA,SGqCqB,CAAAC,GAAgB,6BAErC,sCAEA,OADC,EAAD,gBACA,GAKA,uBAEA,UACA,eACA,oCAEA,UACA,uBAEA,kBATA,IAWA,mBAIA,iCAEA,SACA,uBAEA,SAEA,uBAOA,4BAGA,QADA,KACA,MAFA,8BAEuD,WAA0B,SAChF,EAAD,KACA,OAFiF,IAIjF,eACA,iBAGA,UAEA,UACA,wBACA,kBACA,uCACA,gBACA,0BACA,aACA,iBAEA,iCAmDA,OA9CC,EAAD,oCACA,WACA,gBACA,oBACQ,EAAG,WACX,gBAGA,OAGA,+BACA,aACA,iBAEA,0BACA,iCACA,CAAmB,gBACnB,gCAKA,MAJA,8BACA,6BAEA,YACA,IAKA,yCACC,EAAD,KACA,2BACA,+BACA,iCAGA,8BACA,0BACA,8BAAwC,iCAExC,iCACC,EAAD,gBACA,EAAiB,EAAgB,EAAM,WAAN,EAAM,qCACvC,4CAEA,OADC,KAAD,gBACA,GAEA,EApLa,G,QDdb,mlBAAAC,IAAA,oC,IAYA,QAAsB,CAAE,qBAEjB,oBAOA,WAIA,YAMA,sBAIA,aAIA,cAII,EAAS,YAIb,WAIA,UAMAC,EAAA,c,eErDN,YAA4B,aAU7B,gBACA,IACA,EACA,EACA,EACA,EAJA,IAKA,uBAA4B,OAC5B,qBAPA,IASA,uBACA,oCACA,YAEA,UACA,+BACA,eAA0B,KAC1B,iBAGA,+BAEA,0BACA,aAAmC,mBARnC,MAQ6F,4BAG7F,KACA,iBACK,MACL,MAEA,UAGA,IAIA,YAQA,OAPA,aACA,aACA,8BACA,gCAEA,wBAEA,EAGA,gBACA,eACA,UACI,OAAO,EAGX,oBAEA,0BAA8CF,EAAA,WAM9C,gBACA,2BAA4C,cAA5C,GAA4C,0DAiB5C,eACA,wCACA,2BAIA,iBACA,MACA,WACA,eAIA,wBACA,4CACA,gBAEA,6BACA,yCAEA,wCAGA,gBACA,4EAGA,cACA,WAAuB,cACvB,sBAEA,8BACA,cACA,oBACA,WACA,WAKA,SASA,cACA,mBADA,GAEA,iBAGA,sBAGA,GAFA,6BAEA,gBAAyB,GAAD,UACxB,UACA,YACI,GAAD,eAEC,GAAD,aAIH,GAHA,4CACA,uBAEA,uBACA,sBACA,eACA,wBAGA,eACA,sEAGI,GAAD,kCACH,+BACI,GAAD,sBACH,uCACA,+BAFG,GAIH,6BAEA,8BAEA,2CACI,GAAD,oCACH,IACA,kBACI,WACJ,4DACG,CACH,0CAEA,gBAHG,EAIH,oEAAuFA,EAAA,mBACnF,uBALD,EAMH,mEAA2FA,EAAA,wBArC3F,kBA0CA,cACA,uDAWA,iBACA,MACA,aACA,8BACA,2CAIA,wBACA,MACA,sCAEA,sBAGA,mBAUA,OARA,wCAEA,IACA,MAEA,QAGA,EAGA,sBACA,QACA,IAIA,IAFA,sCAEA,uCAeA,OAdA,0DACA,iBACA,gBAGA,6BASA,IAPA,6CACA,UAIA,QAEA,EAGA,iBACA,wBACA,kBAMA,GAHA,oCAGA,sBACA,EArIA,cACA,2FAEA,OADA,uBACA,EAkIA,MADA,GAGA,MACA,cACA,4BAEA,6CAEA,QAIA,mBACA,OACA,aAEA,YACA,UACA,kCAA6C,KAC7C,wBAgBA,OAZA,8FACA,oBACA,mBAEG,uBACH,8CAGA,oBAEA,IAEA,EAGA,sBACA,IAQA,EACA,EACA,EACA,EACA,EAZA,eACA,KACA,KACA,IACA,IACA,WACA,IACA,eAOA,SACA,YAAkB,IAAS,KAC3B,WACA,OACA,kDACA,SAGK,sDACL,WAHA,IACA,QAOA,SACA,YAAmB,IAAW,KAE9B,OAEA,OAHA,QAGA,IACA,WACA,mBACA,OACA,YACA,UAEM,GAAD,IACL,QAAmB,IAAiB,IACpC,iCACA,IACA,YACA,aACA,WACA,MAKA,aAEA,OACA,kBACA,QACA,iBACM,kBACN,KAEA,qBAMA,KACA,oBACA,qBAtEA,KA0EA,WACA,wBAIA,gBACA,mBADA,EAGA,MAEA,+BAEA,oBACA,KAGA,MAIA,kBACA,cADA,GAEA,CACA,wBACA,QACA,KAIA,kBAGA,eACA,2BACA,0BAIA,WACA,wFACA,wBAOA,kBACA,MACA,WAFA,IAIA,iCACA,aACA,iBAEA,cACA,cACA,YAGA,KACA,wBAGA,OAFA,yBACA,cACA,EAIA,SAGA,kBACA,6BAGA,sBACA,aACA,cAEA,cACA,qBACA,aACA,WAEA,8CACA,UACA,6CACI,6BACJ,kCAIA,oBACA,yCACA,cAGA,mCACA,UAEA,cAEA,QACA,2CAGA,KAFA,UAMA,cAGA,oBACA,gBAEA,IAYA,EACA,EACA,EAdA,UACA,UACA,YACA,iBACA,iBACA,mBACA,SACA,aACA,OACA,eACA,KACA,IA2BA,GAtBA,yCACA,YAA2B,6CAC3B,WAoBA,IAhBA,UACA,UACA,YACA,oEACA,KACI,uBACJ,6BAEA,UACA,UACA,aAGA,sDACA,aAEA,GACA,kBAEA,oBACA,YAA8B,sBAG9B,+BACA,kCAGA,IACA,EACA,EAFA,gBAIA,yBAEA,YACA,MAEA,kCACA,eAEA,IAEA,wBACA,yBACA,qBACA,cACA,aAGA,cAEA,KAEA,OAEA,sBAGA,YA1BA,IA2BA,mBACA,qCAIA,oBACA,mBACA,WACA,qBAEA,IACA,kBACA,UAUA,MAJA,KAGA,SACA,WACA,QACA,IACA,uBACA,YAEA,eACA,uCA/GA,KAmHA,KACA,WACG,IAEH,sBACA,4BAEA,iCAGA,2BACA,iCACG,GAAAC,GAAA,KAGH,wBACA,sBACA,IACA,IACA,0CACA,IACA,OACA,+BACA,6BA2BA,OAxBA,0BACA,aACA,WAEA,QACA,KACA,UAGA,oBACA,iBACA,aAEA,QAEA,aACA,SAEA,WACA,kBACA,UAIA,EAGA,cACA,oCAEA,aAEA,cAEA,iDAEA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OAKP,OAJC,EAAD,aACA,eACA,eACA,eACA,EAUO,SAAS,EAAT,KACP,0DAUO,SAAS,EAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eAWtS,SAAS,EAAT,OAKP,OAJC,EAAD,UACA,YACA,YACA,YACA,EAYO,SAAS,EAAT,SAKP,OAJC,EAAD,eACA,iBACA,iBACA,iBACA,EW1YO,SAAS,IAChB,aAAmC,GASnC,OARM,IAAmB,eACzB,OACA,OACA,OACA,QAEA,OACA,OACA,EASO,SAAS,EAAT,GACP,aAAmC,GAOnC,OANC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,EAUO,SAAS,EAAT,KAOP,OANC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,EASO,SAAS,EAAT,GAOP,OANC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,EAcO,SAAS,EAAT,aACP,aAAmC,GAOnC,OANC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,EAeO,SAAS,EAAT,eAOP,OANC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,EAUO,SAAS,EAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OAEA,UARsB,UAYtB,MAEA,SACA,UACA,UACA,SACA,iBACA,iBAnBsB,GAUtB,KAmBO,SAAS,EAAT,GACP,2BAWO,SAAS,EAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,WACA,aACA,aACA,aACA,eACA,eACA,EAWO,SAAS,EAAT,OAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,WACA,aACA,cACA,cACA,OACA,OACA,EAWO,SAAS,EAAT,OAAc,IACpB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,OACA,SACA,SACA,SACA,OACA,OACA,EAWO,SAAS,EAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAOA,OANC,EAAD,KACA,OACA,OACA,OACA,eACA,eACA,EAcO,SAAS,EAAT,KACP,WACA,OAOA,OANC,EAAD,KACA,OACA,QACA,OACA,OACA,OACA,EAcO,SAAS,GAAT,KAOP,OANC,EAAD,QACA,OACA,OACA,UACA,OACA,OACA,EAcO,SAAS,GAAT,KAOP,OANC,EAAD,KACA,OACA,OACA,OACA,UACA,UACA,EASO,SAAS,GAAT,GACP,0EASO,SAAS,GAAT,GACP,wEAWO,SAAS,GAAT,OAOP,OANC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAOP,OANC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAOP,OANC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,EAYO,SAAS,GAAT,SAOP,OANC,EAAD,eACA,iBACA,iBACA,iBACA,iBACA,iBACA,EAUO,SAAS,GAAT,KACP,oFAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eC1chd,SAAS,KAChB,aAAmC,GAYnC,OAXM,IAAmB,eACzB,OACA,OACA,OACA,OACA,OACA,QAEA,OACA,OACA,OACA,EAUO,SAAS,GAAT,KAUP,OATC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WACA,EASO,SAAS,GAAT,GACP,aAAmC,GAUnC,OATC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EAUO,SAAS,GAAT,KAUP,OATC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EAiBO,SAAS,GAAT,mBACP,aAAmC,GAUnC,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAkBO,SAAS,GAAT,qBAUP,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EASO,SAAS,GAAT,GAUP,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAUO,SAAS,GAAT,KAEP,UACA,WACA,OACA,OACA,UACA,UACA,OACA,UACA,OACA,YAEC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAGA,SAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,UACA,WACA,UAGA,cAhBsB,UAqBtB,MAEA,SACA,kBACA,iBACA,SACA,iBACA,kBACA,SACA,kBACA,iBA/BsB,GAmBtB,KAuBO,SAAS,GAAT,KAAgB,IACtB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAWA,OATC,EAAD,WACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,EASO,SAAS,GAAT,GAAoB,IAC1B,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,4CAWO,SAAS,GAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAaA,OAXC,EAAD,eACA,iBACA,iBAEA,iBACA,iBACA,iBAEA,iBACA,iBACA,iBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAaA,OAXC,EAAD,KACA,OACA,OAEA,OACA,OACA,OAEA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAaA,OAXC,EAAD,WACA,aACA,aAEA,aACA,aACA,aAEA,OACA,OACA,OACA,EAWO,SAAS,GAAT,OACP,WACA,OAaA,OAXC,EAAD,UACA,YACA,YAEA,YACA,YACA,YAEA,UACA,UACA,UACA,EAcO,SAAS,GAAT,KAUP,OATC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,UACA,UACA,OACA,EAcO,SAAS,GAAT,KACP,WACA,OAaA,OAXC,EAAD,KACA,OACA,OAEA,QACA,OACA,OAEA,OACA,OACA,OACA,EAcO,SAAS,GAAT,KAYP,OAXC,EAAD,QACA,OACA,OAEA,OACA,UACA,OAEA,OACA,OACA,OACA,EAUO,SAAS,GAAT,KAYP,OAXC,EAAD,QACA,UACA,OAEA,UACA,UACA,OAEA,UACA,UACA,OACA,EAWO,SAAS,GAAT,SACN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAcA,OAZC,EAAD,SACA,SACA,SAEA,SACA,WACA,SAEA,SACA,SACA,WAEA,EAWO,SAAS,GAAT,SACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAEA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAGA,0BAhCO,UAqCP,MAEA,qBACA,qBACA,qBAEA,qBACA,qBACA,qBAEA,qBACA,qBACA,qBAjDO,GAmCP,KA2BO,SAAS,GAAT,OAUP,OATC,EAAD,OACA,OACA,OACA,OACA,UACA,OACA,QACA,OACA,OACA,EASO,SAAS,GAAT,GACP,uGASO,SAAS,GAAT,GACP,oGAWO,SAAS,GAAT,OAUP,OATC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAUP,OATC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OAUP,OATC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,EAYO,SAAS,GAAT,SAUP,OATC,EAAD,eACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,EAUO,SAAS,GAAT,KACP,2HAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eChxB/sB,SAAS,KAChB,aAAmC,IAmBnC,OAlBM,IAAmB,eACzB,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,SAEA,OACA,OACA,QACA,QACA,EASO,SAAS,GAAT,GACP,aAAmC,IAiBnC,OAhBC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,EAUO,SAAS,GAAT,KAiBP,OAhBC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,YACA,EAwBO,SAAS,GAAT,8BAAAC,GACP,aAAmC,IAiBnC,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAyBO,SAAS,GAAT,8BAAAA,EAAA,GAiBP,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EASO,SAAS,GAAT,GAiBP,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAUO,SAAS,GAAT,KAEP,cACC,EAAD,KACA,OACA,OACA,OACA,OACA,QAEA,UACA,UACA,WACA,OACA,UACA,WACA,OACA,OACA,YACA,QACA,QACA,aAEC,EAAD,QACA,UACA,UACA,WACA,UACA,UACA,UACA,WACA,UACA,UACA,YACA,YACA,WACA,WACA,YACA,YAGA,SAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAEA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAGA,0BAhCsB,UAqCtB,MAEA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,qBACA,sBACA,sBACA,sBACA,sBACA,sBACA,sBAtDsB,GAmCtB,KA+BO,SAAS,GAAT,KAAgB,IACtB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAkBA,OAhBC,EAAD,uCACA,4CACA,yCACA,4CACA,4CACA,yCACA,4CACA,yCACA,yCACA,4CACA,0CACA,6CACA,6CACA,0CACA,6CACA,0CACA,EASO,SAAS,GAAT,GAAoB,IAC1B,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAgBA,OAdA,UAWA,UAVA,UASA,UARA,UAOA,UANA,UAKA,UAJA,UAGA,UAFA,UACA,SAmBO,SAAS,GAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QAGA,OACA,OACA,OACA,OAuBA,OAtBC,EAAD,mBACA,qBACA,qBACA,qBAEA,OAAY,OAAU,OAAU,OAChC,qBACA,qBACA,qBACA,qBAEA,OAAY,OAAU,QAAW,QACjC,qBACA,qBACA,sBACA,sBAEA,QAAa,QAAW,QAAW,QACnC,sBACA,sBACA,sBACA,sBACA,EAWO,SAAS,GAAT,OAAkB,IACxB,EAAD,KACA,OACA,OACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SAsBA,OApBC,IAAD,GACA,iCACA,iCACA,kCACA,oCAEA,OAAe,OAAW,OAAW,OACrC,OAAe,OAAW,OAAW,OACrC,OAAe,OAAW,QAAY,QAEtC,OAAiB,KAAAC,EAAa,OAAa,OAC3C,OAAiB,OAAa,OAAa,OAC3C,OAAiB,OAAa,QAAc,QAE5C,wBACA,wBACA,wBACA,yBAGA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OAkBA,OAhBC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,cACA,cACA,YACA,YACA,YACA,YACA,EAYO,SAAS,GAAT,SAAe,IACrB,EAAD,KACA,OACA,OACA,iBACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SA5BsB,OA8BrB,EAAD,GACA,MAIA,GADA,MAEA,KACA,KAEA,OAEA,KADA,QAGA,OAAa,OAAW,OAAW,OACnC,OAAa,OAAW,OAAW,OACnC,OAAa,OAAW,QAAY,QAGpC,UAAsB,YAAwB,YAC9C,YAA0B,UAAoB,YAC9C,YAA0B,YAAwB,UAGlD,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,iBACA,kBACA,kBAEA,QAEA,YACA,YACA,YACA,aAvEsB,GAoFf,SAAS,GAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QAuBA,OArBC,IAAD,IAEA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,aAIA,aACA,aACA,aACA,aACA,aACA,aACA,cACA,cACA,EAWO,SAAS,GAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QAuBA,OArBC,IAAD,IAEA,UACA,UACA,UACA,UACA,YACA,YACA,YACA,aAIA,aACA,aACA,aACA,aACA,aACA,aACA,cACA,cACA,EAWO,SAAS,GAAT,WACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAuBA,OArBC,IAAD,IAEA,UACA,UACA,YACA,YACA,YACA,YACA,YACA,aAIA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,aACA,EAcO,SAAS,GAAT,KAiBP,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,WACA,WACA,WACA,QACA,EAcO,SAAS,GAAT,KAiBP,OAhBC,EAAD,QACA,OACA,OACA,OACA,OACA,UACA,OACA,OACA,OACA,OACA,WACA,QACA,QACA,QACA,QACA,QACA,EAeO,SAAS,GAAT,OAAqB,IAC3B,EAAD,KACA,OACA,OACA,iBACA,SACA,SACA,SAP4B,OAS3B,EAAD,GACA,MAIA,GADA,MAEA,KACA,KAEA,OAEA,KADA,QAIA,aACA,eACA,eACA,OACA,eACA,aACA,eACA,OACA,eACA,eACA,cACA,QACA,QACA,QACA,QACA,QAtC4B,GAqDrB,SAAS,GAAT,SACN,EAAD,KACA,OAmBA,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,EAcO,SAAS,GAAT,SACN,EAAD,KACA,OAmBA,OAhBC,EAAD,KACA,OACA,QACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAcO,SAAS,GAAT,SACN,EAAD,KACA,OAmBA,OAhBC,EAAD,KACA,OACA,OACA,OACA,QACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EAkBO,SAAS,GAAT,WAEN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAmBA,OAjBC,EAAD,WACA,SACA,SACA,OACA,SACA,aACA,SACA,OACA,SACA,SACA,cACA,QACA,WACA,WACA,WACA,QAEA,EAUO,SAAS,GAAT,SACN,EAAD,OAA2C,GAC3C,QACA,QACA,QACA,OACA,OACA,OACA,OACA,OAEA,kBAYA,OAVC,EAAD,GACA,2BACA,2BACA,6BAEA,yBACA,yBACA,0BAEA,UACA,EAYO,SAAS,GAAT,KAKP,OAJC,EAAD,SACA,WACA,WAEA,EAaO,SAAS,GAAT,SACN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QAMA,OAJC,EAAD,kBACA,oBACA,oBAEA,EAYO,SAAS,GAAT,SAEN,EAAD,gBACA,IA4BA,OA1BC,EAAD,GACA,WACA,WACA,mBACA,mBACA,oBACG,uBACH,yBACA,mBACA,WACA,mBACA,oBACG,YACH,yBACA,mBACA,mBACA,WACA,qBAEA,yBACA,mBACA,mBACA,mBACA,YAGA,EAoBO,SAAS,GAAT,aAEN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OACA,OACA,OAmBA,OAjBC,EAAD,eACA,aACA,aACA,OACA,aACA,iBACA,aACA,OACA,aACA,aACA,kBACA,QACA,WACA,WACA,WACA,QAEA,EAuBO,SAAS,GAAT,eAEN,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAEA,OACA,OACA,OAEA,OACA,OACA,OAEA,cACA,UACA,UACA,UACA,cACA,UACA,UACA,UACA,cAmBA,OAjBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,2BACA,2BACA,2BACA,QAEA,EAWO,SAAS,GAAT,KAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,MACA,MACA,MAEA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MAsBA,OApBC,EAAD,SACA,SACA,SACA,OAEA,SACA,WACA,SACA,OAEA,SACA,SACA,YACA,QAEA,QACA,QACA,QACA,QAEA,EAeO,SAAS,GAAT,mBACN,EAAD,QACA,UACA,UAiBA,OAhBC,EAAD,SACA,OACA,OACA,OACA,OACA,WACA,OACA,OACA,aACA,aACA,cACA,SACA,QACA,QACA,cACA,QACA,EAcO,SAAS,GAAT,WACP,IACA,EADA,YAwBA,OAtBC,EAAD,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,SACA,QACA,QACA,QACA,kBACA,UACA,cACA,gBAEA,SACA,YAEA,EAcO,SAAS,GAAT,aACN,EAAD,sBACA,0BACA,0BACA,2BACA,UACA,UAkBA,OAhBC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,iBACA,gBACA,cACA,SACA,QACA,QACA,gBACA,QACA,EAeO,SAAS,GAAT,mBACN,EAAD,QACA,UACA,UAiBA,OAhBC,EAAD,QACA,OACA,OACA,OACA,OACA,UACA,OACA,OACA,OACA,OACA,UACA,QACA,cACA,cACA,cACA,QACA,EAaO,SAAS,GAAT,aACN,OAAD,EACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OAnBO,OAqBN,EAAD,SAAiD,WAA+C,UACrF,OAOX,OAJA,OAIA,GAHA,OAGA,GAFA,OAEA,IAQA,KAHA,KAFA,MAEA,GAHA,OAMA,GAFA,KALA,MAKA,KAEA,GADA,WACA,KAOA,GADA,MAEA,KACA,OAPA,IACA,IACA,MAYA,KAJA,WAIA,GAHA,WAGA,GAFA,WAEA,KAOA,GADA,MAEA,KACA,OAPA,IACA,IACA,KAQA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA,QACA,qBACA,qBACA,qBACA,QAhFO,GA8FA,SAAS,GAAT,aACN,EAAD,KACA,OACA,OACA,OACA,OACA,OAEA,SACA,SACA,SAEA,cACA,MAEA,GADA,SAEA,KACA,MAGA,cACA,UACA,UA0BA,OAvBA,GADC,EAAD,eAGA,GADA,SAEA,KACA,MAGA,OACA,OACA,OACA,OACA,aACA,aACA,aACA,OACA,OACA,OACA,QACA,QACA,QACA,QACA,QACA,QACA,EASO,SAAS,GAAT,GACP,mLASO,SAAS,GAAT,GACP,gLAWO,SAAS,GAAT,OAiBP,OAhBC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,EAWO,SAAS,GAAT,OAiBP,OAhBC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,kBACA,kBACA,kBACA,kBACA,kBACA,kBACA,EAWO,SAAS,GAAT,OAiBP,OAhBC,EA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DAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eCjgBtS,SAAS,KAChB,aAAmC,GAOnC,OANM,IAAmB,eACzB,OACA,OACA,QAEA,OACA,EASO,SAAS,GAAT,GAKP,OAJC,EAAD,KACA,OACA,OACA,OACA,EAYO,SAAS,GAAT,OAEP,QAFO,GACP,IAMA,OAJC,EAAD,UACA,YACA,YACA,UACA,EAgBO,SAAS,GAAT,SACN,EAAD,WACA,SAWA,OAVC,EAAD,IACA,YACA,YACA,cAGA,OACA,OACA,QAEA,EAWO,SAAS,GAAT,OAAiB,IACvB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,mBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,MADuB,IAGtB,EAAD,KACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAWO,SAAS,GAAT,OACP,MADuB,IAGtB,EAAD,KACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAWO,SAAS,GAAT,OACP,MADuB,IAGtB,EAAD,KACA,OACA,OACA,OACA,OACA,OAMA,OAJC,EAAD,WACA,aACA,aACA,aACA,EAYO,SAAS,GAAT,KACP,WACA,OACA,OAMA,OAJC,EAAD,KACA,OACA,OACA,yBACA,EAYO,SAAS,GAAT,aAGN,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OAEA,SACA,SACA,SACA,SACA,SA+BA,OA1BA,GAFC,EAAD,mBAGA,KACA,KACA,KACA,KACA,MAGA,QAEA,QACA,OACA,eACA,aAIA,MACA,KAGA,aACA,aACA,aACA,aAEA,EASO,SAAS,GAAT,GAAe,IAGrB,EAAU,KACX,EAAW,KACX,EAAW,KAEX,SACA,OAMA,OAJC,EAAD,cACA,gBACA,gBACA,gBACA,EAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,kBACA,UAQA,OAJC,EAAD,QACA,UACA,UACA,SACA,EAWO,SAAS,GAAT,KAKP,OAJC,EAAD,SACA,WACA,WACA,UACA,EAcO,SAAS,GAAT,SAGN,EAAD,eACA,SAEA,OAEA,SACA,UACA,OACA,mBACA,mBACA,uBACG,CAEH,QACA,iBACA,qBAJG,IAKF,GAAD,OACA,UAEA,kCACA,UACA,OACA,2BACA,2BACA,2BAGA,SAaO,SAAS,GAAT,SACP,eAEA,KACA,KAJO,IAMN,EAAD,EAJA,MAKA,OACA,OACA,OACA,OACA,OAOA,OALC,EAAD,eACA,iBACA,iBACA,iBAEA,EASO,SAAS,GAAT,GACP,qDC5YO,SAAS,KAChB,aAAkC,GAWlC,OAVM,IAAmB,eACzB,OACA,OACA,OACA,OACA,OACA,OACA,QAEA,OACA,EAUO,SAAS,GAAT,GACP,aAAkC,GASlC,OARC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EAiBO,SAAS,GAAT,iBACP,aAAkC,GASlC,OARC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAgBO,SAAS,GAAT,eACP,aAAkC,GAClC,OACA,OACA,OACA,OACA,WACA,OACA,OAKA,OAJC,EAAD,eACA,iBACA,iBACA,kBACA,EAYO,SAAS,GAAT,OACP,cACA,UACA,UACA,OACA,OACA,OACA,OASA,OARC,EAAD,KACA,OACA,OACA,OACA,iBACA,iBACA,iBACA,kBACA,EAWO,SAAS,GAAT,KASP,OARC,EAAD,KACA,OACA,OACA,OACA,aACA,aACA,aACA,OACA,EAWO,SAASC,GAAT,KASP,OARC,EAAD,QACA,UACA,UACA,UACA,OACA,OACA,OACA,OACA,EAWO,SAAS,GAAT,KAEP,MAAc,KACZ,QACF,aAAiC,GAGjC,OAFE,QACA,UACF,EAWO,SAAS,GAAT,KASP,OARC,EAAD,QACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,EASO,SAAS,GAAT,GASP,OARC,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,EAkBO,SAAS,GAAT,mBAUP,OATC,EAAD,KACA,OACA,OACA,OAEA,OACA,OACA,OACA,OACA,EAiBO,SAAS,GAAT,KAKP,OAJC,EAAD,QACA,UACA,UACA,UACA,EAqBO,SAAS,GAAT,KAKP,OAJC,EAAD,QACA,UACA,UACA,UACA,EASO,SAAS,GAAT,KACP,WACA,OACA,OACA,OACA,QACA,QACA,QACA,OAIA,OAHC,EAAD,uBACA,yBACA,yBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,UACA,UACA,UACA,OACA,OACA,OACA,OASA,OARC,EAAD,KACA,OACA,OACA,OACA,mBACA,mBACA,mBACA,oBACA,EAWO,SAAS,GAAT,OACP,YACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,kBACA,kBACA,kBACA,kBAUA,OATE,UACF,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,YACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,kBACA,kBACA,kBACA,kBAUA,OATE,UACF,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,YACA,QACA,QACA,OACA,OACA,OACA,OACA,OACA,kBACA,kBACA,kBACA,kBAUA,OATE,UACF,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OAcA,OAZC,EAAD,mBACA,qBACA,qBACA,qBACA,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OAcA,OAZC,EAAD,mBACA,qBACA,qBACA,qBACA,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBACA,EAYO,SAAS,GAAT,SAEP,WACA,OAAW,QAEX,uCAGC,EAAD,EARO,GAOP,IAEA,WACA,WACA,WACA,OAEA,OACA,OACA,OACA,OACA,qBACA,qBACA,qBACA,qBAEA,WACA,OACA,OACA,OAMA,OALC,EAAD,mBACA,qBACA,qBACA,qBAEA,EAYO,SAAS,GAAT,OASP,OARC,EAAD,aACA,eACA,eACA,eACA,eACA,eACA,eACA,eACA,EAWO,SAAS,GAAT,OACP,WACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OASA,OARC,EAAD,mBACA,qBACA,qBACA,qBACA,qCACA,qCACA,qCACA,qCACA,EAkBO,SAAS,GAAT,OASP,OARC,EAAD,UACA,YACA,YACA,YACA,YACA,YACA,YACA,YACA,EAuBO,SAAS,GAAT,SACP,UAYA,OAXS,EAAH,UAAG,MAET,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBAEA,EAUO,SAAS,GAAT,KACP,MAAc,MASd,OARC,EAAD,WACA,aACA,aACA,YACA,aACA,aACA,aACA,YACA,EAWO,SAAS,GAAT,KASP,OARC,EAAD,SACA,WACA,WACA,UACA,WACA,WACA,WACA,UACA,EAyCO,SAAS,GAAT,KACP,MAAkB,MAClB,QACA,OADA,IAGC,EAAD,OACA,SACA,SACA,SAEA,OACA,OACA,OACA,OAEA,kBAEA,OACA,OACA,OACA,OAEA,eACA,eACA,eACA,eAEA,SASO,SAAS,GAAT,GACP,8FAUO,SAAS,GAAT,KACP,8GAUO,SAAS,GAAT,KAAe,IACrB,EAAD,KACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,eAA8B,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,wBAAqE,GAAgB,eC9zB1nB,SAAS,KAChB,aAAmC,GAKnC,OAJM,IAAmB,eACzB,OACA,QAEA,EASO,SAAS,GAAT,GACP,aAAmC,GAGnC,OAFC,EAAD,QACA,UACA,EAUO,SAAS,GAAT,KACP,aAAmC,GAGnC,OAFC,EAAD,KACA,OACA,EAUO,SAAS,GAAT,KAGP,OAFC,EAAD,QACA,UACA,EAWO,SAAS,GAAT,OAGP,OAFC,EAA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kBACA,WACA,uBACA,mBACA,QACA,eACA,mBACA,iBACA,mBACA,gBACA,iBACA,eACA,iBACA,qBACA,sBACA,uBACA,cACA,kBACA,mBACA,oBACA,gBACA,iBACA,WACA,SACA,WACA,cACA,UACA,aACA,QAEA,kBACA,mBACA,kBACA,sBACA,uBACA,uBACA,oBACA,mBAGA,qBAA8C,WAAgB,OAC9D,KACA,mDAAmE,WAAgB,IAEnF,EADA,KACA,MAMA,kBAAA9E,GAAiC,4BASjC,cAWA,eA/GA,IA0OA,GACA,iBACA,oBACA,qBAKA,aACA,mBACA,QAAiC,KACjC,eACA,cACA,gBACA,cACA,mCACA,mCAuEA,OArEC,EAAD,8BACC,EAAD,wBACA,kCAEA,GADA,yBACA,MACA,uBACA,sBACA,+BACA,gBACA,6CAEC,GAAD,oCACC,EAAD,yBACA,aACA,WACA,iBACA,qCACA,gBACA,4BAGA,UAEA,+BACA,2BACA,oBACA,yBADA,IAEC,EAAD,qBACA,2BACA,gBACA,4BACA,qBACA,uBACA,uBACA,gBACA,8BAEC,GAAD,gCACA,iBACA,aACA,iBACA,qCACA,gBACA,+BAKA,8BACA,WACA,kCAA8C,yBAE9C,8BACA,2BAA6C,WAAgB,IAA7D,EACA,KACA,YAEA,aAEA,gCACA,2BAA6C,WAAgB,IAA7D,EACA,KACA,eAEA,aAEA,6BACA,2BAEA,EA/EA,GAiFA,UAIA,IAAI,EAAJ,WACA,gBACA,gBACA,UAQA,OANC,EAAD,+BACA,sBAEA,6BACA,qCAEA,EAXA,GAaA,aAIA,IAAI,EAAJ,YAEA,gBACA,yBAGA,OAFC,EAAD,QACA,OACA,EAQA,OAbC,EAAD,KAOA,iCACA,gCAAwC,gBAExC,6BACA,8CAEA,EAdA,IAgBA,UAIA,IAAI,EAAJ,YAEA,kBACA,yBAIA,OAHC,EAAD,OACA,UACA,OACA,EAQA,OAdC,EAAD,KAQA,iCACA,qBAA6B,8BAE7B,6BACA,wDAEA,EAfA,IAiBA,SAIA,IAAI,EAAJ,YAEA,oBACA,2BAIA,OAHC,EAAD,OACA,UACA,OACA,EAwCA,OA9CC,EAAD,KAQA,4CACC,EAAD,GACA,KACA,eACA,mBACA,0BAEA,OADC,EAAD,+BACA,GAEA,4CACA,gDAEA,iDACC,EAAD,GACA,KACA,cACA,mBACA,0BACA,6CAGA,OAFC,EAAD,eACA,YACA,GAEA,2CACC,EAAD,GACA,KAEA,OADA,WACA,YAEA,oCACA,gCAEA,iCACA,sBAEA,6BACA,qEAEA,EA/CA,IAiDA,cAUA,SANA,gBAIA,YAHC,IAAD,IAA0B,UAC1B,QAA2B,uBAC3B,QAA6B,KAC7B,uC,sGCzbA,OACAC,EAAA,KAEA,QAEA,QACA,QAEA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QAEA,IAAY,GAAZ,SAAAD,GACE,IAAA+E,KAAA,UACA,IAAAC,OAAA,YAFF,CAAY,IAAAC,aAAA,EAAAA,WAAU,KAStB,gBAA0BC,YA+FxB,YAAY,GAQVC,QApCF,KAAAC,UAAoB,EACpB,KAAAC,UAAA,EACA,KAAAC,SAAmB,EACnB,KAAAC,UAAoB,EACX,KAAAC,SAAmB,EAAI,GAEhC,KAAAC,MAAgB,GAEhB,KAAAC,eAAA,EAEA,KAAAC,MAAe,IAAI,EAAAC,MACnB,KAAAC,MAAe,IAAI,EAAAC,MACnB,KAAAC,SAAqB,IAAI,EAAAC,SAGzB,KAAAC,SAAkB,GAqHlB,KAAAC,UAAa,IAMX,GALI,GAAU,EAAOC,SACnB5D,KAAK6D,aAAa,EAAOD,OAAO3D,MAChCD,KAAK8D,WAAW,EAAWrB,UAGxB,EAAOsB,MAAQ,EAAOA,IAAI9D,KAC7B,OAP2B,MAUvB,EAAM,EAAO8D,IAAI9D,KACjB,EAAQ,EAAO+D,MACrB,IAAI,KACJ,EAAMC,QAAQ,IACZ,EAAa,GAAc,EAAIC,WAdJ,GAiB3B,EAAMD,QAAQ,GAAQ,EAAIhE,KAAO,EAAI+D,MAAM9C,KAAK,EAAIjB,MAAQ,GAI9DqC,OAAO6B,QAAQ,EAAOC,SAASH,QAAQ,EAAE,EAAD,MAClC,EAAKhE,OACP,EAAImE,QAAJ,GAAoB,EAAKnE,QAIF,EAAvB,EAAOoE,OAAOC,QAChB,EAAOD,OAAOJ,QAAQ,IAChB,EAAMhE,MACRD,KAAKqE,OAAOnD,KAAK,EAAMjB,QAK7BD,KAAKuE,UAALC,GAEAxE,KAAKyE,cAAc,EAAAC,IAAI,OAAQ,CAAEC,OAAQ,CAAEC,KAAK,OAGlD,KAAAC,KAAO,KACLC,sBAAsB9E,KAAK6E,MADjB,MAGJ,EAAS7E,KAAK+E,OACd,EAAS,EAAOC,cACtB,KAAY,CAAC,MACL,EAAK,EAAOC,YACZ,EAAK,EAAOC,cACd,EAAOjH,QAAP,GAAuB,EAAOU,SAAP,KACzB,EAAOV,MAAP,EACA,EAAOU,OAAP,EACAqB,KAAKmF,OAAOC,OAAS,EAAOH,YAAc,EAAOC,aACjDlF,KAAKmF,OAAOE,yBACZrF,KAAKsF,QAAQC,GAAGC,SACd,EACA,EACAxF,KAAKsF,QAAQC,GAAGE,mBAChBzF,KAAKsF,QAAQC,GAAGG,uBAKlB,EAAOT,cAAgB,EAAOhH,OAC9B,EAAOiH,eAAiB,EAAOvG,UAE/B,EAAOV,MAAQ,EAAOgH,YACtB,EAAOtG,OAAS,EAAOuG,aACvBlF,KAAKmF,OAAOC,OAAS,EAAOH,YAAc,EAAOC,aACjDlF,KAAKmF,OAAOE,yBACZrF,KAAKsF,QAAQC,GAAGC,SACd,EACA,EACAxF,KAAKsF,QAAQC,GAAGE,mBAChBzF,KAAKsF,QAAQC,GAAGG,sBAjCZ,MAsCJ,EAAW,EAAKC,MAAQ,IACxB,EAAK,EAAW3F,KAAK+C,SAvCjB,IAwCV/C,KAAKgD,WAAL,EAEOhD,KAAKgD,UAAYhD,KAAKiD,UAC3BjD,KAAK4F,OAAO5F,KAAKiD,UACjBjD,KAAKgD,WAAahD,KAAKiD,SAGzBjD,KAAK6F,SAAShB,OACO,KAAjB7E,KAAK8F,UACP9F,KAAK+F,SAASlB,KAAK7E,KAAKmF,QACxBnF,KAAKgG,WAAWnB,KAAK7E,KAAKmF,OAAQnF,KAAK0D,WAGzC1D,KAAK+C,SAAL,GA+EF,KAAAkD,aAAgB,IACd,MAAM,EAAQ,EAAEC,QAAQtB,KAAK,GADE,IAG7B5E,KAAKoD,MAAM+C,SAAX,EACAnG,KAAKoD,MAAMpF,SAAS,GAAK,EAAMoI,QAC/BpG,KAAKoD,MAAMpF,SAAS,GAAK,EAAMqI,UAInC,KAAAC,WAAa,KACXtG,KAAKoD,MAAM+C,SAAX,EACAnG,KAAKoD,MAAMmD,MAAM,GAAK,EACtBvG,KAAKoD,MAAMmD,MAAM,GAAK,GAGxB,KAAAC,YAAe,IACb,MAAM,EAAQ,EAAEN,QAAQtB,KAAK,GACzB,GAAS5E,KAAKoD,MAAM+C,UACtBnG,KAAKoD,MAAMmD,MAAM,GACjBvG,KAAKoD,MAAMmD,MAAM,GAAK,EAAMH,QAAUpG,KAAKoD,MAAMpF,SAAS,GAC1DgC,KAAKoD,MAAMmD,MAAM,GAAK,EAAMF,QAAUrG,KAAKoD,MAAMpF,SAAS,GAE1DgC,KAAKoD,MAAMpF,SAAS,GAAK,EAAMoI,QAC/BpG,KAAKoD,MAAMpF,SAAS,GAAK,EAAMqI,UAInC,KAAAI,YAAe,IACTzG,KAAKmD,gBACPnD,KAAKsD,MAAMiD,MAAM,GAAmB,GAAd,EAAEG,UACxB1G,KAAKsD,MAAMiD,MAAM,GAAmB,GAAd,EAAEI,UAExB3G,KAAKsD,MAAMtF,SAAS,GAAK,EAAE4I,MAC3B5G,KAAKsD,MAAMtF,SAAS,GAAK,EAAE6I,QAI/B,KAAAC,QAAW,IACT9G,KAAKwD,SAASuD,KAAK,EAAEC,OAAS,GAE1BhH,KAAKmD,gBACP,EAAE8D,kBAJI,IAWV,KAAAC,MAAS,IACPlH,KAAKwD,SAASuD,KAAK,EAAEC,OAAS,GAE1BhH,KAAKmD,gBACP,EAAE8D,kBAJE,IAWR,KAAAE,mBAAqB,KACnB,GAAIC,SAASC,OAAQ,CACnB,GAAIrH,KAAK8C,SACP,OAGF9C,KAAK6C,UAAY,EAAK8C,MAAQ,IAC9B3F,KAAK8C,UAAL,MACK,CACL,IAAK9C,KAAK8C,SACR,OAGF9C,KAAK+C,SAAW,EAAK4C,MAAQ,IAAO3F,KAAK6C,UAAY7C,KAAK+C,SAC1D/C,KAAK8C,UAAL,IApVF9C,KAAKqE,OAAS,GACdrE,KAAKsH,YAAc,IAAI,EAAAC,YAEvBvH,KAAKwH,OAAS,EAAOA,OACrBxH,KAAKyH,OAAS,IAAI,EAAAC,OAAO1H,KAAKwH,QAE9BxH,KAAKyH,OAAOE,iBAAiB,UAAYlK,IACvCuC,KAAK2D,UAAwBlG,EAAOkH,OAAO8C,UAG7CL,SAASO,iBAAiB,aAAc3H,KAAKiG,cAA7C,GACAmB,SAASO,iBAAiB,WAAY3H,KAAKsG,YAA3C,GACAc,SAASO,iBAAiB,cAAe3H,KAAKsG,YAA9C,GACAc,SAASO,iBAAiB,YAAa3H,KAAKwG,aAA5C,GACAY,SAASO,iBAAiB,YAAa3H,KAAKyG,aAA5C,GACAmB,OAAOD,iBAAiB,UAAW3H,KAAK8G,SACxCc,OAAOD,iBAAiB,QAAS3H,KAAKkH,OACtCU,OAAOD,iBAAiB,mBAAoB3H,KAAKmH,oBAEjDnH,KAAK+E,OAAS,EAAOA,OACrB/E,KAAKmF,OAAS,EAAA0C,OAAOC,KAAK9H,KAAK+E,OAAO9G,MAAQ+B,KAAK+E,OAAOpG,QAE1DqB,KAAKsF,QAAU,EAAOA,QACtBtF,KAAK6F,SAAW,EAAOA,SACvB7F,KAAKgG,WAAa,EAAOA,WACzBhG,KAAK+F,SAAW,EAAOA,SAEvB/F,KAAK+H,KAAO,EAAWvF,KAEvBxC,KAAKgI,OAAS,IAAI,EAAAC,aAAajI,MAE/BA,KAAK8F,QAAU,GAtIV,eAEL,IADe,EAAAoC,QAAQC,oBACXC,WACV,MAAO,CACLC,OAAQ,QACRC,QAAS,qBAIb,MAAM,EAASlB,SAASmB,cAAc,UACtC,IAAK,EACH,MAAO,CACLF,OAAQ,QACRC,QAAS,sCAIb,MAAM,EAAU,EAAAJ,QAAQJ,KAAR,GAChB,IAAK,EACH,MAAO,CACLO,OAAQ,QACRC,QAAS,sCAIb,MAAM,EAAW,EAAAE,SAASV,KAAT,GACjB,IAAK,EACH,MAAO,CACLO,OAAQ,QACRC,QAAS,iCAIb,MAAM,EAAa,EAAAG,WAAWX,KAAX,GACnB,IAAK,EACH,MAAO,CACLO,OAAQ,QACRC,QAAS,oCAIb,MAAMI,EAAW,EAAAC,SAASb,KAAT,GACjB,OAAKY,EAgBE,CACLL,OAAQ,UACRO,KAXW,IAAI,EAAK,CACpB7D,OAAA,EACAyC,OAAA,EACAlC,QAAA,EACAO,SAAA,EACAG,WAAA,EACAD,SAAA2C,KAZO,CACLL,OAAQ,QACRC,QAAS,kCA4Ff,YACE,OAAOtI,KAAK+E,OAGd,KAAK,GACH/E,KAAKyE,cAAc,EAAAC,IAAI,cACvB1E,KAAKyH,OAAOoB,KAAZ,GAGF,UAAU,GACR,GAAI7I,KAAK8F,QAAQgD,gBAAkB,EAAIC,KAAKD,cAA5C,CAIA9I,KAAK8F,QAAU,EAAIiD,KAEnB/I,KAAKgG,WAAWzB,UAAhB,GACAvE,KAAK+F,SAASxB,UAAd,GAEAvE,KAAK0D,SAAW,EAAIA,SAEpB,MAAM,EAAQ,EAAIA,SAASsF,KAAK,GAAwB,sBAAnB,aAXrC,GAcEhJ,KAAKmF,OAAOnH,SAAS,GAAK,EAAMiL,OAAO,GACvCjJ,KAAKmF,OAAOnH,SAAS,GAAK,EAAMiL,OAAO,GACvCjJ,KAAKmF,OAAOnH,SAAS,GAAK,EAAMiL,OAAO,KAEvCjJ,KAAKmF,OAAOnH,SAAS,GAAK,EAC1BgC,KAAKmF,OAAOnH,SAAS,GAAK,EAC1BgC,KAAKmF,OAAOnH,SAAS,GAAK,GAG5BgC,KAAKmF,OAAO+D,SAAS,GAAK,EAC1BlJ,KAAKmF,OAAO+D,SAAS,GAAK,EAC1BlJ,KAAKmF,OAAO+D,SAAS,GAAK,GAG5B,aAAa,GAGXlJ,KAAKgI,OAAOnE,aAAZ,GAKF,WAAW,GACT7D,KAAK+H,KAAL,EACA/H,KAAKyE,cAAc,EAAAC,IAAI,eAGzB,SAAS,GACP1E,KAAKkD,MAAL,EAEAlD,KAAKyE,cAAc,EAAAC,IAAI,cAAe,CAAEC,OAAQ,CAAEC,KAAK,MAGzD,WACE,OAAO5E,KAAKkD,MAmGd,OAAO,GACLlD,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAM5E,SADvC,MAGT,EAASA,KAAKmF,OACd,EAAWnF,KAAKwD,SAChB,EAAQxD,KAAKsD,MACb,EAAQtD,KAAKoD,MAEnB,GAAIpD,KAAK+H,OAAS,EAAWtF,OAC3BzC,KAAKgI,OAAOpC,OAAZ,QACK,GAAI5F,KAAK+H,OAAS,EAAWvF,KAAM,CACpCxC,KAAKoD,MAAM+C,SACb,EAAO+C,SAAS,GAAK,EACnB,EAAS,EAAOA,SAAS,GAAK,EAAM3C,MAAM,GAAK,KAAM,EAAU,GAC/D,EAAU,GAEZ,EAAO2C,SAAS,IAAM,EAAM3C,MAAM,GAAK,MAEvC,EAAO2C,SAAS,GAAK,EACnB,EAAS,EAAOA,SAAS,GAAK,EAAM3C,MAAM,GAAK,KAAM,EAAU,GAC/D,EAAU,GAEZ,EAAO2C,SAAS,IAAM,EAAM3C,MAAM,GAAK,KAZD,MAgBlC,EADQ,IACH,EACL,EAAQ,EAAA9C,SAAS0F,KAAKC,EACtB,EAAQ,EAAA3F,SAAS0F,KAAKE,EACtB,EAAQ,EAAA5F,SAAS0F,KAAKG,EACtB,EAAQ,EAAA7F,SAAS0F,KAAKI,EACtB,EAAU,EAAA9F,SAAS0F,KAAKK,EACxB,EAAQ,EAAA/F,SAAS0F,KAAKM,MACxB,EAAS1C,KAAT,KAAyB,EAASA,KAAT,KACvB,EAASA,KAAT,IACF,EAAO/I,SAAS,IAAM,EAAS,EAAOkL,SAAS,GAAK,EAAU,GAAxC,EACtB,EAAOlL,SAAS,IAAM,EAAS,EAAOkL,SAAS,GAAK,EAAU,GAAxC,GACb,EAASnC,KAAT,KACT,EAAO/I,SAAS,IAAM,EAAS,EAAOkL,SAAS,GAAK,EAAU,GAAxC,EACtB,EAAOlL,SAAS,IAAM,EAAS,EAAOkL,SAAS,GAAK,EAAU,GAAxC,IAItB,EAASnC,KAAT,KAAyB,EAASA,KAAT,KACvB,EAASA,KAAT,IACF,EAAO/I,SAAS,IAAM,EAAS,EAAOkL,SAAS,IAAzB,EACtB,EAAOlL,SAAS,IAAM,EAAS,EAAOkL,SAAS,IAAzB,GACb,EAASnC,KAAT,KACT,EAAO/I,SAAS,IAAM,EAAS,EAAOkL,SAAS,IAAzB,EACtB,EAAOlL,SAAS,IAAM,EAAS,EAAOkL,SAAS,IAAzB,IAItB,EAASnC,KAAT,KAAyB,EAASA,KAAT,KACvB,EAASA,KAAT,GACF,EAAO/I,SAAS,IAAhB,EACS,EAAS+I,KAAT,KACT,EAAO/I,SAAS,IAAhB,IAKN,EAAMuI,MAAM,GAAK,EACjB,EAAMA,MAAM,GAAK,EAEjBvG,KAAKyE,cAAc,EAAAC,IAAI,aAAc,CAAEC,OAAQ,CAAEC,KAAM5E,SAGzD,GAAGvC,EAAH,GACE,OAAOuC,KAAK2H,iBAAL,EAAAnD,GAGT,IAAI/G,EAAJ,GACE,OAAOuC,KAAK0J,oBAAL,EAAAlF,IAhXX,U,4EC3BA,yBAAA/G,EAAA,GAEqB,MAEb,EAAO,IAAI0D,WAA2B,EAAhB,EAAOmD,QAE7B,EAAM,EAAOA,OACnB,IAAK,IAAI,EAAI,EAAG,MAAW,EACzB,EAAS,EAAJ,GAAS,EAAoB,EAAZ,MACtB,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,IAGpB,OAAO,GAGT,sCAAA7G,EAAA,GAEqB,MAEb,EAAO,IAAI0D,WAA2B,EAAhB,EAAOmD,QAE7B,EAAM,EAAOA,OACnB,IAAK,IAAI,EAAI,EAAG,MAAW,EACP,MAAd,KACF,EAAS,EAAJ,EAAQ,GAAK,GAElB,EAAS,EAAJ,GAAS,EAAoB,EAAZ,MACtB,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,EAAoB,EAAZ,KAAgB,GAC1C,EAAS,EAAJ,EAAQ,GAAK,KAItB,OAAO,I,4ECnCT,MAAM,EAAWsD,OAEjB,IAAI,EACuB,oBAAhB+B,cACLA,YAAYhE,IACd,EAAO,IAAM,EAAIgE,YAAYhE,MACpB,EAAIgE,YAAYC,OACzB,EAAO,IAAM,EAAID,YAAYC,SACpB,EAAID,YAAYE,MACzB,EAAO,IAAM,EAAIF,YAAYE,QACpB,EAAIF,YAAYG,KACzB,EAAO,IAAM,EAAIH,YAAYG,OACpB,EAAIH,YAAYI,UACzB,EAAO,IAAM,EAAIJ,YAAYI,YACpBC,KAAKrE,MACd,EAAO,IAAMqE,KAAKrE,QAIT,EAAAA,IAAM,SAAe,IAAIqE,MAAOC,WAEhC,EAAAC,WAAc,IAAmB,MACtC,EAAI,EAAW,EAAU,IACzB,EAAI,EAAW,EAAc,GAAJ,GAG/B,OAFe,GAAJ,EAAS,MAAU,EAAEC,YAEpB,KADG,GAAJ,EAAS,MAAU,EAAEA,c,oFCzBlC,OAGM,EAAWvC,OAGX,EAA6B,IADN,EAAIwC,cAAgB,EAAIC,oBAGrD,4BAAiC1H,YAM/B,cACEC,QACA5C,KAAKsF,QAAL,EAEA,MAAM,EAASgF,WAAWC,aAAaC,QAAQ,WAAa,OAC5DD,aAAaE,QAAQ,SAAU,EAAON,YAEtCnK,KAAK0K,SAAW,GAEhB1K,KAAK2K,cAAgB,EACrB3K,KAAK4K,WAAa5K,KAAKsF,QAAQuF,aAC/B7K,KAAK4K,WAAWE,KAAKC,MAArB,EACA/K,KAAK4K,WAAWI,QAAQhL,KAAKsF,QAAQ2F,aAErC,IAAK,IAAI,EAAI,EAAO,EAAJ,IAAS,EACvBjL,KAAK0K,SAASxJ,KAAK,CACjBgK,OAAQ,KACRJ,KAAM9K,KAAKsF,QAAQuF,eAErB7K,KAAK0K,SAAL,GAAiBI,KAAKE,QAAQhL,KAAK4K,YAIvC,oBACE,OAAO,EAGT,KAAK,EAAL,KACE5K,KAAKmL,KAAL3G,GAEA,MAAM,EAAOxE,KAAK0K,SAALlG,GAAuBsG,KACpC,EAAKA,KAAKC,MAAQ,EAAS,EAAG,EAAS,EAAT,IAE9B,MAAM,EAAS/K,KAAKsF,QAAQ8F,qBAC5B,EAAOhK,OAAS,EAAMA,OACtB,EAAO4J,QAAP,GACA,EAAOK,MAAM,GAEbrL,KAAK0K,SAALlG,GAAuB0G,OAAvB,EAGF,KAAK,GACH,MAAM,EAASlL,KAAK0K,SAAL,GAAuBQ,OADpB,GAGhB,EAAOC,KAAK,GAIhB,YACE,OAAOnL,KAAK4K,WAAWE,KAAKC,MAG9B,UAAU,GACR,MAAM,EAAU/K,KAAK4K,WAAWE,KAAKC,MACvB,EAAV,GAAyB,IAAV,IACjB/K,KAAK2K,cAALnG,GAGFxE,KAAK4K,WAAWE,KAAKC,MAArB,EAEAR,aAAaE,QAAQ,SAAU,EAAMN,YAErCnK,KAAKyE,cAAc,EAAAC,IAAI,eAAgB,CAAEC,OAAQ,CAAEC,KAAK,MAG1D,aAC2B,IAArB5E,KAAKsL,YACPtL,KAAKuL,UAAUvL,KAAK2K,eAEpB3K,KAAKuL,UAAU,M,oFCnFrB,QACA7N,EAAA,MACA,QACA,OACA,QACA,QAEM,EAAa,IAEjB,MAAiB,WADL,EAAEkE,KAAK,IAIf,EAAc,IAAD,CACjB4J,aAAc,EAAEC,KAChBC,YAAa,EAAED,KACf3F,QAAS,EAAElE,KAAK,KAChB+J,QAAS,EAAE/J,KAAK,KAChBgK,OAAQ,EAAElO,IACVmO,UAAW,EAAEJ,OAGT,EAAkB,CAAC,EAAD,KACtB,EAAEpL,KAAF,GADoD,IAGhD,EAAQ,EAAEoL,KACV,EAAc,GAClB,IAAK,IAAI,EAAI,EAAG,MAAa,EAC3B,EAAYvK,KAAK,CACf4K,GAAI,EAAEL,KACN1C,KAAM,EAAEnH,KAAK,IACbmK,MAAO,EAAEN,KACTO,QAAS,EAAEtO,IACXuO,KAAM,EAAE/J,IACRgK,OAAQ,EAAET,KACVtL,OAAQ,EAAEsL,KACVnH,OAAQ,EAAEmH,OAId,OAAO,GAyCH,EAAY,CAAC,EAAD,OAChB,IAAI,EAAa,CACfU,KAAM,EAAEnL,KACRiL,KAAM,EAAE/J,IACRkK,KAAM,EAAEX,MAGV,OAAQ,EAAMU,MACZ,KAAK,EACL,KAAK,EACH,EAAE3L,KAAK,GACP,EAAM2E,OAAS,CACbnH,SAAU,CAAC,EAAEkE,IAAK,EAAEA,IAAK,EAAEA,KAC3BmK,YAAa,CAAC,EAAEnK,IAAK,EAAEA,IAAK,EAAEA,MAEhC,EAAE1B,KAAK,KACP,EAAMP,KAtDU,EAAC,EAAD,OAAuD,IACvE,EAAS,EAAEwL,KACX,EAAQ,EAAEnL,OAAFgM,EACR,EAAO,GAHgE,KAIpE,EAAEhM,OAAF,GAAkB,CACvB,IAAI,EAAO,EAAEU,KACb,GAAa,IAAT,EACF,SACK,GAAY,IAAR,EAAY,CACjB,OAAqD,EAA7B,KAAqBuL,KAC/C,EAAE/L,KAAK,KAAqB+L,MAE5B,EAAE/L,KAAK,EAAEQ,MAGX,SAGF,IAAI,EAAU,EAAAwL,gBAAgBC,KAAhB,OAdS,GAgBR,KAAT,IACF,EAAe,EAAQC,OAAvB,GAEF,EAAKxL,KAAK,CACRiL,KAAA,EACAlM,KAAK,KAGP,EAAEI,KAAF,GAOJ,OAFA,EAAEA,KAAF,GAEA,GAmBiB,QACb,MAEF,KAAK,EACH,MAEF,KAAK,EACH,EAAMsM,QAAU,EAAE/K,KAAK,IACvB,MAEF,KAAK,EACH,EAAEpB,KAAK,IACP,MAEF,KAAK,EACH,MAEF,KAAK,EACH,EAAEA,KAAK,IACP,MAEF,KAAK,EACH,EAAEA,KAAK,GACP,MAEF,KAAK,EACH,EAAMoM,MAAQ,CACZC,QAAS,EAAEnP,IACXoP,OAAQ,EAAElL,KAAK,EAAE6J,MACjBsB,YAAa,EAAE7K,IACf8K,OAAQ,EAAE9K,IACV6J,MAAO,EAAEN,KACTwB,MAAO,EAAEvP,KAEX,MAEF,KAAK,EACH,EAAE8C,KAAK,EAAEiL,MACT,MAEF,QACE,EAAMyB,OAAN,EAKJ,OAAO,GAGT,QAKE,YAAY,EAAZ,GACElN,KAAKmN,OAAL,EACAnN,KAAK8F,QAAU9F,KAAKmN,OAAOrH,QAC3B9F,KAAKoN,YAAL5I,EAGF,+BAA+C,IACzC,EAAI,IAAI,EAAA6I,OAAJ,GAER,GAAc,WADF,EAAEzL,KAAK,GAEjB,MAAM,IAAI0L,MAAM,yBAGlB,IAAI,EAAc,GAClB,EAAO9B,aAAe,EAAEC,KACxB,EAAOC,YAAc,EAAED,KACvB,EAAO3F,QAAU,EAAElE,KAAK,KACxB,EAAO+J,QAAU,EAAE/J,KAAK,KACxB,EAAOgK,OAAS,EAAElO,IAClB,EAAOmO,UAAY,EAAEJ,KAErB,EAAEpL,KAAK,EAAOwL,WAf+B,IAgBzC,EAAiB,EAAEJ,KACnB,EAAqB,GACzB,IAAK,IAAI,EAAI,EAAG,MAAsB,EACpC,EAAYvK,KAAK,CACf4K,GAAI,EAAEL,KACN1C,KAAM,EAAEnH,KAAK,IACbmK,MAAO,EAAEN,KACTO,QAAS,EAAEtO,IACXuO,KAAM,EAAE/J,IACRgK,OAAQ,EAAET,KACVtL,OAAQ,EAAEsL,KACVnH,OAAQ,EAAEmH,KACV8B,OAAQ,KAIZ,IAAK,IAAI,EAAI,EAAG,EAAI,EAAYjJ,SAAU,EAAG,CAC3C,EAAEjE,KAAK,KAAeF,QADqB,IAG3C,IAAI,MACI,GAAqB,CAC3B,IAAI,EAAa,CACfgM,KAAM,EAAEqB,IACRvB,KAAM,EAAE/J,IACRuL,MAAO,EAAEhC,MAGX,OAAQ,EAAMU,MACZ,KAAK,EACL,KAAK,EACH,EAAE3L,KAAK,GACP,EAAM2E,OAAS,CACbnH,SAAU,CAAC,EAAEkE,IAAK,EAAEA,IAAK,EAAEA,KAC3BmK,YAAa,CAAC,EAAEnK,IAAK,EAAEA,IAAK,EAAEA,MAEhC,EAAE1B,KAAK,KACP,EAAEA,KAAK,EAAEiL,MACT,MAGF,KAAK,EAGH,MAGF,KAAK,EACH,EAAMkB,QAAU,EAAE/K,KAAK,IACvB,MAGF,KAAK,EACH,EAAEpB,KAAK,IACP,MAGF,KAAK,EAEH,KACA,MAGF,KAAK,EACH,EAAEA,KAAK,IACP,MAGF,KAAK,EACH,EAAEA,KAAK,GACP,MAGF,KAAK,EACH,EAAEA,KAAK,GACP,EAAEA,KAAK,EAAEiL,KAAO,IAChB,MAGF,KAAK,EACH,EAAEjL,KAAK,EAAEiL,MACT,MAGF,QAAS,CAAC,MACF,KAAgB,EAAEnL,OAAS,IAAG6J,SAAS,IACvC,EAAM,sBACW,EAAMgC,wBACX,MAChBuB,KAAK,IACP,MAAM,IAAIJ,MAAJ,IAIV,KAAeC,OAAOrM,KAAtB,IAIJ,OAAO,WAGT,mCAAmD,IAC7C,EAAI,IAAI,EAAAmM,OAAJ,GAER,GAAc,WADF,EAAEzL,KAAK,GAEjB,MAAM,IAAI0L,MAAM,yBAGlB,IAAI,EAAc,GAClB,EAAO9B,aAAe,EAAEC,KACxB,EAAOC,YAAc,EAAED,KACvB,EAAO3F,QAAU,EAAElE,KAAK,KACxB,EAAO+J,QAAU,EAAE/J,KAAK,KACxB,EAAOgK,OAAS,EAAElO,IAClB,EAAOmO,UAAY,EAAEJ,KAErB,EAAEpL,KAAK,EAAOwL,WAfmC,IAgB7C,EAAiB,EAAEJ,KACnB,EAAqB,GACzB,IAAK,IAAI,EAAI,EAAG,MAAsB,EACpC,EAAYvK,KAAK,CACf4K,GAAI,EAAEL,KACN1C,KAAM,EAAEnH,KAAK,IACbmK,MAAO,EAAEN,KACTO,QAAS,EAAEtO,IACXuO,KAAM,EAAE/J,IACRgK,OAAQ,EAAET,KACVtL,OAAQ,EAAEsL,KACVnH,OAAQ,EAAEmH,KACV8B,OAAQ,KA5BqC,IAgC7C,EAAgB,EAAAI,0BAEhB,EAAiB,GAErB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAYrJ,SAAU,EAAG,CAC3C,EAAEjE,KAAK,KAAeF,QADqB,IAG3C,IAAI,MACI,GAAqB,CAC3B,IAAI,EAAa,CACfgM,KAAM,EAAEqB,IACRvB,KAAM,EAAE/J,IACRuL,MAAO,EAAEhC,MAEX,OAAQ,EAAMU,MACZ,KAAK,EACL,KAAK,EAAG,CACN,EAAE3L,KAAK,GACP,EAAM2E,OAAS,CACbnH,SAAU,CAAC,EAAEkE,IAAK,EAAEA,IAAK,EAAEA,KAC3BmK,YAAa,CAAC,EAAEnK,IAAK,EAAEA,IAAK,EAAEA,KAC9B0L,QAAS,CAAC,EAAE1L,IAAK,EAAEA,IAAK,EAAEA,KAC1B7C,MAAO,CAAC,EAAE6C,IAAK,EAAEA,IAAK,EAAEA,KACxB2L,GAAI,CAAC,EAAE3L,IAAK,EAAEA,IAAK,EAAEA,MAGvB,EAAM4L,UAAY,CAChBC,UAAW,EAAE7L,IACb+J,KAAM,EAAE/J,IACR8L,aAAc,EAAEtQ,IAChBuQ,OAAQ,EAAEvQ,IACVwQ,UAAW,EAAExQ,IACbyQ,SAAU,EAAEzQ,IACZ0Q,WAAY,EAAE1Q,IACd2Q,SAAU,CAAC,EAAEnM,IAAK,EAAEA,IAAK,EAAEA,KAC3B+G,OAAQ,CAAC,EAAE/G,IAAK,EAAEA,IAAK,EAAEA,KACzBoM,WAAY,CAAC,EAAEpM,IAAK,EAAEA,IAAK,EAAEA,KAC7BqM,WAAY,EAAErM,IACdsM,WAAY,CAAC,EAAEtM,IAAK,EAAEA,IAAK,EAAEA,KAC7BuM,OAAQ,EAAE/Q,IACVgR,eAAgB,CAAC,EAAExM,IAAK,EAAEA,IAAK,EAAEA,KACjCyM,SAAU,EAAEzM,IACZ0M,WAAY,CAAC,EAAE1M,IAAK,EAAEA,IAAK,EAAEA,KAC7B2M,WAAY,EAAEnR,IACdoR,WAAY,EAAEpR,IACdqR,YAAa,EAAErR,IACfsR,YAAa,EAAEtR,IACfuR,aAAc,EAAEvR,IAChBwR,SAAU,EAAExR,IACZyR,UAAW,EAAEzR,IACb0R,QAAS,EAAE1R,IACX2R,aAAc,EAAE3R,IAChB8H,SAAU,CAAC,EAAE9H,IAAK,EAAEA,IAAK,EAAEA,IAAK,EAAEA,KAClC4R,SAAU,EAAE5R,IACZ6R,eAAgB,EAAE7R,KAGpB,EAAM8R,QAAU,CACdC,UAAW,EAAE/G,IACbgH,KAAM,EAAE1O,KACR2O,QAAS,EAAE3O,KACXwN,WAAY,CAAC,EAAEtM,IAAK,EAAEA,IAAK,EAAEA,KAC7B0N,YAAa,EAAE1N,IACf2N,SAAU,EAAE3N,IACZ4N,OAAQ,EAAE5N,IACV6N,WAAY,EAAEvC,IACdwC,QAAS,EAAEhP,KACXtC,QAAS,EAAEuR,KACXC,QAAS,EAAE1C,IACX2C,aAAc,EAAE3C,IAChB4C,OAAQ,EAAE1H,IACV2H,YAAa,EAAE3S,IACf4S,eAAgB,CAAC,EAAEpO,IAAK,EAAEA,IAAK,EAAEA,MAGnC,EAAMqO,SAAW,CACfC,QAAS,EAAEtO,IACXuO,UAAW,EAAEvO,IACbwO,SAAU,EAAExO,IACZyO,kBAAmB,EAAEzO,IACrB0O,aAAc,EAAE1O,IAChB2O,gBAAiB,EAAE3O,IACnB4O,kBAAmB,EAAE5O,IACrB6O,SAAU,EAAE7O,IACZ8O,aAAc,EAAE9O,IAChB+O,cAAe,EAAE/O,IACjBgP,cAAe,EAAEhP,IACjBiP,OAAQ,EAAEjP,IACVkP,SAAU,EAAElP,IACZmP,YAAa,EAAEnP,IACfoP,KAAM,EAAEpP,IACRqP,WAAY,EAAErP,IACdsP,UAAW,EAAE9T,IACb+T,QAAS,EAAE7P,KAAK,IAChB8P,UAAW,EAAExP,IACbyP,UAAW,EAAEzP,IACb0P,SAAU,CAAC,EAAE1P,IAAK,EAAEA,IAAK,EAAEA,KAC3B2P,OAAQ,CAAC,EAAE3P,IAAK,EAAEA,IAAK,EAAEA,MAG3B,EAAM4P,KAAO,CAAC,EAAE5P,IAAK,EAAEA,IAAK,EAAEA,KAC9B,EAAM6P,UAAY,EAAErU,IAEpB,EAAMsU,kBAAoB,EAAEtU,IAC5B,EAAMuU,sBAAwB,EAAEvU,IAChC,EAAMwU,+BAAiC,EAAExU,IACzC,EAAMyU,2BAA6B,EAAEzU,IACrC,EAAM0U,kBAAoB,EAAE1U,IAC5B,EAAM2U,kBAAoB,EAAE3U,IAC5B,EAAM4U,uBAAyB,EAAE5U,IA7F3B,IAgGF,EADkB,EAAE+N,KACa,EAAEnL,OAhGjC,IAiGN,EAAMiS,UAAY,GACX,EAAEjS,OAAF,GAAyB,CAC9B,IAAI,EAAO,EAAEU,KACb,GAAa,IAAT,EACF,SACK,GAAY,IAAR,EAAY,CAEjB,OAAqD,EAA7B,KAAqBuL,KAC/C,EAAE/L,KAAK,KAAqB+L,MAE5B,EAAE/L,KAAK,EAAEQ,MAGX,SAGF,IAAI,EAAY,EAAAwL,gBAAgBC,KAAhB,OAfc,GAiBf,KAAT,IACF,EAAe,EAAUC,OAAzB,GAEF,EAAM6F,UAAUrR,KAAK,CAAEiL,KAAA,EAAMoG,UAAA,KAE7B,EAAElS,KAAF,GAKJ,EAAEA,KAAF,GACA,MAGF,KAAK,EAGH,MAGF,KAAK,EACH,EAAMsM,QAAU,EAAE/K,KAAK,IACvB,MAGF,KAAK,EACH,EAAM4Q,WAAa,CACjBxU,SAAU,CAAC,EAAEkE,IAAK,EAAEA,IAAK,EAAEA,KAC3BgH,SAAU,CAAC,EAAEhH,IAAK,EAAEA,IAAK,EAAEA,KAC3BuQ,YAAa,EAAEhH,KACfiH,IAAK,EAAExQ,KAET,MAGF,KAAK,EAEH,KACA,MAGF,KAAK,EACH,EAAMyQ,MAAQ,CACZ5G,MAAO,EAAEN,KACTiB,MAAO,EAAEjB,KACTmH,MAAO,EAAE1Q,IACT2Q,KAAM,CACJ9G,MAAO,EAAEN,KACTqH,YAAa,EAAErH,KACfzN,SAAU,CAAC,EAAEkE,IAAK,EAAEA,IAAK,EAAEA,KAC3BgH,SAAU,CAAC,EAAEhH,IAAK,EAAEA,IAAK,EAAEA,KAC3BmM,SAAU,CAAC,EAAEnM,IAAK,EAAEA,IAAK,EAAEA,KAC3B6Q,QAAS,EAAEtH,KACXuH,QAAS,EAAE9Q,IACX+Q,QAAS,EAAE/Q,IACXgR,QAAS,EAAExV,IACXyV,QAAS,EAAEzV,IACX0V,QAAS,EAAE1V,IACX2V,QAAS,EAAE3V,MAGf,MAGF,KAAK,EACH,EAAM4V,gBAAkB,CACtBC,UAAW,EAAE7V,IACb8V,KAAM,EAAE9V,KAEV,MAGF,KAAK,EACH,EAAMkP,MAAQ,CACZC,QAAS,EAAEnP,IACXoP,OAAQ,EAAElL,KAAK,EAAE6J,MACjBsB,YAAa,EAAE7K,IACf8K,OAAQ,EAAE9K,IACV6J,MAAO,EAAEN,KACTwB,MAAO,EAAEvP,KAEX,MAGF,KAAK,EACH,EAAE8C,KAAK,EAAEiL,MACT,MAGF,QAAS,CAAC,MACF,KAAgB,EAAEnL,OAAS,IAAG6J,SAAS,IACvC,uBAA2B,EAAMgC,qBAA3B,IAEZ,MAAM,IAAImB,MAAJ,IAIV,KAAeC,OAAOrM,KAAtB,IAIJ,OAAO,WAGT,0BACE,IAAI,EAAI,IAAI,EAAAmM,OAAJ,GAER,IAAK,KACH,MAAM,IAAIC,MAAM,8BAJsB,IAcpC,EACA,EACA,EACA,EAGA,EAbA,EAAO,GACP,EAAgB,EAAAK,0BAChB,EAAwB,GAExB,EAAS,KACT,EAAc,IAAmB,EAAO9B,WAMxC,EAAQ,IAAI,EAAA4H,YAlBwB,IAuBxC,EAAqB,EAAY,GAAGtT,OAAS,EAAY,GAAGmE,OAC5D,EAAEjE,KAAK,EAAY,GAAGF,QACf,EAAEG,OAAF,GAA+B,CACpC,IAAI,EAAQ,IAAAgM,EAAA,GAGZ,GAFA,EAAMoH,UAAN,GAEI,EAAMxG,MACR,MAAM,IAAII,MAAM,0CAGlB,GAAiB,EAAb,EAAMnB,KAAuB,CAC/B,IAAI,EAAa,EAAMlM,KAAK+I,KACzB,GAAa,EAAImD,OAAS,EAAAK,gBAAgBmH,IAAIC,YAFlB,IAK7B,EAAa,IAAI,EAAAC,UAAU,EAAW5T,KAAK6T,aAC3C,EAAK5S,KAAL,IAGF,IAAIoL,EAAe,EAAMrM,KAAK+I,KAC3B,GAAa,EAAImD,OAAS,EAAAK,gBAAgBmH,IAAII,cAE7CzH,GAAA,GACF,EAAW0H,aAAa1H,EAAarM,OAK3C,KAAM,aAAsB,EAAA4T,WAC1B,MAAM,IAAIvG,MAAM,+BApDsB,IAuDxC,EAAkB,EAAEhN,OACpB,EAAe,IAAI,EAAA2T,YAAJ,EAAuB,GACtC,EAAWC,SAAX,GAGA,EAAqB,EAAY,GAAG/T,OAAS,EAAY,GAAGmE,OAC5D,EAAEjE,KAAK,EAAY,GAAGF,UACT,CACX,IAAI,EAAS,EAAEG,OACf,GAAI,KAA8B,CAEhC,IAAI,EAAa,EAAU2L,KAAO,EAAakI,UAC/C,EAAaC,WAAb,EACA,IAAI,EAAkB,IACtB,EAAE/T,KAAF,GACA,EAAagU,QAAQ,EAAEC,KAAFhI,EAAwB,EAAAvM,eAAeT,QAC5D,EAAEe,KAAF,GAEA,MAGF,IAAI,EAAQ,IAAAiM,EAAA,GAIZ,GAHA,EAAMoH,UAAN,GACA,EAAAa,EAEI,EAAMrH,MACR,MAAM,IAAII,MAAM,0CAGlB,GAAiB,EAAb,EAAMnB,KAAU,CAClB,IAAI,EAAa,EAAMlM,KAAK+I,KACzB,GAAa,EAAImD,OAAS,EAAAK,gBAAgBmH,IAAIC,YAEjD,KAAgB,CAEd,EAAa,IAAI,EAAAC,UAAU,EAAW5T,KAAK6T,aAC3C,EAAK5S,KAAL,GAGA,IAAI,EAAa,EAAU+K,KAAO,EAAakI,UAC/C,EAAaC,WAAb,EAPc,IAQV,EAAkB,IAClB,EAAa,EAAE9T,OACnB,EAAED,KAAF,GACA,EAAagU,QAAQ,EAAEC,KAAF,EAAwB,EAAAvU,eAAeT,QAC5D,EAAEe,KAAF,GAGA,IACA,EAAe,IAAI,EAAA4T,YAAJ,EAAuB,EAAMhI,MAC5C,EAAWiI,SAAX,GAGF,IAAI,EAAe,EAAMjU,KAAK+I,KAC3B,GAAa,EAAImD,OAAS,EAAAK,gBAAgBmH,IAAII,cAMjD,MAHE,EAAWC,aAAa,EAAa/T,MAGvC,EACE,SAGF,IAAK,MAAI,EAAI,EAAG,EAAI,EAAMA,KAAKqE,SAAU,EAEvC,MADc,EAAMrE,KAAN,IAEJkM,OAAS,EAAAK,gBAAgBmH,IAAIa,OACrC,EAAQrI,OAAS,EAAAK,gBAAgBmH,IAAIc,iBACrC,CACA,IAAI,EAAQ,EAAWC,UAAUrQ,OAAO2E,KACrC,GAAW,EAAE0D,QAAU,EAAQzM,KAAK0U,YAFvC,IAKE,EAAMC,MAAN,QAEG,GAAI,EAAQzI,OAAS,EAAAK,gBAAgBmH,IAAIkB,UAAW,CAAC,IACtD,EAAS,EAAWH,UAAUrQ,OAC9B,EAAW,EAAQpE,KAAK6U,SAE5B,IAAK,IAAI,EAAI,EAAG,EAAI,EAASxQ,SAAU,EAAG,CAAC,IACrC,EAAU,KAEV,EAAO,EAAQyQ,KACnB,IACY,UAAT,GAA6B,QAAT,IACK,IAA1B,EAAQC,OAAO1Q,OACf,CAAC,IACG,EAAY,EAAQ0Q,OAAO,GAAK,OAChC,EAAQ,EAAOhM,KAAM,GAAW,EAAED,OAAF,GAFpC,IAIE,EAAM6L,MAAN,WAML,GAAmB,IAAf,EAAMzI,KAAY,CAC3B,IAAI,EAAQ,EAAWuI,UAAUrQ,OAAO2E,KACrC,GAAW,EAAED,OAAS,EAAM6D,MAAME,QAFV,IAKzB,EAAM8H,MAAN,GAIJ,GAAI,EAAaT,UAAY,GAAK,EAAMlI,KAAM,CAAC,IAEzC,EAAkB,IAClB,EAAa,EAAE3L,OACnB,EAAED,KAAF,GACA,EAAagU,QAAQ,EAAEC,KAAF,EAAwB,EAAAvU,eAAeT,QAC5D,EAAEe,KAAFiM,GAGA,IACA,EAAe,IAAI,EAAA2H,YAAJ,EAAuB,EAAMhI,MAC5C,EAAWiI,SAAX,IAIJ,MAAO,CACL5P,OAAQ,EAAY,GAAG2H,KACvBgJ,KAAA,EACAC,cAAA,EACAC,eAAA,GAIJ,qBACE,OAAO,KAGT,4BACE,OAAO,OAGT,wBACE,OAAO,SAGT,4BACE,OAAO,UA/kBX,Y,4ECjJA,QAKE,YAAY,EAAkB,MAAI,GAE9BnV,KAAKoV,UAAYC,KAAKC,MAAMD,KAAKE,UAAU,EAAIH,YAC/CpV,KAAKwV,UAAYH,KAAKC,MAAMD,KAAKE,UAAU,EAAIC,YAC/CxV,KAAK0D,SAAW2R,KAAKC,MAAMD,KAAKE,UAAU,EAAI7R,aAE9C1D,KAAKoV,UAAY,CAAC,EAAG,EAAG,GACxBpV,KAAKwV,UAAY,CAAC,EAAG,EAAG,GACxBxV,KAAK0D,SAAW,IAIpB,UAAU,GACR,OAAQ,EAAMyI,MACZ,KAAK,EACL,KAAK,EACHnM,KAAKoV,UAAU,GAAK,EAAMjQ,OAAOnH,SAAS,GAC1CgC,KAAKoV,UAAU,GAAK,EAAMjQ,OAAOnH,SAAS,GAC1CgC,KAAKoV,UAAU,GAAK,EAAMjQ,OAAOnH,SAAS,GAE1CgC,KAAKwV,UAAU,GAAK,EAAMrQ,OAAOkH,YAAY,GAC7CrM,KAAKwV,UAAU,GAAK,EAAMrQ,OAAOkH,YAAY,GAC7CrM,KAAKwV,UAAU,GAAK,EAAMrQ,OAAOkH,YAAY,IAkBnD,QACE,OAAO,MAAgBrM,OA9C3B,iB,8ECAA,cAIA,qBAAAvC,EAAA,GAAyD,IACnD,EAAgC,GAEhC,EAAe,EAAGgY,SAAS,GAC3B,EAAW,GACf,IAAK,IAAI,EAAI,EAAG,MAAoB,EAClC,EAASvU,KAAK,EAAGuU,SAAS,IAG5B,IAAI,KACJ,IAAK,IAAI,EAAI,EAAG,MAAoB,EAAG,CACrC,IAAK,MAAI,EAAI,EAAO,EAAJ,IAAS,EAAG,CAE1B,IAAA/X,EADY,EAAQ,EAAJ,KACF,EAAG4G,OAAQ,CACvB,KACA,MAGF,GAAI,KAAe,KACjB,GAAI,KAAUyH,MAAQ,EAAA2J,UAAUC,QAC9B,GAAI,KAAU5J,MAAQ,EAAA2J,UAAUE,UAAW,CAAC,IACtC,EAAO,EAAGH,SAAS,IAAM,EAAI,EAC7B,EAAQ,EAAGA,SAAS,KAAUI,KAAO,GACrC,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAS,IAAD,MAClB,CAAC,IACF,EAAQ,EAAG0M,SAAS,KAAUI,MAC9B,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAQ,SAEpB,GAAI,KAAUgD,MAAQ,EAAA2J,UAAUK,SACrC,GAAI,KAAUhK,MAAQ,EAAA2J,UAAUE,UAAW,CAAC,IACtC,EAAO,EAAGH,SAAS,IAAM,EAAI,EAC7B,EAAQ,EAAGA,SAAS,KAAUI,KAAO,GACrC,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAS,IAAD,MAClB,CAAC,IACF,EAAQ,EAAG0M,SAAS,KAAUI,MAC9B,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAQ,SAEpB,GAAI,KAAUgD,MAAQ,EAAA2J,UAAUM,WACrC,GAAI,KAAUjK,MAAQ,EAAA2J,UAAUE,UAAW,CAAC,IACtC,EAAO,EAAGH,SAAS,IAAM,EAAI,EAC7B,EAAQ,EAAGA,SAAS,KAAUI,KAAO,GACrC,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAS,IAAD,MAClB,CAAC,IACF,EAAQ,EAAG0M,SAAS,KAAUI,MAC9B,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAQ,SAEpB,GACL,KAAUgD,MAAQ,EAAA2J,UAAUO,UAC5B,KAAUlK,MAAQ,EAAA2J,UAAUQ,iBAC5B,KAAUnK,MAAQ,EAAA2J,UAAUS,kBAE5B,GAAI,KAAUpK,MAAQ,EAAA2J,UAAUE,UAAW,CAAC,IACtC,EAAO,EAAGH,SAAS,IAAM,EAAI,EAC7B,EAAQ,EAAGA,SAAS,KAAUI,KAAO,GACrC,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAS,IAAD,MAClB,CAAC,IACF,EAAQ,EAAG0M,SAAS,KAAUI,MAC9B,EAAU,KAAUC,QACxB,EAAK,KAAU/M,MAAQ,SAEpB,GAAI,KAAUgD,MAAQ,EAAA2J,UAAUU,SAAU,CAAC,IAC5C,EAAQ,EAAGX,SAAS,KAAUI,MAC9B,EAAa,KAAO,GAAK,KAAUA,MACvC,EAAK,KAAU9M,MAAQ,SACd,KAAUgD,MAAQ,EAAA2J,UAAUW,YACrC,EAAK,KAAUtN,MAAQ,EAAGuN,cAKhC,KACE,MAIJ,OAAO,GAGT,MAAM,EAAuB,CAC3BC,oBAAqB,CACnB,CACExN,KAAM,QACN8M,KAAM,GACNC,QAAS,EACT/J,MAAO,EAAA2J,UAAUM,YAEnB,CACEjN,KAAM,OACN8M,KAAM,EACNC,QAAS,EACT/J,MAAO,EAAA2J,UAAUW,WAEnB,CACEtN,KAAM,SACN8M,KAAM,GACNC,QAAS,EACT/J,MAAO,EAAA2J,UAAUM,YAEnB,CACEjN,KAAM,OACN8M,KAAM,EACNC,QAAS,EACT/J,MAAO,EAAA2J,UAAUM,YAEnB,CACEjN,KAAM,OACN8M,KAAM,EACNC,QAAS,EACT/J,MAAO,EAAA2J,UAAUM,YAEnB,CACEjN,KAAM,UACN8M,KAAM,GACNC,QAAS,IACT/J,MAAO,EAAA2J,UAAUO,UAEnB,CACElN,KAAM,gBACN8M,KAAM,GACNC,QAAS,IACT/J,MAAO,EAAA2J,UAAUO,YAKV,EAAAtI,wBAA0B,IAElC,qB,oFC1IL,OACAjQ,EAAA,KAsBA,IAQY,GARZ,SAAAD,GACE,IAAA+Y,oBAAA,yBACA,IAAAC,eAAA,oBACA,IAAAC,YAAA,iBACA,IAAAC,SAAA,cACA,IAAAC,qBAAA,0BALF,CAAY,EAAAC,aAAA,EAAAA,WAAU,KAQtB,SAAApZ,GACE,IAAAqZ,WAAA,gBACA,IAAAC,aAAA,kBACA,IAAAC,eAAA,oBACA,IAAAC,aAAA,kBAJF,CAAY,IAAAC,kBAAA,EAAAA,gBAAe,KAO3B,SAAAzZ,GACE,IAAA0Z,aAAA,kBACA,IAAAC,OAAA,YAFF,CAAY,EAAAC,iBAAA,EAAAA,eAAc,KAK1B,QAIE,YAAY,EAAZ,GACErX,KAAKmN,OAAL,EACAnN,KAAKkM,OAAL1H,EAGF,gBAAgC,MACxB,EAAI,IAAI,EAAA6I,OAAJ,GAGV,GAAc,SADA,EAAEzL,KAAK,GAEnB,MAAM,IAAI0L,MAAM,8BALY,MAQxB,EAAuB,CAC3BgK,QAAS,EAAE5Z,IACXyO,KAAM,EAAEzO,IACR6Z,UAAW,EAAE7Z,IACb8Z,OAAQ,EAAEtV,IACVjE,MAAO,EAAEP,IACTiB,OAAQ,EAAEjB,IACV+Z,WAAY,EAAE/Z,IACdga,WAAY,EAAExV,IACdyV,SAAU,EAAEja,KAGR,EAAc,EAAEgL,IAChB,EAAU,EAAE4L,KAAmB,EAAd,EAAiB,EAAAvU,eAAeT,OAEjD,EAAwB,GAC9B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAOmY,aAAc,EAAG,CAAC,MACrC,EAAQ,CACZG,MAAO,EAAEla,IACTM,SAAU,CAAC,EAAEN,IAAK,EAAEA,KACpBO,MAAO,EAAEP,IACTiB,OAAQ,EAAEjB,IACVuC,KAAM,IAAIkB,WAAW,EAAOlD,MAAQ,EAAOU,OAAS,IAGhD,EAAS,EAAE2V,KAAK,EAAOrW,MAAQ,EAAOU,OAAQ,EAAAoB,eAAeT,OAGjE,EAAMW,KADJ,EAAOsX,YAAc,EAAgBN,aAC1B,EAAAY,2BAAA,KAEA,EAAAC,cAAA,KAGf,EAAO5W,KAAP,GAGF,OAAO,YArDX,Y,iGC3CA,OACA,OACAxD,EAAA,KACA,QACA,OAUA,+BAAoC,EAAAqa,UAApC,c,oBAIE,KAAAC,gBAAkB,KACZhY,KAAKiY,MAAMrP,KAAKb,OAAS,EAAArF,WAAWF,OAIxCxC,KAAKiY,MAAMrP,KAAK9E,WAAW,EAAApB,WAAWF,MACtCxC,KAAKiY,MAAMrP,KAAKZ,OAAOkQ,UAGzB,KAAAC,kBAAoB,KACdnY,KAAKiY,MAAMrP,KAAKb,OAAS,EAAArF,WAAWD,QAIxCzC,KAAKiY,MAAMrP,KAAK9E,WAAW,EAAApB,WAAWD,SAGxC,KAAA2V,WAAa,KACXpY,KAAKqY,SAAS,CAAEC,QAAStY,KAAKuY,MAAMD,UAGtC,SACE,MAAM,IAActY,KAAKiY,MAAMrP,KAAKZ,OAAOpE,OAE3C,OACE,WAAK4U,MAAO9P,EAAE,oBAAA+P,UACZ,WAAKD,MAAO,EAAAE,QAAQ,gBAAG1Z,OAAQ0J,EAAE,oBAAA1J,QAAS2Z,QAAS3Y,KAAKoY,YACtD,WAAKQ,MAAM,6BAA6BC,QAAQ,aAC9C,wBACY,UAAS,YACT,UACVC,KAAK,UACLC,EAAE,ogCAKR,WAAKP,MAAOxY,KAAKuY,MAAMD,OAAS5P,EAAE,oBAAAsQ,SAAWtQ,EAAE,oBAAAuQ,MAC7C,YAAMT,MAAO9P,EAAE,oBAAAwQ,eAAa,QAC3B,EACC,YACEV,MACExY,KAAKiY,MAAMrP,KAAKb,OAAS,EAAArF,WAAWD,OAChCiG,EAAE,oBAAAyQ,iBACFzQ,EAAE,oBAAA0Q,SAERT,QAAS3Y,KAAKmY,mBAAiB,UAKjC,iBAEF,YACEK,MACExY,KAAKiY,MAAMrP,KAAKb,OAAS,EAAArF,WAAWF,KAChCkG,EAAE,oBAAAyQ,iBACFzQ,EAAE,oBAAA0Q,SAERT,QAAS3Y,KAAKgY,iBAAe,a,oFC7EzC,OACA,OACAta,EAAA,MACA,QACA,OAWA,iCAAsC,EAAAqa,UAAtC,c,oBAIE,KAAAQ,MAA+B,CAC7Bc,gBAAe,GAWjB,KAAAV,QAAU,KACJ,EAAAW,WAAWD,iBACb,EAAAC,WAAWC,OAEX,EAAAD,WAAWE,MAAMxZ,KAAKiY,MAAMwB,OAIhC,KAAAC,aAAe,KACb1Z,KAAKqY,SAAS,CACZgB,eAAgB,EAAAC,WAAWD,oBAlB/B,oBACE,EAAAC,WAAWK,SAAS3Z,KAAK0Z,cAG3B,uBACE,EAAAJ,WAAWM,eAAe5Z,KAAK0Z,cAiBjC,SACE,OACE,WAAKlB,MAAO,EAAAE,QAAQ,gBAAG1Z,OAAQ0J,EAAE,sBAAA1J,QAAS2Z,QAAS3Y,KAAK2Y,SACrD3Y,KAAKuY,MAAMc,eACV,WACET,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,uKAGV,WACEH,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,mK,4EC9DpB,MAAMc,EAAO,CACX,CACEC,QAAS,oBACTC,QAAS,oBACTC,QAAS,oBACTT,KAAM,iBACNU,OAAQ,mBACR/M,MAAO,mBAET,CACE4M,QAAS,uBACTC,QAAS,uBACTC,QAAS,uBACTT,KAAM,sBACNU,OAAQ,sBACR/M,MAAO,sBAET,CACE4M,QAAS,0BACTC,QAAS,iCACTC,QAAS,0BACTT,KAAM,uBACNU,OAAQ,yBACR/M,MAAO,yBAET,CACE4M,QAAS,sBACTC,QAAS,sBACTC,QAAS,sBACTT,KAAM,mBACNU,OAAQ,qBACR/M,MAAO,sBAIX,IAAI,EAAS,EAKb,MAAM,EAAW9F,SAEjB,IAAK,IAAI,EAAI,EAAG,EAAIyS,EAAKvV,SAAU,EACjC,QAAoC,IAAzB,EAAIuV,EAAA,GAAQC,SAA0B,CAC/C,IACA,MAIJ,QACE,iBACE,OAAO,EAAID,EAAA,GAAaE,SAG1B,iBACE,OAAO,EAAIF,EAAA,GAAaC,SAG1B,wBACE,OAAgC,OAAzB,EAAWC,UAGpB,gBACE,EAAKF,EAAA,GAAaG,WAGpB,cACE,EAAIH,EAAA,GAAaN,QAGnB,mBACE,OAAO3R,OAAOD,iBAAiBkS,EAAA,GAAaI,OAArC,GAGT,yBACErS,OAAO8B,oBAAoBmQ,EAAA,GAAaI,OAAxC,GAGF,kBACE,OAAOrS,OAAOD,iBAAiBkS,EAAA,GAAa3M,MAArC,IA9BX,gB,oFCjDA,OACA,QACAxP,EAAA,MAIA,MAAM,EAKJ,YAAY,GACVsC,KAAK4I,KAAL,EAGF,KAAK,GACH5I,KAAK4I,KAAKC,KAAV,GAGF,SAAS,GACP7I,KAAK4I,KAAKsR,SAAV,GAGF,WACE,OAAOla,KAAK4I,KAAKuR,YAIrB,IAAU,EArBe,EAAAC,QAHT,KAwBN,MAAQ,KACAtS,KAAhB,SAAArK,EAAA,GACE,MAAM,EAAO2J,SAASiT,cAAT,GACb,IAAK,EACH,OAAO,KAH+I,MAMlJ,EAAS,EAAAC,OAAOxS,KAAP,GACT,EAAS,EAAAyS,KAAKzS,KAAL,GACf,GAAsB,YAAlB,EAAOO,OAAsB,CAAC,MAC1B,EAAO,EAAOO,KAMpB,OALW,IAAI,EAAA4R,gBAAJ,KAER3V,OACH,EAAKA,OAEE,IAAI,EAAJ,GAGT,OAAO,MAIX,a,mXClDA,QAEAnH,EAAA,MACA,QACA,OACA,QACA,QACA,QACA,QAEA,IAAK,GAAL,SAAAD,GACE,IAAAgd,QAAA,aACA,IAAAC,QAAA,aACA,IAAApN,MAAA,WACA,IAAAqN,KAAA,UAJF,CAAK,MAAc,KAOnB,MAAM,EAMJ,YAAY,GACV3a,KAAK+I,KAAL,EACA/I,KAAK4a,SAAW,EAChB5a,KAAKqI,OAAS,EAAeoS,QAC7Bza,KAAKC,KAAO,KAGd,YACE,OAAOD,KAAKqI,SAAW,EAAeoS,QAGxC,OACEza,KAAKqI,OAAS,EAAeqS,QAG/B,YACE,OAAO1a,KAAKqI,SAAW,EAAeqS,QAIxC,QACE1a,KAAKqI,OAAS,EAAeiF,MAG/B,UACE,OAAOtN,KAAKqI,SAAW,EAAeiF,MAGxC,KAAK,GACHtN,KAAKqI,OAAS,EAAesS,KAC7B3a,KAAKC,KAAL,EAGF,SACE,OAAOD,KAAKqI,SAAW,EAAesS,MAI1C,MAAM,UAAN,gB,oBACE,KAAAxO,KAAiB,UAGnB,MAAM,UAAN,gB,oBACE,KAAAA,KAAc,OAGhB,MAAM,UAAN,gB,oBACE,KAAAA,KAAc,OAGhB,MAAM,UAAN,gB,oBACE,KAAAA,KAAc,OAGhB,MAAM,UAAN,gB,oBACE,KAAAA,KAAgB,SAGlB,MAAM,UAAN,gB,oBACE,KAAAA,KAAiB,UAWnB,uBAA4BxJ,YAU1B,YAAY,GACVC,QAHF,KAAAwB,QAA8C,GAI5CpE,KAAKwH,OAAL,EAEAxH,KAAK4D,YAAL,EACA5D,KAAK+D,SAAL,EACA/D,KAAKgE,MAAQ,GACbhE,KAAK6a,KAAO,GACZ7a,KAAKqE,OAAS,GAGhB,QACErE,KAAK4D,YAAL,EACA5D,KAAK+D,SAAL,EACA/D,KAAKgE,MAAMM,OAAS,EACpBtE,KAAK6a,KAAKvW,OAAS,EACnBtE,KAAKqE,OAAOC,OAAS,EACrBtE,KAAKoE,QAAU,GAGjB,cACE,KAAIpE,KAAK4D,QAAW5D,KAAK4D,OAAOM,aAI5BlE,KAAK+D,KAAQ/D,KAAK+D,IAAIG,UAJ1B,CAQA,IAAK,IAAI,EAAI,EAAG,EAAIlE,KAAKgE,MAAMM,SAAU,EACvC,GAAItE,KAAKgE,MAAL,GAAc8W,YAChB,OAIJ,IAAK,IAAI,EAAI,EAAG,EAAI9a,KAAK6a,KAAKvW,SAAU,EACtC,GAAItE,KAAK6a,KAAL,GAAaC,YACf,OAIJ,IAAK,IAAI,EAAI,EAAG,EAAI9a,KAAKqE,OAAOC,SAAU,EACxC,GAAItE,KAAKqE,OAAL,GAAeyW,YACjB,OAIJ,MAAM,EAAUxY,OAAO6B,QAAQnE,KAAKoE,SACpC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAQE,SAAU,EACpC,GAAI,KAAW,GAAGwW,YAChB,OAIJ9a,KAAKyE,cAAc,EAAAC,IAAI,UAAW,CAAEC,OAAQ,CAAE8C,OAAQzH,UAGxD,KAAK,GACH,MAAM,EAAY,EAAA+a,QAAAtd,GACA,SAAd,EACFuC,KAAKgb,WAAL,GACuB,SAAd,EACThb,KAAKib,QAAL,GAEAC,QAAQhO,MAAM,yBAAd,GAIE,WAAW,G,wCACflN,KAAK4D,OAAS,IAAI,EAAJ,GAEd5D,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAM5E,KAAK4D,W,MAUrD,EAAa5D,KAAKwH,OAAO2T,iBACzB,QAAe,EAAAC,OAAO,KAAH,IAAyB,CAChDC,OAAQ,MACRC,UAAS,EACTC,iBAZyC,CAAC,EAAD,KACrCvb,KAAK4D,SACP5D,KAAK4D,OAAOgX,SAAZpW,GAGFxE,KAAKyE,cAAc,EAAAC,IAAI,WAAY,CAAEC,OAAQ,CAAEC,KAAM5E,KAAK4D,cAQzD4X,MAAO/d,IACJuC,KAAK4D,QACP5D,KAAK4D,OAAOsJ,QAEdgO,QAAQhO,MAAR,EAAmBlN,KAAK4D,UAG1B,IAAI5D,KAAK4D,OAAO6X,UAAhB,CAIA,MAAM,QAAe,EAAAC,OAAOC,gBAAP,GACrB3b,KAAK4D,OAAOgY,KAAZ,GAEA5b,KAAKib,QAAQ,EAAOhG,KAAK,GAAGlM,KAAO,QAEpB,EAAOkM,KAAK,GAAGP,UAAUrQ,OACjCJ,QAAS,IACV,EAAM2Q,MACR5U,KAAK6b,UAAU,EAAM9S,KAAM,EAAM2D,SAIrC1M,KAAKyE,cAAc,EAAAC,IAAI,OAAQ,CAAEC,OAAQ,CAAEC,KAAM5E,KAAK4D,WACtD5D,KAAK8b,iBAGD,QAAQ,G,wCACZ9b,KAAK+D,IAAM,IAAI,EAAJ,GACX/D,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAM5E,KAAK+D,Q,MAUrD,EAAW/D,KAAKwH,OAAOuU,cACvB,QAAe,EAAAX,OAAO,KAAH,IAAuB,CAC9CC,OAAQ,MACRC,UAAS,EACTC,iBAZyC,CAAC,EAAD,KACrCvb,KAAK+D,MACP/D,KAAK+D,IAAI6W,SAATpW,GAGFxE,KAAKyE,cAAc,EAAAC,IAAI,WAAY,CAAEC,OAAQ,CAAEC,KAAM5E,KAAK+D,WAQzDyX,MAAM/d,IACHuC,KAAK+D,KACP/D,KAAK+D,IAAImJ,QAGXgO,QAAQhO,MAAR,EAAmBlN,KAAK+D,OAG1B,GAAI/D,KAAK+D,IAAI0X,UACX,OAGF,MAAM,QAAY,EAAAO,UAAU1G,MAAV,KAClBtV,KAAK+D,IAAI6X,KAAT,GAEA,EAAIlY,SACDK,IAAK,GACmB,iBAAZ,EAAEkY,QAAiD,EAA3B,EAAEA,MAAMC,QAAQ,QAC1C,EAAED,WAFR,GAMJE,OACC,CAAC,EAAD,MACE,GAAKtC,EAAIqC,QAAJ,QAERjY,QAAQ,GAAK,GAAKjE,KAAKoc,WAAL,IAErB,MAAM,EAAU,EAAI1Y,SAAS,GAAG2Y,QAQhC,GAPA,GACgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,MACvCtY,IAAI,MAAQ,IAAH,KAAkBE,QAAQ,GAAKjE,KAAKsc,QAAL,IAK5C,EAAIC,SAASvT,KAAK,GAAK,EAAEwT,YAAa,CAAC,MAEnC,EADO,EAAI9Y,SAAS,GAAG+Y,IACJ1Y,IAAK,GAAc/D,KAAK0c,QAAL,UACtCC,QAAQC,IAAR,GAGR5c,KAAKyE,cAAc,EAAAC,IAAI,OAAQ,CAAEC,OAAQ,CAAEC,KAAM5E,KAAK+D,QACtD/D,KAAK8b,gBAGD,WAAW,G,wCACf,MAAM,EAAO,IAAI,EAAJ,GACb9b,KAAKoE,QAAL,GAAAI,EAEAxE,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAA,M,MAQ1C,QAAe,EAAAwW,OAAOpb,KAAKwH,OAAOqV,iBAAf,IAAwC,CAC/DxB,OAAQ,MACRC,UAAS,EACTC,iBATyC,CAAC,EAAD,KACzC,EAAKX,SAAL,EAEA5a,KAAKyE,cAAc,EAAAC,IAAI,WAAY,CAAEC,OAAQ,CAAEC,KAAA,SAO9C4W,MAAO/d,IACR,EAAKyP,QACLgO,QAAQhO,MAAR,KACAlN,KAAK8b,gBAGP,IAAI,EAAKL,UAAT,CAIA,MAAM,EAAS,EAAAqB,OAAOxH,MAAP,GACf,EAAKsG,KAAL,GAEA5b,KAAKyE,cAAc,EAAAC,IAAI,OAAQ,CAAEC,OAAQ,CAAEC,KAAA,MAC3C5E,KAAK8b,iBAGD,QAAQ,G,wCACZ,MAAM,EAAO,IAAI,EAAJ,GACb9b,KAAKgE,MAAM9C,KAAXsD,GACAxE,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAA,M,MAO1C,EAAY5E,KAAKwH,OAAOuV,eACxB,QAAe,EAAA3B,OAAO,KAAH,QAA4B,CACnDC,OAAQ,MACRC,UAAS,EACTC,iBATyC,CAAC,EAAD,KACzC,EAAKX,SAAL,EACA5a,KAAKyE,cAAc,EAAAC,IAAI,WAAY,CAAEC,OAAQ,CAAEC,KAAA,SAQ9C4W,MAAO/d,IACR,EAAKyP,QACLgO,QAAQhO,MAAR,KACAlN,KAAK8b,gBAGP,IAAI,EAAKL,UAAT,CAIA,MAAM,EAAW,EAAAuB,IAAI1H,MAAJ,KACjB,EAAKsG,KAAL,GAEA5b,KAAKyE,cAAc,EAAAC,IAAI,OAAQ,CAAEC,OAAQ,CAAEC,KAAA,MAC3C5E,KAAK8b,iBAGD,QAAQ,G,wCACZ,MAAM,EAAU,IAAI,EAAJ,GAChB9b,KAAK6a,KAAK3Z,KAAVsD,GACAxE,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAK,M,MAO/C,EAAW5E,KAAKwH,OAAOyV,cACvB,QAAe,EAAA7B,OAAO,KAAH,IAAuB,CAC9CC,OAAQ,MACRC,UAAS,EACTC,iBATyC,CAAC,EAAD,KACzC,EAAQX,SAAR,EACA5a,KAAKyE,cAAc,EAAAC,IAAI,WAAY,CAAEC,OAAQ,CAAEC,KAAK,SAQnD4W,MAAO/d,IACR,EAAQyP,QACRgO,QAAQhO,MAAR,KACAlN,KAAK8b,gBAGP,GAAI,EAAQL,UACV,OAGF,MAAM,QAAY,EAAAyB,IAAI5H,MAAJ,GAGlB,GAFA,EAAQsG,KAAR,IAEK5b,KAAK+D,MAAQ/D,KAAK+D,IAAI9D,KACzB,O,MAGI,EAAMD,KAAK+D,IAAI9D,KAErB,EAAIkE,QAAQF,QAAQxG,IACC,YAAfA,EAAM0O,MAIV,EAAIoQ,SAAStY,QAAQO,IANX,EAAC,EAAD,IAAoB,EAAEsE,gBAAkB,EAAEA,cAO9C,CAAIrL,EAAMsL,KAAMvE,EAAQuE,QAC1BvE,EAAQvG,MAAQR,EAAMQ,MACtBuG,EAAQ7F,OAASlB,EAAMkB,OACvB6F,EAAQvE,KAAOxC,EAAMwC,UAK3BD,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAK,MACrD5E,KAAK8b,gBAGD,UAAU,EAAV,G,wCACJ,MAAM,EAAQ,IAAI,EAAJ,GACd9b,KAAKqE,OAAOnD,KAAZ,GAEAlB,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAK,M,MAQ/C,EAAa5E,KAAKwH,OAAO2V,gBACzB,QAAe,EAAA/B,OAAO,KAAH,IAAyB,CAChDC,OAAQ,MACRC,UAAS,EACTC,iBAVyC,CAAC,EAAD,KACzC,EAAMX,SAAN,EAEA5a,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAK,SAQpD4W,MAAO/d,IACR,EAAMyP,QACNgO,QAAQhO,MAAR,KACAlN,KAAK8b,gBAGP,IAAI,EAAML,UAAV,CAIA,MAAM,QAAa,EAAA2B,MAAMC,OAAN,GAAqB7B,MAAO/d,IAC7C,EAAMyP,QACNgO,QAAQhO,MAAR,KACAlN,KAAK8b,iBAGF,GAAQ,EAAML,YAInB,EAAK/O,MAAL,EACA,EAAK3D,KAAL,EACA,EAAM6S,KAAN,GAEA5b,KAAKyE,cAAc,EAAAC,IAAI,YAAa,CAAEC,OAAQ,CAAEC,KAAK,MACrD5E,KAAK8b,qB,8ECvbT,cAEA,QAKE,YAAY,GACV9b,KAAK0M,OAAS,EACd1M,KAAK+I,KAAO,GACZ/I,KAAKoB,OAAL,EAGF,iBACE,OAAO,IAAIub,QAAe,CAAC,EAAD,KACxB,EAAApV,YAAY+V,aAAaC,gBAAzB,EAEG,IACC,EAAQ,IAAI,EAAJ,KAET9f,IACC,UAnBV,W,8ECFA,aAEA,QAME,YAAY,EAAZ,OACEuC,KAAK+I,KAAL,EACA/I,KAAK/B,MAALuG,EACAxE,KAAKrB,OAAL,EACAqB,KAAKC,KAAL,EAGF,kBAA8C,IACxC,EAAI,IAAI,EAAAoN,OAAJ,GAEJ,EAAS,CACXmQ,SAAU,EAAExc,KACZyc,aAAc,EAAEzc,KAChB0c,UAAW,EAAE1c,KACb2c,SAAU,CACRC,gBAAiB,EAAE3N,KACnB3L,OAAQ,EAAE2L,KACV1D,KAAM,EAAEvL,MAEV6c,MAAO,CACLC,QAAS,EAAE7N,KACX8N,QAAS,EAAE9N,KACXhS,MAAO,EAAEgS,KACTtR,OAAQ,EAAEsR,KACV+N,MAAO,EAAEhd,KACTid,WAAY,EAAEjd,OAUlB,GALI,EAAOwc,UAET,EAAElJ,KAAK,EAAOkJ,SAAU,EAAAzd,eAAeT,OAGrC,EAAOme,aACT,MAAM,IAAInQ,MAAM,mBA7B0B,IAmCxC,EAHA,EAAI,EAAOuQ,MAAM5f,MACjB,EAAI,EAAO4f,MAAMlf,OACjB,EAAa,IAGjB,GAAyB,IAArB,EAAO+e,UAAoB,CAC7B,IAAI,EAAa,EAAa,EAAOG,MAAMG,MAAS,EAEpD,GADA,EAAY,EAAE1J,KAAF,EAAkB,EAAAvU,eAAeT,OAClB,KAAvB,EAAOue,MAAMG,MAAc,CAC7B,IAAI,EAAO,IAAI7c,WAAwB,EAAb,GAC1B,IAAK,IAAI,EAAI,EAAG,MAAS,EACvB,IAAK,MAAI,EAAI,EAAG,MAAS,EAEvB,EAAW,GAFb,GACa,EAAI,EAAJ,GAAD,MACM,EAAwB,GAAb,OAAiB,GAC5C,EAAW,EAAN,EAAU,GAAK,EAAwB,GAAb,OAAiB,GAChD,EAAW,EAAN,EAAU,GAAK,EAAwB,GAAb,QAC/B,EAAW,EAAN,EAAU,GAAK,IAGxB,SACK,GAA2B,KAAvB,EAAO0c,MAAMG,MAAc,CACpC,IAAI,EAAO,IAAI7c,WAAwB,EAAb,GAC1B,IAAK,IAAI,EAAI,EAAG,MAAS,EACvB,IAAK,MAAI,EAAI,EAAG,MAAS,EAEvB,EAAW,GAFb,GACa,EAAI,EAAJ,GAAD,MACM,EAAwB,GAAb,OAAiB,GAC5C,EAAW,EAAN,EAAU,GAAK,EAAwB,GAAb,OAAiB,GAChD,EAAW,EAAN,EAAU,GAAK,EAAwB,GAAb,QAC/B,EAAW,EAAN,EAAU,GAAK,IAGxB,UAEG,GAAyB,KAArB,EAAOuc,YAChB,EAAY,IAAIvc,WAAwB,EAAb,GACA,KAAvB,EAAO0c,MAAMG,OACf,IAAK,IAAI,EAAI,EAAG,MAAS,EACvB,IAAK,MAAI,EAAI,EAAG,KAEd,GAAe,KAAf,EADe,EAAEhd,MACI,CACnBsL,EAA+B,GAAR,IAAXA,GADO,UAEf,EAAK,EAAEtL,KACP,EAAK,EAAEA,KACP,EAAK,EAAEA,KACJ,QAEL,EAAgB,GAPC,GAMN,EAAI,EAAJ,GAAD,MACV,EACA,EAAgB,EAAN,EAAU,GAApBtD,EACA,EAAgB,EAAN,EAAU,GAApB,EACA,EAAgB,EAAN,EAAU,GAAK,MACvB,IACA4O,OAZN,IAeEA,EAA+B,GAAR,IAAXA,GACL,QAAmB,CACxB,IAAI,GAAO,EAAI,EAAJ,GAAD,IACV,EAAgB,EAAN,EAAU,GAAK,EAAEtL,KAC3B,EAAgB,EAAN,EAAU,GAAK,EAAEA,KAC3B,EAAgB,EAAN,GAAW,EAAEA,KACvB,EAAgB,EAAN,EAAU,GAAK,MACvB,IACAsL,EAQd,OAAO,QAAc,EAAOuR,MAAM5f,MAAO,EAAO4f,MAAMlf,OAA/C,IAnHX,S,6BCwEA,SAAS,EAAT,KAAwD,MAEhD,EAAQ,EAAE8M,MAAQ,IAClB,EAAS,EAAEA,KACX,EAAW,EAAEA,KACb,EAAY,EAAEA,KAEd,EAAS,GAEf,IAAK,IAAI,EAAI,EAAO,IAAJ,IAAW,EAAG,CAAC,MACvB,EAAc,EAAEwE,KAChB,EAAa,EAAEA,KAErB,EAAO/O,KAAK,CACVgd,EAAG,IACHC,EAAI,EAAW,KAAX,EAAD,EACHlgB,MAAM,EACNU,OAAO,IAjB2C,MAsBhDyf,EAAS,EAAE9J,KADE,IACe,EAAAvU,eAAeT,OAEjD,EAAEkB,KAAK,GAEP,MAAM,EAAU,EAAE8T,KAAF,IAAgB,EAAAvU,eAAeT,OAE/C,MAAO,CACL6M,KAAM,OACNpD,KAAM,EAASA,KACf9K,MAAA,EACAU,OAAA,EACA0f,SAAA,EACAC,UAAA,EACAC,OAAA,EACAte,KAAM,EAAA4X,2BAAAuG,EAAA,IAUV,SAAS,EAAT,KAEE,OADA,EAAE/d,KAAK,EAASF,QACR,EAASgM,MACf,KAAK,GACH,OAzHN,YAA6B,MACrB,EAAO,EAAEvK,KAAK,IAEd,EAAQ,EAAE6J,KACV,EAAS,EAAEA,KAEjB,EAAEjL,KAAF,IAN2B,MASrB,EAAa,IACb,EAAS,EAAE8T,KAAF,EAAmB,EAAAvU,eAAeT,OAGjD,EAAEkB,KAAW,EAAa,GAAnB,IAEP,EAAEA,KAAK,GAfoB,MAiBrB,EAAU,EAAE8T,KAAK,IAAK,EAAAvU,eAAeT,OAO3C,MAAO,CACL6M,KAAM,QACNpD,KAAA,EACA9K,MAAA,EACAU,OAAA,EACAsB,KATY,MAAZ,EAAK,GACD,EAAA4X,2BAAA,KACA,EAAAC,cAAA,MAmGK,IAET,KAAK,GACH,OAAOsG,EAAA,KAET,KAAK,GACH,OAzFN,YAA+B,MACvB,EAAO,EAAExc,KAAK,IAEd,EAAQ,EAAE6J,KACV,EAAS,EAAEA,KAEjB,EAAEjL,KAAF,IAN6B,MASvB,EAAa,IACb,EAAS,EAAE8T,KAAF,EAAmB,EAAAvU,eAAeT,OAGjD,EAAEkB,KAAW,EAAa,GAAnB,IAEP,EAAEA,KAAK,GAfsB,MAiBvB,EAAU,EAAE8T,KAAK,IAAK,EAAAvU,eAAeT,OAO3C,MAAO,CACL6M,KAAM,UACNpD,KAAA,EACA9K,MAAA,EACAU,OAAA,EACAsB,KATY,MAAZ,EAAK,GACD,EAAA4X,2BAAA,KACA,EAAAC,cAAA,MAmEK,IAET,KAAK,GACH,OAAO,OAGT,QAEE,OAAO,Q,uDA1Ib,OACA,OAmCMsG,EAAa,CAAC,EAAD,MACjBjS,KAAM,QACNpD,KAAM,EAASA,OA4EX,EAAe,CAAC,EAAD,MACnBoD,KAAM,UACNpD,KAAM,EAASA,KACf9I,KAAM,EAAEqU,KAAK,EAAShQ,OAAQ,EAAAvE,eAAeT,SAgF/C,QAGE,YAAY7B,GACVuC,KAAKmE,QAAL,EAGF,gBAAgC,MACxB,EAAI,IAAI,EAAAkJ,OAAJ,GAGV,GAAc,SADA,EAAEzL,KAAK,GAEnB,MAAM,IAAI0L,MAAM,2BALY,MAQxB,EAAa,EAAE7B,KACf,EAAkB,EAAEA,KAC1B,EAAEpL,KAAF,GACA,MAAM,EAAsC,GAC5C,IAAK,IAAI,EAAI,EAAG,MAAkB,EAAG,CACnC,MAAM5C,EAA0B,CAC9B0C,OAAQ,EAAEsL,KACV+S,WAAY,EAAE/S,KACdnH,OAAQ,EAAEmH,KACVU,KAAM,EAAEqB,IACRiR,aAAc,EAAEjR,IAChBzE,KAAM,IAER,EAAEvI,KAAK,GACP/C,EAAMsL,KAAO,EAAEnH,KAAK,IACpB,EAAgBV,KAAhBzD,GAGF,MAAM,EAAsB,EAAgBsG,IAAI,GAAK,QAErD,OAAO,UAnCX,S,4ECnMA,kBAKE,YAAY,GACV/D,KAAK+I,KAAO,EAAY2V,MAAM,KAAKC,UAAU,GAAGD,MAAM,KAAK,GAC3D1e,KAAK4e,OAAS,GACd5e,KAAK0U,UAAY,CACfrQ,OAAQ,GACRwa,MAAO,GACPC,OAAQ,GACRC,OAAQ,GACRC,OAAQ,GACRC,OAAQ,IAIZ,aAAa,GACX,EAAUhb,QAAQ,IAChB,OAAQ,EAAIkI,MACV,KAAK,EACH,EAAIyI,MAAJ,EACA5U,KAAK0U,UAAUrQ,OAAOnD,KAAtB,GACA,MAEF,KAAK,EACHlB,KAAK0U,UAAUmK,MAAM3d,KAArB,GACA,MAEF,KAAK,EACHlB,KAAK0U,UAAUoK,OAAO5d,KAAtB,GACA,MAEF,KAAK,EACHlB,KAAK0U,UAAUqK,OAAO7d,KAAtB,GACA,MAEF,KAAK,EACHlB,KAAK0U,UAAUsK,OAAO9d,KAAtB,GACA,MAEF,KAAK,EACHlB,KAAK0U,UAAUuK,OAAO/d,KAAtB,MAOR,SAAS,GACPlB,KAAK4e,OAAO1d,KAAZ,M,8ECrDJ,aAGA,oBAOE,YAAY,EAAZ,GACElB,KAAKuY,MAAQ,EAAa2G,QAC1Blf,KAAKmU,UAAL3P,EACAxE,KAAKoU,WAAa,GAClBpU,KAAKC,KAAO,KACZD,KAAKmf,OAAS,KAGhB,QAAQ,GACNnf,KAAKC,KAAO,IAAIkB,WAAW,EAAKmD,QAChC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAKA,SAAU,EACjCtE,KAAKC,KAALuE,GAAe,KAGjBxE,KAAKmf,OAAS,IAAI,EAAA9R,OAAOrN,KAAKC,KAAKmB,W,oFCxBvC,QACA,QACA1D,EAAA,MAEA,OAIA,QACE,aACE,MAAM,IAAI4P,MAAM,wBAGlB,aACE,OAAO,KAGT,qBACE,MAAO,CACL8R,OAAQ,EAAEvd,OAId,kBACE,IAAI,EAAK,IAAI,EAAAwd,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAFyC,IAWlD,EAAkB,GAClB,EAAa,EAAGmV,SAAS,GAC7B,IAAK,IAAI,EAAI,EAAG,MAAkB,EAAG,CAAC,IAChChY,EAAe,CACjBiP,MAAO,EAAG+I,SAAS,KAGrB,GADqB,EAAGA,SAAS,GACb,CAClBhY,EAAM6hB,YAAc,EAAG7J,SAAS,IACjB,EAAGA,SAAS,KAEzBhY,EAAM8I,MAAQ,EAAAgZ,UAAAjT,EAAc,YAGd,EAAGmJ,SAAS,KAE5BhY,EAAM+hB,SAAW,EAAG/J,SAAS,KAG/B,EAAOvU,KAAPzD,GASF,OANmB,EAAf,EAAGiP,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CAAEuS,OAAA,GAGX,kBACE,MAAO,CACL3H,QAAS,EAAE7L,MAIf,kBACE,MAAO,CACLqH,YAAa,EAAEpK,KAInB,gBACE,IAAI,EAAK,IAAI,EAAA2W,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAFO,IAIhB,EAAQ,EAAGmV,SAAS,GAEpB,EAAS,EACO,IAAP,EAAR,KACH,EAAS,EAAGA,SAAS,GAAK,KAG5B,IAAI,EAAc,EACE,IAAP,EAAR,KACH,EAAc,EAAGA,SAAS,GAAK,IAbb,IAmBhB,EAHA,EAAU,EAAGA,SAAS,GACtB,EAAc,EAAGA,SAAS,IAjBV,EAoBA,IAAP,EAAR,GAGU,EAAGA,SAAS,GAFZ,EAAGA,SAAS,IArBP,IA6BhB,EACA,EACA,EALA,EAAQ,EAAGA,SAAS,GACpB,EAAQ,EAAGA,SAAS,GACpB,EAAQ,EAAGA,SAAS,GA5BJ,IAiClB,EAAY,EAAAgK,UAAA,IAjCM,IAoClB,EAAY,EAAAA,UAAA,IApCM,IAuClB,EAAY,EAAAA,UAAA,IAGd,IAAI,EAAQ,EAWZ,OAVoB,IAAP,EAAR,KACH,EAAQ,EAAGhK,SAAS,IAGH,EAAf,EAAG/I,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CACLX,MAAA,EACAiB,OAAA,EACAD,YAAA,EACAF,QAAA,EACAiG,YAAA,EACA6B,WAAA,EACA+K,UAAA,EACAC,UAAA,EACAC,UAAA,EACA3S,MAAA,GAIJ,eACE,MAAO,CACLhB,KAAM,EAAE/J,KAIZ,gBACE,MAAO,CACLoG,QAAS,EAAEzG,OAIf,oBAcE,MAAO,CAAEiT,SAbK,EAAEjT,MACO6c,MAAM,KAAK3a,IAAI,IAAU,IAC1C,EAAO,EACR2a,MAAM,wBACN3a,IAAI,GAAO,EAAI/B,QAAQ,WAAY,MAAM6d,QACzC1D,OAAO,MAKV,MAAO,CAAEpH,KAHE,EAAK,GAGDC,OAFF,EAAKlT,MAAM,OAQ5B,mBACE,MAAO,CACLmL,MAAO,EAAEvE,IACToX,IAAK,EAAEpX,IACPqX,KAAM,EAAErX,KAIZ,qBACE,IAAI,EAAO,CACTsX,SAAU,EAAEtiB,IACZuiB,WAAY,EAAEviB,IACdkO,OAAQ,EAAElO,IACVwiB,cAAe,EAAE5L,KAAK,GAAI,EAAAvU,eAAeT,OACzC6gB,WAAY,EAAEnf,KACdof,YAAa,EAAEpf,KACfqf,aAAc,EAAErf,KAChBsf,QAAS,EAAEze,MACX0e,SAAU,EAAE1e,MACZiS,YAAa,EAAEjS,MACf2e,SAAU,EAAE3e,OAId,OAFA,EAAErB,KAAK,GAEP,EAGF,qBACE,MAAO,CACLkM,MAAO,EAAE1L,KACTyf,UAAW,EAAE5e,OAIjB,yBACE,MAAO,CACL6e,YAAa,EAAE1f,KACf2f,aAAc,EAAElV,KAChBmV,eAAgB,EAAE/e,MAClBgf,gBAAiB,EAAEvM,KAAK,GAAI,EAAAvU,eAAeT,QAI/C,6BAAmE,IAC7D,EAGA,CACFyJ,KAAM,EAAElH,MACRif,OAAQ,IAGN,EAAK,IAAI,EAAAzB,UAAU,EAAEpf,KAAKmB,QAC1B,EAAa,EAAE6O,KACnB,EAAGvD,MAAmB,EAAX,EAAEpM,OACb,IAAK,IAAI,EAAI,EAAG,MAAkB,EAChC,EAAKwgB,OAAO5f,KAAK,EAAAqe,UAAA,EAAc,wBAUjC,OARA,EAAc,EAAKxW,MAAQ,EAAK+X,OAEb,EAAf,EAAGpU,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGpBJ,EAGF,uBACE,IAAI,EAAK,IAAI,EAAA+S,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAEO,EAAGmV,SAAS,KAG9B,EAAG/I,OAAS,GAP6C,IAUvD,EAAoB,eACpB,EAAa,EAAA6S,UAAAjT,EAAA,GAGb,EAAoB,gBAdmC,KAepD,EAAGmJ,SAAS,IACjB,EAAG/I,OAAS,EACZ,EAAA6S,UAAAjT,EAAA,GASF,OANmB,EAAf,EAAGI,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CACL8F,WAAA,GAIJ,oBACE,MAAO,CACLM,YAAa,EAAEpK,KAInB,gBACE,IAAI,EAAK,IAAI,EAAA2W,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAEb,IAAI,EAAQ,GAJQ,KAKb,EAAGmV,SAAS,IACjB,EAAMvU,KAAK,CACT6f,KAAM,EAAGtL,SAAS,GAClBuL,KAAM,EAAGvL,SAAS,GAClBwL,KAAM,EAAGxL,SAAS,KAUtB,OANmB,EAAf,EAAG/I,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGpBJ,EAGF,mBACE,MAAO,CACLtO,SAAU,CAAC,EAAE0K,IAAM,EAAG,EAAEA,IAAM,EAAG,EAAEA,IAAM,GACzCwY,UAAW,CAAC,EAAE1T,IAAK,EAAEA,IAAK,EAAEA,KAC5B2T,MAAO,EAAEngB,KACTogB,MAAO,EAAEpgB,MAIb,gBAEE,OAAO,KAGT,sBACE,IAAI,EAAY,CACdqgB,WAAY,EAAE3Y,IACd4Y,SAAU,EAAE9T,IACZC,MAAO,EAAED,IACTmQ,SAAU,EAAEjV,IACZ6Y,KAAM,EAAE/T,IACRxP,SAAU,GACVkL,SAAU,IAeZ,OAbA,EAAKlL,SAAS,GAAK,EAAE0K,IAAM,EAC3B,EAAKQ,SAAS,GAAK,UAAEsE,IACrB,EAAKxP,SAAS,GAAK,EAAE0K,IAAM,EAC3B,EAAKQ,SAAS,GAAK,UAAEsE,IACrB,EAAKxP,SAAS,GAAK,EAAE0K,IAAM,EAC3B,EAAKQ,SAAS,GAAK,UAAEsE,IACrB,EAAKgU,WAAa,EAAEhU,IAChB,EAAKgU,aACP,EAAKC,UAAY,EAAEjU,IACnB,EAAKkU,YAAc,CAAC,EAAE1gB,KAAM,EAAEA,KAAM,EAAEA,MACtC,EAAK2gB,SAAW,EAAEnU,KAGpB,EAGF,0BACE,IAAI,EAAK,IAAI,EAAA6R,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAFiD,IAO1D,EAHA,EAAa,EAAGmV,SAAS,IACzB,EAAY,EAAA8J,UAAAjT,EAAc,WAC1ByM,EAAW,EAAGtD,SAAS,GAY3B,OAAO,IATL,EAAQ,EAAGA,SAAS,KAGH,EAAf,EAAG/I,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CACLkV,WAAA,EACAC,UAAA,EACAC,SAAA/I,EACAnG,MAAA,GAIJ,0BACE,IAAI,EAAK,IAAI,EAAAyM,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAEb,IAAI,EAAW,GAJ+C,OAKjD,CACX,IAMI,EANA7C,EAAY,EAAGgY,SAAS,IAC5B,GAAI,OAAAhY,EACF,MAHS,EAQM,EAFA,EAAGgY,SAAS,GAGX,EAAZhY,GAA8B,IAAbA,EACA,wBAEA,iBAGF,wBAGrB,EAAAA,GAAsB,EAAA8hB,UAAAjT,EAAc,MAItC,GAAI,KADS,EAAGmJ,SAAS,GAEvB,MAAM,IAAInI,MAAM,qBA5B4C,IA+B1D,EAAa,EAAGmI,SAAS,GACzB,EAAY,GAChB,IAAK,IAAI,EAAI,EAAG,MAAkB,EAChC,EAAUvU,KAAK,EAAAqe,UAAAjT,EAAc,mBAS/B,OANmB,EAAf,EAAGI,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CACLhJ,SAAA,EACAqe,UAAA,GAIJ,qBAA2B,IA8DrB,EAAY,GAChB,OAFW,EAAE/gB,MAGX,KA/DoB,EAgElB,EAAER,KAAK,IACP,MAGF,KAnEsB,EAoEpB,EAAEA,KAAK,IACP,MAGF,KAvEiB,EAwEf,EAAEA,KAAK,GACP,MAGF,KA3EmB,EA4EjB,EAAEA,KAAK,IACP,MAGF,KA/EsB,EAgFpB,EAAEA,KAAK,GACP,MAGF,KAnFe,EAoFb,EAAEA,KAAK,IACP,MAGF,KAvFgB,EAwFd,EAAEA,KAAK,IACP,MAGF,KA3FmB,EA4FjB,EAAEA,KAAK,IACP,MAGF,KA/FkB,EAgGhB,EAAEA,KAAK,IACP,MAGF,KAnGgB,EAwGhB,KAvGoB,GA4GpB,KA3GkB,GA4GhB,EAAEA,KAAK,GACP,MAGF,KA/GoB,GAgHlB,EAAEA,KAAK,GACP,MAGF,KAnHkB,GAoHhB,EAAEA,KAAK,GACW,EAAEkI,KAElB,EAAElI,KAAK,GAET,MAGF,KA3HmB,GA4HjB,EAAEA,KAAK,GACP,MAGF,KA/HqB,GAgInB,EAAEA,KAAK,IACP,MAGF,KAnIgB,GAoId,EAAEA,KAAK,IACP,MAGF,KAvIoB,GAwIlB,EAAEA,KAAK,IACP,MAGF,KA3ImB,GAgJnB,KA/IkB,GAoJlB,KAnJsB,GAoJpB,EAAEA,KAAK,IACP,MAGF,KAvJoB,GAwJlB,EAAEA,KAAK,IACP,MAGF,KA3JoB,GA4JlB,EAAEA,KAAK,IACP,MAGF,KA/JkB,GAgKhB,EAAEA,KAAK,IACP,MAGF,KAnKuB,GAoKrB,EAAEA,KAAK,IACP,MAGF,KAvKgB,GAwKd,EAAEA,KAAK,IACP,MAGF,KA3KgB,GA4Kd,EAAEA,KAAK,IACP,MAGF,KA/KqB,GAgLnB,EAAKqM,QAAU,EAAEW,IACjB,EAAK0Q,EAAI,EAAExV,IACX,EAAKyV,EAAI,EAAEzV,IACX,EAAKsZ,OAAS,EAAExU,IAChB,EAAKyU,UAAY,CAAC,EAAEjhB,KAAM,EAAEA,KAAM,EAAEA,KAAM,EAAEA,MAC5C,EAAKkhB,YAAc,CAAC,EAAElhB,KAAM,EAAEA,KAAM,EAAEA,KAAM,EAAEA,MAC9C,EAAKmhB,WAAa,EAAEzZ,IACpB,EAAK0Z,YAAc,EAAE1Z,IACrB,EAAK2Z,SAAW,EAAE3Z,IACd,EAAKsZ,SACP,EAAKM,WAAa,EAAE5Z,KAEtB,EAAKJ,QAAU,EAAEzG,MACjB,MAGF,KA/Lc,GAoMd,KAnMa,GAoMX,EAAErB,KAAK,IACP,MAGF,KAvMkB,GAwMhB,EAAEA,KAAK,GACP,MAGF,KA3MqB,IA4MnB,EAAEA,KAAK,IACP,MAGF,KA/MqB,IAgNnB,EAAEA,KAAK,IACP,MAGF,KAnNkB,IAoNhB,EAAEA,KAAK,IACP,MAGF,KAvNe,IAwNb,EAAEA,KAAK,IACP,MAGF,KA3Ne,IA4Nb,EAAEA,KAAK,GACP,MAGF,KA/Nc,IAgOZ,EAAEA,KAAK,GACP,MAGF,KAnOe,IAoOb,EAAEA,KAAK,IACP,MAGF,KAvOsB,IAwOpB,EAAEA,KAAK,IACP,MAGF,KA3OoB,IA4OlB,EAAEA,KAAK,IACP,MAGF,KA/OsB,IAgPpB,EAAEA,KAAK,GACP,MAGF,KAnPsB,IAoPpB,EAAEA,KAAK,IACP,MAGF,KAvPwB,IAwPtB,EAAEA,KAAK,GACP,MAGF,KA3PqB,IA4PnB,EAAEA,KAAK,IACP,MAGF,KA/PiB,IAoQjB,KAnQqB,IAoQnB,EAAEA,KAAK,IACP,MAGF,KAvQqB,IAwQnB,EAAEA,KAAK,IACP,MAGF,KA3QoB,IAgRpB,KA/QwB,IAgRtB,EAAEA,KAAK,GACP,MAGF,KAnRmB,IAoRjB,EAAEA,KAAK,GACP,MAGF,KAvRoB,IAwRlB,EAAEA,KAAK,IACP,MAGF,KA3Re,IA4Rb,EAAEA,KAAK,IACP,MAGF,KA/RuB,IAgSrB,EAAEA,KAAK,GACP,MAGF,KAnSuB,IAoSrB,EAAEA,KAAK,IACP,MAGF,KAvSmB,IAwSjB,EAAEA,KAAK,GACP,MAGF,KA3S0B,IA4SxB,EAAEA,KAAK,GACP,MAGF,KA/S+B,IAgT7B,EAAEA,KAAK,GACP,MAGF,KAnTsB,IAoTpB,EAAEA,KAAK,IACP,MAGF,KAvToB,IAwTlB,EAAEA,KAAK,IACP,MAGF,QACE,MAAM,IAAI8M,MAAM,4BAIpB,OAAO,EAGT,mBACE,MAAO,CACLxK,SAAU,EAAE0K,KAIhB,oBACE,MAAO,CACL+U,KAAM,EAAE/U,KAIZ,sBACE,MAAO,CACLlF,QAAS,EAAEzG,OAIf,uBAEE,OAAO,KAGT,qBAEE,OAAO,KAGT,2BACE,MAAO,CACL7D,SAAU,CAAC,EAAE0K,IAAM,EAAG,EAAEA,IAAM,EAAG,EAAEA,IAAM,GACzCiM,WAAY,EAAE1E,KACdjD,OAAQ,EAAEhM,KAAO,IACjB+L,YAAa,EAAE/L,KAAO,GACtB8R,YAAa,EAAE7C,KACfhD,MAAO,EAAEjM,KACT+K,MAAO,EAAE/K,MAIb,sBAEE,OAAO,KAGT,iBACE,MAAO,CACLwhB,KAAM,EAAE3gB,OAIZ,kBACE,MAAO,CACL4gB,MAAO,EAAEjV,IACTkV,UAAW,EAAElV,KAIjB,kBAAwB,IAClB,EAAW,EAAE3L,MACb,EAAW,EAAEb,KACb,EAAO,GACX,IAAK,IAAI,EAAI,EAAG,MAAgB,EAC9B,EAAKE,KAAK,EAAEW,OAGd,MAAO,CAAE8gB,SAAA,EAAU1N,KAAA,GAGrB,mBACE,MAAO,CACLuN,KAAM,EAAE3gB,OAIZ,qBACE,MAAO,CACL+gB,eAAgB,EAAEpV,IAClBqV,qBAAsB,EAAErV,KAI5B,oBACE,MAAO,CACLsV,cAAe,EAAE9hB,KACjB+hB,UAAW,EAAElhB,OAIjB,mBACE,MAAO,CACLsK,KAAM,EAAE8D,MAIZ,mBAEE,MAAO,CACL+S,WAAY,EAAEta,KAAO,IAAM,QAI/B,qBACE,MAAO,CACLgE,MAAO,EAAE1L,KACTuL,KAAM,EAAEiB,IACRzE,KAAM,EAAEnH,KAAK,KAIjB,2BACE,IAAI,EAAK,IAAI,EAAAyd,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAEb,IAAI,EAAe,GACnB,EAAGmV,SAAS,IALmD,IAM/D,MAAI,EAAe,EAGF,KAT8C,EAQhD,EAAGA,SAAS,MARoC,CAgB7D,GAHA,EAAG/I,OAAS,GAEgB,EAAG+I,SAAS,GAStC,QAR0B,CACC,EAAGA,SAAS,GAErC,EAAe,EAAGA,SAAS,IAE3B,GAAgB,EAAGA,SAAS,GArB6B,IA2BzD,EAAS,EAAGA,SAAS,GACP,EAAGA,SAAS,KAE5B,EAAG/I,OAAS,GAGd,IAAI,EAAa,iBACE,EAAf,GAAoC,IAAhB,EACtB,EAAa,wBAnC8C,IAqC3D,EAAa,yBAGf,EAAaxL,KAAK,EAAAqe,UAAAjT,EAAc,EAAAyM,KASlC,OANmB,EAAf,EAAGrM,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CAAEuW,aAAA,GAGX,gCACE,IAAI,EAAK,IAAI,EAAA5D,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAEb,EAAGmV,SAAS,IACZ,EAAG/I,OAAS,EALwD,IAOhE,EAAe,GACf,EAAY,EARoD,OASvD,CAEX,GAAe,IADF,EAAG+I,SAAS,IAEvB,MAGF,EAAG/I,OAAS,GAND,IAQP,EAAe,EAAG+I,SAAS,GAQ/B,GAP2B,EAAGA,SAAS,GAErC,EAAY,EAAGA,SAAS,IAExB,GAAa,EAAGA,SAAS,GAG3B,EACE,SAjBS,IAoBP,EAAS,EAAGA,SAAS,GACrB,EAAa,iBACD,EAAZ,GAA6B,GAAZ,EACnB,EAAa,wBAvBJ,IAyBT,EAAa,yBAGf,KAA0B,EAAA8J,UAAAjT,EAAc,MAS1C,OANmB,EAAf,EAAGI,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGb,CAAEuW,aAAA,GAGX,eAEE,OAAO,KAGT,uBACE,IAAI,EAAK,IAAI,EAAA5D,UAAU,EAAEpf,KAAKmB,QAC9B,EAAGsL,MAAmB,EAAX,EAAEpM,OAFc,IAMvB,EAAU,GACV,EAAa,EAAGmV,SAAS,IAC7B,IAAK,MAAI,EAAI,EAAG,MAAkB,EAAG,EAAC,EACnB,IACXtJ,KAAO,EAAGsJ,SAAS,GACzB,EAAM1M,KAAO,EAAGuN,aAChB,EAAM5J,MAAQ,EAAG+I,SAAS,IAC1B,EAAMlJ,KAAO,EAAGkJ,SAAS,IAGb,EADA,EAAGA,SAAS,KAGtB,EAAG/I,OAAS,KAIV,EAAG+I,SAAS,KAEd,EAAG/I,OAAS,KAGd,EAAQxL,KAAR,GAGF,GAAI,EAAGuU,SAAS,GAAhB,KACS,EAAGA,SAAS,IAAI,CACrB,IAAI,EAAQ,EAAGA,SAAS,GAAK,EAAI,GACjC,EAAG/I,OAAH,EAUJ,OANmB,EAAf,EAAGA,MAAQ,EACb,EAAErM,KAAK,EAAW,EAAGqM,MAAQ,GAAK,GAElC,EAAErM,KAAK,EAAGqM,MAAQ,GAGpBJ,EAGF,sBACE,MAAO,CACLkE,QAAS,EAAEtO,IACXuO,UAAW,EAAEvO,IACbwO,SAAU,EAAExO,IACZyO,kBAAmB,EAAEzO,IACrB0O,aAAc,EAAE1O,IAChB2O,gBAAiB,EAAE3O,IACnB4O,kBAAmB,EAAE5O,IACrB6O,SAAU,EAAE7O,IACZ8O,aAAc,EAAE9O,IAChB+O,cAAe,EAAE/O,IACjBgP,cAAe,EAAEhP,IACjBiP,OAAQ,EAAEjP,IACVkP,SAAU,EAAElP,IACZmP,YAAa,EAAEnP,IACfoP,KAAM,EAAEpP,IACRqP,WAAY,EAAErP,IACdsP,UAAW,EAAEhE,IACbkE,UAAW,EAAExP,IACbyP,UAAW,EAAEzP,IACb0P,SAAU,CAAC,EAAE1P,IAAK,EAAEA,IAAK,EAAEA,KAC3B2P,OAAQ,CAAC,EAAE3P,IAAK,EAAEA,IAAK,EAAEA,KACzBuP,QAAS,EAAE5P,OAIf,0BACE,IAAI,EAAO,CACToe,WAAY,EAAEviB,KAIhB,OAFA,EAAE8C,KAAK,GAEP,EAGF,wBAA8B,IAOxB,EANA,EAAc,EAAEQ,KAChB,EAAO,EAAEA,KACT,EAAO,EAAEa,MACT,EAAQ,EAAEoO,KACV,EAAe,EAAExE,KACjB,EAAQ,EAAEzK,KAMd,OAJY,EAAR,IACF,EAAU,CAAC,EAAEtD,IAAK,EAAEA,IAAK,EAAEA,IAAK,EAAEA,MAG7B,CACL0iB,YAAA,EACAjU,KAAA,EACApD,KAAA,EACA2D,MAAA,EACAwW,aAAA,EACAnX,MAAA,EACAoX,QAAA,GAIJ,yBACE,MAAO,CACLlW,MAAO,EAAEO,IACTsS,IAAK,EAAEtS,KAIX,oBACE,MAAO,CACL4V,eAAgB,EAAEpiB,KAClBqhB,SAAU,EAAErhB,KACZohB,YAAa,EAAEphB,KACfmhB,WAAY,EAAEnhB,MAIlB,0BACE,MAAO,CACLqiB,SAAU,EAAExhB,OAIhB,eACE,MAAO,CACLkG,KAAM,EAAE/G,MAIZ,mBACE,IAAI,EAAS,EAAEA,KACf,MAAO,CACLsiB,KAAM,EAAEtiB,KACRsH,QAAS,EAAE1G,KAAK,EAAS,IAI7B,oBACE,MAAO,CACL2hB,UAAW,EAAE1hB,MACb2hB,QAAS,EAAEhW,KAIf,oBAA0B,IACpB,EAAc,EAAExM,KAChB,EAAO,EAAEiP,KAEb,MAAO,CAAEmQ,YAAA,EAAangB,KADX,EAAEqU,KAAF,EAAa,EAAAvU,eAAeT,QAIzC,wBACE,MAAO,CACLmkB,YAAa,EAAE5hB,MACf6hB,SAAU,EAAE1iB,MAIhB,oBACE,MAAO,CACL2iB,UAAW,EAAEzhB,KAIjB,2BACE,MAAO,CACL0hB,IAAK,EAAE/hB,OAIX,wBAEE,MAAO,CACLkH,KAAM,EAAElH,OAIZ,yBACE,MAAO,CACLgiB,UAAW,EAAEpY,KACb1C,KAAM,EAAElH,OAIZ,mBACE,GAAa,IAAT2C,EAEF,OAAO,KAGT,MAAM,EAAU,EAAgBsf,SAAhB,GANmD,SAQ1D,OAEA,MAKK,EAAAA,SAA+B,CAC7C,EAAgBC,IAChB,EAAgBC,IAChB,EAAgBC,WAChB,EAAgBtR,MAChB,EAAgB2E,QAChB,EAAgB4M,QAChB,EAAgBtX,MAChB,EAAgBX,KAChB,EAAgBkY,MAChB,EAAgBC,UAChB,EAAgBC,SAChB,EAAgBC,WAChB,EAAgBC,WAChB,EAAgBC,eAChB,EAAgBC,iBAChB,EAAgBjS,WAChB,EAAgBkS,UAChB,EAAgBC,MAChB,EAAgBC,SAChB,EAAgBC,OAChB,EAAgBC,YAChB,EAAgBC,cAChB,EAAgBC,cAChB,EAAgBC,WAChB,EAAgBC,SAChB,EAAgBC,UAChB,EAAgBC,YAChB,EAAgBC,cAChB,EAAgBC,YAChB,EAAgBC,iBAChB,EAAgBvX,aAChB,EAAgBwX,OAChB,EAAgBxZ,QAChB,EAAgByZ,QAChB,EAAgBC,SAChB,EAAgBC,WAChB,EAAgB5C,UAChB,EAAgB6C,SAChB,EAAgBC,SAChB,EAAgBC,WAChB,EAAgBC,eAChB,EAAgBC,oBAChB,EAAgBC,MAChB,EAAgBC,aAChB,EAAgBC,YAChB,EAAgBC,gBAChB,EAAgBC,cAChB,EAAgB3X,eAChB,EAAgB4X,UAChB,EAAgBC,gBAChB,EAAgBC,KAChB,EAAgBC,SAChB,EAAgBC,UAChB,EAAgBC,UAChB,EAAgBC,cAChB,EAAgBjD,UAChB,EAAgBkD,iBAChB,EAAgBC,cAChB,EAAgBC,gBArvCpB,oBAyvCA,SAAAtpB,GACE,IAAY,GAAZ,SAAAA,GACE,IAAAupB,IAAA,SACA,IAAAC,IAAA,SACA,IAAAC,WAAA,gBACA,IAAAC,MAAA,WACA,IAAA/M,QAAA,aACA,IAAAgN,QAAA,aACA,IAAA5S,MAAA,WACA,IAAA6S,KAAA,UACA,IAAAC,MAAA,WACA,IAAAzS,UAAA,eACA,IAAA0S,SAAA,eACA,IAAA3T,WAAA,iBACA,IAAA4T,WAAA,iBACA,IAAAC,eAAA,qBACA,IAAAC,iBAAA,uBACA,IAAAC,WAAA,iBACA,IAAAC,UAAA,gBACA,IAAAC,MAAA,YACA,IAAAC,SAAA,eACA,IAAAC,OAAA,aACA,IAAAC,YAAA,kBACA,IAAAC,eAAA,qBACA,IAAAC,cAAA,oBACA,IAAAC,WAAA,iBACA,IAAAC,SAAA,eACA,IAAAC,UAAA,gBACA,IAAAC,YAAA,kBACA,IAAAC,cAAA,oBACA,IAAAC,YAAA,kBACA,IAAA/T,iBAAA,uBACA,IAAAgU,aAAA,mBACA,IAAAC,OAAA,aACA,IAAAC,QAAA,cACA,IAAAC,QAAA,cACA,IAAAC,SAAA,eACA,IAAAC,WAAA,iBACA,IAAAC,UAAA,gBACA,IAAAC,SAAA,eACA,IAAAC,SAAA,eACA,IAAAC,WAAA,iBACA,IAAAC,eAAA,qBACA,IAAAC,oBAAA,0BACA,IAAAC,MAAA,YACA,IAAAtV,aAAA,mBACA,IAAAuV,YAAA,kBACA,IAAAC,gBAAA,sBACA,IAAAC,cAAA,oBACA,IAAAC,eAAA,qBACA,IAAAC,UAAA,gBACA,IAAAC,gBAAA,sBACA,IAAAC,KAAA,WACA,IAAAC,SAAA,eACA,IAAAC,UAAA,gBACA,IAAAC,UAAA,gBACA,IAAAC,cAAA,oBACA,IAAAC,UAAA,gBACA,IAAAC,iBAAA,uBACA,IAAAC,cAAA,oBACA,IAAAC,eAAA,qBA3DF,CAAY,IAAAzW,MAAA,EAAAA,IAAG,KADjB,CAAiB,IAAAnH,kBAAA,EAAAA,gBAAe,M,4EC/vChC,qBAAA/O,GAAuC,IACjC,EAAU,EAAGgY,SAAS,GACtB,EAAe,EAAGA,SAAS,GAE/B,IAAK,IAAY,EACf,OAAO,EAL4B,IAQjC,EAAO,EAAGA,SAAS,GACnB,EAAW,EACX,EAAgB,EAViB,IAYnC,EAAW,EAAGA,SAAS,KAZY,IAenC,EAAgB,EAAGA,SAAS,IAG9B,IAAI,EAAQ,EAAW,EAAgB,GAKvC,OAAO,IAHL,GAAS,GAGX,I,4ECzBF,SAAAhY,GACE,IAAAkY,QAAA,aACA,IAAAI,SAAA,cACA,IAAAE,SAAA,cACA,IAAAD,WAAA,gBACA,IAAAI,SAAA,eACA,IAAAF,gBAAA,sBACA,IAAAC,kBAAA,wBACA,IAAAE,UAAA,iBACA,IAAAT,WAAA,wBATF,CAAY,EAAAF,YAAA,EAAAA,UAAS,M,4ECArB,QAKE,YAAY,GACV1V,KAAK8R,KAAO,IAAI3Q,WAAJ,EAAuB,EAAG,EAAOf,YAG/C,QAAQ,EAAR,EAAsC,MAGpC,GAAI,EAFiC,EAAnBJ,KAAK8R,KAAKxN,OAAV,EAGhB,MAAM,IAAIgJ,MAAM,sBAGlB,IAAI,EAAQ,EACZ,IAAK,IAAI,EAAI,EAAG,KAAY,CAAC,MACrB,EAAY,IACZ,EAAqB,EAAT,EACZ,EAActN,KAAK8R,KAAK,GAAU,GAGlC,EAAO,IAAoB,KAMjC,IADkB,MAFJ,MAAa,IAGlB,EAET,KACA,KAvBgD,UA8BnC,KAAT,GAAe,EAAS,GAAM,EAAO,IACvC,IAAU,GAAM,MAAa,GA/BiB,GAqC3C,IAAU,EAGnB,QAAQ,GACN,OAAO9R,KAAKqqB,QAAL,EAAqB,GAArB,GAGT,SAAS,GACP,OAAOrqB,KAAKqqB,QAAL,EAAqB,GAArB,GAGT,SAAS,GACP,OAAOrqB,KAAKqqB,QAAL,EAAqB,IAArB,GAGT,UAAU,GACR,OAAOrqB,KAAKqqB,QAAL,EAAqB,IAArB,GAGT,SAAS,GACP,OAAOrqB,KAAKqqB,QAAL,EAAqB,IAArB,GAGT,UAAU,GACR,OAAOrqB,KAAKqqB,QAAL,EAAqB,IAArB,GAGT,WAAW,GAET,OADA,EAAQC,QAAQC,UAAU,EAAGvqB,KAAKa,UAAL,IACtB,EAAQypB,QAAQxpB,WAAW,GAGpC,WAAW,GAIT,OAHA,EAAQwpB,QAAQC,UAAU,EAAGvqB,KAAKa,UAAL,IAE7B,EAAQypB,QAAQC,UAAU,EAAGvqB,KAAKa,UAAU,EAAS,KAC9C,EAAQypB,QAAQvpB,WAAW,IAjF7B,EAAAupB,QAAU,IAAIpqB,SAAS,IAAIsqB,YAAY,IADhD,YAsFA,kBAIE,YAAY,GACVxqB,KAAK8R,KAAO,IAAI,EAAJ,GACZ9R,KAAK0M,MAAQ,EAGf,SAAS,EAAc,MACrB,MAAM,EAAM1M,KAAK8R,KAAKuY,QAAQrqB,KAAK0M,MAAvB,EAAAlI,GAEZ,OADAxE,KAAK0M,OAAL,EACA,EAGF,WACE,MAAM,EAAM1M,KAAK8R,KAAKvR,QAAQP,KAAK0M,OAEnC,OADA1M,KAAK0M,OAAS,EACd,EAGF,YACE,MAAM,EAAM1M,KAAK8R,KAAKrR,SAAST,KAAK0M,OAEpC,OADA1M,KAAK0M,OAAS,EACd,EAGF,YACE,MAAM,EAAM1M,KAAK8R,KAAKpR,SAASV,KAAK0M,OAEpC,OADA1M,KAAK0M,OAAS,GACd,EAGF,aACE,MAAM,EAAM1M,KAAK8R,KAAKnR,UAAUX,KAAK0M,OAErC,OADA1M,KAAK0M,OAAS,GACd,EAGF,YACE,MAAM,EAAM1M,KAAK8R,KAAKlR,SAASZ,KAAK0M,OAEpC,OADA1M,KAAK0M,OAAS,GACd,EAGF,aACE,MAAM,EAAM1M,KAAK8R,KAAKjR,UAAUb,KAAK0M,OAErC,OADA1M,KAAK0M,OAAS,GACd,EAGF,cACE,MAAM,EAAM1M,KAAK8R,KAAKhR,WAAWd,KAAK0M,OAEtC,OADA1M,KAAK0M,OAAS,GACd,EAGF,cACE,MAAM,EAAM1M,KAAK8R,KAAK/Q,WAAWf,KAAK0M,OAEtC,OADA1M,KAAK0M,OAAS,GACd,EAGF,WAAW,EAAQ,EAAG,MACpB,IAAI,EAAI,EACR,MAAM,EAAQ,GAFkB,IAGhC,IAAImN,GAAA,GAII,GAAU,GAAS,KAAY,CACrC,MAAM,EAAI7Z,KAAKyqB,YAGf,GAAU,IAAN,IACF5Q,GAAA,GAGK,GACH,MATiC,GAanC,EAAM3Y,KAAN,GAGF,IAGF,MAAM,EAAS,EAAoBwpB,MAAM,KAA1B,GACf,MAQE,SAPA,IAEE,OAAOC,mBAAA,GACP,SACA,OAAO,M,4EC3Kf,eAAAltB,EAAA,GAAkD,IAC5C,EAAS,EAAO4d,QAAU,MAC1B,EAAW,EAAOC,SAClB,EAAmB,EAAOC,iBAE9B,IAAK,EACH,MAAM,IAAIjO,MAAM,yBAGlB,OAAO,IAAIqP,QAAgB,CAAC,EAAD,KACzB,IAAI,EAAU,IAAIiO,eAD2B,IAI3C,EAAQC,aAAe,eAGrB,GAAAntB,GACF,EAAQiK,iBAAiB,WAAYlK,IACnC,GAAIA,EAAMqtB,iBACR,IAA0BrtB,EAAMstB,OAASttB,EAAMutB,WAC1C,CAAC,IAEFxmB,EAAW,EAAQymB,kBAAkB,kBACrC,EAAQ,EAHP,IAKH,EAAQ3gB,WAAW9F,IAErB,IAAI,EAAW,EAAQymB,kBAAkB,oBACzC,GAAI,OAAiD,EAA5B,EAAS/O,QAAQ,QAAc,CAEtD,GAAS,EACT,IAAI,EAAgB,EAAS,IAAMze,EAAMstB,OAAN,GACnC,YAGA,IAA0B,MAMlC,EAAQpjB,iBAAiB,mBAAqBlK,IACZ,IAA5BA,EAAMytB,OAAOC,aAIW,MAAxB1tB,EAAMytB,OAAO7iB,QALyC,GAOtD,IAA0B,GAG5B,EAAQ5K,EAAMytB,OAAOE,WAErB,EAAO,CACL/iB,OAAQ5K,EAAMytB,OAAO7iB,YAK3B,EAAQgjB,KAAR,QACA,EAAQC,W,6BC/DZ,WAAA7tB,EAAA,eAUE,MAAM,EAAe,GAErB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAO6G,SAAU,EAAG,CAAC,MACjC,EAAQ,KAER,EAGA,GAEA,EAAK,IAAI5C,aAAa,GACtB,EAAK,IAAIA,aAAa,GACtB,EAAK,IAAIA,aAAa,GACtB,EAAM,IAAIA,aAAa,GACvB,EAAM,IAAIA,aAAa,GACvB,EAAM,IAAIA,aAAa,GACvB,EAAO,IAAIA,aAAa,GACxB,EAAO,IAAIA,aAAa,GACxB,EAAO,IAAIA,aAAa,GAE9B,IAAI,EACI,IAAN,EACI,CAAC,EAAG,EAAG,GACP,CAAC,EAAG,EAAG,GAAGqC,IACR,CAAC,EAAD,KAAW,EAAMwnB,KAAN,GAAgB,EAAMC,KAAN,IAAiB,EAAI,EAAMA,KAAN,IAGxD,IAAK,IAAI,EAAI,EAAMC,UAAW,EAAI,EAAMA,UAAY,EAAMC,YAAa,EAAG,CAAC,MACnE,EAAW,CAEftqB,OAAQ,IAAIM,aAAwC,IAA1B,KAASiqB,UAAY,IAC/CC,cAAe,GAGX,EAAc,EAAQ,KAASC,aAC/B,EAAc,EAAS,EAAYD,cACnC,EAAgB,EAAU9pB,MAC9B,KAASgqB,UACT,KAASA,UAAY,KAASH,WAG1B,EACJ,EAAM,EAAS,EAAc,KAAwB,EAAnB,EAAc,GAAS,EAAI,GAC/D,EAAG,GAAK,KAAgB,GACxB,EAAG,GAAK,KAAgB,GACxB,EAAG,GAAK,KAAgB,GAExB,EAAI,GACF,EAAG,GAAK,EAAYjjB,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAYqjB,OACd,EAAI,GACF,EAAG,GAAK,EAAYvnB,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAYwnB,OAEd,EAAK,GAAK,EACV,EAAK,GAAK,EAEV,MAAMruB,EACJ,EAAM,EAAS,EAAc,KAAwB,EAAnB,EAAc,GAAS,EAAI,GAC/D,EAAG,GAAK,EAAAA,GAAgB,GACxB,EAAG,GAAK,EAAAA,GAAgB,GACxB,EAAG,GAAK,EAAAA,GAAgB,GAExB,EAAI,GACF,EAAG,GAAK,EAAY+K,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAYqjB,OACd,EAAI,GACF,EAAG,GAAK,EAAYvnB,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAYwnB,OACd,EAAK,GAAK,EACV,EAAK,GAAK,KAEV,IAAI,EAAY,EAChB,IAAK,IAAI,EAAI,EAAG,EAAI,KAASL,YAAa,EAAG,CAC3C,MAAM,EACJ,EAAM,EAAS,OAAsC,EAAnB,KAAuB,EAAI,GAC/D,EAAG,GAAK,KAAgB,GACxB,EAAG,GAAK,KAAgB,GACxB,EAAG,GAAK,KAAgB,GACxB,EAAI,GACF,EAAG,GAAK,EAAYjjB,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAYqjB,OACd,EAAI,GACF,EAAG,GAAK,EAAYvnB,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAG,GAAK,EAAYA,EAAE,GACtB,EAAYwnB,OACd,EAAK,GAAK,KACV,EAAK,GAAK,KAGV,EAAS5qB,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAI,GACnC,EAASA,OAAO,KAAe,EAAI,GACnC,EAASA,OAAO,KAAe,EAAK,GACpC,EAASA,OAAO,KAAe,EAAK,GAGpC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAI,GACnC,EAASA,OAAO,KAAe,EAAI,GACnC,EAASA,OAAO,KAAe,EAAK,GACpC,EAASA,OAAO,KAAe,EAAK,GAGpC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAG,GAClC,EAASA,OAAO,KAAe,EAAI,GACnC,EAASA,OAAO,KAAe,EAAI,GACnC,EAASA,OAAO,KAAe,EAAK,GACpC,EAASA,OAAO,KAAe,EAAK,GAEpC,EAAG,GAAK,EAAG,GACX,EAAG,GAAK,EAAG,GACX,EAAG,GAAK,EAAG,GACX,EAAI,GAAK,EAAI,GACb,EAAI,GAAK,EAAI,GACb,EAAK,GAAK,EAAK,GACf,EAAK,GAAK,EAAK,IAIS,IAAtB,EAAY2K,QAAsC,QAAvB,EAAYA,QACzC,EAASkgB,YACP,EAAS7qB,OADX,EAGE,KAAS8qB,gBAIb,EAASN,aAAe,EAAYA,aAEpC,IAAK,IAAI,EAAI,EAAG,EAAI,EAASxqB,OAAOkD,OAAS,IAAK,EAChD,EAASlD,OAAW,EAAJ,IAAU,EAAO,GACjC,EAASA,OAAW,EAAJ,EAAQ,IAAM,EAAO,GACrC,EAASA,OAAW,EAAJ,EAAQ,IAAM,EAAO,GACrC,EAASA,OAAW,EAAJ,EAAQ,IAAM,EAAYnD,MAC1C,EAASmD,OAAW,EAAJ,EAAQ,IAAM,EAAYzC,OAG5C,EAAOuC,KAAP,GAGF,EAAaA,KAAK,CAChB+H,OAAA,EACAkjB,MAAM,IAIV,OAAO,E,uDArLT,OACAzuB,EAAA,MACA,QACA,OACA,QACA,OAmLA,IAAY,EAjLZ,gBAiLA,SAAAD,GACE,IAAA2uB,SAAA,cACA,IAAAC,OAAA,YACA,IAAAC,SAAA,cACA,IAAAC,SAAA,cACA,IAAAC,WAAA,gBACA,IAAAC,MAAA,WACA,IAAAC,QAAA,aACA,IAAAC,MAAA,WACA,IAAAC,SAAA,cACA,IAAAC,UAAA,eACA,IAAAC,OAAA,aACA,IAAAC,aAAA,mBACA,IAAAC,MAAA,YACA,IAAAC,UAAA,gBACA,IAAAC,OAAA,aAfF,CAAY,IAAAC,eAAA,EAAAA,aAAY,KA4DxB,kBACE,kBAA8C,MACtC,EAAI,IAAI,EAAA9f,OAAJ,GAEV,GAAgB,KADA,EAAE5B,KAEhB,MAAM,IAAI6B,MAAM,uBAGlB,MAAMiH,EAAmB,GACzB,IAAK,IAAI,EAAI,EAAO,GAAJ,IAAU,EACxBA,EAAMrT,KAAK,CACTf,OAAQ,EAAEsL,KACVnH,OAAQ,EAAEmH,OAX8B,MAetC,EAAWzL,KAAKotB,aAAL,EAEf7Y,EAAM,EAAa6X,UAAUjsB,OAC7BoU,EAAM,EAAa6X,UAAU9nB,QAGzB,EAAWtE,KAAKqtB,aAAL,EAAqB9Y,EAAM,EAAa+X,UAAUnsB,QAE7D,EAASH,KAAKstB,WAAL,EAEb/Y,EAAM,EAAa2Y,QAAQ/sB,OAC3BoU,EAAM,EAAa2Y,QAAQ5oB,QAGvB,EAAQtE,KAAKutB,UAAL,EAEZhZ,EAAM,EAAaoY,OAAOxsB,OAC1BoU,EAAM,EAAaoY,OAAOroB,QAGtB,EAAQtE,KAAKwtB,UAAL,EAEZjZ,EAAM,EAAayY,OAAO7sB,OAC1BoU,EAAM,EAAayY,OAAO1oB,QAGtB,EAAYtE,KAAKytB,cAAL,EAEhBlZ,EAAM,EAAa0Y,WAAW9sB,OAC9BoU,EAAM,EAAa0Y,WAAW3oB,QAG1B,EAAWtE,KAAK0tB,aAAL,EAEfnZ,EAAM,EAAagY,UAAUpsB,OAC7BoU,EAAM,EAAagY,UAAUjoB,QAGzB,EAAUtE,KAAK2tB,YAAL,EAEdpZ,EAAM,EAAamY,SAASvsB,OAC5BoU,EAAM,EAAamY,SAASpoB,QAGxB,EAAWtE,KAAK4tB,aAAL,EAEfrZ,EAAM,EAAaqY,UAAUzsB,OAC7BoU,EAAM,EAAaqY,UAAUtoB,QAGzB,EAAiB,EAAAupB,kBAAkB/lB,KAAlB,GAEjB,EAAe,cAAAsW,EAAA,GAWrB,OAAO,IAAI,EAAA0P,IAAJ,QAAgD,CACrD7vB,MAAO,EAAA4vB,kBAAkBE,aACzBpvB,OAAQ,EAAAkvB,kBAAkBE,aAC1B9tB,KAAM,EAAe+tB,eAIjB,wBAKN,EAAE3tB,KAAF,GAEA,MAAM,EAAQ,GACd,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,KAAM,EACjC,EAAMa,KAAK,CACT+sB,MAAO,EAAEhe,KACTie,UAAW,EAAEje,KACb6b,UAAW,EAAErgB,KACbkgB,UAAW,EAAE1b,KACb4b,YAAa,EAAE5b,KACfke,OAAQ,CAAC,EAAEntB,KAAM,EAAEA,KAAM,EAAEA,KAAM,EAAEA,MACnCkrB,eAAgB,EAAEzgB,OAGtB,OAAO,EAGD,yBAKN,EAAEpL,KAAF,GAEA,MAAM,EAAS,GACf,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,KAAM,EACjC,EAAOa,KAAK,CACVsqB,KAAM,CAAC,EAAEtpB,IAAK,EAAEA,IAAK,EAAEA,KACvBqpB,KAAM,CAAC,EAAErpB,IAAK,EAAEA,IAAK,EAAEA,KACvB+G,OAAQ,CAAC,EAAE/G,IAAK,EAAEA,IAAK,EAAEA,KACzBksB,UAAW,CAAC,EAAE1wB,IAAK,EAAEA,IAAK,EAAEA,IAAK,EAAEA,KACnC2wB,UAAW,EAAE3wB,IACb+tB,UAAW,EAAE/tB,IACbguB,UAAW,EAAEhuB,MAGjB,OAAO,EAGD,wBAKN,EAAE2C,KAAF,GAEA,MAAM,EAAQ,GACd,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,IAAK,EAChC,EAAMa,KAAK,CAAC,EAAE+O,KAAM,EAAEA,OAExB,OAAO,EAGD,4BAKN,EAAE5P,KAAF,GAEA,MAAM,EAAY,GAClB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,IAAK,EAChC,EAAUa,KAAK,EAAExD,KAEnB,OAAO,EAGD,2BAKN,EAAE2C,KAAF,GAEA,MAAM,EAAW,GACjB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,KAAM,EACjC,EAASa,KAAK,CAAC,EAAEgB,IAAK,EAAEA,IAAK,EAAEA,MAEjC,OAAO,EAGD,0BAKN,EAAE7B,KAAF,GAEA,MAAM,EAA4B,GAClC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAS,KAAM,EACjC,EAAQa,KAAK,CACXwH,EAAG,CAAC,EAAExG,IAAK,EAAEA,IAAK,EAAEA,KACpB6pB,OAAQ,EAAE7pB,IACVsC,EAAG,CAAC,EAAEtC,IAAK,EAAEA,IAAK,EAAEA,KACpB8pB,OAAQ,EAAE9pB,IACV0pB,aAAc,EAAEluB,IAChBqO,MAAO,EAAErO,MAGb,OAAO,EAGD,2BAMN,OADA,EAAE2C,KAAF,GACO,EAAEiU,KAAF,EAAe,EAAAvU,eAAeT,OAG/B,0BAAgC,MAChC,EAAO,EAAEsC,KAAK,IACd,EAAQ,EAAE6J,KACV,EAAS,EAAEA,KAEX,GAAc,EAAEA,KACtB,KAAgB,CACd,MAAM,EAAO,IAAItK,WAAW,GAG5B,OAFA,EAAK,GAAK,EAAK,GAAK,EAAK,GAAK,EAAK,GAAK,IAEjC,CAAE4H,KAAA,EAAM9K,MAAA,EAAOU,OAAA,EAAQsB,KAAA,EAAMuc,WAAA,GAC/B,CACL,EAAEhc,KAAF,IADK,MAIC,EAAa,IACb,EAAS,EAAE8T,KAAF,EAAmB,EAAAvU,eAAeT,OAGjD,EAAEkB,KAAW,EAAa,GAAnB,IAEP,EAAEA,KAAK,GAVF,MAYC,EAAU,EAAE8T,KAAK,IAAK,EAAAvU,eAAeT,OAO3C,MAAO,CAAEyJ,KAAA,EAAM9K,MAAA,EAAOU,OAAA,EAAQsB,KAJhB,MAAZ,EAAK,GACD,EAAA4X,2BAAA,KACA,EAAAC,cAAA,KAE8B0E,WAAA,IAIhC,yBACN,EAAEnc,KAAF,GADmD,MAG7C,EAAQ,EAAEoL,KACV,EAAU,GAChB,IAAK,IAAI,EAAI,EAAG,MAAa,EAC3B,EAAQvK,KAAK,EAAEuK,MAGjB,MAAM,EAAyB,GAC/B,IAAK,IAAI,EAAI,EAAG,MAAa,EACR,aAAf,KACF,EAASvK,KAAK,CACZ6H,KAAM,WACN9K,MAAO,EACPU,OAAQ,EACRsB,KAAM,IAAIkB,WAAW,CAAC,EAAG,IAAK,EAAG,MACjCqb,YAAW,KAGb,EAAEnc,KAAK,EAAS,MAChB,EAASa,KAAKlB,KAAKsuB,gBAAL,KAIlB,OAAO,EAGD,2BACN,EAAEjuB,KAAF,GADmE,MAE7D,EAAkB,EAAAkuB,IAAI,EAAE3sB,KAAF,IAEtB,EAAe,CACnB,SACA,SACA,iBACA,SACA,cACA,aAEI,EAAe,CAAC,YAAa,aAAc,SAE3C,EAAa,EAAS,GA2C5B,MA1C6B,eAAzB,EAAW4sB,YACb,EAAWvS,MAAQ,KACnB,EAAWQ,IAAM,EAAWA,KAAO,GACnC,EAAWA,IAAM,EAAWA,IACzBiC,MAAM,KACNvC,OAAQ,GAAc,EAAE7X,QACxBP,IAAK,GAAc,EAAE/B,QAAQ,MAAO,MACpC+B,IAAK,GAAc,EAAA0qB,SAAA,KAGxB,EAASxqB,QAAQ,IAAI,MAqBiCyqB,OAAOpkB,WApBvD,EAAE2R,aACuB,IAAhB,EAAE0S,YACX,EAAEA,UAAY,QAGY,IAAjB,EAAEC,aACX,EAAEA,WAAa,QAGS,IAAf,EAAEC,WACX,EAAEA,SAAW,QAGc,IAAlB,EAAEC,cACX,EAAEA,YAAc,UAIpB,EAAa7qB,QAAQ4V,IACf,OACF,KAAU,KAAQ6E,MAAM,KAAK3a,IAAK,GAAc,SAIpD,EAAaE,QAAQ4V,IACf,OACF,KAAU,EAAkB,WAKlC,K,4ECrjBJ,eAAApc,GAAiC,IAC3B,EAAQ,EACR,EAAc,GACd,EAAc,GAClB,MAAM,EAAiB,GAEvB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM6G,SAAU,EAAG,CACrC,MAAM,EAAI,KAEV,UACE,KAAK,EAEH,GAAI,KAAKyqB,KAAL,GACF,SACK,GAAU,MAAN,EAIT,MAAO,GAHP,EAAQ7tB,KAAK,IACb,EAAQ,EAIV,MAGF,KAAK,EAEH,GAAI,KAAK6tB,KAAL,GACF,SACK,GAAU,MAAN,EACT,EAAQ,MACH,IAAU,MAAN,EAIT,MAAO,GAHP,EAAM,GACN,EAAQ,EAIV,MAGF,KAAK,EAEO,MAAN,EACF,EAAQ,EAER,KAEF,MAGF,KAAK,EAEH,GAAI,KAAKA,KAAL,GACF,SACe,MAAN,IACT,EAAM,GACN,EAAQ,GAEV,MAGF,KAAK,EAEO,MAAN,GACF,EAAQ,EAAQzqB,OAAS,GAAzB,KACA,EAAQ,GAER,MAOR,OAAO,I,4ECpDT,YASE,YAAY,EAAZ,SAHA,KAAAN,MAAe,GACf,KAAAI,QAAsC,GASpCpE,KAAK+I,KAAL,EACA/I,KAAK0D,SAALc,EACAxE,KAAKuc,SAAL,EACAvc,KAAK8e,OAAL,EACA9e,KAAKgvB,SAAL,K,4EC/BJ,QAWE,eAFQ,KAAAC,MAAQ,IAAI3tB,YAAY,EAAkBysB,cAGhD/tB,KAAKgvB,SAAL,EAEAhvB,KAAKkvB,QAAU,IAAI/tB,WACjB,EAAkB4sB,aAAe,EAAkBA,aAAe,GAEpE/tB,KAAKkvB,QAAQlvB,KAAKkvB,QAAQ5qB,OAAS,GAAK,IACxCtE,KAAKkvB,QAAQlvB,KAAKkvB,QAAQ5qB,OAAS,GAAK,IACxCtE,KAAKkvB,QAAQlvB,KAAKkvB,QAAQ5qB,OAAS,GAAK,IACxCtE,KAAKkvB,QAAQlvB,KAAKkvB,QAAQ5qB,OAAS,GAAK,IAjB1C,eACE,OAAO,SAmBT,aACE,OAAOtE,KAAKkvB,QAGd,YAAY,EAAZ,KAWgB,MAER,EAAOlvB,KAAKmvB,cAAL,GACP,EAAOnvB,KAAKovB,aAAL,EAA0B,EAAKnxB,MAAO,EAAKU,QACxD,KAEE,IAAK,MAAI,EAAI,EAAG,EAAI,EAAS2F,OAAS,IAAK,EAAG,CAAC,EAE3C,EAAa,EAAJ,GAASE,EAAQkE,EAAE,GAC5B,EAAa,EAAJ,EAAQ,GAAKlE,EAAQkE,EAAE,GAChC,EAAa,EAAJ,EAAQ,GAAKlE,EAAQkE,EAAE,GAChClE,EAAQunB,OACR,EAAKsD,KACP,GAAe,GAAT,EAAKnR,EAAS,EACpB,GAAuC,GAAjC,EAAkB6P,aAExB,IAAI,EACF,EAAa,EAAJ,GAASvpB,EAAQA,EAAE,GAC5B,EAAa,EAAJ,EAAQ,GAAKA,EAAQA,EAAE,GAChC,EAAa,EAAJ,EAAQ,GAAKA,EAAQA,EAAE,GAChCA,EAAQwnB,OACR,EAAKsD,KACP,GAAe,GAAT,EAAKnR,EAAS,EACpB,GAAuC,GAAjC,EAAkB4P,aAExB,EAAa,EAAJ,EAAQ,GAAjB,EACA,EAAa,EAAJ,EAAQ,GAAjB,GAKE,cAAc,GAAsB,IAEtC,EAAO,EAAW,EAAS,IAC3B,EAAO,EAAW,EAAS,IAC3B,EAAO,EAAW,EAAS,IAC3B,EAAO,EAAW,EAAS,IAE/B,IAAK,IAAI,EAAI,EAAG,EAAI,EAASzpB,OAAS,IAAK,EACrC,EAAW,EAAa,EAAJ,EAAQ,IAA5B,IACF,EAAO,EAAW,EAAa,EAAJ,EAAQ,KAEjC,EAAW,EAAa,EAAJ,EAAQ,IAA5B,IACF,EAAO,EAAW,EAAa,EAAJ,EAAQ,KAEjC,EAAW,EAAa,EAAJ,EAAQ,IAA5B,IACF,EAAO,EAAW,EAAa,EAAJ,EAAQ,KAEjC,EAAW,EAAa,EAAJ,EAAQ,IAA5B,IACF,EAAO,EAAW,EAAa,EAAJ,EAAQ,KAKvC,MAAO,CACLrG,MAAO,EAAU,EAAO,IAAM,EAAW,EAAO,IAAM,EACtDU,OAAQ,EAAU,EAAO,IAAM,EAAW,EAAO,IAAM,EACvD0wB,KAAM,KACNC,KAAM,MAIF,aAAa,EAAb,KAKN,GAAc,GAAV,GAAwB,GAAT,EACjB,OAAO,KAGT,MAAM,EAAQtvB,KAAKuvB,cAAL,KAEd,GAAA7xB,EAAW,CAAC,MACJ,EAAI,CAAC,EAAMwgB,EAAG,EAAMC,GACpB,EAAI,CAAC,EAAD,GACJ,EAAI,CAAC,EAAkB4P,aAAc,EAAkBA,cAE7D,IAAK,IAAI,EAAI,EAAG,EADF,MACe,EAAG,CAC9B,MAAM,EAAI,EAAE,GAAK,EAAE,GAAK,EAAE,GAAK,EAAE,GAAK,EAAW,EAAI,EAAE,IAAO,EAAI,EAAE,GACpE/tB,KAAKkvB,QAAY,EAAJ,GAAS,EAAS,IAAqC,EAAhClvB,KAAKgvB,SAAS,EAAa,EAAJ,IAC3DhvB,KAAKkvB,QAAY,EAAJ,EAAQ,GAAK,EACxB,IACoC,EAApClvB,KAAKgvB,SAAS,EAAa,EAAJ,EAAQ,IAEjChvB,KAAKkvB,QAAY,EAAJ,EAAQ,GAAK,EACxB,IACoC,EAApClvB,KAAKgvB,SAAS,EAAa,EAAJ,EAAQ,IAEjChvB,KAAKkvB,QAAY,EAAJ,EAAQ,GAAK,KAI9B,OAAO,EAGD,cAAc,EAAd,GAAkC,IACpC,EAAI,EACJ,EAAI,EAEJ,EAAa,EAAkBnB,aACnC,IAAK,IAAI,EAAI,EAAG,EAAI/tB,KAAKivB,MAAM3qB,OAAX,IAAyB,EAAG,CAAC,IAG3C,EAFAE,EAAkB,EAGtB,IAAK,EAAI,EAAG,OACNxE,KAAKivB,MAAM,EAAAvxB,IAAX,KADe,EAIfsC,KAAKivB,MAAM,EAAAvxB,GAAX8G,IACFA,EAAkBxE,KAAKivB,MAAM,EAAAvxB,IAI7B,QACF,IACA,EAAI,KAIR,GAAI,IAAiB,EAAkBqwB,aACrC,OAAO,KAGT,IAAK,IAAI,EAAI,EAAG,MAAS,EACvB/tB,KAAKivB,MAAM,KAAS,IAGtB,MAAO,CAAE/Q,EAAA,EAAGC,EAAA,IArKP,EAAA4P,aAAe,KADxB,uB,8ECTA,aAEA,4BACE,KAAAyB,OAAA,EACA,KAAAC,WAAA,EACA,KAAAC,YAAA,EACA,KAAA1xB,SAAiB,EAAA2xB,KAAKtS,SACtB,KAAA9W,MAAc,EAAAopB,KAAKtS,Y,8ECPrB,aAEA,4BACE,KAAAlX,SAAA,EACA,KAAAnI,SAAiB,EAAA2xB,KAAKtS,SACtB,KAAA9W,MAAc,EAAAopB,KAAKtS,Y,8ECLrB,aAEA,QAeE,eAVA,KAAAuS,iBAAyB,EAAAC,KAAKxS,SAE9B,KAAA3K,IAAc,EAAAod,SAASC,SAAS,IAChC,KAAAC,KAAe,EACf,KAAAC,IAAc,KAEd,KAAAC,WAAmB,EAAAL,KAAKxS,SACxB,KAAArf,SAAW,EAAAmyB,KAAK9S,SAChB,KAAAnU,SAAW,EAAAinB,KAAK9S,SAGdrd,KAAKoF,OAAL,EACApF,KAAKqF,yBAhBP,eACE,OAAO,IAAAhD,EAAA,GAkBT,yBACE,EAAAwtB,KAAKO,YACHpwB,KAAK4vB,iBACL5vB,KAAK0S,IACL1S,KAAKoF,OACLpF,KAAKgwB,KACLhwB,KAAKiwB,KAIT,mBACE,EAAAJ,KAAKQ,SAASrwB,KAAKkwB,YACnB,EAAAL,KAAKS,QACHtwB,KAAKkwB,WACLlwB,KAAKkwB,WACLlwB,KAAKkJ,SAAS,GAAK,EAAU,GAE/B,EAAA2mB,KAAKU,QACHvwB,KAAKkwB,WACLlwB,KAAKkwB,WACL,EAAU,EAAIlwB,KAAKkJ,SAAS,IAE9B,EAAA2mB,KAAKW,UAAUxwB,KAAKkwB,WAAYlwB,KAAKkwB,WAAY,EAC9ClwB,KAAKhC,SAAS,IACdgC,KAAKhC,SAAS,IACdgC,KAAKhC,SAAS,MA7CrB,Y,4ECFA,QAGE,cACEgC,KAAK+G,KAAO,IAAI5F,WAAW,KAC3B,IAAK,IAAI,EAAI,EAAO,IAAJ,IAAW,EACzBnB,KAAK+G,KAAK,GAAK,GANrB,aAWA,SAAAtJ,GACE,IAAY,GAAZ,SAAAA,GACE,IAAA6L,EAAA,IAAqB,IACrB,IAAAmnB,EAAA,IAAqB,IACrB,IAAAjnB,EAAA,IAAqB,IACrB,IAAAD,EAAA,IAAqB,IACrB,IAAAmnB,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAloB,EAAA,IAAqB,IACrB,IAAAmoB,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAtoB,EAAA,IAAqB,IACrB,IAAAuoB,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,EAAA,IAAqB,IACrB,IAAAC,KAAA,WACA,IAAAC,IAAA,UACA,IAAAtoB,MAAA,YA7BF,CAAY,IAAAN,OAAA,EAAAA,KAAI,KADlB,CAAiB,IAAA1F,WAAA,EAAAA,SAAQ,M,2BCLzB,IAAY,E,iDAAZ,SAAAhG,GACE,IAAAu0B,OAAA,YACA,IAAAC,SAAA,cAFF,CAAY,IAAAC,aAAA,EAAAA,WAAU,KAKtB,QACS,eACL,MAAM,EAAK,EAAO5U,WAAW,QAAS,CACpC6U,OAAM,IAFkC,SAQnC,IAAI,EAAJ,IAHLjX,QAAQhO,MAAM,+BACP,MAKJ,2BAAwB,MACvB,EACS,8CADT,EAEK,oDAIX,IADiBtF,OACRwqB,sBACP,MAAO,CACLhqB,YAAW,EACXE,QAAS,GAIb,MAAM,EAAIlB,SAASmB,cAAc,UACjC,IAAI,OACU,EAAE+U,WAAW,UAAY,EAAEA,WAAW,sBAEzC,CACLlV,YAAW,EACXE,QAAS,IAGJ,CACLF,YAAW,EACXE,QAAS,GAGb,SACA,MAAO,CACLF,YAAW,EACXE,QAAS,IAOf,eACEtI,KAAKuF,GAAL,EAGF,cAAc,GAMZ,MAAM,EAAKvF,KAAKuF,GAChB,IAAI,EAAU,EAAG8sB,gBACjB,IAAK,EAEH,OADAnX,QAAQhO,MAAM,kCACP,KAGT,MAAM,EAAelN,KAAKsyB,aAAa,CACrCpnB,OAAQ,EAAOqnB,gBACfpmB,KAAM,EAAW6lB,SAEnB,IAAK,EAEH,OADA9W,QAAQhO,MAAM,mCACP,KAET,MAAM,EAAiBlN,KAAKsyB,aAAa,CACvCpnB,OAAQ,EAAOsnB,kBACfrmB,KAAM,EAAW8lB,WAEnB,IAAK,EAEH,OADA/W,QAAQhO,MAAM,qCACP,KAQT,GALA,EAAGulB,aAAH,KACA,EAAGA,aAAH,KACA,EAAGC,YAAH,GACA,EAAGC,gBAAH,IAEK,EAAGC,oBAAH,EAAgC,EAAGC,aAAc,CACpD,EAAGC,cAAH,GACA,EAAGC,aAAH,GACA,EAAGA,aAAH,GAEA,MAAM,EAAS,EAAGC,kBAAH,GAEf,OADA9X,QAAQhO,sCAAsC,KACvC,KAGT,IAAK,EAAG0lB,oBAAH,EAAgC,EAAGK,iBAAkB,CACxD,EAAGH,cAAH,GACA,EAAGC,aAAH,GACA,EAAGA,aAAH,GAEA,MAAM,EAAS,EAAGC,kBAAH,GAEf,OADA9X,QAAQhO,sCAAsC,KACvC,KAGT,EAAGgmB,WAAH,GAEA,MAAM,EAAyC,GAC/C,IAAK,IAAI,EAAI,EAAG,EAAI,EAAOC,eAAe7uB,SAAU,EAAG,CAAC,MAChDjC,EAAO,EAAO8wB,eAAP,GACP,EAAO,EAAGC,kBAAH,KACb,IAAc,IAAV,EAGF,OAFAlY,QAAQhO,uDAAuD7K,MAC/D,EAAGywB,cAAH,GACO,KAET,OAGF,MAAM,EAAqD,GAC3D,IAAK,IAAI,EAAI,EAAG,EAAI,EAAOO,aAAa/uB,SAAU,EAAG,CAAC,MAC9CjC,EAAO,EAAOgxB,aAAP,GACP,EAAU,EAAGC,mBAAH,KAChB,GAAgB,OAAZ,EAKF,OAJApY,QAAQhO,yDAC6C7K,MAErD,EAAGywB,cAAH,GACO,KAET,OAGF,MAAO,CACLS,OAAO,EACPC,WAAA,EACAC,SAAA,GAIJ,aAAa,GAA4C,MACjD,EAAKzzB,KAAKuF,GACV,EACJ,EAAO4G,OAAS,EAAW6lB,OACvB,EAAGM,aAAa,EAAGoB,eACnB,EAAGpB,aAAa,EAAGqB,iBAL8B,UAUvD,EAAGC,aAAH,EAAwB,EAAO1oB,QAC/B,EAAG2oB,cAAH,GAEK,EAAGC,mBAAH,EAA8B,EAAGC,gBAbiB,GAcrD7Y,QAAQhO,MAAM,EAAG8mB,iBAAH,IACd,EAAGjB,aAAH,GACO,QATP7X,QAAQhO,MAAM,mCACP,MAcX,yBACE,OACElN,KAAKuF,GAAG0uB,aAAa,mCACrBj0B,KAAKuF,GAAG0uB,aAAa,uCACrBj0B,KAAKuF,GAAG0uB,aAAa,yCAIzB,iBAAiBx2B,GACf,OAAOuC,KAAKuF,GAAG2uB,aAAaz2B,EAAU02B,iCA/K1C,a,oFCXA,OAEAz2B,EAAA,KACA,QACA,QAEM,EAAa,CAAC,EAAD,KACjB,EAAKyH,OAAOnH,SAAS,GAAK,EAAMoX,UAAU,GAC1C,EAAKjQ,OAAOnH,SAAS,GAAK,EAAMoX,UAAU,GAC1C,EAAKjQ,OAAOnH,SAAS,GAAK,EAAMoX,UAAU,GAC1C,EAAKjQ,OAAO+D,SAAS,GAAK,EAAA4mB,SAASC,SAAS,EAAMva,UAAU,IAC5D,EAAKrQ,OAAO+D,SAAS,GAAK,EAAA4mB,SAASC,SAAS,EAAMva,UAAU,IAC5D,EAAKrQ,OAAO+D,SAAS,GAAK,EAAA4mB,SAASC,SAAS,EAAMva,UAAU,KAG9D,6BAAkC7S,YAahC,YAAY,GACVC,QATF,KAAAwxB,WAAqB,EACrB,KAAAC,aAAuB,EACvB,KAAAC,YAAsB,EACtB,KAAAC,YAAsB,EACtB,KAAAC,WAAA,EACA,KAAA1xB,UAAA,EACA,KAAA2xB,MAAgB,EAIdz0B,KAAK00B,QACL10B,KAAK4I,KAAL,EACA5I,KAAKuY,MAAQ,IAAI,EAAA9E,YACjBzT,KAAK4D,OAAS,KAGhB,QAUE,GATA5D,KAAKo0B,WAAa,EAClBp0B,KAAKq0B,aAAe,EACpBr0B,KAAKs0B,YAAc,EACnBt0B,KAAKu0B,YAAc,EAEnBv0B,KAAKw0B,WAAL,EACAx0B,KAAK8C,UAAL,EACA9C,KAAKy0B,MAAQ,EAETz0B,KAAK4D,OAAQ,CACf,IAAI,EAAa5D,KAAK4D,OAAOqR,KAAK,GAAG2J,OAAO,GAC5C,EAAWO,OAAO9e,KAAK,GACvBL,KAAKuY,MAAQ,EAAWA,MAAM2G,SAIlC,GAAGzhB,EAAH,GACE,OAAOuC,KAAK2H,iBAAL,EAAAnD,GAGT,IAAI/G,EAAJ,GACEuC,KAAK0J,oBAAL,EAAAlF,GAGF,aAAa,GACXxE,KAAK4D,OAAL,EACA5D,KAAK00B,QAGP,OACO10B,KAAKw0B,UAECx0B,KAAK8C,WACd9C,KAAK8C,UAAL,GAFA9C,KAAKw0B,WAAL,EAKFx0B,KAAKyE,cAAc,EAAAC,IAAI,SAGzB,QACM1E,KAAKw0B,YACPx0B,KAAK8C,UAAL,GAGF9C,KAAKyE,cAAc,EAAAC,IAAI,UAGzB,OACE1E,KAAK00B,QACL10B,KAAKyE,cAAc,EAAAC,IAAI,SAGzB,UACE1E,KAAKy0B,MAAQ,EAAsB,EAAbz0B,KAAKy0B,MAAW,GAGxC,YACEz0B,KAAKy0B,MAAQ,EAASz0B,KAAKy0B,MAAQ,EAAG,KAGxC,KAAK,GAAa,IACZ,EAAI,EAAS,EAAG,EAASz0B,KAAK4D,OAAOU,OAArB,IAEhB,EAAOtE,KAAK4D,OAAOqR,KACvB,IAAK,MAAI,EAAI,EAAG,EAAI,EAAK3Q,SAAU,EAAG,CAAC,EACxB,KAAQsa,OACrB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAOta,SAAU,EAAG,CAAC,IACnC,EAAQ,KACR,EAAY,EAAM6P,UAClB,EAAY,EAAY,EAAMC,WAClC,GAAI,MAAkB,IAAe,CACnCpU,KAAKo0B,WAAL,EACAp0B,KAAKq0B,aAAL,EACAr0B,KAAKs0B,YAAL,EAEAt0B,KAAKuY,MAAQ,EAAMA,MAAM2G,QALU,IAM/B,EAAgBlf,KAAK4D,OAAOsR,cAC5B,EAAiBlV,KAAK4D,OAAOuR,eAC7B,EAAI,EAAMgK,OARqB,IASnC,EAAE9e,KAAK,KACM,CAAC,IACR,EAAS,EAAEC,OACX,EAAQ,EAAAob,OAAOiZ,UAAP,OACZ,KAAI,EAAM1oB,MAAN,GAGG,CACL,EAAE5L,KAAF,GACA,MAJAL,KAAKuY,MAAM7E,UAAXlP,GACAxE,KAAKu0B,YAAc,EAAMnoB,KAS7B,YAFA,EAAWpM,KAAK4I,KAAM5I,KAAKuY,UAQnC,cAAc,GACZ,EAAQ,EAAS,EAAG,IAAgB,MAAQ,IAC5C,GAASvY,KAAK4D,OAAOU,OACrBtE,KAAKK,KAAL,GAGF,OAAO,GACL,IAAKL,KAAKw0B,WAAax0B,KAAK8C,SAC1B,OAFa,IAKX,EAAgB9C,KAAK4D,OAAOsR,cAC5B,EAAiBlV,KAAK4D,OAAOuR,eAE7B,EAAMnV,KAAK4D,OAAOqR,KAAKjV,KAAKo0B,YAC5B,EAAQ,EAAIxV,OAAO5e,KAAKq0B,cACxB,EAAI,EAAMlV,OAEV,EAAUnf,KAAKs0B,YAAc,EAAKt0B,KAAKy0B,MAEvC,KAdW,OAgBF,CACX,IAAI,EAAS,EAAEn0B,OACf,GAAI,GAAU,EAAML,KAAKqE,OAAQ,CAC/B,GAAItE,KAAKq0B,eAAiB,EAAIzV,OAAOta,OAAS,EAW5CtE,KAAKq0B,eACL,EAAQ,EAAIzV,OAAO5e,KAAKq0B,kBAXxB,IAAIr0B,KAAKo0B,aAAep0B,KAAK4D,OAAOqR,KAAK3Q,OAAS,EAAG,CACnD,KACA,MAEAtE,KAAKq0B,aAAe,EACpBr0B,KAAKo0B,aAEL,GADA,EAAMp0B,KAAK4D,OAAOqR,KAAKjV,KAAKo0B,aAChBxV,OAAO5e,KAAKq0B,eAO5B,EAAI,EAAMlV,QACR9e,KAAK,GACP,EAAS,EAET,SAtBS,IAyBP,EAAgBL,KAAK4I,KAAKvE,OAC1B,EAAa,EAAAqX,OAAOiZ,UAAP,OACjB,GAAiB,EAAb,EAAMxoB,KACR,IAAK,MAAI,EAAI,EAAG,EAAI,EAAMlM,KAAKqE,SAAU,EAEvC,GAAqB,KAArB,EADc,EAAMrE,KAAN,IACFkM,KAAY,CAAC,IAEnB,EAAW,EAAQlM,KACnB,EAAQ,EAAO+I,KAAM,GAAW,EAAE0D,QAAU,EAASiI,YACzD,GAAI,GAAwB,oBAAf,EAAM5L,KAA4B,CAAC,IAC1C,EAAU,EAAS8D,QACnB,EAAS,EAASG,OAEtBhN,KAAK4I,KAAKtB,YAAYstB,KAAtB,EAAApwB,EAAA,SAEG,GAAqB,KAAjB,EAAQ2H,KAAa,CAAC,IAE3B,EAAW,EAAQlM,KACnB,EAAQ,EAAO+I,KAAM,GAAW,EAAE0D,QAAU,EAASiI,YACrD,GAAS,EAAM5L,UAKO,IAAjB,EAAQoD,MACjB,EAAQlM,KAAK6U,SAAS7Q,QAAS,IAC7B,OAAQ,EAAQ8Q,MACd,IAAK,QACL,IAAK,MACL,IAAK,OAAQ,CAAC,IACR,EAAY,EAAQC,OAAO,GAAK,OAChC,EAAQ,EAAOhM,KAAM,GAAW,EAAED,OAAF,GACpC,IAAK,EACH,OAGF/I,KAAK4I,KAAKtB,YAAYstB,KAAtB,EAAkC,EAAG,IACrC,MAEF,IAAK,UAAW,CAAC,IAEX,EADA,EAAY,EAAQ5f,OAAO,GAAK,OADtB,EAGV6f,MAAM,EAAQ7f,OAAO,IACd,EAEA1K,WAAW,EAAQ0K,OAAO,IAErC,IAAI,EAAQ,EAAOhM,KAAM,GAAW,EAAED,OAAF,GACpC,IAAK,EACH,OAGF/I,KAAK4I,KAAKtB,YAAYstB,KAAtB,EAAkC,EAAlC,GACA,eAML,GAAmB,IAAf,EAAMzoB,KAAY,CAAC,IACxB,EAAS,EAAMS,MAAME,OACrB,EAAQ,EAAO9D,KAAK,GAAK,EAAED,OAAF,GAC7B,GAAI,GAAwB,oBAAf,EAAMA,KAA4B,CAAC,IAC1C,EAAU,EAAM6D,MAAMC,QACtB,EAAS,EAAMD,MAAMI,OACzBhN,KAAK4I,KAAKtB,YAAYstB,KAAtBpwB,EAAA,MAGJ,KAAI,EAAMyH,MAAN,GAGG,CACL,EAAE5L,KAAF,GACA,MAJAL,KAAKuY,MAAM7E,UAAX,GACA1T,KAAKu0B,YAAc,EAAMnoB,KAO7B,EAAWpM,KAAK4I,KAAM5I,KAAKuY,OAE3BvY,KAAKs0B,YAAL,EAxHe,GA2Hbt0B,KAAKmL,U,4ECxQX,QAoBE,eAIA,KAAAtG,KAAO,KACL,MAAM,EAAK7E,KAAKsF,QAAQC,GAExB,EAAGuvB,MAAM,EAAGC,iBAAmB,EAAGC,mBANlCh1B,KAAKsF,QAAU,EAAOA,QApBxB,eACE,MAAM,EAAK,EAAQC,GAanB,OAXA,EAAG0vB,WAAW,EAAK,EAAK,EAAK,GAC7B,EAAGC,WAAW,GACd,EAAGC,OAAO,EAAGC,YACb,EAAGC,UAAU,EAAGC,QAEhB,EAAGH,OAAO,EAAGI,OACb,EAAGC,UAAU,EAAGC,UAAW,EAAGC,qBAE9B,EAAGP,OAAO,EAAGQ,WACb,EAAGC,SAAS,EAAGC,OAER,IAAI,EAAS,CAAEvwB,QAAA,KAf1B,c,8ECEA,cAEA,QAkBE,eALQ,KAAAwwB,aAAmC,KACnC,KAAAC,YAAkC,KAClC,KAAA7G,QAA+B,KAC/B,KAAA8G,SAAA,EAGNh2B,KAAKsF,QAAU,EAAOA,QACtBtF,KAAKi2B,OAAS,EAAOA,OAnBvB,eACE,MAAM,EAAS,EAAAC,UAAUpuB,KAAV,GADW,SAOnB,IAAI,EAAS,CAAExC,QAAA,EAAS2wB,OAAA,KAJ7B/a,QAAQhO,MAAM,eACP,MAkBX,UAAU,GACR,GAAyB,IAArB,EAAIlJ,MAAMM,OAEZ,YADAtE,KAAKg2B,SAAL,GAFc,MAMV,EAAKh2B,KAAKsF,QAAQC,GAClB,EAAe,EAAG4wB,eAClB,EAAc,EAAGA,eACjB,EAAU,EAAGC,gBACnB,IAAK,IAAiB,IAAgB,EAEpC,MAAM,IAAI9oB,MAAM,mBAZF,MAgBV5P,EAAU,IAAIyD,WAAW,CAC7B,EAAI,EAAI,EAAQ,EAAI,EAAI,EACxB,EAAI,EAAI,EAAQ,EAAI,EAAI,EACxB,EAAI,EAAI,GAAQ,EAAI,GAAI,GACxB,GAAI,GAAI,GAAQ,GAAI,GAAI,GACxB,GAAI,GAAI,GAAQ,GAAI,GAAI,GACxB,GAAI,GAAI,GAAQ,GAAI,GAAI,KAGpB,EAAW,IAAIO,aAAa,EAE/B,GAAM,EAAM,EAAK,KAAO,KACxB,GAAM,EAAM,EAAK,KAAO,KACxB,EAAM,EAAM,EAAK,KAAO,MACxB,EAAM,EAAM,EAAK,KAAO,MAGxB,GAAM,GAAM,EAAK,KAAO,MACxB,EAAM,GAAM,EAAK,KAAO,KACxB,EAAM,GAAM,EAAK,KAAO,KACxB,GAAM,GAAM,EAAK,KAAO,MAGxB,EAAM,GAAM,EAAK,KAAO,MACxB,EAAM,EAAM,EAAK,KAAO,KACxB,EAAM,EAAM,EAAK,KAAO,KACxB,EAAM,GAAM,EAAK,KAAO,MAGxB,GAAM,GAAM,EAAK,KAAO,KACxB,GAAM,GAAM,EAAK,KAAO,KACxB,GAAM,EAAM,EAAK,KAAO,MACxB,GAAM,EAAM,EAAK,KAAO,KAGxB,GAAM,GAAM,EAAK,KAAO,KACxB,EAAM,GAAM,EAAK,KAAO,KACxB,EAAM,EAAM,EAAK,KAAO,KACxB,GAAM,EAAM,EAAK,KAAO,MAGxB,GAAM,GAAM,EAAK,KAAO,MACxB,GAAM,EAAM,EAAK,KAAO,MACxB,EAAM,EAAM,EAAK,KAAO,MACxB,EAAM,GAAM,EAAK,KAAO,MACzBqC,IAAI,CAAC,EAAD,IAAqB,EAAT,EAAI,EAAc,KAAJ,EAAhB,IAEhB,EAAGsyB,WAAW,EAAGC,aAAjB,GACA,EAAGC,WAAW,EAAGD,aAAjB,EAAyC,EAAGE,aAC5C,EAAGC,wBAAwB,GAE3B,EAAGJ,WAAW,EAAGK,qBAAjB,GACA,EAAGH,WAAW,EAAGG,qBAAjB,EAAgD,EAAGF,aAEnD,MAAM,EAASpvB,SAASmB,cAAc,UACtC,EAAOtK,MAAQ,IACf,EAAOU,OAAS,KAChB,MAAM,EAAM,EAAO2e,WAAW,MAC9B,IAAK,EACH,MAAM,IAAIhQ,MAAM,gBAGlB,MAAM,EAAuC,CAC3CO,GAAI,CAAC,EAAG,GACR8oB,GAAI,CAAC,EAAG,KACRC,GAAI,CAAC,EAAG,KACRC,GAAI,CAAC,IAAK,GACVC,GAAI,CAAC,IAAK,KACVC,GAAI,CAAC,IAAK,MAGZ,EAAI/yB,MAAMC,QAAS,IAAY,MACvB,EAAMmD,SAASmB,cAAc,UAC7B,EAAQ,EAAI+U,WAAW,MAC7B,IAAK,EACH,MAAM,IAAIhQ,MAAM,kBAElB,EAAIrP,MAAQ,EAAIA,MAChB,EAAIU,OAAS,EAAIA,OACjB,MAAM,EAAY,EAAMq4B,aAAa,EAAG,EAAG,EAAI/4B,MAAO,EAAIU,QAC1D,IAAK,IAAI,EAAI,EAAG,EAAI,EAAIsB,KAAKqE,SAAU,EACrC,EAAUrE,KAAV,GAAoB,EAAIA,KAAJ,GAEtB,EAAMg3B,aAAN,EAA8B,EAAG,GAZJ,MAcvB,EAAO,EAAIluB,KAAKjH,OAAO,GACvB,EAAI,KAAe,KAAe,GAGxC,IAAK,EACH,MAAM,IAAIwL,MAAM,kBAElB,EAAI4pB,UAAJ,EAAmB,EAAE,GAAI,EAAE,MAG7B,MAAM9Y,EAAY,EAAI4Y,aAAa,EAAG,EAAG,IAAK,MAAM/2B,KACpD,EAAGk3B,YAAY,EAAGC,WAAlB,GACA,EAAGC,WACD,EAAGD,WACH,EACA,EAAGE,KACH,IACA,KACA,EACA,EAAGA,KACH,EAAGC,cACH,IAAIp2B,WAAJ,IAEF,EAAGq2B,eAAe,EAAGJ,YACrB,EAAGK,cAAc,EAAGL,WAAY,EAAGM,eAAgB,EAAGC,QACtD,EAAGF,cAAc,EAAGL,WAAY,EAAGQ,eAAgB,EAAGD,QACtD,EAAGF,cACD,EAAGL,WACH,EAAGS,mBACH,EAAGC,sBAEL,EAAGC,cAAc,EAAGX,WAAY,EAAGY,mBAAoB,EAAGC,QAC1D,MAAM,EAAaj4B,KAAKsF,QAAQ4yB,yBArIhB,GAuId,EAAGT,cACD,EAAGL,WACH,EAAWe,2BACXn4B,KAAKsF,QAAQ8yB,iBAAb,IAIJp4B,KAAK81B,aAAL,EACA91B,KAAK+1B,YAAL,EACA/1B,KAAKkvB,QAAL,EACAlvB,KAAKg2B,SAAL,EAGF,KAAK,GACH,GAAKh2B,KAAKg2B,QAAV,OAIM,EAAKh2B,KAAKsF,QAAQC,GAClB,EAASvF,KAAKi2B,OAEpB,EAAO/C,WAAP,GACA,EAAGiE,YAAY,EAAGC,WAAYp3B,KAAKkvB,SACnC,EAAGmH,WAAW,EAAGC,aAAct2B,KAAK81B,cACpC,EAAGO,WAAW,EAAGK,qBAAsB12B,KAAK+1B,aAC5C,EAAOsC,oBAAP,GACA,EAAOC,wBAAP,GACA,EAAOC,WAAP,EAAsB,GAbtB,MAeM,EAAI,EAAOv6B,SAAS,GACpB,EAAI,EAAOA,SAAS,GACpB,EAAI,EAAOA,SAAS,GAC1B,EAAOA,SAAS,GAAK,EACrB,EAAOA,SAAS,GAAK,EACrB,EAAOA,SAAS,GAAK,EACrB,EAAOw6B,mBACP,EAAOx6B,SAAS,GAAhB,EACA,EAAOA,SAAS,GAAhB,EACA,EAAOA,SAAS,GAAhB,EAEA,EAAOy6B,cAAP,EAAyB,EAAOvI,YAChC,EAAOwI,oBAAP,EAA+B,EAAO9I,kBAEtC,EAAG+I,aAAa,EAAGC,UAAW,GAAI,EAAGrB,cAAe,GACpD,EAAGzC,MAAM,EAAGE,oBA1MhB,c,kFCHM,EAAc,qOAad,EAAY,iTAiBlB,QACE,eAA4B,MAGpB,EAAU,EAAQ3C,cAAc,CACpCE,gBAAgB,EAChBC,kBAAkB,EAClBW,eALqB,CAAC,WAAY,YAMlCE,aAL6B,CAAC,aAAc,mBAAoB,aAFxC,SAcnB,IAAI,EAAJ,IAJLnY,QAAQhO,MAAM,uCACP,MAaX,eACElN,KAAK64B,QAAU,EAAQtF,OACvBvzB,KAAK84B,UAAY,EAAQtF,WAAR,SACjBxzB,KAAK+4B,UAAY,EAAQvF,WAAR,SACjBxzB,KAAKg5B,QAAU,EAAQvF,SAAR,WACfzzB,KAAKi5B,cAAgB,EAAQxF,SAAR,iBACrBzzB,KAAKk5B,SAAW,EAAQzF,SAAR,QAGlB,WAAW,GACT,EAAGP,WAAWlzB,KAAK64B,SAGrB,cAAc,EAAd,GACE,EAAGM,iBAAiBn5B,KAAKg5B,SAAzB,KAGF,oBAAoB,EAApB,GACE,EAAGG,iBAAiBn5B,KAAKi5B,eAAzB,KAGF,WAAW,EAAX,GACE,EAAGG,UAAUp5B,KAAKk5B,SAAlB,GAGF,oBAAoB,GAClB,EAAGzC,wBAAwBz2B,KAAK84B,WAChC,EAAGrC,wBAAwBz2B,KAAK+4B,WAGlC,wBAAwB,GACtB,EAAGM,oBAAoBr5B,KAAK84B,UAAW,EAAG,EAAGQ,OAA7C,KAAkE,GAClE,EAAGD,oBAAoBr5B,KAAK+4B,UAAW,EAAG,EAAGO,OAA7C,UAzDJ,e,mCCskBgB/7B,KAAKg8B,M,uDAvmBrB,OAIA,QACA,QACA,QACA,QAoBA,QA0CE,eApBQ,KAAAC,YAAoB,EAAA3J,KAAKxS,SAEzB,KAAAoc,UAAuB,CAC7Bn1B,OAAQ,EACRrE,KAAM,IAAIyB,aAAa,GACvBod,OAAQ,IAEF,KAAA4a,IAAkB,KAClB,KAAAnd,SAMF,GACE,KAAAnY,QAAsC,GACtC,KAAA4qB,SAGG,KAMThvB,KAAKoB,OAAS,EAAOA,OACrBpB,KAAKsF,QAAU,EAAOA,QACtBtF,KAAKi2B,OAAS,EAAOA,OAhDvB,eACE,MAAM,EAAS,EAAA0D,WAAW7xB,KAAX,GACf,IAAK,EAEH,OADAoT,QAAQhO,MAAM,6BACP,KAGT,EAAOgmB,WAAW,EAAQ3tB,IAE1B,MAAM,EAAS,EAAQA,GAAG4wB,eATA,SAenB,IAAI,EAAW,CAAE/0B,OAAA,EAAQkE,QAAA,EAAS2wB,OAAA,KAJvC/a,QAAQhO,MAAM,iCACP,MAuCX,UAAU,GACRlN,KAAK45B,WAAL,GACA55B,KAAKqtB,aAAL,GACArtB,KAAK65B,mBAAL,GACA75B,KAAK4tB,aAAL,GACA5tB,KAAK05B,IAAL,EAGM,WAAW,GAAQ,MACnB,EAAK15B,KAAKsF,QAAQC,GAClB,EAAS,EAAIuZ,OAEb,EAAqB,CACzB,aACA,OACA,OACA,OACA,SACA,YACA,OACA,UACA,MACA,OAIF,IAAI,EAAO,EACX,IAAK,IAAI,EAAI,EAAG,EAAI,EAAOxa,SAAU,EAAG,CACtC,MAAM,EAAQ,KACd,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM6nB,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAU,EAAIiY,SAAS,EAAM4P,MAAN,GAAeP,eACI,EAA5C,EAAmB1P,QAAQ,EAAQnT,QAIvC,GAAQ,EAAMojB,MAAN,GAAe/qB,OAAOkD,SAQlC,MAAMoE,EAAuB,CAC3BpE,OAJF,MAKErE,KAAM,IAAIyB,aAAJW,GACNyc,OAAQ,IAIV,IAAI,EAAgB,EACpB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAIA,OAAOxa,SAAU,EAAG,CAAC,MACrC,EAAQ,EAAIwa,OAAJ,GACR,EAAuB,CAC3B7V,OAAQ,EAAMA,OACd9I,OAAO,EACPmE,OAAQ,EACRw1B,eAAc,EACd3N,MAAO,IAGT,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMA,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAU,EAAIiY,SAAS,EAAM4P,MAAN,GAAeP,cAC5C,IAAgD,EAA5C,EAAmB1P,QAAQ,EAAQnT,MACrC,SAGF,MAAM,EAAqB,CACzB5I,OAAO,EACPmE,OAAQ,EACRsnB,cAAe,GAGjB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMO,MAAN,GAAe/qB,OAAOkD,SAAU,EAClDoE,EAAUzI,KAAK,KAAmB,EAAMksB,MAAN,GAAe/qB,OAAf,GAIjC,EAAU04B,eAC2C,MAAtD,EAAIvd,SAAS,EAAM4P,MAAN,GAAeP,cAAc7iB,KAAK,KAE/C,EAAU+wB,eAAV,GAGF,EAASlO,aAAe,EAAMO,MAAN,GAAeP,aACvC,EAAStnB,OAAS,EAAgB,EAASnE,OAC3C,EAAUgsB,MAAMjrB,KAAhB,GAGF,EAAUoD,OAAS,EAAgB,EAAUnE,OAC7CuI,EAAUoW,OAAO5d,KAAjB,GAIFwH,EAAUoW,OAAO5d,KAAK,CACpB+H,OAAQ,CAAC,EAAG,EAAG,GACf9I,OAAO,EACPmE,OAAQ,EACRw1B,eAAc,EACd3N,MAAO,CACL,CACEhsB,OAAO,EACPmE,OAAQ,EACRsnB,aAAc,MAIpBljB,EAAUzI,KAAK,MAAoB,GACnCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,MAAoB,GACnCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAElCyI,EAAUzI,KAAK,KAAmB,GAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,GAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAElCyI,EAAUzI,KAAK,MAAoB,GACnCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,GAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAElCyI,EAAUzI,KAAK,MAAoB,GACnCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,MAAoB,GACnCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAElCyI,EAAUzI,KAAK,KAAmB,GAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,MAAoB,GACnCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAElCyI,EAAUzI,KAAK,KAAmB,GAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,GAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAClCyI,EAAUzI,KAAK,KAAmB,EAIlC,EAAgB,EAChB,MAAM,EAA6B,CACjCA,KAAM,IAAIyB,aAAagH,EAAUzI,MACjCqE,OAAQoE,EAAUpE,OAClBwa,OAAQpW,EAAUoW,OAAO/a,IAAI,KAC3BkF,OAAQ,IAAI,EAAMA,QAClB9I,OAAQ,EAAMA,OACdmE,OAAQ,EAAMA,OACdw1B,cAAe,EAAMA,cACrB3N,MAAO,EAAMA,MAAMpoB,IAAI,KACrB5D,OAAQ,EAAKA,OACbmE,OAAQ,EAAKA,OACbsnB,aAAc,EAAKA,oBAIzB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAgB9M,OAAOxa,SAAU,EAAG,CACtD,MAAM,EAAQ,EAAgBwa,OAAhB,GACd,EAAMqN,MAAM4N,KAAK,CAAC,EAAD,IAAU,EAAEnO,aAAe,EAAEA,cAE9C,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMO,MAAM7nB,SAAU,EAAG,CAAC,MACtC,EAAO,EAAM6nB,MAAN,GACP,IAEN,IAAK,IAAI,EAAI,EAAG,EAAI,EAAK7nB,SAAU,EACjC,EAAgBrE,KAAhB,GAAsCyI,EAAUzI,KAAK,EAAKE,OAAL,GACrD,GAAiB,EAGnB,EAAKA,OAAL,EAGF,MAAM,EAAuB,GAC7B,IAAI,GAAuB,EAC3B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMgsB,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAO,EAAM6nB,MAAN,GAET,EAAKP,eAAL,EACF,EAAS,EAAStnB,OAAS,GAAGA,QAAU,EAAKA,QAG7C,EAASpD,KAAK,CACZf,OAAQ,EAAKA,OACbmE,OAAQ,EAAKA,OACbsnB,aAAc,EAAKA,eAErB,EAAsB,EAAKA,cAG/B,EAAMO,MAAN,EAEFnsB,KAAKy5B,UAAL,EAEA,EAAGpD,WAAW,EAAGC,aAAct2B,KAAKoB,QACpC,EAAGm1B,WAAW,EAAGD,aAAct2B,KAAKy5B,UAAUx5B,KAAM,EAAGu2B,aAGjD,aAAa,GACnB,MAAM,EAAKx2B,KAAKsF,QAAQC,GAExB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAIgX,SAASjY,SAAU,EAAG,CAC5C,MAAM,EAAY,EAAG8xB,gBACrB,IAAK,EAGH,MAAM,IAAI9oB,MAAM,eAGlB,MAAM,EAAU,EAAIiP,SAAJ,GAChB,IAAK,EAAAyd,aAAa,EAAQ/7B,SAAW,EAAA+7B,aAAa,EAAQr7B,QAAS,CAAC,MAC5D,EAAI,EAAQV,MACZ,EAAI,EAAQU,OACZ,EAAK,EAAAs7B,eAAe,EAAQh8B,OAC5B,EAAK,EAAAg8B,eAAe,EAAQt7B,QAClC,EAAQsB,KAAO,EAAAi6B,cAAc,EAAQj6B,KAAtB,MAAAqM,GACf,EAAQrO,MAAR,EACA,EAAQU,OAAR,EAGF,EAAGw4B,YAAY,EAAGC,WAAlB,GACA,EAAGC,WACD,EAAGD,WACH,EACA,EAAGE,KACH,EAAQr5B,MACR,EAAQU,OACR,EACA,EAAG24B,KACH,EAAGC,cACH,EAAQt3B,MAEV,EAAGw3B,cAAc,EAAGL,WAAY,EAAGY,mBAAoB,EAAGC,QAC1D,EAAGR,cACD,EAAGL,WACH,EAAGS,mBACH,EAAGC,sBAEL,EAAGL,cAAc,EAAGL,WAAY,EAAGM,eAAgB,EAAGC,QACtD,EAAGF,cAAc,EAAGL,WAAY,EAAGQ,eAAgB,EAAGD,QACtD,EAAGH,eAAe,EAAGJ,YAErB,MAAM,EAAap3B,KAAKsF,QAAQ4yB,yBAzCY,GA2C1C,EAAGT,cACD,EAAGL,WACH,EAAWe,2BACXn4B,KAAKsF,QAAQ8yB,iBAAb,IAIJp4B,KAAKuc,SAASrb,KAAK,CACjB6H,KAAM,EAAQA,KACd9K,MAAO,EAAQA,MACfU,OAAQ,EAAQA,OAChBsB,KAAM,EAAQA,KACdszB,OAAO,KAKL,mBAAmB,GACzB,MAAM,EAAKvzB,KAAKsF,QAAQC,GAExB,IAAK,MAAO,EAAD,KAAkBjD,OAAO6B,QAAQ,EAAIC,SAAU,CACxD,MAAM,EAAY,EAAGgyB,gBACrB,IAAK,EAGH,MAAM,IAAI9oB,MAAM,eAGlB,MAAM,EAAU,EAAOpB,OAAO,GAC9B,IAAK,EAAA8tB,aAAa,EAAQ/7B,SAAW,EAAA+7B,aAAa,EAAQr7B,QAAS,CAAC,MAC5D,EAAI,EAAQV,MACZ,EAAI,EAAQU,OACZ,EAAK,EAAAs7B,eAAe,EAAQh8B,OAC5B,EAAK,EAAAg8B,eAAe,EAAQt7B,QAClC,EAAQsB,KAAO,EAAAi6B,cAAc,EAAQj6B,KAAtB,MAAAqM,GACf,EAAQrO,MAAR,EACA,EAAQU,OAAR,EAGF,EAAGw4B,YAAY,EAAGC,WAAlB,GACA,EAAGC,WACD,EAAGD,WACH,EACA,EAAGE,KACH,EAAQr5B,MACR,EAAQU,OACR,EACA,EAAG24B,KACH,EAAGC,cACH,EAAQt3B,MAEV,EAAGw3B,cAAc,EAAGL,WAAY,EAAGY,mBAAoB,EAAGC,QAC1D,EAAGR,cACD,EAAGL,WACH,EAAGS,mBACH,EAAGC,sBAEL,EAAGL,cAAc,EAAGL,WAAY,EAAGM,eAAgB,EAAGC,QACtD,EAAGF,cAAc,EAAGL,WAAY,EAAGQ,eAAgB,EAAGD,QACtD,EAAGH,eAAe,EAAGJ,YAErB,MAAM,EAAap3B,KAAKsF,QAAQ4yB,yBAzCwB,GA2CtD,EAAGT,cACD,EAAGL,WACH,EAAWe,2BACXn4B,KAAKsF,QAAQ8yB,iBAAb,IAIJp4B,KAAKuc,SAASrb,KAAK,CACjB6H,KAAK,EACL9K,MAAO,EAAQA,MACfU,OAAQ,EAAQA,OAChBsB,KAAM,EAAQA,KACdszB,OAAO,IAETvzB,KAAKoE,QAAL,MAII,aAAa,GAAQ,MACrB,EAAKpE,KAAKsF,QAAQC,GAElB,EAAa,EAAG6wB,gBACtB,IAAK,EAGH,MAAM,IAAI9oB,MAAM,eAGlB,EAAG6pB,YAAY,EAAGC,WAAlB,GACA,EAAGC,WACD,EAAGD,WACH,EACA,EAAGE,KACH,EAAItI,SAAS/wB,MACb,EAAI+wB,SAASrwB,OACb,EACA,EAAG24B,KACH,EAAGC,cACH,EAAIvI,SAAS/uB,MAEf,EAAGu3B,eAAe,EAAGJ,YACrB,EAAGK,cAAc,EAAGL,WAAY,EAAGY,mBAAoB,EAAGC,QAC1D,EAAGR,cACD,EAAGL,WACH,EAAGS,mBACH,EAAGC,sBAGL93B,KAAKgvB,SAAW,CACd/uB,KAAM,EAAI+uB,SAAS/uB,KACnBszB,OAAO,GAIX,KAAK,EAAL,GACE,GAAKvzB,KAAK05B,KAAQ15B,KAAKgvB,SAAvB,OAIM,EAAKhvB,KAAKsF,QAAQC,GAClB,EAASvF,KAAKi2B,OAEpB,EAAO/C,WAAP,GAEA,EAAO7tB,yBACP,EAAOmzB,mBAEP,EAAOC,cAAP,EAAyB,EAAOvI,YAChC,EAAOwI,oBAAP,EAA+B,EAAO9I,kBAEtC,EAAGyG,WAAW,EAAGC,aAAct2B,KAAKoB,QACpC,EAAOi3B,oBAAP,GACA,EAAOC,wBAAP,GAEA,EAAOC,WAAP,EAAsB,GACtB,EAAO4B,YAAP,EAAuB,GAEvB,EAAGC,cAAc,EAAGC,UACpB,EAAGlD,YAAY,EAAGC,WAAYp3B,KAAKgvB,SAASuE,QAE5C,EAAG6G,cAAc,EAAGE,UAzBpB,MA2BM,EAAiB,GACjB,EAAsB,GAC5B,IAAK,IAAI,EAAI,EAAG,EAAI,EAASh2B,SAAU,EAAG,CACxC,MAAM,EAAI,KACV,GAAI,EAAE2X,MACJ,GACG,EAAE2S,YACH,EAAEA,YAAc,EAAA2L,WAAWC,QAC3B,EAAE5L,YAAc,EAAA2L,WAAWE,MAclB,EAAE7L,WAAc,EAAA2L,WAAWG,SACpC,EAAoBx5B,KAApB,OAdA,CACA,GAAmB,MAAf,EAAE+a,MAAM,GAAY,CAEtB,GADcjc,KAAKy5B,UAAU3a,OAAO6b,SAAS,EAAE1e,MAAM2e,OAAO,KAClDd,cAAe,CACvB,EAAoB54B,KAApB,GACA,eAEG,IAA+B,EAA3B,EAAE+a,MAAMC,QAAQ,QAAc,CACvC,EAAoBhb,KAApB,GACA,SAGF,EAAeA,KAAf,IASN,EAAO25B,WAAP,EAAsB,GACtB76B,KAAK86B,mBACL96B,KAAK+6B,qBAAL,KAEI,EAAoBz2B,SACtB,EAAG02B,WAAH,GACAh7B,KAAKi7B,0BAAL,KACA,EAAGD,WAAH,KAII,mBAAgB,MAChB,EAAQh7B,KAAKy5B,UAAU3a,OAAO,GAC9B,EAAK9e,KAAKsF,QAAQC,GAExB,EAAAsqB,KAAKQ,SAASrwB,KAAKw5B,aACnBx5B,KAAKi2B,OAAOiF,eAAZ12B,EAA+BxE,KAAKw5B,aAEpC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMrN,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAO,EAAM6nB,MAAN,GACb,EAAGgL,YAAY,EAAGC,WAAYp3B,KAAKuc,SAAS,EAAKqP,cAAc2H,QAC/D,EAAG4H,WAAW,EAAGvC,UAAW,EAAKz4B,OAAS,EAAG,EAAKmE,OAAS,IAIvD,qBAAqB,EAArB,GAAoD,MACpD,EAAKtE,KAAKsF,QAAQC,GAClB,EAASvF,KAAKi2B,OACd,EAAMj2B,KAAKw5B,YAEjB,IAAK,IAAI,EAAI,EAAG,EAAI,EAASl1B,SAAU,EAAG,CAAC,MACnC,EAAS,KACT,EAAaq2B,SAAS,EAAO1e,MAAM2e,OAAO,IAC1C,EAAQ56B,KAAKy5B,UAAU3a,OAAf,GACd,KAAW,CAAC,MACJ,EAAS,EAAOsc,QAAU,CAAC,EAAG,EAAG,GACjC,EAAS,EAAOnyB,OAClB,EAAAknB,KAAKkL,WACH,EAAOpyB,OAAO,GACd,EAAOA,OAAO,GACd,EAAOA,OAAO,IAEhB,EAAAknB,KAAK9S,SACT,EAAA8S,KAAKmL,IAAL,IAAyB,EAAMryB,QAG/B,EAAA4mB,KAAKQ,SAAL,GACA,EAAAR,KAAKW,UAAL,OAEA,EAAAX,KAAKU,QAAL,IAAwB,EAAO,GAAP,EAAuB,KAC/C,EAAAV,KAAKS,QACHtwB,KAAKw5B,YACLx5B,KAAKw5B,YACJ,EAAO,GAAP,EAAuB,KAE1B,EAAO0B,eAAP,EAA0Bl7B,KAAKw5B,aAE/B,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMrN,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAO,EAAM6nB,MAAN,GACb,EAAGgL,YAAY,EAAGC,WAAYp3B,KAAKuc,SAAS,EAAKqP,cAAc2H,QAC/D,EAAG4H,WAAW,EAAGvC,UAAW,EAAKz4B,OAAS,EAAG,EAAKmE,OAAS,SAExD,IAAoC,EAAhC,EAAO2X,MAAMC,QAAQ,QAAc,CAAC,MACvC1X,EAAUxE,KAAKuc,SAASvT,KAAK,GAAK,EAAED,OAAS,EAAOkT,OACpD,EAASjc,KAAKoE,QAAQ,EAAO6X,OACnC,GAAIzX,GAAA,EAAmB,CAAC,MAChB,EAAS,EAAOyE,OAClB,EAAAknB,KAAKkL,WACH,EAAOpyB,OAAO,GACd,EAAOA,OAAO,GACd,EAAOA,OAAO,IAEhB,EAAAknB,KAAK9S,SACH,EAAQ,EAAA8S,KAAKkL,WAAW72B,EAAQvG,MAAO,EAAGuG,EAAQ7F,QAClD,EAAS,EAAOy8B,OAClB,EAAAjL,KAAKkL,WACH,EAAOD,OAAO,GACd,EAAOA,OAAO,GACd,EAAOA,OAAO,IAEhB,EAAAjL,KAAK9S,SAMT,OALA,EAAA8S,KAAKoL,MAAL,IAAyB,EAAOA,OAAS,GAEzC,EAAA1L,KAAKQ,SAAL,GACA,EAAAR,KAAKW,UAAL,OAEQ,EAAOrjB,OAAOhB,MACpB,KAAK,EAAA0K,WAAWL,oBAKhB,KAAK,EAAAK,WAAWJ,eAEd,EAAAoZ,KAAKU,QAAL,IAAuB,EAAOrnB,SAAS,GAAK,EAAU,GACtD,MAEF,KAAK,EAAA2N,WAAWH,YACd,EAAAmZ,KAAKU,QAAL,IAGE,EACE,EAAO,GAAK,EAAOvyB,SAAS,GAC5B,EAAO,GAAK,EAAOA,SAAS,IAE5B,EAAU,GAEd,EAAA6xB,KAAKS,QAAL,IAGE,EACE,EAAOtyB,SAAS,GAAK,EAAO,GAC5B,EACE,EAAS,EAAOA,SAAS,GAAK,EAAO,GAAI,GACvC,EAAS,EAAOA,SAAS,GAAK,EAAO,GAAI,MAKjD,MAEF,KAAK,EAAA6Y,WAAWF,SACd,EAAAkZ,KAAK2L,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,EAAA3L,KAAKU,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,EAAAV,KAAKS,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAM,EAAU,GAC/D,MAEF,KAAK,EAAAzZ,WAAWD,qBACd,EAAAiZ,KAAK2L,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,EAAA3L,KAAKU,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,MAEF,QACE,MAAM,IAAIjjB,MAAM,uBASpB,OALA,EAAAuiB,KAAK0L,MAAL,OACA,EAAOL,eAAP,KACA,EAAOL,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAE/B,EAAOC,YAAc,EAAA2L,WAAWC,QAEjD,KAAK,EAAAD,WAAWC,OACd,EAAOK,WAAP,EAAsB,GACtB,EAAG1D,YAAY,EAAGC,WAAY5yB,EAAQ+uB,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,MAEF,KAAK,EAAAo6B,WAAWkB,MAYhB,KAAK,EAAAlB,WAAWmB,QACd,EAAOb,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY5yB,EAAQ+uB,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,MAEF,KAAK,EAAAo6B,WAAWoB,KAEd,EAAGnG,UAAU,EAAGC,UAAW,EAAGmG,WAC9B,EAAOf,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY5yB,EAAQ+uB,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,EAAGq1B,UAAU,EAAGC,UAAW,EAAGC,qBAC9B,MAEF,KAAK,EAAA6E,WAAWE,MAEd,EAAOI,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY5yB,EAAQ+uB,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,MAEF,KAAK,EAAAo6B,WAAWG,SACd,EAAGlF,UAAU,EAAGC,UAAW,EAAGmG,WAC9B,EAAOf,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY5yB,EAAQ+uB,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,EAAGq1B,UAAU,EAAGC,UAAW,EAAGC,yBASlC,0BAA0Bj4B,EAA1B,GAAyD,MACzD,EAAKuC,KAAKsF,QAAQC,GAClB,EAASvF,KAAKi2B,OACd,EAAMj2B,KAAKw5B,YAGX,EAGA/7B,EACHsG,IAAI,CAAC,EAAD,MACH2I,MAAM,EACNmvB,SAAU,EAAA1L,KAAK2L,KAAK,EAAO99B,SAAU,EAAEiL,QAAU,CAAC,EAAG,EAAG,OAEzD8wB,KAAK,CAAC,EAAD,IAAU,EAAE8B,SAAW,EAAEA,UAEjC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAgBv3B,SAAU,EAAG,CAAC,MAC1C,EAAS7G,EAAS,KAAmBiP,OAErC,EAAaiuB,SAAS,EAAO1e,MAAM2e,OAAO,IAC1C,EAAQ56B,KAAKy5B,UAAU3a,OAAf,GACd,KAAW,CAAC,MACJ,EAAS,EAAOsc,QAAU,CAAC,EAAG,EAAG,GACjC,EAAS,EAAOnyB,QAAU,CAAC,EAAG,EAAG,GAkBvC,OAjBA,EAAO,IAAM,EAAMA,OAAO,GAC1B,EAAO,IAAM,EAAMA,OAAO,GAC1B,EAAO,IAAM,EAAMA,OAAO,GAG1B,EAAA4mB,KAAKQ,SAAL,GACA,EAAAR,KAAKW,UAAL,OACA,EAAAX,KAAKU,QAAL,IAAwB,EAAO,GAAP,EAAuB,KAE/C,EAAAV,KAAKS,QACHtwB,KAAKw5B,YACLx5B,KAAKw5B,YACJ,EAAO,GAAP,EAAuB,KAE1B,EAAO0B,eAAP,EAA0Bl7B,KAAKw5B,aAEZ,EAAO5K,YAAc,EAAA2L,WAAWC,QAEjD,KAAK,EAAAD,WAAWC,OACd,EAAOK,WAAP,EAAsB,GACtB,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM1O,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAO,EAAM6nB,MAAN,GACb,EAAGgL,YACD,EAAGC,WACHp3B,KAAKuc,SAAS,EAAKqP,cAAc2H,QAEnC,EAAG4H,WAAW,EAAGvC,UAAW,EAAKz4B,OAAS,EAAG,EAAKmE,OAAS,GAE7D,MAEF,KAAK,EAAAi2B,WAAWkB,MAahB,KAAK,EAAAlB,WAAWmB,QAYhB,KAAK,EAAAnB,WAAWoB,KAahB,KAAK,EAAApB,WAAWE,MAEd,EAAOI,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMxC,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAO,EAAM6nB,MAAN,GACb,EAAGgL,YACD,EAAGC,WACHp3B,KAAKuc,SAAS,EAAKqP,cAAc2H,QAEnC,EAAG4H,WAAW,EAAGvC,UAAW,EAAKz4B,OAAS,EAAG,EAAKmE,OAAS,GAE7D,MAEF,KAAK,EAAAi2B,WAAWG,SACd,EAAGlF,UAAU,EAAGC,UAAW,EAAGmG,WAC9B,EAAOf,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,IAAK,IAAI,EAAI,EAAG,EAAI,EAAMxC,MAAM7nB,SAAU,EAAG,CAC3C,MAAM,EAAO,EAAM6nB,MAAN,GACb,EAAGgL,YACD,EAAGC,WACHp3B,KAAKuc,SAAS,EAAKqP,cAAc2H,QAEnC,EAAG4H,WAAW,EAAGvC,UAAW,EAAKz4B,OAAS,EAAG,EAAKmE,OAAS,GAE7D,EAAGkxB,UAAU,EAAGC,UAAW,EAAGC,2BAI7B,IAAoC,EAAhC,EAAOzZ,MAAMC,QAAQ,QAAc,CAAC,MACvC,EAAUlc,KAAKuc,SAASvT,KAAK,GAAK,EAAED,OAAS,EAAOkT,OACpD,EAASjc,KAAKoE,QAAQ,EAAO6X,OACnC,GAAI,KAAmB,CAAC,MAChB,EAAS,EAAOhT,OAClB,EAAAknB,KAAKkL,WACH,EAAOpyB,OAAO,GACd,EAAOA,OAAO,GACd,EAAOA,OAAO,IAEhB,EAAAknB,KAAK9S,SACH,EAAQ,EAAA8S,KAAKkL,WAAW,EAAQp9B,MAAO,EAAG,EAAQU,QAClD,EAAS,EAAOy8B,OAClB,EAAAjL,KAAKkL,WACH,EAAOD,OAAO,GACd,EAAOA,OAAO,GACd,EAAOA,OAAO,IAEhB,EAAAjL,KAAK9S,SAMT,OALA,EAAA8S,KAAKoL,MAAL,IAAyB,EAAOA,OAAS,GAEzC,EAAA1L,KAAKQ,SAAL,GACA,EAAAR,KAAKW,UAAL,IAAAuL,GAEQ,EAAO5uB,OAAOhB,MACpB,KAAK,EAAA0K,WAAWL,oBAKhB,KAAK,EAAAK,WAAWJ,eAEd,EAAAoZ,KAAKU,QAAL,IAAuB,EAAOrnB,SAAS,GAAK,EAAU,GACtD,MAEF,KAAK,EAAA2N,WAAWH,YACd,EAAAmZ,KAAKU,QAAL,IAGE,EACE,EAAO,GAAK,EAAOvyB,SAAS,GAC5B,EAAO,GAAK,EAAOA,SAAS,IAE5B,EAAU,GAEd,EAAA6xB,KAAKS,QAAL,IAGE,EACE,EAAOtyB,SAAS,GAAK,EAAO,GAC5B,EACE,EAAS,EAAOA,SAAS,GAAK,EAAO,GAAI,GACvC,EAAS,EAAOA,SAAS,GAAK,EAAO,GAAI,MAKjD,MAEF,KAAK,EAAA6Y,WAAWF,SACd,EAAAkZ,KAAK2L,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,EAAA3L,KAAKU,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,EAAAV,KAAKS,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAM,EAAU,GAC/D,MAEF,KAAK,EAAAzZ,WAAWD,qBACd,EAAAiZ,KAAK2L,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,EAAA3L,KAAKU,QAAL,IAAwB,EAAO,GAAP,EAAuB,IAAxB,GACvB,MAEF,QACE,MAAM,IAAIjjB,MAAM,uBASpB,OALA,EAAAuiB,KAAK0L,MAAL,OACA,EAAOL,eAAP,KACA,EAAOL,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAE/B,EAAOC,YAAc,EAAA2L,WAAWC,QAEjD,KAAK,EAAAD,WAAWC,OACd,EAAOK,WAAP,EAAsB,GACtB,EAAG1D,YAAY,EAAGC,WAAY,EAAQ7D,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,MAEF,KAAK,EAAAo6B,WAAWkB,MAYhB,KAAK,EAAAlB,WAAWmB,QACd,EAAOb,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY,EAAQ7D,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,MAEF,KAAK,EAAAo6B,WAAWoB,KAEd,EAAGnG,UAAU,EAAGC,UAAW,EAAGmG,WAC9B,EAAOf,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY,EAAQ7D,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,EAAGq1B,UAAU,EAAGC,UAAW,EAAGC,qBAC9B,MAEF,KAAK,EAAA6E,WAAWE,MAEd,EAAOI,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY,EAAQ7D,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,MAEF,KAAK,EAAAo6B,WAAWG,SACd,EAAGlF,UAAU,EAAGC,UAAW,EAAGmG,WAC9B,EAAOf,WAAP,GAAuB,EAAOlM,WAAa,KAAO,KAClD,EAAGwI,YAAY,EAAGC,WAAY,EAAQ7D,QACtC,EAAG4H,WACD,EAAGvC,UACH54B,KAAKy5B,UAAU3a,OAAO9e,KAAKy5B,UAAU3a,OAAOxa,OAAS,GAAGnE,OACtD,EACF,GAEF,EAAGq1B,UAAU,EAAGC,UAAW,EAAGC,0BAp9B5C,gB,kFCxBM,EAAc,0ZAkBd,EAAY,obAsBlB,QACE,eAA4B,MAUpB,EAAU,EAAQrD,cAAc,CACpCE,gBAAgB,EAChBC,kBAAkB,EAClBW,eAZqB,CAAC,WAAY,WAAY,aAa9CE,aAZ6B,CAC7B,cACA,aACA,mBACA,UACA,WACA,aARwB,SAqBnB,IAAI,EAAJ,IAJLnY,QAAQhO,MAAM,uCACP,MAiBX,eACElN,KAAK64B,QAAU,EAAQtF,OACvBvzB,KAAK84B,UAAY,EAAQtF,WAAR,SACjBxzB,KAAK+4B,UAAY,EAAQvF,WAAR,SACjBxzB,KAAKg8B,WAAa,EAAQxI,WAAR,UAClBxzB,KAAKi8B,SAAW,EAAQxI,SAAR,YAChBzzB,KAAKg5B,QAAU,EAAQvF,SAAR,WACfzzB,KAAKi5B,cAAgB,EAAQxF,SAAR,iBACrBzzB,KAAKk5B,SAAW,EAAQzF,SAAR,QAChBzzB,KAAKk8B,UAAY,EAAQzI,SAAR,SACjBzzB,KAAKm8B,SAAW,EAAQ1I,SAAR,QAGlB,WAAW,GACT,EAAGP,WAAWlzB,KAAK64B,SAGrB,eAAe,EAAf,GACE,EAAGM,iBAAiBn5B,KAAKi8B,UAAzB,KAGF,cAAc,EAAd,GACE,EAAG9C,iBAAiBn5B,KAAKg5B,SAAzB,KAGF,oBAAoB,EAApB,GACE,EAAGG,iBAAiBn5B,KAAKi5B,eAAzB,KAGF,WAAW,EAAX,GACE,EAAGG,UAAUp5B,KAAKk5B,SAAlB,GAGF,YAAY,EAAZ,GACE,EAAGE,UAAUp5B,KAAKk8B,UAAlB,GAGF,WAAW,EAAX,GACE,EAAGE,UAAUp8B,KAAKm8B,SAAlB,GAGF,oBAAoB,GAClB,EAAG1F,wBAAwBz2B,KAAK84B,WAChC,EAAGrC,wBAAwBz2B,KAAK+4B,WAChC,EAAGtC,wBAAwBz2B,KAAKg8B,YAGlC,wBAAwB,GACtB,EAAG3C,oBAAoBr5B,KAAK84B,UAAW,EAAG,EAAGQ,OAA7C,KAAkE,GAClE,EAAGD,oBAAoBr5B,KAAK+4B,UAAW,EAAG,EAAGO,OAA7C,SACA,EAAGD,oBAAoBr5B,KAAKg8B,WAAY,EAAG,EAAG1C,OAA9C,UAtFJ,gB,4EC5BA,SAAA77B,GACE,IAAA4+B,GAAA,QACA,IAAAC,IAAA,SAFF,CAAY,EAAAC,sBAAA,EAAAA,oBAAmB,KAI/B,SAAA9+B,GACE,IAAA4+B,GAAA,QACA,IAAAC,IAAA,SAFF,CAAY,EAAAE,sBAAA,EAAAA,oBAAmB,KAI/B,SAAA/+B,GACE,IAAA4+B,GAAA,QACA,IAAAC,IAAA,SAFF,CAAY,EAAAG,oBAAA,EAAAA,kBAAiB,KAI7B,SAAAh/B,GACE,IAAAi/B,cAAA,mBACA,IAAAC,UAAA,eAFF,CAAY,EAAAC,wBAAA,EAAAA,sBAAqB,KAejC,SAAAn/B,GACE,IAAA4+B,GAAA,QACA,IAAAQ,KAAA,UACA,IAAAC,IAAA,SACA,IAAAC,cAAA,mBACA,IAAAC,cAAA,mBALF,CAAY,EAAAC,2BAAA,EAAAA,yBAAwB,KAOpC,SAAAx/B,GACE,IAAAy/B,UAAA,eACA,IAAAC,OAAA,YAFF,CAAY,EAAAC,mCAAA,EAAAA,iCAAgC,KAI5C,SAAA3/B,GACE,IAAA4/B,WAAA,gBACA,IAAAC,YAAA,iBAFF,CAAY,EAAAC,+BAAA,EAAAA,6BAA4B,KA0BxC,SAAA9/B,GACE,IAAA+/B,KAAA,UACA,IAAAC,YAAA,iBACA,IAAAC,WAAA,gBACA,IAAAC,QAAA,aACA,IAAAC,WAAA,gBACA,IAAAC,OAAA,YACA,IAAAC,YAAA,iBACA,IAAAC,UAAA,eACA,IAAAC,MAAA,WACA,IAAAC,WAAA,gBACA,IAAAC,eAAA,qBACA,IAAAC,WAAA,iBACD,IAAAC,gBAAA,sBACA,IAAAC,YAAA,kBACA,IAAAC,aAAA,mBACA,IAAAC,SAAA,eACA,IAAAC,UAAA,gBACA,IAAAC,cAAA,oBACA,IAAAC,eAAA,qBACA,IAAAC,oBAAA,0BACA,IAAAC,gBAAA,sBACA,IAAAC,YAAA,kBACA,IAAAC,gBAAA,sBACA,IAAAC,kBAAA,wBACA,IAAAC,MAAA,YACA,IAAAC,QAAA,cACA,IAAAC,QAAA,cACA,IAAAC,QAAA,cA5BD,CAAY,EAAAC,uBAAA,EAAAA,qBAAoB,KA8BhC,SAAA3hC,GACE,IAAA4hC,eAAA,oBACA,IAAAC,YAAA,iBACA,IAAAC,aAAA,kBACA,IAAAC,YAAA,iBACA,IAAAC,YAAA,kBACA,IAAAC,WAAA,iBANF,CAAY,EAAAC,2BAAA,EAAAA,yBAAwB,KAwHpC,SAAAliC,GACE,IAAAmiC,aAAA,kBACA,IAAAC,QAAA,aAFF,CAAY,EAAAC,yBAAA,EAAAA,uBAAsB,KA+ClC,SAAAriC,GACE,IAAAsiC,UAAA,eACA,IAAAC,qBAAA,0BACA,IAAAC,WAAA,gBACA,IAAAC,oBAAA,yBACA,IAAAC,MAAA,WACA,IAAAC,UAAA,eACA,IAAAC,WAAA,gBACA,IAAAC,WAAA,gBACA,IAAAC,uBAAA,6BACA,IAAAC,qBAAA,2BAVF,CAAY,EAAAC,+BAAA,EAAAA,6BAA4B,KA8CxC,SAAAhjC,GACE,IAAAoiC,QAAA,aACA,IAAAa,OAAA,YACA,IAAAC,aAAA,kBACA,IAAAC,KAAA,UACA,IAAAC,YAAA,kBACA,IAAAC,UAAA,gBACA,IAAAC,SAAA,eACA,IAAAC,UAAA,iBACA,IAAAC,QAAA,eATF,CAAY,EAAAC,oBAAA,EAAAA,kBAAiB,KAY7B,SAAAzjC,GACE,IAAA+8B,OAAA,YACA,IAAA2G,YAAA,iBACA,IAAAC,iBAAA,sBACA,IAAAC,kBAAA,uBACA,IAAAC,iBAAA,sBALF,CAAY,EAAAC,iBAAA,EAAAA,eAAc,KAQ1B,SAAA9jC,GACE,IAAA+8B,OAAA,YACD,IAAAuD,UAAA,eACC,IAAAyD,UAAA,eACA,IAAAC,cAAA,mBACA,IAAAC,cAAA,mBACA,IAAAC,aAAA,kBACD,IAAAC,aAAA,kBACC,IAAAC,gBAAA,qBACA,IAAAC,gBAAA,qBACA,IAAAC,WAAA,gBACA,IAAAC,WAAA,iBACA,IAAAC,aAAA,mBACA,IAAAC,YAAA,kBACA,IAAAC,YAAA,kBAIA,IAAAC,aAAA,mBACA,IAAAC,cAAA,oBACA,IAAAC,gBAAA,sBApBF,CAAY,EAAAC,eAAA,EAAAA,aAAY,KAuBxB,SAAA9kC,GACE,IAAA+8B,OAAA,YACA,IAAAiB,MAAA,WACA,IAAAC,QAAA,aACA,IAAAC,KAAA,UACA,IAAAlB,MAAA,WACA,IAAAC,SAAA,cANF,CAAY,EAAAH,aAAA,EAAAA,WAAU,K,MAShB,EAAoB,GAAc,EAAE7b,MAAM,KAAK3a,IAAI,GAAKuG,WAAW,IAEnE,EAmBF,CACFk4B,WAAa,IAAD,CACVhU,UAAW,aACX/R,IAAK,EAAEA,IACJiC,MAAM,KACNvC,OAAQ,GAAc,EAAE7X,QACxBP,IAAK,GAAc,EAAE/B,QAAQ,MAAO,MACvCygC,WAAY9H,SAAS,EAAE8H,YACvBpmB,QAAS,EAAEA,QACXqmB,SAAUp4B,WAAW,EAAEq4B,WAAa,KACpCr6B,QAAS,EAAEA,SAAW,GACtBjE,OAAQs2B,SAAS,EAAEt2B,SAAW,EAC9Bu+B,MAAOjI,SAAS,EAAEiI,QAAU,EAC5BrxB,WAAYjH,WAAW,EAAEu4B,aAAe,EACxCC,UAAWnI,SAAS,EAAEoI,YAAc,EACpCC,QAASrI,SAAS,EAAEsI,UAAY,EAChCC,YAAavI,SAAS,EAAEwI,cAAgB,EACxCC,UAAWzI,SAAS,EAAE0I,YAAc,IAEtCC,oBAAsB,IAAD,CACnB9U,UAAW,sBACX+U,WAAY5I,SAAS,EAAE4I,YACvBC,YAAa,EAAEA,YACfC,UAAW,EAAEA,WAAa,GAC1BC,WAAY/I,SAAS,EAAE+I,aAAe,IACtCC,WAAYhJ,SAAS,EAAEgJ,aAAe,EACtCC,UAAWjJ,SAAS,EAAEiJ,YAAc,EACpCC,kBAAmBlJ,SAAS,EAAEkJ,oBAAsB,IAEtDC,gBAAkB,IAAD,CACftV,UAAW,kBACXvlB,OAAQ,EAAiB,EAAEA,QAC3B86B,WAAY,EAAEC,WACd17B,QAAS,EAAEA,QACXmG,OAAQksB,SAAS,EAAElsB,SAAW,GAC9Bw1B,OAAQtJ,SAAS,EAAEsJ,SAAW,EAC9BC,YAAavJ,SAAS,EAAEwJ,WAAa,EACrCC,OAAQzJ,SAAS,EAAE0J,QACnBC,QAAS3J,SAAS,EAAE4J,SACpBt3B,MAAO0tB,SAAS,EAAE1tB,OAClBu3B,WAAY7J,SAAS,EAAE8J,YACvBC,OAAQ/J,SAAS,EAAEgK,QACnBC,SAAUjK,SAAS,EAAEkK,UACrBC,QAASnK,SAAS,EAAEoK,SACpBC,QAASrK,SAAS,EAAEsK,SACpBC,YAAavK,SAAS,EAAEwK,aACxBC,aAAczK,SAAS,EAAE0K,cACzBC,QAAS3K,SAAS,EAAE4K,SACpBC,WAAY7K,SAAS,EAAE4I,cAEzBkC,SAAW,IAAD,CACRjX,UAAW,WACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9BqC,WAAa,IAAD,CACVpX,UAAW,aACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9BsC,YAAc,IAAD,CACXrX,UAAW,cACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9BuC,aAAe,IAAD,CACZtX,UAAW,eACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9BwC,gBAAkB,IAAD,CACfvX,UAAW,kBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9ByC,cAAgB,IAAD,CACbxX,UAAW,gBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9B0C,cAAgB,IAAD,CACbzX,UAAW,gBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9B2C,eAAiB,IAAD,CACd1X,UAAW,iBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9B4C,aAAe,IAAD,CACZ3X,UAAW,eACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,YAAc,GAC5BpxB,MAAO+nB,SAAS,EAAE/nB,QAAU,EAC5B8yB,WAAY,EAAEC,YAAc,GAC5BH,WAAY,EAAEjC,YAAc,IAE9B6C,cAAgB,IAAD,CACb5X,UAAW,gBACXtD,OAAQ,EAAEA,OACVmb,OAAQ,EAAEA,OACVC,aAAc3L,SAAS,EAAE9L,WAAa,EACtCrN,WAAYmZ,SAAS,EAAE/L,aAAe,EACtC2X,cAAe5L,SAAS,EAAEhM,YAAc,IACxCjN,YAAa,EAAiB,EAAEoN,aAAe,SAC/C0X,eAAgB7L,SAAS,EAAE8L,kBAAoB,EAC/CC,YAAa,EAAEC,aACfnB,WAAY7K,SAAS,EAAE4I,aAAe,IAExCqD,OAAS,IAAD,CACNpY,UAAW,SACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3B2I,WAAY,EAAEC,WACd/nB,MAAO,EAAEA,MACTqF,SAAU,EAAEA,UAAY,GACxBglB,aAAc3L,SAAS,EAAE9L,WAAa,EACtCrN,WAAYmZ,SAAS,EAAE/L,aAAe,EACtC2X,cAAe5L,SAAS,EAAEhM,YAAc,IACxCjN,YAAa,EAAiB,EAAEoN,aAAe,WAEjD+X,cAAgB,IAAD,CACbrY,UAAW,gBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3B2I,WAAY,EAAEC,WACd/nB,MAAO,EAAEA,MACT6qB,UAAWnM,SAAS,EAAEmM,WAAa,MACnCR,aAAc3L,SAAS,EAAE9L,WAAa,EACtCrN,WAAYmZ,SAAS,EAAE/L,aAAe,EACtC2X,cAAe5L,SAAS,EAAEhM,YAAc,IACxCjN,YAAa,EAAiB,EAAEoN,aAAe,WAEjDiY,eAAiB,IAAD,CACdvY,UAAW,gBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3BlQ,OAAQ,EAAEA,OACV6Y,WAAY,EAAEC,WACdgD,cAAe,EAAEC,eAAiB,GAClCC,iBAAkBvM,SAAS,EAAEwM,mBAAqB,EAClDlrB,MAAO,EAAEA,MACTqF,SAAU,EAAEA,SACZglB,aAAc3L,SAAS,EAAE9L,WAAa,EACtCrN,WAAYmZ,SAAS,EAAE/L,aAAe,EACtC2X,cAAe5L,SAAS,EAAEhM,YAAc,IACxCjN,YAAa,EAAiB,EAAEoN,aAAe,WAEjDsY,iBAAmB,IAAD,CAChB5Y,UAAW,kBACXvlB,OAAQ,EAAiB,EAAEA,QAC3BmyB,OAAQ,EAAiB,EAAEA,QAC3B2I,WAAY,EAAEC,WACd/nB,MAAO,EAAEA,MACT6qB,UAAWnM,SAAS,EAAEmM,YAAc,GACpCvL,MAAOjxB,WAAW,EAAEixB,QAAU,EAC9B+K,aAAc3L,SAAS,EAAE9L,WAAa,EACtCrN,WAAYmZ,SAAS,EAAE/L,aAAe,EACtC2X,cAAe5L,SAAS,EAAEhM,YAAc,IACxCjN,YAAa,EAAiB,EAAEoN,aAAe,WAEjDuY,SAAW,IAAD,CACR7Y,UAAW,WACX8X,aAAc3L,SAAS,EAAE9L,WAAa,EACtCrN,WAAYmZ,SAAS,EAAE/L,aAAe,EACtC2X,cAAe5L,SAAS,EAAEhM,YAAc,IACxCjN,YAAa,EAAiB,EAAEoN,aAAe,SAC/CtX,OAAQlN,WAAW,EAAEg9B,SAAW,IAChCC,KAAM5M,SAAS,EAAE4M,OAAS,EAC1BC,UAAW7M,SAAS,EAAE8M,YAAc,GACpCC,eAAgB/M,SAAS,EAAEgN,iBAAmB,EAC9CzY,QAAS,EAAEA,SAAW,wBACtB0Y,cAAejN,SAAS,EAAEkN,gBAAkB,GAC5CC,UAAWnN,SAAS,EAAEmM,YAAc,EACpCiB,WAAYpN,SAAS,EAAEqN,aAAe,EACtCC,WAAYtN,SAAS,EAAEuN,aAAe,EACtCrjB,OAAQ8V,SAAS,EAAE9V,SAAW,EAC9B2gB,WAAY7K,SAAS,EAAE4I,eAyM3B,wBACE,gBACE,MAAM1pB,EAAgB,GAEtB,IAAK,IAAI,EAAI,EAAG,EAAI,EAASvV,SAAU,EAAG,CACxC,MAAM,EAAI,KAEL,EAAEkqB,WACL3U,EAAI3Y,KAAK,CACPstB,UAAW,IACXvuB,KAAK,IAIJ,EAAgB,EAAEuuB,WACrB3U,EAAI3Y,KAAM,EAAgB,EAAEstB,WAAlB,IAEV3U,EAAI3Y,KAAK,CACPstB,UAAW,IACX2Z,kBAAmB,EAAE3Z,UACrBvuB,KAAK,IAKX,OAAO4Z,K,4ECz0BE,EAAAqgB,cAAgB,CAAC,EAAD,WAMzB,MACI,EAAS9yB,SAASmB,cAAc,UAChC,EAAM,EAAO+U,WAAW,MAC9B,IAAK,EACH,MAAM,IAAIhQ,MAAM,kBAElB,EAAOrP,MAAP,EACA,EAAOU,OAAP,EAPE,MASI,EAAKyI,SAASmB,cAAc,UAC5B,EAAO,EAAG+U,WAAW,MAC3B,IAAK,EACH,MAAM,IAAIhQ,MAAM,kBAElB,EAAGrP,MAAH,EACA,EAAGU,OAAH0D,EAEA,MAAM,EAAM,EAAI+lC,gBAAJ,KACZ,IAAK,IAAI,EAAI,EAA8B,EAApB,IAAiB,EAAa,GAAK,EACxD,EAAInoC,KAAJ,GAAc,KACd,EAAIA,KAAK,EAAI,GAAK,EAAO,EAAI,GAC7B,EAAIA,KAAK,EAAI,GAAK,EAAO,EAAI,GAC7B,EAAIA,KAAK,EAAI,GAAK,EAAO,EAAI,GAM/B,OAJA,EAAIg3B,aAAJ,EAAsB,EAAG,GAEzB,EAAKC,UAAL,EAAuB,EAAG,EAA1B,EAAA70B,GAEO,IAAIlB,WAAW,EAAK61B,aAAa,EAAG,EAArB,EAAA30B,GAA6CpC,OAGxD,EAAA+5B,aAAgB,GAAgC,IAAjB,EAAK,EAAI,GAExC,EAAAC,eAAkB,MAC3B,EACF,IAAK,IAAI,EAAI,EAAO,GAAJ,EAAQ,IAAM,EAC5B,GAAS,KAEX,OAAO,EAAI,I,4ECnCb,QACS,eAAuB,OAEnB,IAAI,EADS,iBAAlB,EACgB,CAChBoO,MAAO,CACLC,KAAK,EACLC,WAAY,YACZtzB,QAAS,SACT4F,QAAS,SACT7W,SAAU,UACVK,UAAW,aAIG,CAChBgkC,MAAO,CACLC,KAAO,GAAU,EAAOD,OAAS,EAAOA,MAAMC,MAAS,GACvDC,QAAU,GAAU,EAAOF,OAAS,EAAOA,MAAME,SAAY,SAC7DtzB,KAAO,GAAU,EAAOozB,OAAS,EAAOA,MAAMpzB,MAAS,QACvD4F,KAAO,GAAU,EAAOwtB,OAAS,EAAOA,MAAMxtB,MAAS,QACvD7W,MAAQ,GAAU,EAAOqkC,OAAS,EAAOA,MAAMrkC,OAAU,SACzDK,OAAS,GAAU,EAAOgkC,OAAS,EAAOA,MAAMhkC,QAAW,aAQnE,YAAY,GACVrE,KAAKqoC,MAAK,iBAAQ,EAAOA,OAG3B,cACE,OAAOroC,KAAKqoC,MAAMC,KAEpB,iBACE,OAAOtoC,KAAKqoC,MAAME,QAEpB,cACE,OAAOvoC,KAAKqoC,MAAMpzB,KAEpB,cACE,OAAOjV,KAAKqoC,MAAMxtB,KAEpB,eACE,OAAO7a,KAAKqoC,MAAMrkC,MAEpB,gBACE,OAAOhE,KAAKqoC,MAAMhkC,QAjDtB,Y,oFCTA,OAEA,QAEA,wBAIE,YAAY,EAAZ,GACErE,KAAK4I,KAAL,EACA5I,KAAKwoC,SAALhkC,EAGF,cACE,OAAOxE,KAAKwoC,SAGd,OACEl8B,EAAAm8B,OAAO,IAAC,EAAAC,KAAI,CAAC9/B,KAAM5I,KAAK4I,KAAM6Q,KAAMzZ,KAAKwoC,WAAcxoC,KAAKwoC,a,oFClBhE,OACA,QACA9qC,EAAA,MACA,QACA,QACA,OACA,QAeA,qBAA0B,EAAAqa,UAIxB,YAAY,GACVnV,MAAM,GAJA,KAAA+lC,KAA8B,KAC9B,KAAArE,QAAe,EAoEvB,KAAAsE,oBAAsB,KAElB5oC,KAAKiY,MAAMrP,KAAKzF,gBADdiE,SAASyhC,qBAAuB7oC,KAAKiY,MAAMwB,OAOjD,KAAAqvB,cAAiB,IACf,EAAE7hC,kBAGJ,KAAA8hC,cAAgB,KACd/oC,KAAKqY,SAAS,CAAE2wB,UAAS,KAG3B,KAAAC,YAAe,IACb,EAAEC,kBACFlpC,KAAKqY,SAAS,CAAE2wB,UAAS,IACzBhpC,KAAKmpC,aAGP,KAAAC,UAAa,IACX,GAAKppC,KAAKuY,MAAMywB,SAAhB,CAIA,MAAM,EAAOhpC,KAAKiY,MAAMrP,KAExB,OAAQ,EAAE5B,OACR,KAAK,GAEC,EAAAsS,WAAWD,iBACb,EAAAC,WAAWC,OAEX,EAAAD,WAAWE,MAAMxZ,KAAKiY,MAAMwB,MAE9BzZ,KAAKmpC,YACL,MAGF,KAAK,GAEH,EAAK7hC,YAAY+hC,aACjBrpC,KAAKmpC,YACL,MAGF,KAAK,GAEH,EAAK7hC,YAAYiE,UAAU,EAAKjE,YAAYgE,YAAc,KAC1DtL,KAAKmpC,YACL,MAEF,KAAK,GAEH,EAAK7hC,YAAYiE,UAAU,EAAKjE,YAAYgE,YAAc,KAC1DtL,KAAKmpC,YACL,MAGF,KAAK,GACL,KAAK,GAEH,EAAKnhC,OAAO3H,KAAK,EAAK2H,OAAOssB,YAAc,GAC3Ct0B,KAAKmpC,YACL,MAEF,KAAK,GACL,KAAK,GAEH,EAAKnhC,OAAO3H,KAAK,EAAK2H,OAAOssB,YAAc,GAC3Ct0B,KAAKmpC,YACL,MAGF,KAAK,GACL,KAAK,GAEH,GAAInpC,KAAKiY,MAAMrP,KAAKb,OAAS,EAAArF,WAAWD,OACtC,QAGG,EAAKuF,OAAOwsB,WAAa,EAAKxsB,OAAOlF,SACxC,EAAKkF,OAAO4sB,OAEZ,EAAK5sB,OAAOkQ,WAOpB,KAAAoxB,aAAe,KACbtpC,KAAKupC,eAGP,KAAAC,YAAc,KACZxpC,KAAKqY,SAAS,CAAEyC,WAAU,KAG5B,KAAA2uB,UAAY,KACVzpC,KAAKqY,SAAS,CAAEyC,WAAU,KAG5B,KAAA4uB,cAAiB,IACf1pC,KAAKqY,SAAS,CAAEnV,MAAA,KAGlB,KAAAymC,aAAe,KACb3pC,KAAKqY,SAAS,CAAEuxB,aAAY,IAC5B5pC,KAAKmpC,aAGP,KAAA1iC,YAAc,KACRzG,KAAKuY,MAAMqxB,cAAgB,EAAAtwB,WAAWD,kBACxCrZ,KAAKmpC,aAIT,KAAAU,aAAe,KACb7pC,KAAKqY,SAAS,CACZuxB,aAAY,EACZE,WAAU,IAGZC,aAAa/pC,KAAKskC,SAClBtkC,KAAKskC,QAAU,GAGjB,KAAA6E,UAAY,KACLnpC,KAAKuY,MAAMuxB,WACd9pC,KAAKqY,SAAS,CAAEyxB,WAAU,IAG5BC,aAAa/pC,KAAKskC,SAClBtkC,KAAKskC,QAAU0F,WAAW,KACxBhqC,KAAKqY,SAAS,CAAEyxB,WAAU,IAC1B9pC,KAAKskC,QAAU,GACd,MAGL,KAAA2F,cAAgB,KACd,OAAQjqC,KAAKiY,MAAMrP,KAAKb,MACtB,KAAK,EAAArF,WAAWD,OAAQ,CACtB,MAAM,EAASzC,KAAKiY,MAAMrP,KAAKZ,QAC1B,EAAOwsB,WAAa,EAAO1xB,SAC9B,EAAO8xB,OAEP,EAAO1c,QAET,MAGF,KAAK,EAAAxV,WAAWF,KACdxC,KAAKiY,MAAMwB,KAAKywB,uBAOtB,KAAAC,iBAAmB,KACb,EAAA7wB,WAAWD,iBACb,EAAAC,WAAWC,OAEX,EAAAD,WAAWE,MAAMxZ,KAAKiY,MAAMwB,OArO9BzZ,KAAKuY,MAAQ,CACXrV,MAAO,EAAM0F,KAAK1F,MAClB8lC,UAAS,EACTluB,WAAU,EACV8uB,aAAY,EACZE,WAAU,GAId,oBACE,GAAK9pC,KAAK2oC,KAAV,OAIM,EAAO3oC,KAAKiY,MAAMrP,KAClB,EAAO5I,KAAKiY,MAAMwB,KAExBzZ,KAAK2oC,KAAKyB,YAAY,EAAKC,aAE3B,EAAKC,GAAG,YAAatqC,KAAKwpC,aAC1B,EAAKc,GAAG,OAAQtqC,KAAKypC,WACrB,EAAKa,GAAG,aAActqC,KAAKspC,cAC3B,EAAKgB,GAAG,cAAetqC,KAAK0pC,eAE5B,EAAK/hC,iBAAiB,QAAS3H,KAAKipC,aACpCrhC,OAAOD,iBAAiB,QAAS3H,KAAK+oC,eACtCnhC,OAAOD,iBAAiB,UAAW3H,KAAKopC,WACxChiC,SAASO,iBACP,oBACA3H,KAAK4oC,qBAFP,GAMA,EAAKjhC,iBAAiB,YAAa3H,KAAK2pC,cACxC,EAAKhiC,iBAAiB,YAAa3H,KAAKyG,aACxC,EAAKkB,iBAAiB,WAAY3H,KAAK6pC,cACvC,EAAKliC,iBAAiB,cAAe3H,KAAK8oC,gBAG5C,uBAAoB,MACZ,EAAO9oC,KAAKiY,MAAMrP,KAClB,EAAO5I,KAAKiY,MAAMwB,KAExB,EAAK8wB,IAAI,YAAavqC,KAAKwpC,aAC3B,EAAKe,IAAI,OAAQvqC,KAAKypC,WACtB,EAAKc,IAAI,aAAcvqC,KAAKspC,cAC5B,EAAKiB,IAAI,cAAevqC,KAAK0pC,eAE7B,EAAKhgC,oBAAoB,QAAS1J,KAAKipC,aACvCrhC,OAAO8B,oBAAoB,QAAS1J,KAAK+oC,eACzCnhC,OAAO8B,oBAAoB,UAAW1J,KAAKopC,WAC3ChiC,SAASsC,oBACP,oBACA1J,KAAK4oC,qBAFP,GAMA,EAAKl/B,oBAAoB,YAAa1J,KAAK2pC,cAC3C,EAAKjgC,oBAAoB,YAAa1J,KAAKyG,aAC3C,EAAKiD,oBAAoB,WAAY1J,KAAK6pC,cAC1C,EAAKngC,oBAAoB,cAAe1J,KAAK8oC,eA6K/C,SAAM,MACE,EAAO9oC,KAAKiY,MAAMrP,KAClB,EAAY5I,KAAKuY,MAAMuxB,UAE7B,OACE,WAAKtxB,MAAO,EAAY,YAAEgyB,YAAc,YAAE/wB,MACxC,WAAKjB,MAAO,EAAY,YAAEiyB,aAAe,YAAEvnC,OACxClD,KAAKuY,MAAMrV,OAGd,IAAC,EAAAuX,QAAO,CAAC7R,KAAA,EAAY8hC,QAAS1qC,KAAKuY,MAAMuC,YAEzC,WACEtC,MAAO,YAAEmyB,OACTC,IAAK,GAAS5qC,KAAK2oC,KAAL,EACdhwB,QAAS3Y,KAAKiqC,cACdY,WAAY7qC,KAAKmqC,mBAGlB,EAAKpiC,OAAS,EAAArF,WAAWF,KACxB,IAAC,EAAAsoC,SAAQ,CACPtyB,MAAO,EAAY,YAAE/Z,gBAAkB,YAAEX,SACzC8K,KAAA,EACA6Q,KAAMzZ,KAAKiY,MAAMwB,OAGnB,IAAC,EAAAsxB,WAAU,CACTvyB,MAAO,EAAY,YAAE/Z,gBAAkB,YAAEX,SACzC8K,KAAA,EACA6Q,KAAMzZ,KAAKiY,MAAMwB,KACjBixB,QAAS1qC,KAAKuY,MAAMqxB,kB,oFCnShC,OAGAlsC,EAAA,MAgBM,EAAgD,CACpDkG,OAAQ,SACR81B,IAAK,MACL9sB,MAAO,SACPo+B,IAAK,SACLC,OAAQ,UACRxuB,IAAK,QAGP,wBAA6B,EAAA1E,UAA7B,c,oBACE,KAAAQ,MAAsB,CACpB2yB,MAAO,IAmBT,KAAAC,WAAc,IACZ,MAAM,EAAQnrC,KAAKuY,MAAM2yB,MAAM,EAAK/+B,MAAQnM,KAAKuY,MAAM2yB,MAAM,EAAK/+B,MAAQ,GAE1E,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM7H,SAAU,EAClC,GAAI,SACF,OAIJ,EAAMpD,KAAK,CACT6H,KAAM,EAAKA,KACX6R,SAAU,IAGZ5a,KAAKqY,SAAS,CACZ6yB,MAAK,iBACAlrC,KAAKuY,MAAM2yB,MAAK,CACnB,CAAC,EAAK/+B,MAAN,OAKN,KAAAi/B,eAAkB,IAChB,GAAKprC,KAAKuY,MAAM2yB,MAAM,EAAK/+B,MAA3B,CAIA,MAAM,EAAQnM,KAAKuY,MAAM2yB,MAAM,EAAK/+B,MAEpC,IAAK,IAAI,EAAI,EAAG,EAAI,EAAM7H,SAAU,EAClC,GAAI,KAASyE,OAAS,EAAKA,KAAM,CAC/B,KAAS6R,SAAW,EAAKA,SACzB,MAIJ5a,KAAKupC,gBApDP,oBACE,MAAM,EAASvpC,KAAKiY,MAAMrP,KAAKnB,OAC/B,EAAOE,iBAAiB,YAAclK,IACpCuC,KAAKmrC,WAAW1tC,EAAMkH,OAAOC,QAE/B,EAAO+C,iBAAiB,WAAalK,IACnCuC,KAAKorC,eAAe3tC,EAAMkH,OAAOC,QAIrC,uBACE,MAAM,EAAS5E,KAAKiY,MAAMrP,KAAKnB,OAC/B,EAAOiC,oBAAoB,YAAa1J,KAAKmrC,YAC7C,EAAOzhC,oBAAoB,WAAY1J,KAAKorC,gBA0C9C,WAAW,EAAX,GACE,EAAO,KACP,MAAM,EAAS,EAAsB,IAAX,GAAkB,IAE5C,IAAI,EAAS,GAAK,EAAK9mC,OAAS,EAAOA,OAOvC,OANa,EAAT,IACF,EAAS,EAAI,EAAOA,WAKZ,IAFG+mC,MAAM,GAAQ39B,KAAK,OAEzB,IAGT,SACE,OACE,WAAK8K,MAAOxY,KAAKiY,MAAMyyB,QAAU,eAAEY,QAAU,eAAEC,eAC7C,WAAK/yB,MAAO,eAAEgzB,SACZ,WACE5yB,MAAM,6BACNsF,EAAE,MACFC,EAAE,MACFlgB,MAAM,OACNU,OAAO,OACPka,QAAQ,YACR4yB,SAAS,YAET,YACE3yB,KAAK,UACL7a,MAAM,OACN8a,EAAE,oLAKR,UAAIP,MAAO,eAAEkzB,KACVppC,OAAO6B,QAAQnE,KAAKuY,MAAM2yB,OAAOnnC,IAAI,EAAE,EAAD,KACrC,UAAI4nC,IAAA,EAAWnzB,MAAO,eAAEozB,SACrB5rC,KAAK6rC,WAAL,EAEC,EAAMC,OAAO,CAAC,EAAD,IAAe,EAAO,EAAIlxB,SAAU,GAC/C,EAAMtW,e,oFCjIxB,OAWa,EAAAynC,aAAe,EAAAluC,WAAW,CACrCytC,QAAO,iBAVY,CACnBttC,SAAU,WACVC,MAAO,OACPU,OAAQ,OACRJ,QAAS,EACTC,WAAY,qCACZT,OAAQ,KAORwtC,cAAa,iBAbM,CACnBvtC,SAAU,WACVC,MAAO,OACPU,OAAQ,OACRJ,QAAS,EACTC,WAAY,qCACZT,OAAQ,IAQW,CACjBQ,QAAS,EACTD,WAAY,OACZP,OAAQ,IAEVytC,QAAS,CACPxtC,SAAU,WACVkB,KAAM,MACN8sC,IAAK,MACLC,WAAY,QACZC,UAAW,QACX34B,UAAW,+BACX5U,OAAQ,OACRV,MAAO,OACPkuC,cAAe,EAAAC,UAAU,CACvBC,KAAM,CAAEC,UAAW,gBACnBC,GAAI,CAAED,UAAW,qBAGrBZ,IAAK,CACH1tC,SAAU,WACVwuC,WAAY,kBACZruC,QAAS,OACTsuC,WAAY,YACZC,OAAQ,IACRV,IAAK,OACL3sC,MAAO,EACPstC,YAAa,OACbC,UAAW,QAEbhB,QAAS,CACPhtC,QAAS,Y,YCpCb,SAAS,IACT,mDAEA,SAAS,IACT,qDAsBA,SAAS0N,EAAT,GACA,kBAEA,uBAGA,2BAEA,OADC,EAAD,WACA,gBAEA,IAEA,cACK,SACL,IAEA,wBACS,SAET,0BAsCA,SAAS,IACT,OAGA,KACA,SACA,cAEA,KAEA,UACA,KAIA,SAAS,IACT,OAGA,WACA,KAJA,IAMA,eANA,GAOA,KACA,IACA,OACA,KAHA,GAKA,WAGA,KACA,WAEA,OACA,KAnEA,YACA,oBAEA,uBAGA,6BAEA,OADC,EAAD,aACA,gBAEA,IAEA,KACK,SACL,IAEA,sBACS,SAGT,wBAgDA,KAiBA,SAAS,EAAT,KACA,WACA,aAYA,SAAS,K,IAzJT,EACA,EARA,gBAgBA,WACA,MACA,8BACA,WAFA,EAMK,SACL,IAEA,MACA,gCACA,aAFA,EAMK,SACL,KAjBA,G,IA0EA,EAFA,KACA,KAEA,KAyCA,uBACA,gCACA,sBACA,YAAuB,mBAAsB,IAC7C,oBAGA,mBACA,iBACA,MASA,2BACA,iCAEA,kBACA,aACA,SACA,UACA,aACA,cAIA,OACA,gBACA,SACA,QACA,mBACA,uBACA,SACA,oBACA,wBAEA,uBAAqC,UAErC,qBACA,qDAGA,iBAA2B,WAC3B,mBACA,mDAEA,mBAA4B,W,oFCvL5B,OACA,OAEA5O,EAAA,MACA,OACA,QACA,QAEA,oBAAAD,GACE,OACE,WAAK+a,MAAO,EAAAE,QAAQ,EAAMF,MAAO,gBAAE1a,WACjC,WAAK0a,MAAO,gBAAG9Z,SACb,WAAK8Z,MAAO,gBAAGtZ,OACf,WAAKsZ,MAAO,gBAAGnZ,OACb,IAAC,EAAAwtC,eAAc,CAACjkC,KAAM,EAAMA,OAC5B,IAAC,EAAAkkC,iBAAgB,CAACC,QAAA,EAAetzB,KAAM,EAAMA,Y,8ECfvD,aAEa,EAAAuzB,cAAgB,EAAAnvC,WAAW,CACtCC,SAAU,CACRa,OAAQ,W,oFCJZ,OA4Ba,EAAAsuC,oBAAsB,EAAApvC,WAAW,CAC5C4a,SAAU,CACRza,SAAU,YAEZib,KAAI,iBA9BY,CAChBra,QAAS,OACTZ,SAAU,WACVkB,KAAM,QACNhB,OAAQ,OACRC,QAAS,UACT+uC,SAAU,OACV7uC,gBAAiB,qBACjB8uC,SAAU,SACVC,SAAU,UAwBVp0B,SAAQ,iBAjCQ,CAChBpa,QAAS,OACTZ,SAAU,WACVkB,KAAM,QACNhB,OAAQ,OACRC,QAAS,UACT+uC,SAAU,OACV7uC,gBAAiB,qBACjB8uC,SAAU,SACVC,SAAU,SAyBM,CACdxuC,QAAS,SAEXsa,cAAe,CACb/a,QAAS,UACTkvC,aAAc,kBACdC,WAAY,QAEdl0B,SAAQ,iBA9BY,CACpBna,OAAQ,UACRytC,OAAQ,QACRvuC,QAAS,MACTgB,MAAO,CACL,eAAgB,CACd+sC,UAAW,GAEb,UAAW,CACT7tC,gBAAiB,+BAwBrB8a,iBAAgB,iBAjCI,CACpBla,OAAQ,UACRytC,OAAQ,QACRvuC,QAAS,MACTgB,MAAO,CACL,eAAgB,CACd+sC,UAAW,GAEb,UAAW,CACT7tC,gBAAiB,8BAyBD,CAClBA,gBAAiB,wCAEnBW,OAAQ,CACNf,MAAO,OACPU,OAAQ,OACRR,QAAS,U,8ECtDb,aAEa,EAAAovC,sBAAwB,EAAA1vC,WAAW,CAC9CmB,OAAQ,CACNf,MAAO,OACPmvC,SAAU,OACVzuC,OAAQ,OACRR,QAAS,U,oFCPb,OACA,QAEAT,EAAA,MACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,OASA,2BAAgC,EAAAqa,UAAhC,c,oBAaE,KAAAy1B,YAAc,KACZxtC,KAAKiY,MAAMrP,KAAKZ,OAAO4sB,QAGzB,KAAA6Y,aAAe,KACbztC,KAAKiY,MAAMrP,KAAKZ,OAAOkQ,SAGzB,KAAAw1B,YAAc,KACZ1tC,KAAKiY,MAAMrP,KAAKZ,OAAO2lC,aAGzB,KAAAC,UAAY,KACV5tC,KAAKiY,MAAMrP,KAAKZ,OAAO6lC,WAGzB,KAAAC,cAAgB,KACd9tC,KAAKiY,MAAMrP,KAAKtB,YAAY+hC,cAG9B,KAAA0E,kBAAoB,KAClB/tC,KAAKupC,eAjCP,oBACEvpC,KAAKiY,MAAMrP,KAAKZ,OAAOsiC,GAAG,OAAQtqC,KAAK+tC,mBACvC/tC,KAAKiY,MAAMrP,KAAKZ,OAAOsiC,GAAG,QAAStqC,KAAK+tC,mBACxC/tC,KAAKiY,MAAMrP,KAAKZ,OAAOsiC,GAAG,OAAQtqC,KAAK+tC,mBAGzC,uBACE/tC,KAAKiY,MAAMrP,KAAKZ,OAAOuiC,IAAI,OAAQvqC,KAAK+tC,mBACxC/tC,KAAKiY,MAAMrP,KAAKZ,OAAOuiC,IAAI,QAASvqC,KAAK+tC,mBACzC/tC,KAAKiY,MAAMrP,KAAKZ,OAAOuiC,IAAI,OAAQvqC,KAAK+tC,mBA2B1C,SAAM,MACE,EAAO/tC,KAAKiY,MAAMrP,KAClB,EAAS,EAAKZ,OACd,EAAU,EAAOwsB,UACjB,EAAS,EAAO1xB,SAEtB,OACE,WAAK0V,MAAOxY,KAAKiY,MAAMO,OACrB,IAAC,EAAAw1B,SAAQ,CAACplC,KAAA,IAEV,WAAK4P,MAAO,gBAAG9Z,SACb,WAAK8Z,MAAO,gBAAGtZ,MACb,IAAC,EAAA+uC,gBAAe,CAACt1B,QAAS3Y,KAAK0tC,cAC9B,IAAW,EACV,IAAC,EAAAQ,WAAU,CAACv1B,QAAS3Y,KAAKwtC,cAE1B,IAAC,EAAAW,YAAW,CAACx1B,QAAS3Y,KAAKytC,eAE7B,IAAC,EAAAW,cAAa,CAACz1B,QAAS3Y,KAAK4tC,YAC7B,IAAC,EAAAS,aAAY,CAAC11B,QAAS3Y,KAAK8tC,gBAC5B,IAAC,EAAAQ,cAAa,CAAC1lC,KAAA,IACf,IAAC,EAAA2lC,KAAI,CAACvmC,OAAA,KAGR,WAAKwQ,MAAO,gBAAGnZ,OACb,IAAC,EAAAwtC,eAAc,CAACjkC,KAAA,IAChB,IAAC,EAAAkkC,iBAAgB,CAACC,QAAA,EAActzB,KAAMzZ,KAAKiY,MAAMwB,a,oFCpF7D,OACA,OAEA/b,EAAA,MAUA,qBAA0B,EAAAqa,UAA1B,c,oBAaE,KAAAy2B,OAAS,KACPxuC,KAAKqY,SACH,CACEmc,WAAU,GAEZx0B,KAAK4F,SAIT,KAAA6oC,cAAgB,KACdzuC,KAAKqY,SAAS,CACZmc,WAAU,KAId,KAAA5uB,OAAS,KACF5F,KAAKuY,MAAMic,YAIhBx0B,KAAKupC,cACLS,WAAWhqC,KAAK4F,OAAQ,OAjC1B,oBACE5F,KAAKiY,MAAMjQ,OAAOsiC,GAAG,OAAQtqC,KAAKwuC,QAClCxuC,KAAKiY,MAAMjQ,OAAOsiC,GAAG,QAAStqC,KAAKyuC,eACnCzuC,KAAKiY,MAAMjQ,OAAOsiC,GAAG,OAAQtqC,KAAKyuC,eAGpC,uBACEzuC,KAAKiY,MAAMjQ,OAAOuiC,IAAI,OAAQvqC,KAAKwuC,QACnCxuC,KAAKiY,MAAMjQ,OAAOuiC,IAAI,QAASvqC,KAAKyuC,eACpCzuC,KAAKiY,MAAMjQ,OAAOuiC,IAAI,OAAQvqC,KAAKyuC,eA2BrC,SAAM,MACE,EAAU,EAAAvkC,WAAWlK,KAAKiY,MAAMjQ,OAAOssB,aACvC9vB,EAAQ,EAAA0F,WAAWlK,KAAKiY,MAAMjQ,OAAOpE,OAAOU,QAElD,OACE,WAAKkU,MAAO,OAAEvM,MAAd,E,MAAA,M,8ECvDN,aAEa,EAAAsiC,KAAO,EAAA1wC,WAAW,CAC7BoO,KAAM,CACJwgC,WAAY,yCACZS,SAAU,W,oFCLd,OAEA,QAYA,yBAA8B,EAAAn1B,UAC5B,YAAY,GACVnV,MAAM,GAiBR,KAAA8rC,aAAe,KACb,MAAM,EAAS1uC,KAAKiY,MAAMrP,KAAKZ,OAC/BhI,KAAKqY,SAAS,CACZuC,SAAU,EAAO0Z,YAAc,EAAO1wB,OAAOU,UAIjD,KAAAqU,QAAW,IAAU,MACb,EAAQ,EAAEg2B,cAAcC,iBAAiB,GACzC,EAAW,GAAK,EAAMvvC,MAAQ,EAAEuH,QAAU,EAAMvH,MAAQ,EAAMH,MACpEc,KAAKiY,MAAMrP,KAAKZ,OAAO6mC,cAAyB,IAAX,GACrC7uC,KAAKiY,MAAMrP,KAAKZ,OAAOkQ,SAGzB,KAAAyxB,aAAe,KACb3pC,KAAKqY,SAAS,CACZy2B,iBAAgB,KAIpB,KAAAroC,YAAe,IACb,GAAKzG,KAAKuY,MAAMu2B,gBAAhB,OAIM,EAAQ,EAAEH,cAAcC,iBAAiB,GACzC,EAAc,GAAK,EAAMvvC,MAAQ,EAAEuH,QAAU,EAAMvH,MAAQ,EAAMH,MAEvEc,KAAKqY,SAAS,CACZ02B,aAFwB,IAAd,EAAoB,QAMlC,KAAAlF,aAAe,KACb7pC,KAAKqY,SAAS,CACZy2B,iBAAgB,KAlDlB9uC,KAAKuY,MAAQ,CACXqC,SAAU,EACVk0B,iBAAgB,EAChBC,aAAc,MAIlB,oBACE/uC,KAAKiY,MAAMrP,KAAK0hC,GAAG,aAActqC,KAAK0uC,cAGxC,uBACE1uC,KAAKiY,MAAMrP,KAAK2hC,IAAI,aAAcvqC,KAAK0uC,cA0CzC,SAAM,MACE,EAAgC,IAAtB1uC,KAAKuY,MAAMqC,SAI3B,OACE,WACEpC,MAAO,WAAEw2B,SACTr2B,QAAS3Y,KAAK2Y,QACdgxB,aAAc3pC,KAAK2pC,aACnBljC,YAAazG,KAAKyG,YAClBojC,aAAc7pC,KAAK6pC,cAEnB,WAAKrxB,MAAO,WAAEy2B,YACd,WAAKz2B,MAAO,WAAE02B,KAAMC,MAAO,CAAE9vC,MAXjB,MAAgB,OAY5B,WAAKmZ,MAAO,WAAE42B,KAAMD,MAAO,CAAEjwC,KAbjB,EAAU,OActB,WAAKsZ,MAAO,WAAE62B,UAAWF,MAAO,CAAEjwC,KAAMc,KAAKuY,MAAMw2B,oB,8ECxF3D,aAEa,EAAAf,SAAW,EAAAnwC,WAAW,CACjCmxC,SAAU,CACRpwC,QAAS,OACTG,WAAY,SACZf,SAAU,WACVW,OAAQ,OACRM,OAAQ,WAEViwC,KAAM,CACJvwC,OAAQ,MACRN,gBAAiB,OACjBL,SAAU,WACVkB,KAAM,IACNG,MAAO,IACPiwC,aAAc,OAEhBL,UAAW,CACTtwC,OAAQ,MACRN,gBAAiB,2BACjBL,SAAU,WACVkB,KAAM,IACNG,MAAO,IACPiwC,aAAc,OAEhBF,KAAM,CACJpxC,SAAU,WACVC,MAAO,OACPU,OAAQ,OACRN,gBAAiB,OACjBixC,aAAc,MACdpwC,KAAM,OACN+sC,WAAY,QAEdoD,UAAW,CACTrxC,SAAU,WACVC,MAAO,MACPU,OAAQ,MACRN,gBAAiB,OACjBD,UAAW,aACXkxC,aAAc,MACdpwC,KAAM,IACN+sC,WAAY,OACZrtC,QAAS,OACTO,MAAO,CACL,UAAW,CACTP,QAAS,c,oFC/CjB,OAEAlB,EAAA,MAYA,8BAAmC,EAAAqa,UAIjC,YAAY,GACVnV,MAAM,GAsBR,KAAA2sC,eAAiB,KACfvvC,KAAKqY,SAAS,CACZrL,OAAQhN,KAAKiY,MAAMrP,KAAKtB,YAAYgE,eAIxC,KAAAqN,QAAW,IAAU,MACb,EAAQ,EAAEg2B,cAAcC,iBAAiB,GACzC,EAAS,GAAK,EAAMvvC,MAAQ,EAAEuH,QAAU,EAAMvH,MAAQ,EAAMH,MAClEc,KAAKiY,MAAMrP,KAAKtB,YAAYiE,UAA5B,IAGF,KAAAo+B,aAAe,KACb3pC,KAAKqY,SAAS,CACZy2B,iBAAgB,KAIpB,KAAAroC,YAAe,IACb,GAAKzG,KAAKuY,MAAMu2B,gBAAhB,OAIM,EAAQ,EAAEH,cAAcC,iBAAiB,GACzC,EAAY,GAAK,EAAMvvC,MAAQ,EAAEuH,QAAU,EAAMvH,MAAQ,EAAMH,MAC/D,EAAM,EAAS,GAAI,EAAS,EAAe,IAAZ,IAAoB,IACzDc,KAAKqY,SAAS,CACZ02B,aAAa,MAIjB,KAAAlF,aAAe,KACb7pC,KAAKqY,SAAS,CACZy2B,iBAAgB,KArDlB9uC,KAAKuY,MAAQ,CACXvL,OAAQ,EAAMpE,KAAKtB,YAAYgE,YAC/BwjC,iBAAgB,EAChBC,aAAc,MAIlB,oBACE/uC,KAAKiY,MAAMrP,KAAKtB,YAAYK,iBAAiB,eAAe,KAC1D3H,KAAKuvC,mBAIT,uBACEvvC,KAAKiY,MAAMrP,KAAKtB,YAAYoC,oBAC1B,eACA1J,KAAKuvC,gBAyCT,SAAM,MACE,EAAgC,IAApBvvC,KAAKuY,MAAMvL,OACvB,EAAU,EAAS,GAAI,EAAS,EAAT,IAA0B,IACjD,EAAU,EAAS,GAAI,EAAS,EAAG,QAAoB,IAE7D,OACE,WACEwL,MAAO,gBAAEg3B,QACT72B,QAAS3Y,KAAK2Y,QACdgxB,aAAc3pC,KAAK2pC,aACnBljC,YAAazG,KAAKyG,YAClBojC,aAAc7pC,KAAK6pC,cAEnB,WAAKrxB,MAAO,gBAAEy2B,YACd,WAAKz2B,MAAO,gBAAE02B,KAAMC,MAAO,CAAE9vC,MAAM,KACnC,WAAKmZ,MAAO,gBAAE42B,KAAMD,MAAO,CAAEjwC,KAAK,KAClC,WAAKsZ,MAAO,gBAAE62B,UAAWF,MAAO,CAAEjwC,KAAMc,KAAKuY,MAAMw2B,oB,8EC9F3D,aAEa,EAAAT,cAAgB,EAAAzwC,WAAW,CACtC2xC,QAAS,CACP5wC,QAAS,OACTG,WAAY,SACZf,SAAU,WACVC,MAAO,OACPU,OAAQ,OACRstC,WAAY,MACZ7sC,YAAa,OACbH,OAAQ,WAEViwC,KAAM,CACJvwC,OAAQ,MACRN,gBAAiB,OACjBL,SAAU,WACVkB,KAAM,IACNG,MAAO,IACPiwC,aAAc,OAEhBL,UAAW,CACTtwC,OAAQ,MACRN,gBAAiB,2BACjBL,SAAU,WACVkB,KAAM,IACNG,MAAO,IACPiwC,aAAc,OAEhBF,KAAM,CACJpxC,SAAU,WACVC,MAAO,OACPU,OAAQ,OACRN,gBAAiB,OACjBixC,aAAc,MACdpwC,KAAM,OACN+sC,WAAY,QAEdoD,UAAW,CACTrxC,SAAU,WACVC,MAAO,MACPU,OAAQ,MACRN,gBAAiB,OACjBD,UAAW,aACXkxC,aAAc,MACdpwC,KAAM,IACN+sC,WAAY,OACZrtC,QAAS,OACTO,MAAO,CACL,UAAW,CACTP,QAAS,c,oFClDjB,OACA,OAEA,sBAAAnB,GACE,OACE,WAAK+a,MAAO,gBAAGxZ,OAAQ2Z,QAAS,EAAMA,SACpC,WACEC,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,4B,oFCXhB,OACA,OAEA,uBAAAtb,GACE,OACE,WAAK+a,MAAO,gBAAGxZ,OAAQ2Z,QAAS,EAAMA,SACpC,WACEC,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,4D,oFCXhB,OACA,OACArb,EAAA,MACA,OAEA,wBAAAD,GACE,OACE,WAAK+a,MAAO,EAAAE,QAAQ,gBAAG1Z,OAAQ,eAAEA,QAAS2Z,QAAS,EAAMA,SACvD,WACEC,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,iN,8ECbhB,aAEa,EAAAs1B,aAAe,EAAAxwC,WAAW,CACrCmB,OAAQ,CACNf,MAAO,OACPU,OAAQ,OACRR,QAAS,MACTiB,YAAa,U,oFCPjB,OACA,OAEA,yBAAA3B,GACE,OACE,WAAK+a,MAAO,gBAAGxZ,OAAQ2Z,QAAS,EAAMA,SACpC,WACEC,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,uD,oFCXhB,OACA,OACArb,EAAA,MACA,OAEA,2BAAAD,GACE,OACE,WAAK+a,MAAO,EAAAE,QAAQ,gBAAG1Z,OAAQ,uBAAEA,QAAS2Z,QAAS,EAAMA,SACvD,WACEC,MAAM,6BACNC,QAAQ,YACRC,KAAK,gBAEL,YAAMC,EAAE,uD,8ECbhB,aAEa,EAAA02B,qBAAuB,EAAA5xC,WAAW,CAC7CmB,OAAQ,CACNstC,UAAW,qB,oFCJf,OAqCa,EAAAoD,UAAY,EAAA7xC,WAAW,CAClC4b,KAAI,iBApCY,CAChBzb,SAAU,WACVojB,MAAO,QACPnjB,MAAO,OACPU,OAAQ,OACRM,OAAQ,OACRX,WAAY,SAiCZksC,YAAW,iBAvCK,CAChBxsC,SAAU,WACVojB,MAAO,QACPnjB,MAAO,OACPU,OAAQ,OACRM,OAAQ,OACRX,WAAY,QAkCI,CACdW,OAAQ,YAGViE,MAAK,iBAnCY,CACjBlF,SAAU,WACVguC,IAAK,OACL9sC,KAAM,IACNnB,OAAQ,GACRI,QAAS,sBACTE,gBAAiB,qBACjB6uC,SAAU,OACVT,WAAY,yCACZluC,QAAS,EACTC,WAAY,iBA4BZisC,aAAY,iBAtCK,CACjBzsC,SAAU,WACVguC,IAAK,OACL9sC,KAAM,IACNnB,OAAQ,GACRI,QAAS,sBACTE,gBAAiB,qBACjB6uC,SAAU,OACVT,WAAY,yCACZluC,QAAS,EACTC,WAAY,gBA6BK,CACfD,QAAS,IAGXT,SAAQ,iBA9BY,CACpBC,OAAQ,GACRC,SAAU,WACVC,MAAO,OACPC,OAAQ,EACRC,QAAS,SACTC,UAAW,aACXC,gBAAiB,qBACjBC,WAAY,OACZC,QAAS,EACTC,WAAY,iBAuBZC,gBAAe,iBAjCK,CACpBV,OAAQ,GACRC,SAAU,WACVC,MAAO,OACPC,OAAQ,EACRC,QAAS,SACTC,UAAW,aACXC,gBAAiB,qBACjBC,WAAY,OACZC,QAAS,EACTC,WAAY,gBAwBQ,CAClBD,QAAS,IAGXosC,OAAQ,CACN3sC,SAAU,WACVguC,IAAK,EACL9sC,KAAM,EACNjB,MAAO,OACPU,OAAQ,OACRZ,OAAQ","file":"hlviewer.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"HLViewer\"] = factory();\n\telse\n\t\troot[\"HLViewer\"] = factory();\n})(window, function() {\nreturn ","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 3 Dimensional Vector\r\n * @module vec3\r\n */\r\n\r\n/**\r\n * Creates a new, empty vec3\r\n *\r\n * @returns {vec3} a new 3D vector\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(3);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec3 initialized with values from an existing vector\r\n *\r\n * @param {vec3} a vector to clone\r\n * @returns {vec3} a new 3D vector\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(3);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the length of a vec3\r\n *\r\n * @param {vec3} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport function length(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  return Math.sqrt(x * x + y * y + z * z);\r\n}\r\n\r\n/**\r\n * Creates a new vec3 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @returns {vec3} a new 3D vector\r\n */\r\nexport function fromValues(x, y, z) {\r\n  var out = new glMatrix.ARRAY_TYPE(3);\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one vec3 to another\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the source vector\r\n * @returns {vec3} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec3 to the given values\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @returns {vec3} out\r\n */\r\nexport function set(out, x, y, z) {\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  out[0] = a[0] * b[0];\r\n  out[1] = a[1] * b[1];\r\n  out[2] = a[2] * b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Divides two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function divide(out, a, b) {\r\n  out[0] = a[0] / b[0];\r\n  out[1] = a[1] / b[1];\r\n  out[2] = a[2] / b[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.ceil the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to ceil\r\n * @returns {vec3} out\r\n */\r\nexport function ceil(out, a) {\r\n  out[0] = Math.ceil(a[0]);\r\n  out[1] = Math.ceil(a[1]);\r\n  out[2] = Math.ceil(a[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.floor the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to floor\r\n * @returns {vec3} out\r\n */\r\nexport function floor(out, a) {\r\n  out[0] = Math.floor(a[0]);\r\n  out[1] = Math.floor(a[1]);\r\n  out[2] = Math.floor(a[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the minimum of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function min(out, a, b) {\r\n  out[0] = Math.min(a[0], b[0]);\r\n  out[1] = Math.min(a[1], b[1]);\r\n  out[2] = Math.min(a[2], b[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the maximum of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function max(out, a, b) {\r\n  out[0] = Math.max(a[0], b[0]);\r\n  out[1] = Math.max(a[1], b[1]);\r\n  out[2] = Math.max(a[2], b[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.round the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to round\r\n * @returns {vec3} out\r\n */\r\nexport function round(out, a) {\r\n  out[0] = Math.round(a[0]);\r\n  out[1] = Math.round(a[1]);\r\n  out[2] = Math.round(a[2]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales a vec3 by a scalar number\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec3} out\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec3's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec3} out\r\n */\r\nexport function scaleAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nexport function distance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  return Math.sqrt(x * x + y * y + z * z);\r\n}\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nexport function squaredDistance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  return x * x + y * y + z * z;\r\n}\r\n\r\n/**\r\n * Calculates the squared length of a vec3\r\n *\r\n * @param {vec3} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nexport function squaredLength(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  return x * x + y * y + z * z;\r\n}\r\n\r\n/**\r\n * Negates the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to negate\r\n * @returns {vec3} out\r\n */\r\nexport function negate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the inverse of the components of a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to invert\r\n * @returns {vec3} out\r\n */\r\nexport function inverse(out, a) {\r\n  out[0] = 1.0 / a[0];\r\n  out[1] = 1.0 / a[1];\r\n  out[2] = 1.0 / a[2];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Normalize a vec3\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a vector to normalize\r\n * @returns {vec3} out\r\n */\r\nexport function normalize(out, a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var len = x * x + y * y + z * z;\r\n  if (len > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len = 1 / Math.sqrt(len);\r\n    out[0] = a[0] * len;\r\n    out[1] = a[1] * len;\r\n    out[2] = a[2] * len;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two vec3's\r\n *\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nexport function dot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\r\n}\r\n\r\n/**\r\n * Computes the cross product of two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function cross(out, a, b) {\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2];\r\n  var bx = b[0],\r\n      by = b[1],\r\n      bz = b[2];\r\n\r\n  out[0] = ay * bz - az * by;\r\n  out[1] = az * bx - ax * bz;\r\n  out[2] = ax * by - ay * bx;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation between two vec3's\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec3} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var ax = a[0];\r\n  var ay = a[1];\r\n  var az = a[2];\r\n  out[0] = ax + t * (b[0] - ax);\r\n  out[1] = ay + t * (b[1] - ay);\r\n  out[2] = az + t * (b[2] - az);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a hermite interpolation with two control points\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {vec3} c the third operand\r\n * @param {vec3} d the fourth operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec3} out\r\n */\r\nexport function hermite(out, a, b, c, d, t) {\r\n  var factorTimes2 = t * t;\r\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\r\n  var factor2 = factorTimes2 * (t - 2) + t;\r\n  var factor3 = factorTimes2 * (t - 1);\r\n  var factor4 = factorTimes2 * (3 - 2 * t);\r\n\r\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\r\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\r\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a bezier interpolation with two control points\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the first operand\r\n * @param {vec3} b the second operand\r\n * @param {vec3} c the third operand\r\n * @param {vec3} d the fourth operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec3} out\r\n */\r\nexport function bezier(out, a, b, c, d, t) {\r\n  var inverseFactor = 1 - t;\r\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\r\n  var factorTimes2 = t * t;\r\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\r\n  var factor2 = 3 * t * inverseFactorTimesTwo;\r\n  var factor3 = 3 * factorTimes2 * inverseFactor;\r\n  var factor4 = factorTimes2 * t;\r\n\r\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\r\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\r\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec3} out\r\n */\r\nexport function random(out, scale) {\r\n  scale = scale || 1.0;\r\n\r\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\r\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\r\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\r\n\r\n  out[0] = Math.cos(r) * zScale;\r\n  out[1] = Math.sin(r) * zScale;\r\n  out[2] = z * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec3 with a mat4.\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec3} out\r\n */\r\nexport function transformMat4(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\r\n  w = w || 1.0;\r\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\r\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\r\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec3 with a mat3.\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {mat3} m the 3x3 matrix to transform with\r\n * @returns {vec3} out\r\n */\r\nexport function transformMat3(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  out[0] = x * m[0] + y * m[3] + z * m[6];\r\n  out[1] = x * m[1] + y * m[4] + z * m[7];\r\n  out[2] = x * m[2] + y * m[5] + z * m[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec3 with a quat\r\n * Can also be used for dual quaternions. (Multiply it with the real part)\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec3} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec3} out\r\n */\r\nexport function transformQuat(out, a, q) {\r\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3];\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  // var qvec = [qx, qy, qz];\r\n  // var uv = vec3.cross([], qvec, a);\r\n  var uvx = qy * z - qz * y,\r\n      uvy = qz * x - qx * z,\r\n      uvz = qx * y - qy * x;\r\n  // var uuv = vec3.cross([], qvec, uv);\r\n  var uuvx = qy * uvz - qz * uvy,\r\n      uuvy = qz * uvx - qx * uvz,\r\n      uuvz = qx * uvy - qy * uvx;\r\n  // vec3.scale(uv, uv, 2 * w);\r\n  var w2 = qw * 2;\r\n  uvx *= w2;\r\n  uvy *= w2;\r\n  uvz *= w2;\r\n  // vec3.scale(uuv, uuv, 2);\r\n  uuvx *= 2;\r\n  uuvy *= 2;\r\n  uuvz *= 2;\r\n  // return vec3.add(out, a, vec3.add(out, uv, uuv));\r\n  out[0] = x + uvx + uuvx;\r\n  out[1] = y + uvy + uuvy;\r\n  out[2] = z + uvz + uuvz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 3D vector around the x-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nexport function rotateX(out, a, b, c) {\r\n  var p = [],\r\n      r = [];\r\n  //Translate point to the origin\r\n  p[0] = a[0] - b[0];\r\n  p[1] = a[1] - b[1];\r\n  p[2] = a[2] - b[2];\r\n\r\n  //perform rotation\r\n  r[0] = p[0];\r\n  r[1] = p[1] * Math.cos(c) - p[2] * Math.sin(c);\r\n  r[2] = p[1] * Math.sin(c) + p[2] * Math.cos(c);\r\n\r\n  //translate to correct position\r\n  out[0] = r[0] + b[0];\r\n  out[1] = r[1] + b[1];\r\n  out[2] = r[2] + b[2];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 3D vector around the y-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nexport function rotateY(out, a, b, c) {\r\n  var p = [],\r\n      r = [];\r\n  //Translate point to the origin\r\n  p[0] = a[0] - b[0];\r\n  p[1] = a[1] - b[1];\r\n  p[2] = a[2] - b[2];\r\n\r\n  //perform rotation\r\n  r[0] = p[2] * Math.sin(c) + p[0] * Math.cos(c);\r\n  r[1] = p[1];\r\n  r[2] = p[2] * Math.cos(c) - p[0] * Math.sin(c);\r\n\r\n  //translate to correct position\r\n  out[0] = r[0] + b[0];\r\n  out[1] = r[1] + b[1];\r\n  out[2] = r[2] + b[2];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 3D vector around the z-axis\r\n * @param {vec3} out The receiving vec3\r\n * @param {vec3} a The vec3 point to rotate\r\n * @param {vec3} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec3} out\r\n */\r\nexport function rotateZ(out, a, b, c) {\r\n  var p = [],\r\n      r = [];\r\n  //Translate point to the origin\r\n  p[0] = a[0] - b[0];\r\n  p[1] = a[1] - b[1];\r\n  p[2] = a[2] - b[2];\r\n\r\n  //perform rotation\r\n  r[0] = p[0] * Math.cos(c) - p[1] * Math.sin(c);\r\n  r[1] = p[0] * Math.sin(c) + p[1] * Math.cos(c);\r\n  r[2] = p[2];\r\n\r\n  //translate to correct position\r\n  out[0] = r[0] + b[0];\r\n  out[1] = r[1] + b[1];\r\n  out[2] = r[2] + b[2];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Get the angle between two 3D vectors\r\n * @param {vec3} a The first operand\r\n * @param {vec3} b The second operand\r\n * @returns {Number} The angle in radians\r\n */\r\nexport function angle(a, b) {\r\n  var tempA = fromValues(a[0], a[1], a[2]);\r\n  var tempB = fromValues(b[0], b[1], b[2]);\r\n\r\n  normalize(tempA, tempA);\r\n  normalize(tempB, tempB);\r\n\r\n  var cosine = dot(tempA, tempB);\r\n\r\n  if (cosine > 1.0) {\r\n    return 0;\r\n  } else if (cosine < -1.0) {\r\n    return Math.PI;\r\n  } else {\r\n    return Math.acos(cosine);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec3} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'vec3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec3} a The first vector.\r\n * @param {vec3} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec3} a The first vector.\r\n * @param {vec3} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\r\n}\r\n\r\n/**\r\n * Alias for {@link vec3.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;\r\n\r\n/**\r\n * Alias for {@link vec3.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link vec3.divide}\r\n * @function\r\n */\r\nexport var div = divide;\r\n\r\n/**\r\n * Alias for {@link vec3.distance}\r\n * @function\r\n */\r\nexport var dist = distance;\r\n\r\n/**\r\n * Alias for {@link vec3.squaredDistance}\r\n * @function\r\n */\r\nexport var sqrDist = squaredDistance;\r\n\r\n/**\r\n * Alias for {@link vec3.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Alias for {@link vec3.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Perform some operation over an array of vec3s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nexport var forEach = function () {\r\n  var vec = create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i = void 0,\r\n        l = void 0;\r\n    if (!stride) {\r\n      stride = 3;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min(count * stride + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec[0] = a[i];vec[1] = a[i + 1];vec[2] = a[i + 2];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec[0];a[i + 1] = vec[1];a[i + 2] = vec[2];\r\n    }\r\n\r\n    return a;\r\n  };\r\n}();","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 2x2 Matrix\r\n * @module mat2\r\n */\r\n\r\n/**\r\n * Creates a new identity mat2\r\n *\r\n * @returns {mat2} a new 2x2 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat2 initialized with values from an existing matrix\r\n *\r\n * @param {mat2} a matrix to clone\r\n * @returns {mat2} a new 2x2 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat2 to another\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat2 to the identity matrix\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @returns {mat2} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat2 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 2)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 3)\r\n * @returns {mat2} out A new 2x2 matrix\r\n */\r\nexport function fromValues(m00, m01, m10, m11) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m10;\r\n  out[3] = m11;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat2 to the given values\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 2)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 3)\r\n * @returns {mat2} out\r\n */\r\nexport function set(out, m00, m01, m10, m11) {\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m10;\r\n  out[3] = m11;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transpose the values of a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function transpose(out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache\r\n  // some values\r\n  if (out === a) {\r\n    var a1 = a[1];\r\n    out[1] = a[2];\r\n    out[2] = a1;\r\n  } else {\r\n    out[0] = a[0];\r\n    out[1] = a[2];\r\n    out[2] = a[1];\r\n    out[3] = a[3];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function invert(out, a) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n\r\n  // Calculate the determinant\r\n  var det = a0 * a3 - a2 * a1;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = a3 * det;\r\n  out[1] = -a1 * det;\r\n  out[2] = -a2 * det;\r\n  out[3] = a0 * det;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the adjugate of a mat2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the source matrix\r\n * @returns {mat2} out\r\n */\r\nexport function adjoint(out, a) {\r\n  // Caching this value is nessecary if out == a\r\n  var a0 = a[0];\r\n  out[0] = a[3];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = a0;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat2\r\n *\r\n * @param {mat2} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  return a[0] * a[3] - a[2] * a[1];\r\n}\r\n\r\n/**\r\n * Multiplies two mat2's\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  out[0] = a0 * b0 + a2 * b1;\r\n  out[1] = a1 * b0 + a3 * b1;\r\n  out[2] = a0 * b2 + a2 * b3;\r\n  out[3] = a1 * b2 + a3 * b3;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat2 by the given angle\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2} out\r\n */\r\nexport function rotate(out, a, rad) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  out[0] = a0 * c + a2 * s;\r\n  out[1] = a1 * c + a3 * s;\r\n  out[2] = a0 * -s + a2 * c;\r\n  out[3] = a1 * -s + a3 * c;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales the mat2 by the dimensions in the given vec2\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to rotate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat2} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var v0 = v[0],\r\n      v1 = v[1];\r\n  out[0] = a0 * v0;\r\n  out[1] = a1 * v0;\r\n  out[2] = a2 * v1;\r\n  out[3] = a3 * v1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2.identity(dest);\r\n *     mat2.rotate(dest, dest, rad);\r\n *\r\n * @param {mat2} out mat2 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2} out\r\n */\r\nexport function fromRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = -s;\r\n  out[3] = c;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2.identity(dest);\r\n *     mat2.scale(dest, dest, vec);\r\n *\r\n * @param {mat2} out mat2 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat2} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = v[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a mat2\r\n *\r\n * @param {mat2} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat2(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat2\r\n *\r\n * @param {mat2} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2));\r\n}\r\n\r\n/**\r\n * Returns L, D and U matrices (Lower triangular, Diagonal and Upper triangular) by factorizing the input matrix\r\n * @param {mat2} L the lower triangular matrix\r\n * @param {mat2} D the diagonal matrix\r\n * @param {mat2} U the upper triangular matrix\r\n * @param {mat2} a the input matrix to factorize\r\n */\r\n\r\nexport function LDU(L, D, U, a) {\r\n  L[2] = a[2] / a[0];\r\n  U[0] = a[0];\r\n  U[1] = a[1];\r\n  U[3] = a[3] - L[2] * U[1];\r\n  return [L, D, U];\r\n}\r\n\r\n/**\r\n * Adds two mat2's\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @returns {mat2} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat2} a The first matrix.\r\n * @param {mat2} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat2} a The first matrix.\r\n * @param {mat2} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat2} out the receiving matrix\r\n * @param {mat2} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat2} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat2's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat2} out the receiving vector\r\n * @param {mat2} a the first operand\r\n * @param {mat2} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat2} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Alias for {@link mat2.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat2.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","/**\r\n * Common utilities\r\n * @module glMatrix\r\n */\r\n\r\n// Configuration Constants\r\nexport var EPSILON = 0.000001;\r\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\r\nexport var RANDOM = Math.random;\r\n\r\n/**\r\n * Sets the type of array used when creating new vectors and matrices\r\n *\r\n * @param {Type} type Array type, such as Float32Array or Array\r\n */\r\nexport function setMatrixArrayType(type) {\r\n  ARRAY_TYPE = type;\r\n}\r\n\r\nvar degree = Math.PI / 180;\r\n\r\n/**\r\n * Convert Degree To Radian\r\n *\r\n * @param {Number} a Angle in Degrees\r\n */\r\nexport function toRadian(a) {\r\n  return a * degree;\r\n}\r\n\r\n/**\r\n * Tests whether or not the arguments have approximately the same value, within an absolute\r\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\r\n * than or equal to 1.0, and a relative tolerance is used for larger values)\r\n *\r\n * @param {Number} a The first number to test.\r\n * @param {Number} b The second number to test.\r\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\r\n}","export enum ReaderDataType {\r\n  UByte = 0,\r\n  Byte = 1,\r\n  UShort = 2,\r\n  Short = 3,\r\n  UInt = 4,\r\n  Int = 5,\r\n  Float = 6,\r\n  Double = 7,\r\n  NString = 8,\r\n  String = 9\r\n}\r\n\r\nexport class Reader {\r\n  data: DataView\r\n  offset: number\r\n\r\n  constructor(data: ArrayBuffer) {\r\n    this.data = new DataView(data)\r\n    this.offset = 0\r\n  }\r\n\r\n  length() {\r\n    return this.data.byteLength\r\n  }\r\n\r\n  tell() {\r\n    return this.offset\r\n  }\r\n\r\n  seek(offset: number) {\r\n    this.offset = Math.max(0, offset)\r\n  }\r\n\r\n  skip(offset: number) {\r\n    this.seek(this.tell() + offset)\r\n  }\r\n\r\n  b() {\r\n    const r = this.data.getInt8(this.offset)\r\n    this.skip(1)\r\n    return r\r\n  }\r\n\r\n  ub() {\r\n    const r = this.data.getUint8(this.offset)\r\n    this.skip(1)\r\n    return r\r\n  }\r\n\r\n  s(isLittleEndian = true) {\r\n    const r = this.data.getInt16(this.offset, isLittleEndian)\r\n    this.skip(2)\r\n    return r\r\n  }\r\n\r\n  us(isLittleEndian = true) {\r\n    const r = this.data.getUint16(this.offset, isLittleEndian)\r\n    this.skip(2)\r\n    return r\r\n  }\r\n\r\n  i(isLittleEndian = true) {\r\n    const r = this.data.getInt32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  ui(isLittleEndian = true) {\r\n    const r = this.data.getUint32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  f(isLittleEndian = true) {\r\n    const r = this.data.getFloat32(this.tell(), isLittleEndian)\r\n    this.skip(4)\r\n    return r\r\n  }\r\n\r\n  lf(isLittleEndian = true) {\r\n    const r = this.data.getFloat64(this.tell(), isLittleEndian)\r\n    this.skip(8)\r\n    return r\r\n  }\r\n\r\n  str() {\r\n    let t = this.ub()\r\n    let r = ''\r\n    while (t !== 0) {\r\n      r += String.fromCharCode(t)\r\n      t = this.ub()\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  nstr(n: number) {\r\n    if (n < 0) {\r\n      return ''\r\n    }\r\n\r\n    let r = ''\r\n    while (n > 0) {\r\n      n -= 1\r\n      const charCode = this.ub()\r\n      if (charCode === 0) {\r\n        break\r\n      }\r\n\r\n      r += String.fromCharCode(charCode)\r\n    }\r\n\r\n    if (n !== 0) {\r\n      this.skip(n)\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  arr(n: number, f: () => any) {\r\n    f.bind(this)\r\n    const r = []\r\n    while (n-- > 0) {\r\n      r.push(f())\r\n    }\r\n\r\n    return r\r\n  }\r\n\r\n  arrx(n: number, type: ReaderDataType, nstrlen = 0) {\r\n    let r: any\r\n\r\n    switch (type) {\r\n      case ReaderDataType.UByte: {\r\n        r = new Uint8Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n)\r\n        break\r\n      }\r\n\r\n      case ReaderDataType.Byte: {\r\n        r = new Int8Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n)\r\n        break\r\n      }\r\n\r\n      case ReaderDataType.UShort:\r\n        r = new Uint16Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 2)\r\n        break\r\n\r\n      case ReaderDataType.Short:\r\n        r = new Int16Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 2)\r\n        break\r\n\r\n      case ReaderDataType.UInt:\r\n        r = new Uint32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Int:\r\n        r = new Int32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Float:\r\n        r = new Float32Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 4)\r\n        break\r\n\r\n      case ReaderDataType.Double:\r\n        r = new Float64Array(this.data.buffer, this.tell(), n)\r\n        this.skip(n * 8)\r\n        break\r\n\r\n      case ReaderDataType.NString:\r\n        r = []\r\n        while (n-- > 0) {\r\n          r.push(r.nstr(nstrlen))\r\n        }\r\n        break\r\n\r\n      case ReaderDataType.String:\r\n        r = []\r\n        while (n-- > 0) {\r\n          r.push(r.str())\r\n        }\r\n        break\r\n    }\r\n\r\n    return r\r\n  }\r\n}\r\n"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","import * as FreeStyle from 'free-style';\n/**\n * We need to do the following to *our* objects before passing to freestyle:\n * - For any `$nest` directive move up to FreeStyle style nesting\n * - For any `$unique` directive map to FreeStyle Unique\n * - For any `$debugName` directive return the debug name\n */\nexport function ensureStringObj(object) {\n    /** The final result we will return */\n    var result = {};\n    var debugName = '';\n    for (var key in object) {\n        /** Grab the value upfront */\n        var val = object[key];\n        /** TypeStyle configuration options */\n        if (key === '$unique') {\n            result[FreeStyle.IS_UNIQUE] = val;\n        }\n        else if (key === '$nest') {\n            var nested = val;\n            for (var selector in nested) {\n                var subproperties = nested[selector];\n                result[selector] = ensureStringObj(subproperties).result;\n            }\n        }\n        else if (key === '$debugName') {\n            debugName = val;\n        }\n        else {\n            result[key] = val;\n        }\n    }\n    return { result: result, debugName: debugName };\n}\n// todo: better name here\nexport function explodeKeyframes(frames) {\n    var result = { $debugName: undefined, keyframes: {} };\n    for (var offset in frames) {\n        var val = frames[offset];\n        if (offset === '$debugName') {\n            result.$debugName = val;\n        }\n        else {\n            result.keyframes[offset] = val;\n        }\n    }\n    return result;\n}\n","/** Raf for node + browser */\nexport var raf = typeof requestAnimationFrame === 'undefined'\n    /**\n     * Make sure setTimeout is always invoked with\n     * `this` set to `window` or `global` automatically\n     **/\n    ? function (cb) { return setTimeout(cb); }\n    /**\n     * Make sure window.requestAnimationFrame is always invoked with `this` window\n     * We might have raf without window in case of `raf/polyfill` (recommended by React)\n     **/\n    : typeof window === 'undefined'\n        ? requestAnimationFrame\n        : requestAnimationFrame.bind(window);\n/**\n * Utility to join classes conditionally\n */\nexport function classes() {\n    var classes = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        classes[_i] = arguments[_i];\n    }\n    return classes\n        .map(function (c) { return c && typeof c === 'object' ? Object.keys(c).map(function (key) { return !!c[key] && key; }) : [c]; })\n        .reduce(function (flattened, c) { return flattened.concat(c); }, [])\n        .filter(function (c) { return !!c; })\n        .join(' ');\n}\n/**\n * Merges various styles into a single style object.\n * Note: if two objects have the same property the last one wins\n */\nexport function extend() {\n    var objects = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        objects[_i] = arguments[_i];\n    }\n    /** The final result we will return */\n    var result = {};\n    for (var _a = 0, objects_1 = objects; _a < objects_1.length; _a++) {\n        var object = objects_1[_a];\n        if (object == null || object === false) {\n            continue;\n        }\n        for (var key in object) {\n            /** Falsy values except a explicit 0 is ignored */\n            var val = object[key];\n            if (!val && val !== 0) {\n                continue;\n            }\n            /** if nested media or pseudo selector */\n            if (key === '$nest' && val) {\n                result[key] = result['$nest'] ? extend(result['$nest'], val) : val;\n            }\n            else if ((key.indexOf('&') !== -1 || key.indexOf('@media') === 0)) {\n                result[key] = result[key] ? extend(result[key], val) : val;\n            }\n            else {\n                result[key] = val;\n            }\n        }\n    }\n    return result;\n}\n/**\n * Utility to help customize styles with media queries. e.g.\n * ```\n * style(\n *  media({maxWidth:500}, {color:'red'})\n * )\n * ```\n */\nexport var media = function (mediaQuery) {\n    var objects = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        objects[_i - 1] = arguments[_i];\n    }\n    var mediaQuerySections = [];\n    if (mediaQuery.type)\n        mediaQuerySections.push(mediaQuery.type);\n    if (mediaQuery.orientation)\n        mediaQuerySections.push(\"(orientation: \" + mediaQuery.orientation + \")\");\n    if (mediaQuery.minWidth)\n        mediaQuerySections.push(\"(min-width: \" + mediaLength(mediaQuery.minWidth) + \")\");\n    if (mediaQuery.maxWidth)\n        mediaQuerySections.push(\"(max-width: \" + mediaLength(mediaQuery.maxWidth) + \")\");\n    if (mediaQuery.minHeight)\n        mediaQuerySections.push(\"(min-height: \" + mediaLength(mediaQuery.minHeight) + \")\");\n    if (mediaQuery.maxHeight)\n        mediaQuerySections.push(\"(max-height: \" + mediaLength(mediaQuery.maxHeight) + \")\");\n    var stringMediaQuery = \"@media \" + mediaQuerySections.join(' and ');\n    var object = {\n        $nest: (_a = {},\n            _a[stringMediaQuery] = extend.apply(void 0, objects),\n            _a)\n    };\n    return object;\n    var _a;\n};\nvar mediaLength = function (value) {\n    return typeof value === 'string' ? value : value + \"px\";\n};\n","import { TypeStyle } from './internal/typestyle';\nexport { TypeStyle };\n/**\n * All the CSS types in the 'types' namespace\n */\nimport * as types from './types';\nexport { types };\n/**\n * Export certain utilities\n */\nexport { extend, classes, media } from './internal/utilities';\n/** Zero configuration, default instance of TypeStyle */\nvar ts = new TypeStyle({ autoGenerateTag: true });\n/** Sets the target tag where we write the css on style updates */\nexport var setStylesTarget = ts.setStylesTarget;\n/**\n * Insert `raw` CSS as a string. This is useful for e.g.\n * - third party CSS that you are customizing with template strings\n * - generating raw CSS in JavaScript\n * - reset libraries like normalize.css that you can use without loaders\n */\nexport var cssRaw = ts.cssRaw;\n/**\n * Takes CSSProperties and registers it to a global selector (body, html, etc.)\n */\nexport var cssRule = ts.cssRule;\n/**\n * Renders styles to the singleton tag imediately\n * NOTE: You should only call it on initial render to prevent any non CSS flash.\n * After that it is kept sync using `requestAnimationFrame` and we haven't noticed any bad flashes.\n **/\nexport var forceRenderStyles = ts.forceRenderStyles;\n/**\n * Utility function to register an @font-face\n */\nexport var fontFace = ts.fontFace;\n/**\n * Allows use to use the stylesheet in a node.js environment\n */\nexport var getStyles = ts.getStyles;\n/**\n * Takes keyframes and returns a generated animationName\n */\nexport var keyframes = ts.keyframes;\n/**\n * Helps with testing. Reinitializes FreeStyle + raw\n */\nexport var reinit = ts.reinit;\n/**\n * Takes CSSProperties and return a generated className you can use on your component\n */\nexport var style = ts.style;\n/**\n * Takes an object where property names are ideal class names and property values are CSSProperties, and\n * returns an object where property names are the same ideal class names and the property values are\n * the actual generated class names using the ideal class name as the $debugName\n */\nexport var stylesheet = ts.stylesheet;\n/**\n * Creates a new instance of TypeStyle separate from the default instance.\n *\n * - Use this for creating a different typestyle instance for a shadow dom component.\n * - Use this if you don't want an auto tag generated and you just want to collect the CSS.\n *\n * NOTE: styles aren't shared between different instances.\n */\nexport function createTypeStyle(target) {\n    var instance = new TypeStyle({ autoGenerateTag: false });\n    if (target) {\n        instance.setStylesTarget(target);\n    }\n    return instance;\n}\n","import * as FreeStyle from \"free-style\";\nimport { ensureStringObj, explodeKeyframes } from './formatting';\nimport { extend, raf } from './utilities';\n/**\n * Creates an instance of free style with our options\n */\nvar createFreeStyle = function () { return FreeStyle.create(\n/** Use the default hash function */\nundefined, \n/** Preserve $debugName values */\ntrue); };\n/**\n * Maintains a single stylesheet and keeps it in sync with requested styles\n */\nvar TypeStyle = /** @class */ (function () {\n    function TypeStyle(_a) {\n        var autoGenerateTag = _a.autoGenerateTag;\n        var _this = this;\n        /**\n         * Insert `raw` CSS as a string. This is useful for e.g.\n         * - third party CSS that you are customizing with template strings\n         * - generating raw CSS in JavaScript\n         * - reset libraries like normalize.css that you can use without loaders\n         */\n        this.cssRaw = function (mustBeValidCSS) {\n            if (!mustBeValidCSS) {\n                return;\n            }\n            _this._raw += mustBeValidCSS || '';\n            _this._pendingRawChange = true;\n            _this._styleUpdated();\n        };\n        /**\n         * Takes CSSProperties and registers it to a global selector (body, html, etc.)\n         */\n        this.cssRule = function (selector) {\n            var objects = [];\n            for (var _i = 1; _i < arguments.length; _i++) {\n                objects[_i - 1] = arguments[_i];\n            }\n            var object = ensureStringObj(extend.apply(void 0, objects)).result;\n            _this._freeStyle.registerRule(selector, object);\n            _this._styleUpdated();\n            return;\n        };\n        /**\n         * Renders styles to the singleton tag imediately\n         * NOTE: You should only call it on initial render to prevent any non CSS flash.\n         * After that it is kept sync using `requestAnimationFrame` and we haven't noticed any bad flashes.\n         **/\n        this.forceRenderStyles = function () {\n            var target = _this._getTag();\n            if (!target) {\n                return;\n            }\n            target.textContent = _this.getStyles();\n        };\n        /**\n         * Utility function to register an @font-face\n         */\n        this.fontFace = function () {\n            var fontFace = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                fontFace[_i] = arguments[_i];\n            }\n            var freeStyle = _this._freeStyle;\n            for (var _a = 0, _b = fontFace; _a < _b.length; _a++) {\n                var face = _b[_a];\n                freeStyle.registerRule('@font-face', face);\n            }\n            _this._styleUpdated();\n            return;\n        };\n        /**\n         * Allows use to use the stylesheet in a node.js environment\n         */\n        this.getStyles = function () {\n            return (_this._raw || '') + _this._freeStyle.getStyles();\n        };\n        /**\n         * Takes keyframes and returns a generated animationName\n         */\n        this.keyframes = function (frames) {\n            var _a = explodeKeyframes(frames), keyframes = _a.keyframes, $debugName = _a.$debugName;\n            // TODO: replace $debugName with display name\n            var animationName = _this._freeStyle.registerKeyframes(keyframes, $debugName);\n            _this._styleUpdated();\n            return animationName;\n        };\n        /**\n         * Helps with testing. Reinitializes FreeStyle + raw\n         */\n        this.reinit = function () {\n            /** reinit freestyle */\n            var freeStyle = createFreeStyle();\n            _this._freeStyle = freeStyle;\n            _this._lastFreeStyleChangeId = freeStyle.changeId;\n            /** reinit raw */\n            _this._raw = '';\n            _this._pendingRawChange = false;\n            /** Clear any styles that were flushed */\n            var target = _this._getTag();\n            if (target) {\n                target.textContent = '';\n            }\n        };\n        /** Sets the target tag where we write the css on style updates */\n        this.setStylesTarget = function (tag) {\n            /** Clear any data in any previous tag */\n            if (_this._tag) {\n                _this._tag.textContent = '';\n            }\n            _this._tag = tag;\n            /** This special time buffer immediately */\n            _this.forceRenderStyles();\n        };\n        /**\n         * Takes an object where property names are ideal class names and property values are CSSProperties, and\n         * returns an object where property names are the same ideal class names and the property values are\n         * the actual generated class names using the ideal class name as the $debugName\n         */\n        this.stylesheet = function (classes) {\n            var classNames = Object.getOwnPropertyNames(classes);\n            var result = {};\n            for (var _i = 0, classNames_1 = classNames; _i < classNames_1.length; _i++) {\n                var className = classNames_1[_i];\n                var classDef = classes[className];\n                if (classDef) {\n                    classDef.$debugName = className;\n                    result[className] = _this.style(classDef);\n                }\n            }\n            return result;\n        };\n        var freeStyle = createFreeStyle();\n        this._autoGenerateTag = autoGenerateTag;\n        this._freeStyle = freeStyle;\n        this._lastFreeStyleChangeId = freeStyle.changeId;\n        this._pending = 0;\n        this._pendingRawChange = false;\n        this._raw = '';\n        this._tag = undefined;\n        // rebind prototype to TypeStyle.  It might be better to do a function() { return this.style.apply(this, arguments)}\n        this.style = this.style.bind(this);\n    }\n    /**\n     * Only calls cb all sync operations settle\n     */\n    TypeStyle.prototype._afterAllSync = function (cb) {\n        var _this = this;\n        this._pending++;\n        var pending = this._pending;\n        raf(function () {\n            if (pending !== _this._pending) {\n                return;\n            }\n            cb();\n        });\n    };\n    TypeStyle.prototype._getTag = function () {\n        if (this._tag) {\n            return this._tag;\n        }\n        if (this._autoGenerateTag) {\n            var tag = typeof window === 'undefined'\n                ? { textContent: '' }\n                : document.createElement('style');\n            if (typeof document !== 'undefined') {\n                document.head.appendChild(tag);\n            }\n            this._tag = tag;\n            return tag;\n        }\n        return undefined;\n    };\n    /** Checks if the style tag needs updating and if so queues up the change */\n    TypeStyle.prototype._styleUpdated = function () {\n        var _this = this;\n        var changeId = this._freeStyle.changeId;\n        var lastChangeId = this._lastFreeStyleChangeId;\n        if (!this._pendingRawChange && changeId === lastChangeId) {\n            return;\n        }\n        this._lastFreeStyleChangeId = changeId;\n        this._pendingRawChange = false;\n        this._afterAllSync(function () { return _this.forceRenderStyles(); });\n    };\n    TypeStyle.prototype.style = function () {\n        var freeStyle = this._freeStyle;\n        var _a = ensureStringObj(extend.apply(undefined, arguments)), result = _a.result, debugName = _a.debugName;\n        var className = debugName ? freeStyle.registerStyle(result, debugName) : freeStyle.registerStyle(result);\n        this._styleUpdated();\n        return className;\n    };\n    return TypeStyle;\n}());\nexport { TypeStyle };\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.preact = {})));\n}(this, (function (exports) { 'use strict';\n\n\tvar VNode = function VNode() {};\n\n\tvar options = {};\n\n\tvar stack = [];\n\n\tvar EMPTY_CHILDREN = [];\n\n\tfunction h(nodeName, attributes) {\n\t\tvar children = EMPTY_CHILDREN,\n\t\t    lastSimple = void 0,\n\t\t    child = void 0,\n\t\t    simple = void 0,\n\t\t    i = void 0;\n\t\tfor (i = arguments.length; i-- > 2;) {\n\t\t\tstack.push(arguments[i]);\n\t\t}\n\t\tif (attributes && attributes.children != null) {\n\t\t\tif (!stack.length) stack.push(attributes.children);\n\t\t\tdelete attributes.children;\n\t\t}\n\t\twhile (stack.length) {\n\t\t\tif ((child = stack.pop()) && child.pop !== undefined) {\n\t\t\t\tfor (i = child.length; i--;) {\n\t\t\t\t\tstack.push(child[i]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (typeof child === 'boolean') child = null;\n\n\t\t\t\tif (simple = typeof nodeName !== 'function') {\n\t\t\t\t\tif (child == null) child = '';else if (typeof child === 'number') child = String(child);else if (typeof child !== 'string') simple = false;\n\t\t\t\t}\n\n\t\t\t\tif (simple && lastSimple) {\n\t\t\t\t\tchildren[children.length - 1] += child;\n\t\t\t\t} else if (children === EMPTY_CHILDREN) {\n\t\t\t\t\tchildren = [child];\n\t\t\t\t} else {\n\t\t\t\t\tchildren.push(child);\n\t\t\t\t}\n\n\t\t\t\tlastSimple = simple;\n\t\t\t}\n\t\t}\n\n\t\tvar p = new VNode();\n\t\tp.nodeName = nodeName;\n\t\tp.children = children;\n\t\tp.attributes = attributes == null ? undefined : attributes;\n\t\tp.key = attributes == null ? undefined : attributes.key;\n\n\t\tif (options.vnode !== undefined) options.vnode(p);\n\n\t\treturn p;\n\t}\n\n\tfunction extend(obj, props) {\n\t  for (var i in props) {\n\t    obj[i] = props[i];\n\t  }return obj;\n\t}\n\n\tfunction applyRef(ref, value) {\n\t  if (ref) {\n\t    if (typeof ref == 'function') ref(value);else ref.current = value;\n\t  }\n\t}\n\n\tvar defer = typeof Promise == 'function' ? Promise.resolve().then.bind(Promise.resolve()) : setTimeout;\n\n\tfunction cloneElement(vnode, props) {\n\t  return h(vnode.nodeName, extend(extend({}, vnode.attributes), props), arguments.length > 2 ? [].slice.call(arguments, 2) : vnode.children);\n\t}\n\n\tvar NO_RENDER = 0;\n\n\tvar SYNC_RENDER = 1;\n\n\tvar FORCE_RENDER = 2;\n\n\tvar ASYNC_RENDER = 3;\n\n\tvar ATTR_KEY = '__preactattr_';\n\n\tvar IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;\n\n\tvar items = [];\n\n\tfunction enqueueRender(component) {\n\t\tif (!component._dirty && (component._dirty = true) && items.push(component) == 1) {\n\t\t\t(options.debounceRendering || defer)(rerender);\n\t\t}\n\t}\n\n\tfunction rerender() {\n\t\tvar p = void 0;\n\t\twhile (p = items.pop()) {\n\t\t\tif (p._dirty) renderComponent(p);\n\t\t}\n\t}\n\n\tfunction isSameNodeType(node, vnode, hydrating) {\n\t\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\t\t\treturn node.splitText !== undefined;\n\t\t}\n\t\tif (typeof vnode.nodeName === 'string') {\n\t\t\treturn !node._componentConstructor && isNamedNode(node, vnode.nodeName);\n\t\t}\n\t\treturn hydrating || node._componentConstructor === vnode.nodeName;\n\t}\n\n\tfunction isNamedNode(node, nodeName) {\n\t\treturn node.normalizedNodeName === nodeName || node.nodeName.toLowerCase() === nodeName.toLowerCase();\n\t}\n\n\tfunction getNodeProps(vnode) {\n\t\tvar props = extend({}, vnode.attributes);\n\t\tprops.children = vnode.children;\n\n\t\tvar defaultProps = vnode.nodeName.defaultProps;\n\t\tif (defaultProps !== undefined) {\n\t\t\tfor (var i in defaultProps) {\n\t\t\t\tif (props[i] === undefined) {\n\t\t\t\t\tprops[i] = defaultProps[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn props;\n\t}\n\n\tfunction createNode(nodeName, isSvg) {\n\t\tvar node = isSvg ? document.createElementNS('http://www.w3.org/2000/svg', nodeName) : document.createElement(nodeName);\n\t\tnode.normalizedNodeName = nodeName;\n\t\treturn node;\n\t}\n\n\tfunction removeNode(node) {\n\t\tvar parentNode = node.parentNode;\n\t\tif (parentNode) parentNode.removeChild(node);\n\t}\n\n\tfunction setAccessor(node, name, old, value, isSvg) {\n\t\tif (name === 'className') name = 'class';\n\n\t\tif (name === 'key') {} else if (name === 'ref') {\n\t\t\tapplyRef(old, null);\n\t\t\tapplyRef(value, node);\n\t\t} else if (name === 'class' && !isSvg) {\n\t\t\tnode.className = value || '';\n\t\t} else if (name === 'style') {\n\t\t\tif (!value || typeof value === 'string' || typeof old === 'string') {\n\t\t\t\tnode.style.cssText = value || '';\n\t\t\t}\n\t\t\tif (value && typeof value === 'object') {\n\t\t\t\tif (typeof old !== 'string') {\n\t\t\t\t\tfor (var i in old) {\n\t\t\t\t\t\tif (!(i in value)) node.style[i] = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var _i in value) {\n\t\t\t\t\tnode.style[_i] = typeof value[_i] === 'number' && IS_NON_DIMENSIONAL.test(_i) === false ? value[_i] + 'px' : value[_i];\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (name === 'dangerouslySetInnerHTML') {\n\t\t\tif (value) node.innerHTML = value.__html || '';\n\t\t} else if (name[0] == 'o' && name[1] == 'n') {\n\t\t\tvar useCapture = name !== (name = name.replace(/Capture$/, ''));\n\t\t\tname = name.toLowerCase().substring(2);\n\t\t\tif (value) {\n\t\t\t\tif (!old) node.addEventListener(name, eventProxy, useCapture);\n\t\t\t} else {\n\t\t\t\tnode.removeEventListener(name, eventProxy, useCapture);\n\t\t\t}\n\t\t\t(node._listeners || (node._listeners = {}))[name] = value;\n\t\t} else if (name !== 'list' && name !== 'type' && !isSvg && name in node) {\n\t\t\ttry {\n\t\t\t\tnode[name] = value == null ? '' : value;\n\t\t\t} catch (e) {}\n\t\t\tif ((value == null || value === false) && name != 'spellcheck') node.removeAttribute(name);\n\t\t} else {\n\t\t\tvar ns = isSvg && name !== (name = name.replace(/^xlink:?/, ''));\n\n\t\t\tif (value == null || value === false) {\n\t\t\t\tif (ns) node.removeAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase());else node.removeAttribute(name);\n\t\t\t} else if (typeof value !== 'function') {\n\t\t\t\tif (ns) node.setAttributeNS('http://www.w3.org/1999/xlink', name.toLowerCase(), value);else node.setAttribute(name, value);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction eventProxy(e) {\n\t\treturn this._listeners[e.type](options.event && options.event(e) || e);\n\t}\n\n\tvar mounts = [];\n\n\tvar diffLevel = 0;\n\n\tvar isSvgMode = false;\n\n\tvar hydrating = false;\n\n\tfunction flushMounts() {\n\t\tvar c = void 0;\n\t\twhile (c = mounts.shift()) {\n\t\t\tif (options.afterMount) options.afterMount(c);\n\t\t\tif (c.componentDidMount) c.componentDidMount();\n\t\t}\n\t}\n\n\tfunction diff(dom, vnode, context, mountAll, parent, componentRoot) {\n\t\tif (!diffLevel++) {\n\t\t\tisSvgMode = parent != null && parent.ownerSVGElement !== undefined;\n\n\t\t\thydrating = dom != null && !(ATTR_KEY in dom);\n\t\t}\n\n\t\tvar ret = idiff(dom, vnode, context, mountAll, componentRoot);\n\n\t\tif (parent && ret.parentNode !== parent) parent.appendChild(ret);\n\n\t\tif (! --diffLevel) {\n\t\t\thydrating = false;\n\n\t\t\tif (!componentRoot) flushMounts();\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tfunction idiff(dom, vnode, context, mountAll, componentRoot) {\n\t\tvar out = dom,\n\t\t    prevSvgMode = isSvgMode;\n\n\t\tif (vnode == null || typeof vnode === 'boolean') vnode = '';\n\n\t\tif (typeof vnode === 'string' || typeof vnode === 'number') {\n\t\t\tif (dom && dom.splitText !== undefined && dom.parentNode && (!dom._component || componentRoot)) {\n\t\t\t\tif (dom.nodeValue != vnode) {\n\t\t\t\t\tdom.nodeValue = vnode;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tout = document.createTextNode(vnode);\n\t\t\t\tif (dom) {\n\t\t\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\t\t\t\t\trecollectNodeTree(dom, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tout[ATTR_KEY] = true;\n\n\t\t\treturn out;\n\t\t}\n\n\t\tvar vnodeName = vnode.nodeName;\n\t\tif (typeof vnodeName === 'function') {\n\t\t\treturn buildComponentFromVNode(dom, vnode, context, mountAll);\n\t\t}\n\n\t\tisSvgMode = vnodeName === 'svg' ? true : vnodeName === 'foreignObject' ? false : isSvgMode;\n\n\t\tvnodeName = String(vnodeName);\n\t\tif (!dom || !isNamedNode(dom, vnodeName)) {\n\t\t\tout = createNode(vnodeName, isSvgMode);\n\n\t\t\tif (dom) {\n\t\t\t\twhile (dom.firstChild) {\n\t\t\t\t\tout.appendChild(dom.firstChild);\n\t\t\t\t}\n\t\t\t\tif (dom.parentNode) dom.parentNode.replaceChild(out, dom);\n\n\t\t\t\trecollectNodeTree(dom, true);\n\t\t\t}\n\t\t}\n\n\t\tvar fc = out.firstChild,\n\t\t    props = out[ATTR_KEY],\n\t\t    vchildren = vnode.children;\n\n\t\tif (props == null) {\n\t\t\tprops = out[ATTR_KEY] = {};\n\t\t\tfor (var a = out.attributes, i = a.length; i--;) {\n\t\t\t\tprops[a[i].name] = a[i].value;\n\t\t\t}\n\t\t}\n\n\t\tif (!hydrating && vchildren && vchildren.length === 1 && typeof vchildren[0] === 'string' && fc != null && fc.splitText !== undefined && fc.nextSibling == null) {\n\t\t\tif (fc.nodeValue != vchildren[0]) {\n\t\t\t\tfc.nodeValue = vchildren[0];\n\t\t\t}\n\t\t} else if (vchildren && vchildren.length || fc != null) {\n\t\t\t\tinnerDiffNode(out, vchildren, context, mountAll, hydrating || props.dangerouslySetInnerHTML != null);\n\t\t\t}\n\n\t\tdiffAttributes(out, vnode.attributes, props);\n\n\t\tisSvgMode = prevSvgMode;\n\n\t\treturn out;\n\t}\n\n\tfunction innerDiffNode(dom, vchildren, context, mountAll, isHydrating) {\n\t\tvar originalChildren = dom.childNodes,\n\t\t    children = [],\n\t\t    keyed = {},\n\t\t    keyedLen = 0,\n\t\t    min = 0,\n\t\t    len = originalChildren.length,\n\t\t    childrenLen = 0,\n\t\t    vlen = vchildren ? vchildren.length : 0,\n\t\t    j = void 0,\n\t\t    c = void 0,\n\t\t    f = void 0,\n\t\t    vchild = void 0,\n\t\t    child = void 0;\n\n\t\tif (len !== 0) {\n\t\t\tfor (var i = 0; i < len; i++) {\n\t\t\t\tvar _child = originalChildren[i],\n\t\t\t\t    props = _child[ATTR_KEY],\n\t\t\t\t    key = vlen && props ? _child._component ? _child._component.__key : props.key : null;\n\t\t\t\tif (key != null) {\n\t\t\t\t\tkeyedLen++;\n\t\t\t\t\tkeyed[key] = _child;\n\t\t\t\t} else if (props || (_child.splitText !== undefined ? isHydrating ? _child.nodeValue.trim() : true : isHydrating)) {\n\t\t\t\t\tchildren[childrenLen++] = _child;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (vlen !== 0) {\n\t\t\tfor (var _i = 0; _i < vlen; _i++) {\n\t\t\t\tvchild = vchildren[_i];\n\t\t\t\tchild = null;\n\n\t\t\t\tvar _key = vchild.key;\n\t\t\t\tif (_key != null) {\n\t\t\t\t\tif (keyedLen && keyed[_key] !== undefined) {\n\t\t\t\t\t\tchild = keyed[_key];\n\t\t\t\t\t\tkeyed[_key] = undefined;\n\t\t\t\t\t\tkeyedLen--;\n\t\t\t\t\t}\n\t\t\t\t} else if (min < childrenLen) {\n\t\t\t\t\t\tfor (j = min; j < childrenLen; j++) {\n\t\t\t\t\t\t\tif (children[j] !== undefined && isSameNodeType(c = children[j], vchild, isHydrating)) {\n\t\t\t\t\t\t\t\tchild = c;\n\t\t\t\t\t\t\t\tchildren[j] = undefined;\n\t\t\t\t\t\t\t\tif (j === childrenLen - 1) childrenLen--;\n\t\t\t\t\t\t\t\tif (j === min) min++;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\tchild = idiff(child, vchild, context, mountAll);\n\n\t\t\t\tf = originalChildren[_i];\n\t\t\t\tif (child && child !== dom && child !== f) {\n\t\t\t\t\tif (f == null) {\n\t\t\t\t\t\tdom.appendChild(child);\n\t\t\t\t\t} else if (child === f.nextSibling) {\n\t\t\t\t\t\tremoveNode(f);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdom.insertBefore(child, f);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (keyedLen) {\n\t\t\tfor (var _i2 in keyed) {\n\t\t\t\tif (keyed[_i2] !== undefined) recollectNodeTree(keyed[_i2], false);\n\t\t\t}\n\t\t}\n\n\t\twhile (min <= childrenLen) {\n\t\t\tif ((child = children[childrenLen--]) !== undefined) recollectNodeTree(child, false);\n\t\t}\n\t}\n\n\tfunction recollectNodeTree(node, unmountOnly) {\n\t\tvar component = node._component;\n\t\tif (component) {\n\t\t\tunmountComponent(component);\n\t\t} else {\n\t\t\tif (node[ATTR_KEY] != null) applyRef(node[ATTR_KEY].ref, null);\n\n\t\t\tif (unmountOnly === false || node[ATTR_KEY] == null) {\n\t\t\t\tremoveNode(node);\n\t\t\t}\n\n\t\t\tremoveChildren(node);\n\t\t}\n\t}\n\n\tfunction removeChildren(node) {\n\t\tnode = node.lastChild;\n\t\twhile (node) {\n\t\t\tvar next = node.previousSibling;\n\t\t\trecollectNodeTree(node, true);\n\t\t\tnode = next;\n\t\t}\n\t}\n\n\tfunction diffAttributes(dom, attrs, old) {\n\t\tvar name = void 0;\n\n\t\tfor (name in old) {\n\t\t\tif (!(attrs && attrs[name] != null) && old[name] != null) {\n\t\t\t\tsetAccessor(dom, name, old[name], old[name] = undefined, isSvgMode);\n\t\t\t}\n\t\t}\n\n\t\tfor (name in attrs) {\n\t\t\tif (name !== 'children' && name !== 'innerHTML' && (!(name in old) || attrs[name] !== (name === 'value' || name === 'checked' ? dom[name] : old[name]))) {\n\t\t\t\tsetAccessor(dom, name, old[name], old[name] = attrs[name], isSvgMode);\n\t\t\t}\n\t\t}\n\t}\n\n\tvar recyclerComponents = [];\n\n\tfunction createComponent(Ctor, props, context) {\n\t\tvar inst = void 0,\n\t\t    i = recyclerComponents.length;\n\n\t\tif (Ctor.prototype && Ctor.prototype.render) {\n\t\t\tinst = new Ctor(props, context);\n\t\t\tComponent.call(inst, props, context);\n\t\t} else {\n\t\t\tinst = new Component(props, context);\n\t\t\tinst.constructor = Ctor;\n\t\t\tinst.render = doRender;\n\t\t}\n\n\t\twhile (i--) {\n\t\t\tif (recyclerComponents[i].constructor === Ctor) {\n\t\t\t\tinst.nextBase = recyclerComponents[i].nextBase;\n\t\t\t\trecyclerComponents.splice(i, 1);\n\t\t\t\treturn inst;\n\t\t\t}\n\t\t}\n\n\t\treturn inst;\n\t}\n\n\tfunction doRender(props, state, context) {\n\t\treturn this.constructor(props, context);\n\t}\n\n\tfunction setComponentProps(component, props, renderMode, context, mountAll) {\n\t\tif (component._disable) return;\n\t\tcomponent._disable = true;\n\n\t\tcomponent.__ref = props.ref;\n\t\tcomponent.__key = props.key;\n\t\tdelete props.ref;\n\t\tdelete props.key;\n\n\t\tif (typeof component.constructor.getDerivedStateFromProps === 'undefined') {\n\t\t\tif (!component.base || mountAll) {\n\t\t\t\tif (component.componentWillMount) component.componentWillMount();\n\t\t\t} else if (component.componentWillReceiveProps) {\n\t\t\t\tcomponent.componentWillReceiveProps(props, context);\n\t\t\t}\n\t\t}\n\n\t\tif (context && context !== component.context) {\n\t\t\tif (!component.prevContext) component.prevContext = component.context;\n\t\t\tcomponent.context = context;\n\t\t}\n\n\t\tif (!component.prevProps) component.prevProps = component.props;\n\t\tcomponent.props = props;\n\n\t\tcomponent._disable = false;\n\n\t\tif (renderMode !== NO_RENDER) {\n\t\t\tif (renderMode === SYNC_RENDER || options.syncComponentUpdates !== false || !component.base) {\n\t\t\t\trenderComponent(component, SYNC_RENDER, mountAll);\n\t\t\t} else {\n\t\t\t\tenqueueRender(component);\n\t\t\t}\n\t\t}\n\n\t\tapplyRef(component.__ref, component);\n\t}\n\n\tfunction renderComponent(component, renderMode, mountAll, isChild) {\n\t\tif (component._disable) return;\n\n\t\tvar props = component.props,\n\t\t    state = component.state,\n\t\t    context = component.context,\n\t\t    previousProps = component.prevProps || props,\n\t\t    previousState = component.prevState || state,\n\t\t    previousContext = component.prevContext || context,\n\t\t    isUpdate = component.base,\n\t\t    nextBase = component.nextBase,\n\t\t    initialBase = isUpdate || nextBase,\n\t\t    initialChildComponent = component._component,\n\t\t    skip = false,\n\t\t    snapshot = previousContext,\n\t\t    rendered = void 0,\n\t\t    inst = void 0,\n\t\t    cbase = void 0;\n\n\t\tif (component.constructor.getDerivedStateFromProps) {\n\t\t\tstate = extend(extend({}, state), component.constructor.getDerivedStateFromProps(props, state));\n\t\t\tcomponent.state = state;\n\t\t}\n\n\t\tif (isUpdate) {\n\t\t\tcomponent.props = previousProps;\n\t\t\tcomponent.state = previousState;\n\t\t\tcomponent.context = previousContext;\n\t\t\tif (renderMode !== FORCE_RENDER && component.shouldComponentUpdate && component.shouldComponentUpdate(props, state, context) === false) {\n\t\t\t\tskip = true;\n\t\t\t} else if (component.componentWillUpdate) {\n\t\t\t\tcomponent.componentWillUpdate(props, state, context);\n\t\t\t}\n\t\t\tcomponent.props = props;\n\t\t\tcomponent.state = state;\n\t\t\tcomponent.context = context;\n\t\t}\n\n\t\tcomponent.prevProps = component.prevState = component.prevContext = component.nextBase = null;\n\t\tcomponent._dirty = false;\n\n\t\tif (!skip) {\n\t\t\trendered = component.render(props, state, context);\n\n\t\t\tif (component.getChildContext) {\n\t\t\t\tcontext = extend(extend({}, context), component.getChildContext());\n\t\t\t}\n\n\t\t\tif (isUpdate && component.getSnapshotBeforeUpdate) {\n\t\t\t\tsnapshot = component.getSnapshotBeforeUpdate(previousProps, previousState);\n\t\t\t}\n\n\t\t\tvar childComponent = rendered && rendered.nodeName,\n\t\t\t    toUnmount = void 0,\n\t\t\t    base = void 0;\n\n\t\t\tif (typeof childComponent === 'function') {\n\n\t\t\t\tvar childProps = getNodeProps(rendered);\n\t\t\t\tinst = initialChildComponent;\n\n\t\t\t\tif (inst && inst.constructor === childComponent && childProps.key == inst.__key) {\n\t\t\t\t\tsetComponentProps(inst, childProps, SYNC_RENDER, context, false);\n\t\t\t\t} else {\n\t\t\t\t\ttoUnmount = inst;\n\n\t\t\t\t\tcomponent._component = inst = createComponent(childComponent, childProps, context);\n\t\t\t\t\tinst.nextBase = inst.nextBase || nextBase;\n\t\t\t\t\tinst._parentComponent = component;\n\t\t\t\t\tsetComponentProps(inst, childProps, NO_RENDER, context, false);\n\t\t\t\t\trenderComponent(inst, SYNC_RENDER, mountAll, true);\n\t\t\t\t}\n\n\t\t\t\tbase = inst.base;\n\t\t\t} else {\n\t\t\t\tcbase = initialBase;\n\n\t\t\t\ttoUnmount = initialChildComponent;\n\t\t\t\tif (toUnmount) {\n\t\t\t\t\tcbase = component._component = null;\n\t\t\t\t}\n\n\t\t\t\tif (initialBase || renderMode === SYNC_RENDER) {\n\t\t\t\t\tif (cbase) cbase._component = null;\n\t\t\t\t\tbase = diff(cbase, rendered, context, mountAll || !isUpdate, initialBase && initialBase.parentNode, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (initialBase && base !== initialBase && inst !== initialChildComponent) {\n\t\t\t\tvar baseParent = initialBase.parentNode;\n\t\t\t\tif (baseParent && base !== baseParent) {\n\t\t\t\t\tbaseParent.replaceChild(base, initialBase);\n\n\t\t\t\t\tif (!toUnmount) {\n\t\t\t\t\t\tinitialBase._component = null;\n\t\t\t\t\t\trecollectNodeTree(initialBase, false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (toUnmount) {\n\t\t\t\tunmountComponent(toUnmount);\n\t\t\t}\n\n\t\t\tcomponent.base = base;\n\t\t\tif (base && !isChild) {\n\t\t\t\tvar componentRef = component,\n\t\t\t\t    t = component;\n\t\t\t\twhile (t = t._parentComponent) {\n\t\t\t\t\t(componentRef = t).base = base;\n\t\t\t\t}\n\t\t\t\tbase._component = componentRef;\n\t\t\t\tbase._componentConstructor = componentRef.constructor;\n\t\t\t}\n\t\t}\n\n\t\tif (!isUpdate || mountAll) {\n\t\t\tmounts.push(component);\n\t\t} else if (!skip) {\n\n\t\t\tif (component.componentDidUpdate) {\n\t\t\t\tcomponent.componentDidUpdate(previousProps, previousState, snapshot);\n\t\t\t}\n\t\t\tif (options.afterUpdate) options.afterUpdate(component);\n\t\t}\n\n\t\twhile (component._renderCallbacks.length) {\n\t\t\tcomponent._renderCallbacks.pop().call(component);\n\t\t}if (!diffLevel && !isChild) flushMounts();\n\t}\n\n\tfunction buildComponentFromVNode(dom, vnode, context, mountAll) {\n\t\tvar c = dom && dom._component,\n\t\t    originalComponent = c,\n\t\t    oldDom = dom,\n\t\t    isDirectOwner = c && dom._componentConstructor === vnode.nodeName,\n\t\t    isOwner = isDirectOwner,\n\t\t    props = getNodeProps(vnode);\n\t\twhile (c && !isOwner && (c = c._parentComponent)) {\n\t\t\tisOwner = c.constructor === vnode.nodeName;\n\t\t}\n\n\t\tif (c && isOwner && (!mountAll || c._component)) {\n\t\t\tsetComponentProps(c, props, ASYNC_RENDER, context, mountAll);\n\t\t\tdom = c.base;\n\t\t} else {\n\t\t\tif (originalComponent && !isDirectOwner) {\n\t\t\t\tunmountComponent(originalComponent);\n\t\t\t\tdom = oldDom = null;\n\t\t\t}\n\n\t\t\tc = createComponent(vnode.nodeName, props, context);\n\t\t\tif (dom && !c.nextBase) {\n\t\t\t\tc.nextBase = dom;\n\n\t\t\t\toldDom = null;\n\t\t\t}\n\t\t\tsetComponentProps(c, props, SYNC_RENDER, context, mountAll);\n\t\t\tdom = c.base;\n\n\t\t\tif (oldDom && dom !== oldDom) {\n\t\t\t\toldDom._component = null;\n\t\t\t\trecollectNodeTree(oldDom, false);\n\t\t\t}\n\t\t}\n\n\t\treturn dom;\n\t}\n\n\tfunction unmountComponent(component) {\n\t\tif (options.beforeUnmount) options.beforeUnmount(component);\n\n\t\tvar base = component.base;\n\n\t\tcomponent._disable = true;\n\n\t\tif (component.componentWillUnmount) component.componentWillUnmount();\n\n\t\tcomponent.base = null;\n\n\t\tvar inner = component._component;\n\t\tif (inner) {\n\t\t\tunmountComponent(inner);\n\t\t} else if (base) {\n\t\t\tif (base[ATTR_KEY] != null) applyRef(base[ATTR_KEY].ref, null);\n\n\t\t\tcomponent.nextBase = base;\n\n\t\t\tremoveNode(base);\n\t\t\trecyclerComponents.push(component);\n\n\t\t\tremoveChildren(base);\n\t\t}\n\n\t\tapplyRef(component.__ref, null);\n\t}\n\n\tfunction Component(props, context) {\n\t\tthis._dirty = true;\n\n\t\tthis.context = context;\n\n\t\tthis.props = props;\n\n\t\tthis.state = this.state || {};\n\n\t\tthis._renderCallbacks = [];\n\t}\n\n\textend(Component.prototype, {\n\t\tsetState: function setState(state, callback) {\n\t\t\tif (!this.prevState) this.prevState = this.state;\n\t\t\tthis.state = extend(extend({}, this.state), typeof state === 'function' ? state(this.state, this.props) : state);\n\t\t\tif (callback) this._renderCallbacks.push(callback);\n\t\t\tenqueueRender(this);\n\t\t},\n\t\tforceUpdate: function forceUpdate(callback) {\n\t\t\tif (callback) this._renderCallbacks.push(callback);\n\t\t\trenderComponent(this, FORCE_RENDER);\n\t\t},\n\t\trender: function render() {}\n\t});\n\n\tfunction render(vnode, parent, merge) {\n\t  return diff(merge, vnode, {}, false, parent, false);\n\t}\n\n\tfunction createRef() {\n\t\treturn {};\n\t}\n\n\tvar preact = {\n\t\th: h,\n\t\tcreateElement: h,\n\t\tcloneElement: cloneElement,\n\t\tcreateRef: createRef,\n\t\tComponent: Component,\n\t\trender: render,\n\t\trerender: rerender,\n\t\toptions: options\n\t};\n\n\texports.default = preact;\n\texports.h = h;\n\texports.createElement = h;\n\texports.cloneElement = cloneElement;\n\texports.createRef = createRef;\n\texports.Component = Component;\n\texports.render = render;\n\texports.rerender = rerender;\n\texports.options = options;\n\n\tObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=preact.umd.js.map\n","import { stylesheet } from 'typestyle'\n\nconst controlsStyle = () => ({\n  zIndex: 30,\n  position: 'absolute' as 'absolute',\n  width: '100%',\n  bottom: 0,\n  padding: '0 16px',\n  boxSizing: 'border-box' as 'border-box',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  userSelect: 'none' as 'none',\n  opacity: 0,\n  transition: 'opacity 0.2s'\n})\n\nexport const ControlsStyle = stylesheet({\n  controls: {\n    ...controlsStyle()\n  },\n  controlsVisible: {\n    ...controlsStyle(),\n    opacity: 1\n  },\n  buttons: {\n    height: '100%',\n    display: 'flex',\n    justifyContent: 'space-between',\n    marginBottom: '6px',\n    alignItems: 'center'\n  },\n  button: {\n    width: '32px',\n    height: '32px',\n    padding: '7px',\n    boxSizing: 'border-box',\n    cursor: 'pointer'\n  },\n  left: {\n    display: 'flex',\n    alignItems: 'center',\n    $nest: {\n      '& .button': {\n        marginRight: '8px'\n      }\n    }\n  },\n  right: {\n    display: 'flex',\n    alignItems: 'center',\n    width: '70px',\n    height: '100%',\n    justifyContent: 'space-between'\n  }\n})\n","export function basename(path: string, extension?: string) {\n  return path.slice(path.lastIndexOf('/') + 1).replace(extension || '', '')\n}\n\nexport function extname(path: string) {\n  const slashPos = path.lastIndexOf('/')\n  const dotPos = path.lastIndexOf('.')\n  if (slashPos < dotPos) {\n    return path.slice(dotPos)\n  } else {\n    return ''\n  }\n}\n\nexport function evt(event: string, payload: { detail: any} | {} = {}): CustomEvent {\n  return new CustomEvent(event, payload ? payload : {});\n}\n","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 2x3 Matrix\r\n * @module mat2d\r\n *\r\n * @description\r\n * A mat2d contains six elements defined as:\r\n * <pre>\r\n * [a, c, tx,\r\n *  b, d, ty]\r\n * </pre>\r\n * This is a short form for the 3x3 matrix:\r\n * <pre>\r\n * [a, c, tx,\r\n *  b, d, ty,\r\n *  0, 0, 1]\r\n * </pre>\r\n * The last row is ignored so the array is shorter and operations are faster.\r\n */\r\n\r\n/**\r\n * Creates a new identity mat2d\r\n *\r\n * @returns {mat2d} a new 2x3 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(6);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[4] = 0;\r\n    out[5] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat2d initialized with values from an existing matrix\r\n *\r\n * @param {mat2d} a matrix to clone\r\n * @returns {mat2d} a new 2x3 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(6);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat2d to another\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the source matrix\r\n * @returns {mat2d} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat2d to the identity matrix\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @returns {mat2d} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat2d with the given values\r\n *\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat2d} A new mat2d\r\n */\r\nexport function fromValues(a, b, c, d, tx, ty) {\r\n  var out = new glMatrix.ARRAY_TYPE(6);\r\n  out[0] = a;\r\n  out[1] = b;\r\n  out[2] = c;\r\n  out[3] = d;\r\n  out[4] = tx;\r\n  out[5] = ty;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat2d to the given values\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {Number} a Component A (index 0)\r\n * @param {Number} b Component B (index 1)\r\n * @param {Number} c Component C (index 2)\r\n * @param {Number} d Component D (index 3)\r\n * @param {Number} tx Component TX (index 4)\r\n * @param {Number} ty Component TY (index 5)\r\n * @returns {mat2d} out\r\n */\r\nexport function set(out, a, b, c, d, tx, ty) {\r\n  out[0] = a;\r\n  out[1] = b;\r\n  out[2] = c;\r\n  out[3] = d;\r\n  out[4] = tx;\r\n  out[5] = ty;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat2d\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the source matrix\r\n * @returns {mat2d} out\r\n */\r\nexport function invert(out, a) {\r\n  var aa = a[0],\r\n      ab = a[1],\r\n      ac = a[2],\r\n      ad = a[3];\r\n  var atx = a[4],\r\n      aty = a[5];\r\n\r\n  var det = aa * ad - ab * ac;\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = ad * det;\r\n  out[1] = -ab * det;\r\n  out[2] = -ac * det;\r\n  out[3] = aa * det;\r\n  out[4] = (ac * aty - ad * atx) * det;\r\n  out[5] = (ab * atx - aa * aty) * det;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat2d\r\n *\r\n * @param {mat2d} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  return a[0] * a[3] - a[1] * a[2];\r\n}\r\n\r\n/**\r\n * Multiplies two mat2d's\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5];\r\n  out[0] = a0 * b0 + a2 * b1;\r\n  out[1] = a1 * b0 + a3 * b1;\r\n  out[2] = a0 * b2 + a2 * b3;\r\n  out[3] = a1 * b2 + a3 * b3;\r\n  out[4] = a0 * b4 + a2 * b5 + a4;\r\n  out[5] = a1 * b4 + a3 * b5 + a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat2d by the given angle\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2d} out\r\n */\r\nexport function rotate(out, a, rad) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  out[0] = a0 * c + a2 * s;\r\n  out[1] = a1 * c + a3 * s;\r\n  out[2] = a0 * -s + a2 * c;\r\n  out[3] = a1 * -s + a3 * c;\r\n  out[4] = a4;\r\n  out[5] = a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales the mat2d by the dimensions in the given vec2\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to translate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat2d} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var v0 = v[0],\r\n      v1 = v[1];\r\n  out[0] = a0 * v0;\r\n  out[1] = a1 * v0;\r\n  out[2] = a2 * v1;\r\n  out[3] = a3 * v1;\r\n  out[4] = a4;\r\n  out[5] = a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translates the mat2d by the dimensions in the given vec2\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to translate\r\n * @param {vec2} v the vec2 to translate the matrix by\r\n * @returns {mat2d} out\r\n **/\r\nexport function translate(out, a, v) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var v0 = v[0],\r\n      v1 = v[1];\r\n  out[0] = a0;\r\n  out[1] = a1;\r\n  out[2] = a2;\r\n  out[3] = a3;\r\n  out[4] = a0 * v0 + a2 * v1 + a4;\r\n  out[5] = a1 * v0 + a3 * v1 + a5;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.rotate(dest, dest, rad);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat2d} out\r\n */\r\nexport function fromRotation(out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = -s;\r\n  out[3] = c;\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.scale(dest, dest, vec);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat2d} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = v[1];\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat2d.identity(dest);\r\n *     mat2d.translate(dest, dest, vec);\r\n *\r\n * @param {mat2d} out mat2d receiving operation result\r\n * @param {vec2} v Translation vector\r\n * @returns {mat2d} out\r\n */\r\nexport function fromTranslation(out, v) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = v[0];\r\n  out[5] = v[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a mat2d\r\n *\r\n * @param {mat2d} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat2d(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat2d\r\n *\r\n * @param {mat2d} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + 1);\r\n}\r\n\r\n/**\r\n * Adds two mat2d's\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @returns {mat2d} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  out[4] = a[4] - b[4];\r\n  out[5] = a[5] - b[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat2d} out the receiving matrix\r\n * @param {mat2d} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat2d} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat2d's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat2d} out the receiving vector\r\n * @param {mat2d} a the first operand\r\n * @param {mat2d} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat2d} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  out[4] = a[4] + b[4] * scale;\r\n  out[5] = a[5] + b[5] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat2d} a The first matrix.\r\n * @param {mat2d} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat2d} a The first matrix.\r\n * @param {mat2d} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5));\r\n}\r\n\r\n/**\r\n * Alias for {@link mat2d.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat2d.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 3x3 Matrix\r\n * @module mat3\r\n */\r\n\r\n/**\r\n * Creates a new identity mat3\r\n *\r\n * @returns {mat3} a new 3x3 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(9);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n    out[5] = 0;\r\n    out[6] = 0;\r\n    out[7] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[4] = 1;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copies the upper-left 3x3 values into the given mat3.\r\n *\r\n * @param {mat3} out the receiving 3x3 matrix\r\n * @param {mat4} a   the source 4x4 matrix\r\n * @returns {mat3} out\r\n */\r\nexport function fromMat4(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[4];\r\n  out[4] = a[5];\r\n  out[5] = a[6];\r\n  out[6] = a[8];\r\n  out[7] = a[9];\r\n  out[8] = a[10];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat3 initialized with values from an existing matrix\r\n *\r\n * @param {mat3} a matrix to clone\r\n * @returns {mat3} a new 3x3 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(9);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat3 to another\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat3 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\r\n * @returns {mat3} A new mat3\r\n */\r\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\r\n  var out = new glMatrix.ARRAY_TYPE(9);\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m10;\r\n  out[4] = m11;\r\n  out[5] = m12;\r\n  out[6] = m20;\r\n  out[7] = m21;\r\n  out[8] = m22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat3 to the given values\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\r\n * @returns {mat3} out\r\n */\r\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m10;\r\n  out[4] = m11;\r\n  out[5] = m12;\r\n  out[6] = m20;\r\n  out[7] = m21;\r\n  out[8] = m22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat3 to the identity matrix\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @returns {mat3} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 1;\r\n  out[5] = 0;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transpose the values of a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function transpose(out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a01 = a[1],\r\n        a02 = a[2],\r\n        a12 = a[5];\r\n    out[1] = a[3];\r\n    out[2] = a[6];\r\n    out[3] = a01;\r\n    out[5] = a[7];\r\n    out[6] = a02;\r\n    out[7] = a12;\r\n  } else {\r\n    out[0] = a[0];\r\n    out[1] = a[3];\r\n    out[2] = a[6];\r\n    out[3] = a[1];\r\n    out[4] = a[4];\r\n    out[5] = a[7];\r\n    out[6] = a[2];\r\n    out[7] = a[5];\r\n    out[8] = a[8];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function invert(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  var b01 = a22 * a11 - a12 * a21;\r\n  var b11 = -a22 * a10 + a12 * a20;\r\n  var b21 = a21 * a10 - a11 * a20;\r\n\r\n  // Calculate the determinant\r\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = b01 * det;\r\n  out[1] = (-a22 * a01 + a02 * a21) * det;\r\n  out[2] = (a12 * a01 - a02 * a11) * det;\r\n  out[3] = b11 * det;\r\n  out[4] = (a22 * a00 - a02 * a20) * det;\r\n  out[5] = (-a12 * a00 + a02 * a10) * det;\r\n  out[6] = b21 * det;\r\n  out[7] = (-a21 * a00 + a01 * a20) * det;\r\n  out[8] = (a11 * a00 - a01 * a10) * det;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the adjugate of a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the source matrix\r\n * @returns {mat3} out\r\n */\r\nexport function adjoint(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  out[0] = a11 * a22 - a12 * a21;\r\n  out[1] = a02 * a21 - a01 * a22;\r\n  out[2] = a01 * a12 - a02 * a11;\r\n  out[3] = a12 * a20 - a10 * a22;\r\n  out[4] = a00 * a22 - a02 * a20;\r\n  out[5] = a02 * a10 - a00 * a12;\r\n  out[6] = a10 * a21 - a11 * a20;\r\n  out[7] = a01 * a20 - a00 * a21;\r\n  out[8] = a00 * a11 - a01 * a10;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat3\r\n *\r\n * @param {mat3} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\r\n}\r\n\r\n/**\r\n * Multiplies two mat3's\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2];\r\n  var a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5];\r\n  var a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8];\r\n\r\n  var b00 = b[0],\r\n      b01 = b[1],\r\n      b02 = b[2];\r\n  var b10 = b[3],\r\n      b11 = b[4],\r\n      b12 = b[5];\r\n  var b20 = b[6],\r\n      b21 = b[7],\r\n      b22 = b[8];\r\n\r\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\r\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\r\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\r\n\r\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\r\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\r\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\r\n\r\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\r\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\r\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translate a mat3 by the given vector\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to translate\r\n * @param {vec2} v vector to translate by\r\n * @returns {mat3} out\r\n */\r\nexport function translate(out, a, v) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5],\r\n      a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8],\r\n      x = v[0],\r\n      y = v[1];\r\n\r\n  out[0] = a00;\r\n  out[1] = a01;\r\n  out[2] = a02;\r\n\r\n  out[3] = a10;\r\n  out[4] = a11;\r\n  out[5] = a12;\r\n\r\n  out[6] = x * a00 + y * a10 + a20;\r\n  out[7] = x * a01 + y * a11 + a21;\r\n  out[8] = x * a02 + y * a12 + a22;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat3 by the given angle\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat3} out\r\n */\r\nexport function rotate(out, a, rad) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a10 = a[3],\r\n      a11 = a[4],\r\n      a12 = a[5],\r\n      a20 = a[6],\r\n      a21 = a[7],\r\n      a22 = a[8],\r\n      s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  out[0] = c * a00 + s * a10;\r\n  out[1] = c * a01 + s * a11;\r\n  out[2] = c * a02 + s * a12;\r\n\r\n  out[3] = c * a10 - s * a00;\r\n  out[4] = c * a11 - s * a01;\r\n  out[5] = c * a12 - s * a02;\r\n\r\n  out[6] = a20;\r\n  out[7] = a21;\r\n  out[8] = a22;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Scales the mat3 by the dimensions in the given vec2\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to rotate\r\n * @param {vec2} v the vec2 to scale the matrix by\r\n * @returns {mat3} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var x = v[0],\r\n      y = v[1];\r\n\r\n  out[0] = x * a[0];\r\n  out[1] = x * a[1];\r\n  out[2] = x * a[2];\r\n\r\n  out[3] = y * a[3];\r\n  out[4] = y * a[4];\r\n  out[5] = y * a[5];\r\n\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.translate(dest, dest, vec);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {vec2} v Translation vector\r\n * @returns {mat3} out\r\n */\r\nexport function fromTranslation(out, v) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 1;\r\n  out[5] = 0;\r\n  out[6] = v[0];\r\n  out[7] = v[1];\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.rotate(dest, dest, rad);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat3} out\r\n */\r\nexport function fromRotation(out, rad) {\r\n  var s = Math.sin(rad),\r\n      c = Math.cos(rad);\r\n\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = 0;\r\n\r\n  out[3] = -s;\r\n  out[4] = c;\r\n  out[5] = 0;\r\n\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat3.identity(dest);\r\n *     mat3.scale(dest, dest, vec);\r\n *\r\n * @param {mat3} out mat3 receiving operation result\r\n * @param {vec2} v Scaling vector\r\n * @returns {mat3} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n\r\n  out[3] = 0;\r\n  out[4] = v[1];\r\n  out[5] = 0;\r\n\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copies the values from a mat2d into a mat3\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat2d} a the matrix to copy\r\n * @returns {mat3} out\r\n **/\r\nexport function fromMat2d(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = 0;\r\n\r\n  out[3] = a[2];\r\n  out[4] = a[3];\r\n  out[5] = 0;\r\n\r\n  out[6] = a[4];\r\n  out[7] = a[5];\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n* Calculates a 3x3 matrix from the given quaternion\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {quat} q Quaternion to create matrix from\r\n*\r\n* @returns {mat3} out\r\n*/\r\nexport function fromQuat(out, q) {\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var yx = y * x2;\r\n  var yy = y * y2;\r\n  var zx = z * x2;\r\n  var zy = z * y2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out[0] = 1 - yy - zz;\r\n  out[3] = yx - wz;\r\n  out[6] = zx + wy;\r\n\r\n  out[1] = yx + wz;\r\n  out[4] = 1 - xx - zz;\r\n  out[7] = zy - wx;\r\n\r\n  out[2] = zx - wy;\r\n  out[5] = zy + wx;\r\n  out[8] = 1 - xx - yy;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n* Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\r\n*\r\n* @param {mat3} out mat3 receiving operation result\r\n* @param {mat4} a Mat4 to derive the normal matrix from\r\n*\r\n* @returns {mat3} out\r\n*/\r\nexport function normalFromMat4(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n\r\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n\r\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a 2D projection matrix with the given bounds\r\n *\r\n * @param {mat3} out mat3 frustum matrix will be written into\r\n * @param {number} width Width of your gl context\r\n * @param {number} height Height of gl context\r\n * @returns {mat3} out\r\n */\r\nexport function projection(out, width, height) {\r\n  out[0] = 2 / width;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = -2 / height;\r\n  out[5] = 0;\r\n  out[6] = -1;\r\n  out[7] = 1;\r\n  out[8] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a mat3\r\n *\r\n * @param {mat3} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat3(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' + a[8] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat3\r\n *\r\n * @param {mat3} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2));\r\n}\r\n\r\n/**\r\n * Adds two mat3's\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  out[6] = a[6] + b[6];\r\n  out[7] = a[7] + b[7];\r\n  out[8] = a[8] + b[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @returns {mat3} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  out[4] = a[4] - b[4];\r\n  out[5] = a[5] - b[5];\r\n  out[6] = a[6] - b[6];\r\n  out[7] = a[7] - b[7];\r\n  out[8] = a[8] - b[8];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat3} out the receiving matrix\r\n * @param {mat3} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat3} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  out[6] = a[6] * b;\r\n  out[7] = a[7] * b;\r\n  out[8] = a[8] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat3} out the receiving vector\r\n * @param {mat3} a the first operand\r\n * @param {mat3} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat3} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  out[4] = a[4] + b[4] * scale;\r\n  out[5] = a[5] + b[5] * scale;\r\n  out[6] = a[6] + b[6] * scale;\r\n  out[7] = a[7] + b[7] * scale;\r\n  out[8] = a[8] + b[8] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat3} a The first matrix.\r\n * @param {mat3} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat3} a The first matrix.\r\n * @param {mat3} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5],\r\n      a6 = a[6],\r\n      a7 = a[7],\r\n      a8 = a[8];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5],\r\n      b6 = b[6],\r\n      b7 = b[7],\r\n      b8 = b[8];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\r\n}\r\n\r\n/**\r\n * Alias for {@link mat3.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat3.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\r\n * @module mat4\r\n */\r\n\r\n/**\r\n * Creates a new identity mat4\r\n *\r\n * @returns {mat4} a new 4x4 matrix\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(16);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n    out[4] = 0;\r\n    out[6] = 0;\r\n    out[7] = 0;\r\n    out[8] = 0;\r\n    out[9] = 0;\r\n    out[11] = 0;\r\n    out[12] = 0;\r\n    out[13] = 0;\r\n    out[14] = 0;\r\n  }\r\n  out[0] = 1;\r\n  out[5] = 1;\r\n  out[10] = 1;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat4 initialized with values from an existing matrix\r\n *\r\n * @param {mat4} a matrix to clone\r\n * @returns {mat4} a new 4x4 matrix\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(16);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  out[9] = a[9];\r\n  out[10] = a[10];\r\n  out[11] = a[11];\r\n  out[12] = a[12];\r\n  out[13] = a[13];\r\n  out[14] = a[14];\r\n  out[15] = a[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one mat4 to another\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  out[8] = a[8];\r\n  out[9] = a[9];\r\n  out[10] = a[10];\r\n  out[11] = a[11];\r\n  out[12] = a[12];\r\n  out[13] = a[13];\r\n  out[14] = a[14];\r\n  out[15] = a[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Create a new mat4 with the given values\r\n *\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} A new mat4\r\n */\r\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n  var out = new glMatrix.ARRAY_TYPE(16);\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m03;\r\n  out[4] = m10;\r\n  out[5] = m11;\r\n  out[6] = m12;\r\n  out[7] = m13;\r\n  out[8] = m20;\r\n  out[9] = m21;\r\n  out[10] = m22;\r\n  out[11] = m23;\r\n  out[12] = m30;\r\n  out[13] = m31;\r\n  out[14] = m32;\r\n  out[15] = m33;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a mat4 to the given values\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\r\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\r\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\r\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\r\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\r\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\r\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\r\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\r\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\r\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\r\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\r\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\r\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\r\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\r\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\r\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\r\n * @returns {mat4} out\r\n */\r\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\r\n  out[0] = m00;\r\n  out[1] = m01;\r\n  out[2] = m02;\r\n  out[3] = m03;\r\n  out[4] = m10;\r\n  out[5] = m11;\r\n  out[6] = m12;\r\n  out[7] = m13;\r\n  out[8] = m20;\r\n  out[9] = m21;\r\n  out[10] = m22;\r\n  out[11] = m23;\r\n  out[12] = m30;\r\n  out[13] = m31;\r\n  out[14] = m32;\r\n  out[15] = m33;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a mat4 to the identity matrix\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @returns {mat4} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = 1;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transpose the values of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function transpose(out, a) {\r\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\r\n  if (out === a) {\r\n    var a01 = a[1],\r\n        a02 = a[2],\r\n        a03 = a[3];\r\n    var a12 = a[6],\r\n        a13 = a[7];\r\n    var a23 = a[11];\r\n\r\n    out[1] = a[4];\r\n    out[2] = a[8];\r\n    out[3] = a[12];\r\n    out[4] = a01;\r\n    out[6] = a[9];\r\n    out[7] = a[13];\r\n    out[8] = a02;\r\n    out[9] = a12;\r\n    out[11] = a[14];\r\n    out[12] = a03;\r\n    out[13] = a13;\r\n    out[14] = a23;\r\n  } else {\r\n    out[0] = a[0];\r\n    out[1] = a[4];\r\n    out[2] = a[8];\r\n    out[3] = a[12];\r\n    out[4] = a[1];\r\n    out[5] = a[5];\r\n    out[6] = a[9];\r\n    out[7] = a[13];\r\n    out[8] = a[2];\r\n    out[9] = a[6];\r\n    out[10] = a[10];\r\n    out[11] = a[14];\r\n    out[12] = a[3];\r\n    out[13] = a[7];\r\n    out[14] = a[11];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Inverts a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function invert(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n\r\n  if (!det) {\r\n    return null;\r\n  }\r\n  det = 1.0 / det;\r\n\r\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\r\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\r\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\r\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\r\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\r\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\r\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\r\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\r\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\r\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\r\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\r\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\r\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\r\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\r\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\r\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the adjugate of a mat4\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the source matrix\r\n * @returns {mat4} out\r\n */\r\nexport function adjoint(out, a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\r\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\r\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\r\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\r\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\r\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\r\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\r\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\r\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\r\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\r\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\r\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\r\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\r\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\r\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\r\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the determinant of a mat4\r\n *\r\n * @param {mat4} a the source matrix\r\n * @returns {Number} determinant of a\r\n */\r\nexport function determinant(a) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  var b00 = a00 * a11 - a01 * a10;\r\n  var b01 = a00 * a12 - a02 * a10;\r\n  var b02 = a00 * a13 - a03 * a10;\r\n  var b03 = a01 * a12 - a02 * a11;\r\n  var b04 = a01 * a13 - a03 * a11;\r\n  var b05 = a02 * a13 - a03 * a12;\r\n  var b06 = a20 * a31 - a21 * a30;\r\n  var b07 = a20 * a32 - a22 * a30;\r\n  var b08 = a20 * a33 - a23 * a30;\r\n  var b09 = a21 * a32 - a22 * a31;\r\n  var b10 = a21 * a33 - a23 * a31;\r\n  var b11 = a22 * a33 - a23 * a32;\r\n\r\n  // Calculate the determinant\r\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\r\n}\r\n\r\n/**\r\n * Multiplies two mat4s\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var a00 = a[0],\r\n      a01 = a[1],\r\n      a02 = a[2],\r\n      a03 = a[3];\r\n  var a10 = a[4],\r\n      a11 = a[5],\r\n      a12 = a[6],\r\n      a13 = a[7];\r\n  var a20 = a[8],\r\n      a21 = a[9],\r\n      a22 = a[10],\r\n      a23 = a[11];\r\n  var a30 = a[12],\r\n      a31 = a[13],\r\n      a32 = a[14],\r\n      a33 = a[15];\r\n\r\n  // Cache only the current line of the second matrix\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b[4];b1 = b[5];b2 = b[6];b3 = b[7];\r\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b[8];b1 = b[9];b2 = b[10];b3 = b[11];\r\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n\r\n  b0 = b[12];b1 = b[13];b2 = b[14];b3 = b[15];\r\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\r\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\r\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\r\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translate a mat4 by the given vector\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {mat4} out\r\n */\r\nexport function translate(out, a, v) {\r\n  var x = v[0],\r\n      y = v[1],\r\n      z = v[2];\r\n  var a00 = void 0,\r\n      a01 = void 0,\r\n      a02 = void 0,\r\n      a03 = void 0;\r\n  var a10 = void 0,\r\n      a11 = void 0,\r\n      a12 = void 0,\r\n      a13 = void 0;\r\n  var a20 = void 0,\r\n      a21 = void 0,\r\n      a22 = void 0,\r\n      a23 = void 0;\r\n\r\n  if (a === out) {\r\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\r\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\r\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\r\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\r\n  } else {\r\n    a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];\r\n    a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];\r\n    a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];\r\n\r\n    out[0] = a00;out[1] = a01;out[2] = a02;out[3] = a03;\r\n    out[4] = a10;out[5] = a11;out[6] = a12;out[7] = a13;\r\n    out[8] = a20;out[9] = a21;out[10] = a22;out[11] = a23;\r\n\r\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\r\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\r\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\r\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {vec3} v the vec3 to scale the matrix by\r\n * @returns {mat4} out\r\n **/\r\nexport function scale(out, a, v) {\r\n  var x = v[0],\r\n      y = v[1],\r\n      z = v[2];\r\n\r\n  out[0] = a[0] * x;\r\n  out[1] = a[1] * x;\r\n  out[2] = a[2] * x;\r\n  out[3] = a[3] * x;\r\n  out[4] = a[4] * y;\r\n  out[5] = a[5] * y;\r\n  out[6] = a[6] * y;\r\n  out[7] = a[7] * y;\r\n  out[8] = a[8] * z;\r\n  out[9] = a[9] * z;\r\n  out[10] = a[10] * z;\r\n  out[11] = a[11] * z;\r\n  out[12] = a[12];\r\n  out[13] = a[13];\r\n  out[14] = a[14];\r\n  out[15] = a[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a mat4 by the given angle around the given axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\r\nexport function rotate(out, a, rad, axis) {\r\n  var x = axis[0],\r\n      y = axis[1],\r\n      z = axis[2];\r\n  var len = Math.sqrt(x * x + y * y + z * z);\r\n  var s = void 0,\r\n      c = void 0,\r\n      t = void 0;\r\n  var a00 = void 0,\r\n      a01 = void 0,\r\n      a02 = void 0,\r\n      a03 = void 0;\r\n  var a10 = void 0,\r\n      a11 = void 0,\r\n      a12 = void 0,\r\n      a13 = void 0;\r\n  var a20 = void 0,\r\n      a21 = void 0,\r\n      a22 = void 0,\r\n      a23 = void 0;\r\n  var b00 = void 0,\r\n      b01 = void 0,\r\n      b02 = void 0;\r\n  var b10 = void 0,\r\n      b11 = void 0,\r\n      b12 = void 0;\r\n  var b20 = void 0,\r\n      b21 = void 0,\r\n      b22 = void 0;\r\n\r\n  if (len < glMatrix.EPSILON) {\r\n    return null;\r\n  }\r\n\r\n  len = 1 / len;\r\n  x *= len;\r\n  y *= len;\r\n  z *= len;\r\n\r\n  s = Math.sin(rad);\r\n  c = Math.cos(rad);\r\n  t = 1 - c;\r\n\r\n  a00 = a[0];a01 = a[1];a02 = a[2];a03 = a[3];\r\n  a10 = a[4];a11 = a[5];a12 = a[6];a13 = a[7];\r\n  a20 = a[8];a21 = a[9];a22 = a[10];a23 = a[11];\r\n\r\n  // Construct the elements of the rotation matrix\r\n  b00 = x * x * t + c;b01 = y * x * t + z * s;b02 = z * x * t - y * s;\r\n  b10 = x * y * t - z * s;b11 = y * y * t + c;b12 = z * y * t + x * s;\r\n  b20 = x * z * t + y * s;b21 = y * z * t - x * s;b22 = z * z * t + c;\r\n\r\n  // Perform rotation-specific matrix multiplication\r\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\r\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\r\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\r\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\r\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\r\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\r\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\r\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\r\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\r\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\r\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\r\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged last row\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the X axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function rotateX(out, a, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  var a10 = a[4];\r\n  var a11 = a[5];\r\n  var a12 = a[6];\r\n  var a13 = a[7];\r\n  var a20 = a[8];\r\n  var a21 = a[9];\r\n  var a22 = a[10];\r\n  var a23 = a[11];\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged rows\r\n    out[0] = a[0];\r\n    out[1] = a[1];\r\n    out[2] = a[2];\r\n    out[3] = a[3];\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[4] = a10 * c + a20 * s;\r\n  out[5] = a11 * c + a21 * s;\r\n  out[6] = a12 * c + a22 * s;\r\n  out[7] = a13 * c + a23 * s;\r\n  out[8] = a20 * c - a10 * s;\r\n  out[9] = a21 * c - a11 * s;\r\n  out[10] = a22 * c - a12 * s;\r\n  out[11] = a23 * c - a13 * s;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the Y axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function rotateY(out, a, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  var a00 = a[0];\r\n  var a01 = a[1];\r\n  var a02 = a[2];\r\n  var a03 = a[3];\r\n  var a20 = a[8];\r\n  var a21 = a[9];\r\n  var a22 = a[10];\r\n  var a23 = a[11];\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged rows\r\n    out[4] = a[4];\r\n    out[5] = a[5];\r\n    out[6] = a[6];\r\n    out[7] = a[7];\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = a00 * c - a20 * s;\r\n  out[1] = a01 * c - a21 * s;\r\n  out[2] = a02 * c - a22 * s;\r\n  out[3] = a03 * c - a23 * s;\r\n  out[8] = a00 * s + a20 * c;\r\n  out[9] = a01 * s + a21 * c;\r\n  out[10] = a02 * s + a22 * c;\r\n  out[11] = a03 * s + a23 * c;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a matrix by the given angle around the Z axis\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to rotate\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function rotateZ(out, a, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n  var a00 = a[0];\r\n  var a01 = a[1];\r\n  var a02 = a[2];\r\n  var a03 = a[3];\r\n  var a10 = a[4];\r\n  var a11 = a[5];\r\n  var a12 = a[6];\r\n  var a13 = a[7];\r\n\r\n  if (a !== out) {\r\n    // If the source and destination differ, copy the unchanged last row\r\n    out[8] = a[8];\r\n    out[9] = a[9];\r\n    out[10] = a[10];\r\n    out[11] = a[11];\r\n    out[12] = a[12];\r\n    out[13] = a[13];\r\n    out[14] = a[14];\r\n    out[15] = a[15];\r\n  }\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = a00 * c + a10 * s;\r\n  out[1] = a01 * c + a11 * s;\r\n  out[2] = a02 * c + a12 * s;\r\n  out[3] = a03 * c + a13 * s;\r\n  out[4] = a10 * c - a00 * s;\r\n  out[5] = a11 * c - a01 * s;\r\n  out[6] = a12 * c - a02 * s;\r\n  out[7] = a13 * c - a03 * s;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromTranslation(out, v) {\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = 1;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a vector scaling\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.scale(dest, dest, vec);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {vec3} v Scaling vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromScaling(out, v) {\r\n  out[0] = v[0];\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = v[1];\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = v[2];\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a given angle around a given axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotate(dest, dest, rad, axis);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @param {vec3} axis the axis to rotate around\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotation(out, rad, axis) {\r\n  var x = axis[0],\r\n      y = axis[1],\r\n      z = axis[2];\r\n  var len = Math.sqrt(x * x + y * y + z * z);\r\n  var s = void 0,\r\n      c = void 0,\r\n      t = void 0;\r\n\r\n  if (len < glMatrix.EPSILON) {\r\n    return null;\r\n  }\r\n\r\n  len = 1 / len;\r\n  x *= len;\r\n  y *= len;\r\n  z *= len;\r\n\r\n  s = Math.sin(rad);\r\n  c = Math.cos(rad);\r\n  t = 1 - c;\r\n\r\n  // Perform rotation-specific matrix multiplication\r\n  out[0] = x * x * t + c;\r\n  out[1] = y * x * t + z * s;\r\n  out[2] = z * x * t - y * s;\r\n  out[3] = 0;\r\n  out[4] = x * y * t - z * s;\r\n  out[5] = y * y * t + c;\r\n  out[6] = z * y * t + x * s;\r\n  out[7] = 0;\r\n  out[8] = x * z * t + y * s;\r\n  out[9] = y * z * t - x * s;\r\n  out[10] = z * z * t + c;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from the given angle around the X axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateX(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function fromXRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = 1;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = c;\r\n  out[6] = s;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = -s;\r\n  out[10] = c;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from the given angle around the Y axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateY(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function fromYRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = c;\r\n  out[1] = 0;\r\n  out[2] = -s;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = 1;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = s;\r\n  out[9] = 0;\r\n  out[10] = c;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from the given angle around the Z axis\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.rotateZ(dest, dest, rad);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {Number} rad the angle to rotate the matrix by\r\n * @returns {mat4} out\r\n */\r\nexport function fromZRotation(out, rad) {\r\n  var s = Math.sin(rad);\r\n  var c = Math.cos(rad);\r\n\r\n  // Perform axis-specific matrix multiplication\r\n  out[0] = c;\r\n  out[1] = s;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = -s;\r\n  out[5] = c;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 1;\r\n  out[11] = 0;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation and vector translation\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotationTranslation(out, q, v) {\r\n  // Quaternion math\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out[0] = 1 - (yy + zz);\r\n  out[1] = xy + wz;\r\n  out[2] = xz - wy;\r\n  out[3] = 0;\r\n  out[4] = xy - wz;\r\n  out[5] = 1 - (xx + zz);\r\n  out[6] = yz + wx;\r\n  out[7] = 0;\r\n  out[8] = xz + wy;\r\n  out[9] = yz - wx;\r\n  out[10] = 1 - (xx + yy);\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new mat4 from a dual quat.\r\n *\r\n * @param {mat4} out Matrix\r\n * @param {quat2} a Dual Quaternion\r\n * @returns {mat4} mat4 receiving operation result\r\n */\r\nexport function fromQuat2(out, a) {\r\n  var translation = new glMatrix.ARRAY_TYPE(3);\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7];\r\n\r\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw;\r\n  //Only scale if it makes sense\r\n  if (magnitude > 0) {\r\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\r\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\r\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\r\n  } else {\r\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\r\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\r\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\r\n  }\r\n  fromRotationTranslation(out, a, translation);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the translation vector component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslation,\r\n *  the returned vector will be the same as the translation vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive translation component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\r\nexport function getTranslation(out, mat) {\r\n  out[0] = mat[12];\r\n  out[1] = mat[13];\r\n  out[2] = mat[14];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the scaling factor component of a transformation\r\n *  matrix. If a matrix is built with fromRotationTranslationScale\r\n *  with a normalized Quaternion paramter, the returned vector will be\r\n *  the same as the scaling vector\r\n *  originally supplied.\r\n * @param  {vec3} out Vector to receive scaling factor component\r\n * @param  {mat4} mat Matrix to be decomposed (input)\r\n * @return {vec3} out\r\n */\r\nexport function getScaling(out, mat) {\r\n  var m11 = mat[0];\r\n  var m12 = mat[1];\r\n  var m13 = mat[2];\r\n  var m21 = mat[4];\r\n  var m22 = mat[5];\r\n  var m23 = mat[6];\r\n  var m31 = mat[8];\r\n  var m32 = mat[9];\r\n  var m33 = mat[10];\r\n\r\n  out[0] = Math.sqrt(m11 * m11 + m12 * m12 + m13 * m13);\r\n  out[1] = Math.sqrt(m21 * m21 + m22 * m22 + m23 * m23);\r\n  out[2] = Math.sqrt(m31 * m31 + m32 * m32 + m33 * m33);\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a quaternion representing the rotational component\r\n *  of a transformation matrix. If a matrix is built with\r\n *  fromRotationTranslation, the returned quaternion will be the\r\n *  same as the quaternion originally supplied.\r\n * @param {quat} out Quaternion to receive the rotation component\r\n * @param {mat4} mat Matrix to be decomposed (input)\r\n * @return {quat} out\r\n */\r\nexport function getRotation(out, mat) {\r\n  // Algorithm taken from http://www.euclideanspace.com/maths/geometry/rotations/conversions/matrixToQuaternion/index.htm\r\n  var trace = mat[0] + mat[5] + mat[10];\r\n  var S = 0;\r\n\r\n  if (trace > 0) {\r\n    S = Math.sqrt(trace + 1.0) * 2;\r\n    out[3] = 0.25 * S;\r\n    out[0] = (mat[6] - mat[9]) / S;\r\n    out[1] = (mat[8] - mat[2]) / S;\r\n    out[2] = (mat[1] - mat[4]) / S;\r\n  } else if (mat[0] > mat[5] && mat[0] > mat[10]) {\r\n    S = Math.sqrt(1.0 + mat[0] - mat[5] - mat[10]) * 2;\r\n    out[3] = (mat[6] - mat[9]) / S;\r\n    out[0] = 0.25 * S;\r\n    out[1] = (mat[1] + mat[4]) / S;\r\n    out[2] = (mat[8] + mat[2]) / S;\r\n  } else if (mat[5] > mat[10]) {\r\n    S = Math.sqrt(1.0 + mat[5] - mat[0] - mat[10]) * 2;\r\n    out[3] = (mat[8] - mat[2]) / S;\r\n    out[0] = (mat[1] + mat[4]) / S;\r\n    out[1] = 0.25 * S;\r\n    out[2] = (mat[6] + mat[9]) / S;\r\n  } else {\r\n    S = Math.sqrt(1.0 + mat[10] - mat[0] - mat[5]) * 2;\r\n    out[3] = (mat[1] - mat[4]) / S;\r\n    out[0] = (mat[8] + mat[2]) / S;\r\n    out[1] = (mat[6] + mat[9]) / S;\r\n    out[2] = 0.25 * S;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotationTranslationScale(out, q, v, s) {\r\n  // Quaternion math\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n  var sx = s[0];\r\n  var sy = s[1];\r\n  var sz = s[2];\r\n\r\n  out[0] = (1 - (yy + zz)) * sx;\r\n  out[1] = (xy + wz) * sx;\r\n  out[2] = (xz - wy) * sx;\r\n  out[3] = 0;\r\n  out[4] = (xy - wz) * sy;\r\n  out[5] = (1 - (xx + zz)) * sy;\r\n  out[6] = (yz + wx) * sy;\r\n  out[7] = 0;\r\n  out[8] = (xz + wy) * sz;\r\n  out[9] = (yz - wx) * sz;\r\n  out[10] = (1 - (xx + yy)) * sz;\r\n  out[11] = 0;\r\n  out[12] = v[0];\r\n  out[13] = v[1];\r\n  out[14] = v[2];\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\r\n * This is equivalent to (but much faster than):\r\n *\r\n *     mat4.identity(dest);\r\n *     mat4.translate(dest, vec);\r\n *     mat4.translate(dest, origin);\r\n *     let quatMat = mat4.create();\r\n *     quat4.toMat4(quat, quatMat);\r\n *     mat4.multiply(dest, quatMat);\r\n *     mat4.scale(dest, scale)\r\n *     mat4.translate(dest, negativeOrigin);\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat4} q Rotation quaternion\r\n * @param {vec3} v Translation vector\r\n * @param {vec3} s Scaling vector\r\n * @param {vec3} o The origin vector around which to scale and rotate\r\n * @returns {mat4} out\r\n */\r\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\r\n  // Quaternion math\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var xy = x * y2;\r\n  var xz = x * z2;\r\n  var yy = y * y2;\r\n  var yz = y * z2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  var sx = s[0];\r\n  var sy = s[1];\r\n  var sz = s[2];\r\n\r\n  var ox = o[0];\r\n  var oy = o[1];\r\n  var oz = o[2];\r\n\r\n  var out0 = (1 - (yy + zz)) * sx;\r\n  var out1 = (xy + wz) * sx;\r\n  var out2 = (xz - wy) * sx;\r\n  var out4 = (xy - wz) * sy;\r\n  var out5 = (1 - (xx + zz)) * sy;\r\n  var out6 = (yz + wx) * sy;\r\n  var out8 = (xz + wy) * sz;\r\n  var out9 = (yz - wx) * sz;\r\n  var out10 = (1 - (xx + yy)) * sz;\r\n\r\n  out[0] = out0;\r\n  out[1] = out1;\r\n  out[2] = out2;\r\n  out[3] = 0;\r\n  out[4] = out4;\r\n  out[5] = out5;\r\n  out[6] = out6;\r\n  out[7] = 0;\r\n  out[8] = out8;\r\n  out[9] = out9;\r\n  out[10] = out10;\r\n  out[11] = 0;\r\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\r\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\r\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates a 4x4 matrix from the given quaternion\r\n *\r\n * @param {mat4} out mat4 receiving operation result\r\n * @param {quat} q Quaternion to create matrix from\r\n *\r\n * @returns {mat4} out\r\n */\r\nexport function fromQuat(out, q) {\r\n  var x = q[0],\r\n      y = q[1],\r\n      z = q[2],\r\n      w = q[3];\r\n  var x2 = x + x;\r\n  var y2 = y + y;\r\n  var z2 = z + z;\r\n\r\n  var xx = x * x2;\r\n  var yx = y * x2;\r\n  var yy = y * y2;\r\n  var zx = z * x2;\r\n  var zy = z * y2;\r\n  var zz = z * z2;\r\n  var wx = w * x2;\r\n  var wy = w * y2;\r\n  var wz = w * z2;\r\n\r\n  out[0] = 1 - yy - zz;\r\n  out[1] = yx + wz;\r\n  out[2] = zx - wy;\r\n  out[3] = 0;\r\n\r\n  out[4] = yx - wz;\r\n  out[5] = 1 - xx - zz;\r\n  out[6] = zy + wx;\r\n  out[7] = 0;\r\n\r\n  out[8] = zx + wy;\r\n  out[9] = zy - wx;\r\n  out[10] = 1 - xx - yy;\r\n  out[11] = 0;\r\n\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = 0;\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a frustum matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Number} left Left bound of the frustum\r\n * @param {Number} right Right bound of the frustum\r\n * @param {Number} bottom Bottom bound of the frustum\r\n * @param {Number} top Top bound of the frustum\r\n * @param {Number} near Near bound of the frustum\r\n * @param {Number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nexport function frustum(out, left, right, bottom, top, near, far) {\r\n  var rl = 1 / (right - left);\r\n  var tb = 1 / (top - bottom);\r\n  var nf = 1 / (near - far);\r\n  out[0] = near * 2 * rl;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = near * 2 * tb;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = (right + left) * rl;\r\n  out[9] = (top + bottom) * tb;\r\n  out[10] = (far + near) * nf;\r\n  out[11] = -1;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[14] = far * near * 2 * nf;\r\n  out[15] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a perspective projection matrix with the given bounds.\r\n * Passing null/undefined/no value for far will generate infinite projection matrix.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} fovy Vertical field of view in radians\r\n * @param {number} aspect Aspect ratio. typically viewport width/height\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum, can be null or Infinity\r\n * @returns {mat4} out\r\n */\r\nexport function perspective(out, fovy, aspect, near, far) {\r\n  var f = 1.0 / Math.tan(fovy / 2),\r\n      nf = void 0;\r\n  out[0] = f / aspect;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = f;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[11] = -1;\r\n  out[12] = 0;\r\n  out[13] = 0;\r\n  out[15] = 0;\r\n  if (far != null && far !== Infinity) {\r\n    nf = 1 / (near - far);\r\n    out[10] = (far + near) * nf;\r\n    out[14] = 2 * far * near * nf;\r\n  } else {\r\n    out[10] = -1;\r\n    out[14] = -2 * near;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a perspective projection matrix with the given field of view.\r\n * This is primarily useful for generating projection matrices to be used\r\n * with the still experiemental WebVR API.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\r\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\r\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\r\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\r\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\r\n  var xScale = 2.0 / (leftTan + rightTan);\r\n  var yScale = 2.0 / (upTan + downTan);\r\n\r\n  out[0] = xScale;\r\n  out[1] = 0.0;\r\n  out[2] = 0.0;\r\n  out[3] = 0.0;\r\n  out[4] = 0.0;\r\n  out[5] = yScale;\r\n  out[6] = 0.0;\r\n  out[7] = 0.0;\r\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\r\n  out[9] = (upTan - downTan) * yScale * 0.5;\r\n  out[10] = far / (near - far);\r\n  out[11] = -1.0;\r\n  out[12] = 0.0;\r\n  out[13] = 0.0;\r\n  out[14] = far * near / (near - far);\r\n  out[15] = 0.0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a orthogonal projection matrix with the given bounds\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {number} left Left bound of the frustum\r\n * @param {number} right Right bound of the frustum\r\n * @param {number} bottom Bottom bound of the frustum\r\n * @param {number} top Top bound of the frustum\r\n * @param {number} near Near bound of the frustum\r\n * @param {number} far Far bound of the frustum\r\n * @returns {mat4} out\r\n */\r\nexport function ortho(out, left, right, bottom, top, near, far) {\r\n  var lr = 1 / (left - right);\r\n  var bt = 1 / (bottom - top);\r\n  var nf = 1 / (near - far);\r\n  out[0] = -2 * lr;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 0;\r\n  out[4] = 0;\r\n  out[5] = -2 * bt;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  out[8] = 0;\r\n  out[9] = 0;\r\n  out[10] = 2 * nf;\r\n  out[11] = 0;\r\n  out[12] = (left + right) * lr;\r\n  out[13] = (top + bottom) * bt;\r\n  out[14] = (far + near) * nf;\r\n  out[15] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\r\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\r\nexport function lookAt(out, eye, center, up) {\r\n  var x0 = void 0,\r\n      x1 = void 0,\r\n      x2 = void 0,\r\n      y0 = void 0,\r\n      y1 = void 0,\r\n      y2 = void 0,\r\n      z0 = void 0,\r\n      z1 = void 0,\r\n      z2 = void 0,\r\n      len = void 0;\r\n  var eyex = eye[0];\r\n  var eyey = eye[1];\r\n  var eyez = eye[2];\r\n  var upx = up[0];\r\n  var upy = up[1];\r\n  var upz = up[2];\r\n  var centerx = center[0];\r\n  var centery = center[1];\r\n  var centerz = center[2];\r\n\r\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\r\n    return identity(out);\r\n  }\r\n\r\n  z0 = eyex - centerx;\r\n  z1 = eyey - centery;\r\n  z2 = eyez - centerz;\r\n\r\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2);\r\n  z0 *= len;\r\n  z1 *= len;\r\n  z2 *= len;\r\n\r\n  x0 = upy * z2 - upz * z1;\r\n  x1 = upz * z0 - upx * z2;\r\n  x2 = upx * z1 - upy * z0;\r\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2);\r\n  if (!len) {\r\n    x0 = 0;\r\n    x1 = 0;\r\n    x2 = 0;\r\n  } else {\r\n    len = 1 / len;\r\n    x0 *= len;\r\n    x1 *= len;\r\n    x2 *= len;\r\n  }\r\n\r\n  y0 = z1 * x2 - z2 * x1;\r\n  y1 = z2 * x0 - z0 * x2;\r\n  y2 = z0 * x1 - z1 * x0;\r\n\r\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2);\r\n  if (!len) {\r\n    y0 = 0;\r\n    y1 = 0;\r\n    y2 = 0;\r\n  } else {\r\n    len = 1 / len;\r\n    y0 *= len;\r\n    y1 *= len;\r\n    y2 *= len;\r\n  }\r\n\r\n  out[0] = x0;\r\n  out[1] = y0;\r\n  out[2] = z0;\r\n  out[3] = 0;\r\n  out[4] = x1;\r\n  out[5] = y1;\r\n  out[6] = z1;\r\n  out[7] = 0;\r\n  out[8] = x2;\r\n  out[9] = y2;\r\n  out[10] = z2;\r\n  out[11] = 0;\r\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\r\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\r\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\r\n  out[15] = 1;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a matrix that makes something look at something else.\r\n *\r\n * @param {mat4} out mat4 frustum matrix will be written into\r\n * @param {vec3} eye Position of the viewer\r\n * @param {vec3} center Point the viewer is looking at\r\n * @param {vec3} up vec3 pointing up\r\n * @returns {mat4} out\r\n */\r\nexport function targetTo(out, eye, target, up) {\r\n  var eyex = eye[0],\r\n      eyey = eye[1],\r\n      eyez = eye[2],\r\n      upx = up[0],\r\n      upy = up[1],\r\n      upz = up[2];\r\n\r\n  var z0 = eyex - target[0],\r\n      z1 = eyey - target[1],\r\n      z2 = eyez - target[2];\r\n\r\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    z0 *= len;\r\n    z1 *= len;\r\n    z2 *= len;\r\n  }\r\n\r\n  var x0 = upy * z2 - upz * z1,\r\n      x1 = upz * z0 - upx * z2,\r\n      x2 = upx * z1 - upy * z0;\r\n\r\n  len = x0 * x0 + x1 * x1 + x2 * x2;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    x0 *= len;\r\n    x1 *= len;\r\n    x2 *= len;\r\n  }\r\n\r\n  out[0] = x0;\r\n  out[1] = x1;\r\n  out[2] = x2;\r\n  out[3] = 0;\r\n  out[4] = z1 * x2 - z2 * x1;\r\n  out[5] = z2 * x0 - z0 * x2;\r\n  out[6] = z0 * x1 - z1 * x0;\r\n  out[7] = 0;\r\n  out[8] = z0;\r\n  out[9] = z1;\r\n  out[10] = z2;\r\n  out[11] = 0;\r\n  out[12] = eyex;\r\n  out[13] = eyey;\r\n  out[14] = eyez;\r\n  out[15] = 1;\r\n  return out;\r\n};\r\n\r\n/**\r\n * Returns a string representation of a mat4\r\n *\r\n * @param {mat4} a matrix to represent as a string\r\n * @returns {String} string representation of the matrix\r\n */\r\nexport function str(a) {\r\n  return 'mat4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ', ' + a[8] + ', ' + a[9] + ', ' + a[10] + ', ' + a[11] + ', ' + a[12] + ', ' + a[13] + ', ' + a[14] + ', ' + a[15] + ')';\r\n}\r\n\r\n/**\r\n * Returns Frobenius norm of a mat4\r\n *\r\n * @param {mat4} a the matrix to calculate Frobenius norm of\r\n * @returns {Number} Frobenius norm\r\n */\r\nexport function frob(a) {\r\n  return Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2) + Math.pow(a[2], 2) + Math.pow(a[3], 2) + Math.pow(a[4], 2) + Math.pow(a[5], 2) + Math.pow(a[6], 2) + Math.pow(a[7], 2) + Math.pow(a[8], 2) + Math.pow(a[9], 2) + Math.pow(a[10], 2) + Math.pow(a[11], 2) + Math.pow(a[12], 2) + Math.pow(a[13], 2) + Math.pow(a[14], 2) + Math.pow(a[15], 2));\r\n}\r\n\r\n/**\r\n * Adds two mat4's\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  out[6] = a[6] + b[6];\r\n  out[7] = a[7] + b[7];\r\n  out[8] = a[8] + b[8];\r\n  out[9] = a[9] + b[9];\r\n  out[10] = a[10] + b[10];\r\n  out[11] = a[11] + b[11];\r\n  out[12] = a[12] + b[12];\r\n  out[13] = a[13] + b[13];\r\n  out[14] = a[14] + b[14];\r\n  out[15] = a[15] + b[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts matrix b from matrix a\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @returns {mat4} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  out[4] = a[4] - b[4];\r\n  out[5] = a[5] - b[5];\r\n  out[6] = a[6] - b[6];\r\n  out[7] = a[7] - b[7];\r\n  out[8] = a[8] - b[8];\r\n  out[9] = a[9] - b[9];\r\n  out[10] = a[10] - b[10];\r\n  out[11] = a[11] - b[11];\r\n  out[12] = a[12] - b[12];\r\n  out[13] = a[13] - b[13];\r\n  out[14] = a[14] - b[14];\r\n  out[15] = a[15] - b[15];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiply each element of the matrix by a scalar.\r\n *\r\n * @param {mat4} out the receiving matrix\r\n * @param {mat4} a the matrix to scale\r\n * @param {Number} b amount to scale the matrix's elements by\r\n * @returns {mat4} out\r\n */\r\nexport function multiplyScalar(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  out[6] = a[6] * b;\r\n  out[7] = a[7] * b;\r\n  out[8] = a[8] * b;\r\n  out[9] = a[9] * b;\r\n  out[10] = a[10] * b;\r\n  out[11] = a[11] * b;\r\n  out[12] = a[12] * b;\r\n  out[13] = a[13] * b;\r\n  out[14] = a[14] * b;\r\n  out[15] = a[15] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\r\n *\r\n * @param {mat4} out the receiving vector\r\n * @param {mat4} a the first operand\r\n * @param {mat4} b the second operand\r\n * @param {Number} scale the amount to scale b's elements by before adding\r\n * @returns {mat4} out\r\n */\r\nexport function multiplyScalarAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  out[4] = a[4] + b[4] * scale;\r\n  out[5] = a[5] + b[5] * scale;\r\n  out[6] = a[6] + b[6] * scale;\r\n  out[7] = a[7] + b[7] * scale;\r\n  out[8] = a[8] + b[8] * scale;\r\n  out[9] = a[9] + b[9] * scale;\r\n  out[10] = a[10] + b[10] * scale;\r\n  out[11] = a[11] + b[11] * scale;\r\n  out[12] = a[12] + b[12] * scale;\r\n  out[13] = a[13] + b[13] * scale;\r\n  out[14] = a[14] + b[14] * scale;\r\n  out[15] = a[15] + b[15] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\r\n}\r\n\r\n/**\r\n * Returns whether or not the matrices have approximately the same elements in the same position.\r\n *\r\n * @param {mat4} a The first matrix.\r\n * @param {mat4} b The second matrix.\r\n * @returns {Boolean} True if the matrices are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var a4 = a[4],\r\n      a5 = a[5],\r\n      a6 = a[6],\r\n      a7 = a[7];\r\n  var a8 = a[8],\r\n      a9 = a[9],\r\n      a10 = a[10],\r\n      a11 = a[11];\r\n  var a12 = a[12],\r\n      a13 = a[13],\r\n      a14 = a[14],\r\n      a15 = a[15];\r\n\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  var b4 = b[4],\r\n      b5 = b[5],\r\n      b6 = b[6],\r\n      b7 = b[7];\r\n  var b8 = b[8],\r\n      b9 = b[9],\r\n      b10 = b[10],\r\n      b11 = b[11];\r\n  var b12 = b[12],\r\n      b13 = b[13],\r\n      b14 = b[14],\r\n      b15 = b[15];\r\n\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\r\n}\r\n\r\n/**\r\n * Alias for {@link mat4.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link mat4.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 4 Dimensional Vector\r\n * @module vec4\r\n */\r\n\r\n/**\r\n * Creates a new, empty vec4\r\n *\r\n * @returns {vec4} a new 4D vector\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n    out[3] = 0;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec4 initialized with values from an existing vector\r\n *\r\n * @param {vec4} a vector to clone\r\n * @returns {vec4} a new 4D vector\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec4 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} a new 4D vector\r\n */\r\nexport function fromValues(x, y, z, w) {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  out[3] = w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one vec4 to another\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the source vector\r\n * @returns {vec4} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec4 to the given values\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {vec4} out\r\n */\r\nexport function set(out, x, y, z, w) {\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  out[3] = w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  out[2] = a[2] - b[2];\r\n  out[3] = a[3] - b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  out[0] = a[0] * b[0];\r\n  out[1] = a[1] * b[1];\r\n  out[2] = a[2] * b[2];\r\n  out[3] = a[3] * b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Divides two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function divide(out, a, b) {\r\n  out[0] = a[0] / b[0];\r\n  out[1] = a[1] / b[1];\r\n  out[2] = a[2] / b[2];\r\n  out[3] = a[3] / b[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.ceil the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to ceil\r\n * @returns {vec4} out\r\n */\r\nexport function ceil(out, a) {\r\n  out[0] = Math.ceil(a[0]);\r\n  out[1] = Math.ceil(a[1]);\r\n  out[2] = Math.ceil(a[2]);\r\n  out[3] = Math.ceil(a[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.floor the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to floor\r\n * @returns {vec4} out\r\n */\r\nexport function floor(out, a) {\r\n  out[0] = Math.floor(a[0]);\r\n  out[1] = Math.floor(a[1]);\r\n  out[2] = Math.floor(a[2]);\r\n  out[3] = Math.floor(a[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the minimum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function min(out, a, b) {\r\n  out[0] = Math.min(a[0], b[0]);\r\n  out[1] = Math.min(a[1], b[1]);\r\n  out[2] = Math.min(a[2], b[2]);\r\n  out[3] = Math.min(a[3], b[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the maximum of two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {vec4} out\r\n */\r\nexport function max(out, a, b) {\r\n  out[0] = Math.max(a[0], b[0]);\r\n  out[1] = Math.max(a[1], b[1]);\r\n  out[2] = Math.max(a[2], b[2]);\r\n  out[3] = Math.max(a[3], b[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.round the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to round\r\n * @returns {vec4} out\r\n */\r\nexport function round(out, a) {\r\n  out[0] = Math.round(a[0]);\r\n  out[1] = Math.round(a[1]);\r\n  out[2] = Math.round(a[2]);\r\n  out[3] = Math.round(a[3]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales a vec4 by a scalar number\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec4} out\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec4's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec4} out\r\n */\r\nexport function scaleAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  out[2] = a[2] + b[2] * scale;\r\n  out[3] = a[3] + b[3] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nexport function distance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  var w = b[3] - a[3];\r\n  return Math.sqrt(x * x + y * y + z * z + w * w);\r\n}\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nexport function squaredDistance(a, b) {\r\n  var x = b[0] - a[0];\r\n  var y = b[1] - a[1];\r\n  var z = b[2] - a[2];\r\n  var w = b[3] - a[3];\r\n  return x * x + y * y + z * z + w * w;\r\n}\r\n\r\n/**\r\n * Calculates the length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport function length(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var w = a[3];\r\n  return Math.sqrt(x * x + y * y + z * z + w * w);\r\n}\r\n\r\n/**\r\n * Calculates the squared length of a vec4\r\n *\r\n * @param {vec4} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nexport function squaredLength(a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var w = a[3];\r\n  return x * x + y * y + z * z + w * w;\r\n}\r\n\r\n/**\r\n * Negates the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to negate\r\n * @returns {vec4} out\r\n */\r\nexport function negate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = -a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the inverse of the components of a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to invert\r\n * @returns {vec4} out\r\n */\r\nexport function inverse(out, a) {\r\n  out[0] = 1.0 / a[0];\r\n  out[1] = 1.0 / a[1];\r\n  out[2] = 1.0 / a[2];\r\n  out[3] = 1.0 / a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Normalize a vec4\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a vector to normalize\r\n * @returns {vec4} out\r\n */\r\nexport function normalize(out, a) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  var z = a[2];\r\n  var w = a[3];\r\n  var len = x * x + y * y + z * z + w * w;\r\n  if (len > 0) {\r\n    len = 1 / Math.sqrt(len);\r\n    out[0] = x * len;\r\n    out[1] = y * len;\r\n    out[2] = z * len;\r\n    out[3] = w * len;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two vec4's\r\n *\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nexport function dot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation between two vec4's\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the first operand\r\n * @param {vec4} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec4} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var ax = a[0];\r\n  var ay = a[1];\r\n  var az = a[2];\r\n  var aw = a[3];\r\n  out[0] = ax + t * (b[0] - ax);\r\n  out[1] = ay + t * (b[1] - ay);\r\n  out[2] = az + t * (b[2] - az);\r\n  out[3] = aw + t * (b[3] - aw);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec4} out\r\n */\r\nexport function random(out, scale) {\r\n  scale = scale || 1.0;\r\n\r\n  // Marsaglia, George. Choosing a Point from the Surface of a\r\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\r\n  // http://projecteuclid.org/euclid.aoms/1177692644;\r\n  var v1, v2, v3, v4;\r\n  var s1, s2;\r\n  do {\r\n    v1 = glMatrix.RANDOM() * 2 - 1;\r\n    v2 = glMatrix.RANDOM() * 2 - 1;\r\n    s1 = v1 * v1 + v2 * v2;\r\n  } while (s1 >= 1);\r\n  do {\r\n    v3 = glMatrix.RANDOM() * 2 - 1;\r\n    v4 = glMatrix.RANDOM() * 2 - 1;\r\n    s2 = v3 * v3 + v4 * v4;\r\n  } while (s2 >= 1);\r\n\r\n  var d = Math.sqrt((1 - s1) / s2);\r\n  out[0] = scale * v1;\r\n  out[1] = scale * v2;\r\n  out[2] = scale * v3 * d;\r\n  out[3] = scale * v4 * d;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec4 with a mat4.\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec4} out\r\n */\r\nexport function transformMat4(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2],\r\n      w = a[3];\r\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\r\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\r\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\r\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec4 with a quat\r\n *\r\n * @param {vec4} out the receiving vector\r\n * @param {vec4} a the vector to transform\r\n * @param {quat} q quaternion to transform with\r\n * @returns {vec4} out\r\n */\r\nexport function transformQuat(out, a, q) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3];\r\n\r\n  // calculate quat * vec\r\n  var ix = qw * x + qy * z - qz * y;\r\n  var iy = qw * y + qz * x - qx * z;\r\n  var iz = qw * z + qx * y - qy * x;\r\n  var iw = -qx * x - qy * y - qz * z;\r\n\r\n  // calculate result * inverse quat\r\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\r\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\r\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec4} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'vec4(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec4} a The first vector.\r\n * @param {vec4} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\r\n}\r\n\r\n/**\r\n * Alias for {@link vec4.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;\r\n\r\n/**\r\n * Alias for {@link vec4.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link vec4.divide}\r\n * @function\r\n */\r\nexport var div = divide;\r\n\r\n/**\r\n * Alias for {@link vec4.distance}\r\n * @function\r\n */\r\nexport var dist = distance;\r\n\r\n/**\r\n * Alias for {@link vec4.squaredDistance}\r\n * @function\r\n */\r\nexport var sqrDist = squaredDistance;\r\n\r\n/**\r\n * Alias for {@link vec4.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Alias for {@link vec4.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Perform some operation over an array of vec4s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nexport var forEach = function () {\r\n  var vec = create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i = void 0,\r\n        l = void 0;\r\n    if (!stride) {\r\n      stride = 4;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min(count * stride + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec[0] = a[i];vec[1] = a[i + 1];vec[2] = a[i + 2];vec[3] = a[i + 3];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec[0];a[i + 1] = vec[1];a[i + 2] = vec[2];a[i + 3] = vec[3];\r\n    }\r\n\r\n    return a;\r\n  };\r\n}();","import * as glMatrix from \"./common.js\";\r\nimport * as mat3 from \"./mat3.js\";\r\nimport * as vec3 from \"./vec3.js\";\r\nimport * as vec4 from \"./vec4.js\";\r\n\r\n/**\r\n * Quaternion\r\n * @module quat\r\n */\r\n\r\n/**\r\n * Creates a new identity quat\r\n *\r\n * @returns {quat} a new quaternion\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(4);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n    out[2] = 0;\r\n  }\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a quat to the identity quaternion\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @returns {quat} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 0;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Sets a quat from the given angle and rotation axis,\r\n * then returns it.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {vec3} axis the axis around which to rotate\r\n * @param {Number} rad the angle in radians\r\n * @returns {quat} out\r\n **/\r\nexport function setAxisAngle(out, axis, rad) {\r\n  rad = rad * 0.5;\r\n  var s = Math.sin(rad);\r\n  out[0] = s * axis[0];\r\n  out[1] = s * axis[1];\r\n  out[2] = s * axis[2];\r\n  out[3] = Math.cos(rad);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Gets the rotation axis and angle for a given\r\n *  quaternion. If a quaternion is created with\r\n *  setAxisAngle, this method will return the same\r\n *  values as providied in the original parameter list\r\n *  OR functionally equivalent values.\r\n * Example: The quaternion formed by axis [0, 0, 1] and\r\n *  angle -90 is the same as the quaternion formed by\r\n *  [0, 0, 1] and 270. This method favors the latter.\r\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\r\n * @param  {quat} q     Quaternion to be decomposed\r\n * @return {Number}     Angle, in radians, of the rotation\r\n */\r\nexport function getAxisAngle(out_axis, q) {\r\n  var rad = Math.acos(q[3]) * 2.0;\r\n  var s = Math.sin(rad / 2.0);\r\n  if (s > glMatrix.EPSILON) {\r\n    out_axis[0] = q[0] / s;\r\n    out_axis[1] = q[1] / s;\r\n    out_axis[2] = q[2] / s;\r\n  } else {\r\n    // If s is zero, return any axis (no rotation - axis does not matter)\r\n    out_axis[0] = 1;\r\n    out_axis[1] = 0;\r\n    out_axis[2] = 0;\r\n  }\r\n  return rad;\r\n}\r\n\r\n/**\r\n * Multiplies two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {quat} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bx = b[0],\r\n      by = b[1],\r\n      bz = b[2],\r\n      bw = b[3];\r\n\r\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\r\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\r\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\r\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the X axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nexport function rotateX(out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bx = Math.sin(rad),\r\n      bw = Math.cos(rad);\r\n\r\n  out[0] = ax * bw + aw * bx;\r\n  out[1] = ay * bw + az * bx;\r\n  out[2] = az * bw - ay * bx;\r\n  out[3] = aw * bw - ax * bx;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the Y axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nexport function rotateY(out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var by = Math.sin(rad),\r\n      bw = Math.cos(rad);\r\n\r\n  out[0] = ax * bw - az * by;\r\n  out[1] = ay * bw + aw * by;\r\n  out[2] = az * bw + ax * by;\r\n  out[3] = aw * bw - ay * by;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a quaternion by the given angle about the Z axis\r\n *\r\n * @param {quat} out quat receiving operation result\r\n * @param {quat} a quat to rotate\r\n * @param {number} rad angle (in radians) to rotate\r\n * @returns {quat} out\r\n */\r\nexport function rotateZ(out, a, rad) {\r\n  rad *= 0.5;\r\n\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bz = Math.sin(rad),\r\n      bw = Math.cos(rad);\r\n\r\n  out[0] = ax * bw + ay * bz;\r\n  out[1] = ay * bw - ax * bz;\r\n  out[2] = az * bw + aw * bz;\r\n  out[3] = aw * bw - az * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the W component of a quat from the X, Y, and Z components.\r\n * Assumes that quaternion is 1 unit in length.\r\n * Any existing W component will be ignored.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate W component of\r\n * @returns {quat} out\r\n */\r\nexport function calculateW(out, a) {\r\n  var x = a[0],\r\n      y = a[1],\r\n      z = a[2];\r\n\r\n  out[0] = x;\r\n  out[1] = y;\r\n  out[2] = z;\r\n  out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a spherical linear interpolation between two quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat} out\r\n */\r\nexport function slerp(out, a, b, t) {\r\n  // benchmarks:\r\n  //    http://jsperf.com/quaternion-slerp-implementations\r\n  var ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n  var bx = b[0],\r\n      by = b[1],\r\n      bz = b[2],\r\n      bw = b[3];\r\n\r\n  var omega = void 0,\r\n      cosom = void 0,\r\n      sinom = void 0,\r\n      scale0 = void 0,\r\n      scale1 = void 0;\r\n\r\n  // calc cosine\r\n  cosom = ax * bx + ay * by + az * bz + aw * bw;\r\n  // adjust signs (if necessary)\r\n  if (cosom < 0.0) {\r\n    cosom = -cosom;\r\n    bx = -bx;\r\n    by = -by;\r\n    bz = -bz;\r\n    bw = -bw;\r\n  }\r\n  // calculate coefficients\r\n  if (1.0 - cosom > glMatrix.EPSILON) {\r\n    // standard case (slerp)\r\n    omega = Math.acos(cosom);\r\n    sinom = Math.sin(omega);\r\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\r\n    scale1 = Math.sin(t * omega) / sinom;\r\n  } else {\r\n    // \"from\" and \"to\" quaternions are very close\r\n    //  ... so we can do a linear interpolation\r\n    scale0 = 1.0 - t;\r\n    scale1 = t;\r\n  }\r\n  // calculate final values\r\n  out[0] = scale0 * ax + scale1 * bx;\r\n  out[1] = scale0 * ay + scale1 * by;\r\n  out[2] = scale0 * az + scale1 * bz;\r\n  out[3] = scale0 * aw + scale1 * bw;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random quaternion\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @returns {quat} out\r\n */\r\nexport function random(out) {\r\n  // Implementation of http://planning.cs.uiuc.edu/node198.html\r\n  // TODO: Calling random 3 times is probably not the fastest solution\r\n  var u1 = glMatrix.RANDOM();\r\n  var u2 = glMatrix.RANDOM();\r\n  var u3 = glMatrix.RANDOM();\r\n\r\n  var sqrt1MinusU1 = Math.sqrt(1 - u1);\r\n  var sqrtU1 = Math.sqrt(u1);\r\n\r\n  out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\r\n  out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\r\n  out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\r\n  out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the inverse of a quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate inverse of\r\n * @returns {quat} out\r\n */\r\nexport function invert(out, a) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3];\r\n  var dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\r\n  var invDot = dot ? 1.0 / dot : 0;\r\n\r\n  // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\r\n\r\n  out[0] = -a0 * invDot;\r\n  out[1] = -a1 * invDot;\r\n  out[2] = -a2 * invDot;\r\n  out[3] = a3 * invDot;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the conjugate of a quat\r\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quat to calculate conjugate of\r\n * @returns {quat} out\r\n */\r\nexport function conjugate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = a[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a quaternion from the given 3x3 rotation matrix.\r\n *\r\n * NOTE: The resultant quaternion is not normalized, so you should be sure\r\n * to renormalize the quaternion yourself where necessary.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {mat3} m rotation matrix\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport function fromMat3(out, m) {\r\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\r\n  // article \"Quaternion Calculus and Fast Animation\".\r\n  var fTrace = m[0] + m[4] + m[8];\r\n  var fRoot = void 0;\r\n\r\n  if (fTrace > 0.0) {\r\n    // |w| > 1/2, may as well choose w > 1/2\r\n    fRoot = Math.sqrt(fTrace + 1.0); // 2w\r\n    out[3] = 0.5 * fRoot;\r\n    fRoot = 0.5 / fRoot; // 1/(4w)\r\n    out[0] = (m[5] - m[7]) * fRoot;\r\n    out[1] = (m[6] - m[2]) * fRoot;\r\n    out[2] = (m[1] - m[3]) * fRoot;\r\n  } else {\r\n    // |w| <= 1/2\r\n    var i = 0;\r\n    if (m[4] > m[0]) i = 1;\r\n    if (m[8] > m[i * 3 + i]) i = 2;\r\n    var j = (i + 1) % 3;\r\n    var k = (i + 2) % 3;\r\n\r\n    fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);\r\n    out[i] = 0.5 * fRoot;\r\n    fRoot = 0.5 / fRoot;\r\n    out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\r\n    out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\r\n    out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\r\n  }\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a quaternion from the given euler angle x, y, z.\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {x} Angle to rotate around X axis in degrees.\r\n * @param {y} Angle to rotate around Y axis in degrees.\r\n * @param {z} Angle to rotate around Z axis in degrees.\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport function fromEuler(out, x, y, z) {\r\n  var halfToRad = 0.5 * Math.PI / 180.0;\r\n  x *= halfToRad;\r\n  y *= halfToRad;\r\n  z *= halfToRad;\r\n\r\n  var sx = Math.sin(x);\r\n  var cx = Math.cos(x);\r\n  var sy = Math.sin(y);\r\n  var cy = Math.cos(y);\r\n  var sz = Math.sin(z);\r\n  var cz = Math.cos(z);\r\n\r\n  out[0] = sx * cy * cz - cx * sy * sz;\r\n  out[1] = cx * sy * cz + sx * cy * sz;\r\n  out[2] = cx * cy * sz - sx * sy * cz;\r\n  out[3] = cx * cy * cz + sx * sy * sz;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a quatenion\r\n *\r\n * @param {quat} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'quat(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ')';\r\n}\r\n\r\n/**\r\n * Creates a new quat initialized with values from an existing quaternion\r\n *\r\n * @param {quat} a quaternion to clone\r\n * @returns {quat} a new quaternion\r\n * @function\r\n */\r\nexport var clone = vec4.clone;\r\n\r\n/**\r\n * Creates a new quat initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {quat} a new quaternion\r\n * @function\r\n */\r\nexport var fromValues = vec4.fromValues;\r\n\r\n/**\r\n * Copy the values from one quat to another\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the source quaternion\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var copy = vec4.copy;\r\n\r\n/**\r\n * Set the components of a quat to the given values\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @param {Number} z Z component\r\n * @param {Number} w W component\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var set = vec4.set;\r\n\r\n/**\r\n * Adds two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var add = vec4.add;\r\n\r\n/**\r\n * Alias for {@link quat.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Scales a quat by a scalar number\r\n *\r\n * @param {quat} out the receiving vector\r\n * @param {quat} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var scale = vec4.scale;\r\n\r\n/**\r\n * Calculates the dot product of two quat's\r\n *\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @returns {Number} dot product of a and b\r\n * @function\r\n */\r\nexport var dot = vec4.dot;\r\n\r\n/**\r\n * Performs a linear interpolation between two quat's\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var lerp = vec4.lerp;\r\n\r\n/**\r\n * Calculates the length of a quat\r\n *\r\n * @param {quat} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport var length = vec4.length;\r\n\r\n/**\r\n * Alias for {@link quat.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Calculates the squared length of a quat\r\n *\r\n * @param {quat} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n * @function\r\n */\r\nexport var squaredLength = vec4.squaredLength;\r\n\r\n/**\r\n * Alias for {@link quat.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Normalize a quat\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a quaternion to normalize\r\n * @returns {quat} out\r\n * @function\r\n */\r\nexport var normalize = vec4.normalize;\r\n\r\n/**\r\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {quat} a The first quaternion.\r\n * @param {quat} b The second quaternion.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport var exactEquals = vec4.exactEquals;\r\n\r\n/**\r\n * Returns whether or not the quaternions have approximately the same elements in the same position.\r\n *\r\n * @param {quat} a The first vector.\r\n * @param {quat} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport var equals = vec4.equals;\r\n\r\n/**\r\n * Sets a quaternion to represent the shortest rotation from one\r\n * vector to another.\r\n *\r\n * Both vectors are assumed to be unit length.\r\n *\r\n * @param {quat} out the receiving quaternion.\r\n * @param {vec3} a the initial vector\r\n * @param {vec3} b the destination vector\r\n * @returns {quat} out\r\n */\r\nexport var rotationTo = function () {\r\n  var tmpvec3 = vec3.create();\r\n  var xUnitVec3 = vec3.fromValues(1, 0, 0);\r\n  var yUnitVec3 = vec3.fromValues(0, 1, 0);\r\n\r\n  return function (out, a, b) {\r\n    var dot = vec3.dot(a, b);\r\n    if (dot < -0.999999) {\r\n      vec3.cross(tmpvec3, xUnitVec3, a);\r\n      if (vec3.len(tmpvec3) < 0.000001) vec3.cross(tmpvec3, yUnitVec3, a);\r\n      vec3.normalize(tmpvec3, tmpvec3);\r\n      setAxisAngle(out, tmpvec3, Math.PI);\r\n      return out;\r\n    } else if (dot > 0.999999) {\r\n      out[0] = 0;\r\n      out[1] = 0;\r\n      out[2] = 0;\r\n      out[3] = 1;\r\n      return out;\r\n    } else {\r\n      vec3.cross(tmpvec3, a, b);\r\n      out[0] = tmpvec3[0];\r\n      out[1] = tmpvec3[1];\r\n      out[2] = tmpvec3[2];\r\n      out[3] = 1 + dot;\r\n      return normalize(out, out);\r\n    }\r\n  };\r\n}();\r\n\r\n/**\r\n * Performs a spherical linear interpolation with two control points\r\n *\r\n * @param {quat} out the receiving quaternion\r\n * @param {quat} a the first operand\r\n * @param {quat} b the second operand\r\n * @param {quat} c the third operand\r\n * @param {quat} d the fourth operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat} out\r\n */\r\nexport var sqlerp = function () {\r\n  var temp1 = create();\r\n  var temp2 = create();\r\n\r\n  return function (out, a, b, c, d, t) {\r\n    slerp(temp1, a, d, t);\r\n    slerp(temp2, b, c, t);\r\n    slerp(out, temp1, temp2, 2 * t * (1 - t));\r\n\r\n    return out;\r\n  };\r\n}();\r\n\r\n/**\r\n * Sets the specified quaternion with values corresponding to the given\r\n * axes. Each axis is a vec3 and is expected to be unit length and\r\n * perpendicular to all other specified axes.\r\n *\r\n * @param {vec3} view  the vector representing the viewing direction\r\n * @param {vec3} right the vector representing the local \"right\" direction\r\n * @param {vec3} up    the vector representing the local \"up\" direction\r\n * @returns {quat} out\r\n */\r\nexport var setAxes = function () {\r\n  var matr = mat3.create();\r\n\r\n  return function (out, view, right, up) {\r\n    matr[0] = right[0];\r\n    matr[3] = right[1];\r\n    matr[6] = right[2];\r\n\r\n    matr[1] = up[0];\r\n    matr[4] = up[1];\r\n    matr[7] = up[2];\r\n\r\n    matr[2] = -view[0];\r\n    matr[5] = -view[1];\r\n    matr[8] = -view[2];\r\n\r\n    return normalize(out, fromMat3(out, matr));\r\n  };\r\n}();","import * as glMatrix from \"./common.js\";\r\nimport * as quat from \"./quat.js\";\r\nimport * as mat4 from \"./mat4.js\";\r\n\r\n/**\r\n * Dual Quaternion<br>\r\n * Format: [real, dual]<br>\r\n * Quaternion format: XYZW<br>\r\n * Make sure to have normalized dual quaternions, otherwise the functions may not work as intended.<br>\r\n * @module quat2\r\n */\r\n\r\n/**\r\n * Creates a new identity dual quat\r\n *\r\n * @returns {quat2} a new dual quaternion [real -> rotation, dual -> translation]\r\n */\r\nexport function create() {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    dq[0] = 0;\r\n    dq[1] = 0;\r\n    dq[2] = 0;\r\n    dq[4] = 0;\r\n    dq[5] = 0;\r\n    dq[6] = 0;\r\n    dq[7] = 0;\r\n  }\r\n  dq[3] = 1;\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a new quat initialized with values from an existing quaternion\r\n *\r\n * @param {quat2} a dual quaternion to clone\r\n * @returns {quat2} new dual quaternion\r\n * @function\r\n */\r\nexport function clone(a) {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  dq[0] = a[0];\r\n  dq[1] = a[1];\r\n  dq[2] = a[2];\r\n  dq[3] = a[3];\r\n  dq[4] = a[4];\r\n  dq[5] = a[5];\r\n  dq[6] = a[6];\r\n  dq[7] = a[7];\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a new dual quat initialized with the given values\r\n *\r\n * @param {Number} x1 X component\r\n * @param {Number} y1 Y component\r\n * @param {Number} z1 Z component\r\n * @param {Number} w1 W component\r\n * @param {Number} x2 X component\r\n * @param {Number} y2 Y component\r\n * @param {Number} z2 Z component\r\n * @param {Number} w2 W component\r\n * @returns {quat2} new dual quaternion\r\n * @function\r\n */\r\nexport function fromValues(x1, y1, z1, w1, x2, y2, z2, w2) {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  dq[0] = x1;\r\n  dq[1] = y1;\r\n  dq[2] = z1;\r\n  dq[3] = w1;\r\n  dq[4] = x2;\r\n  dq[5] = y2;\r\n  dq[6] = z2;\r\n  dq[7] = w2;\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a new dual quat from the given values (quat and translation)\r\n *\r\n * @param {Number} x1 X component\r\n * @param {Number} y1 Y component\r\n * @param {Number} z1 Z component\r\n * @param {Number} w1 W component\r\n * @param {Number} x2 X component (translation)\r\n * @param {Number} y2 Y component (translation)\r\n * @param {Number} z2 Z component (translation)\r\n * @returns {quat2} new dual quaternion\r\n * @function\r\n */\r\nexport function fromRotationTranslationValues(x1, y1, z1, w1, x2, y2, z2) {\r\n  var dq = new glMatrix.ARRAY_TYPE(8);\r\n  dq[0] = x1;\r\n  dq[1] = y1;\r\n  dq[2] = z1;\r\n  dq[3] = w1;\r\n  var ax = x2 * 0.5,\r\n      ay = y2 * 0.5,\r\n      az = z2 * 0.5;\r\n  dq[4] = ax * w1 + ay * z1 - az * y1;\r\n  dq[5] = ay * w1 + az * x1 - ax * z1;\r\n  dq[6] = az * w1 + ax * y1 - ay * x1;\r\n  dq[7] = -ax * x1 - ay * y1 - az * z1;\r\n  return dq;\r\n}\r\n\r\n/**\r\n * Creates a dual quat from a quaternion and a translation\r\n *\r\n * @param {quat2} dual quaternion receiving operation result\r\n * @param {quat} q quaternion\r\n * @param {vec3} t tranlation vector\r\n * @returns {quat2} dual quaternion receiving operation result\r\n * @function\r\n */\r\nexport function fromRotationTranslation(out, q, t) {\r\n  var ax = t[0] * 0.5,\r\n      ay = t[1] * 0.5,\r\n      az = t[2] * 0.5,\r\n      bx = q[0],\r\n      by = q[1],\r\n      bz = q[2],\r\n      bw = q[3];\r\n  out[0] = bx;\r\n  out[1] = by;\r\n  out[2] = bz;\r\n  out[3] = bw;\r\n  out[4] = ax * bw + ay * bz - az * by;\r\n  out[5] = ay * bw + az * bx - ax * bz;\r\n  out[6] = az * bw + ax * by - ay * bx;\r\n  out[7] = -ax * bx - ay * by - az * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a dual quat from a translation\r\n *\r\n * @param {quat2} dual quaternion receiving operation result\r\n * @param {vec3} t translation vector\r\n * @returns {quat2} dual quaternion receiving operation result\r\n * @function\r\n */\r\nexport function fromTranslation(out, t) {\r\n  out[0] = 0;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = t[0] * 0.5;\r\n  out[5] = t[1] * 0.5;\r\n  out[6] = t[2] * 0.5;\r\n  out[7] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a dual quat from a quaternion\r\n *\r\n * @param {quat2} dual quaternion receiving operation result\r\n * @param {quat} q the quaternion\r\n * @returns {quat2} dual quaternion receiving operation result\r\n * @function\r\n */\r\nexport function fromRotation(out, q) {\r\n  out[0] = q[0];\r\n  out[1] = q[1];\r\n  out[2] = q[2];\r\n  out[3] = q[3];\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new dual quat from a matrix (4x4)\r\n *\r\n * @param {quat2} out the dual quaternion\r\n * @param {mat4} a the matrix\r\n * @returns {quat2} dual quat receiving operation result\r\n * @function\r\n */\r\nexport function fromMat4(out, a) {\r\n  //TODO Optimize this\r\n  var outer = quat.create();\r\n  mat4.getRotation(outer, a);\r\n  var t = new glMatrix.ARRAY_TYPE(3);\r\n  mat4.getTranslation(t, a);\r\n  fromRotationTranslation(out, outer, t);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one dual quat to another\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the source dual quaternion\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  out[2] = a[2];\r\n  out[3] = a[3];\r\n  out[4] = a[4];\r\n  out[5] = a[5];\r\n  out[6] = a[6];\r\n  out[7] = a[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set a dual quat to the identity dual quaternion\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @returns {quat2} out\r\n */\r\nexport function identity(out) {\r\n  out[0] = 0;\r\n  out[1] = 0;\r\n  out[2] = 0;\r\n  out[3] = 1;\r\n  out[4] = 0;\r\n  out[5] = 0;\r\n  out[6] = 0;\r\n  out[7] = 0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a dual quat to the given values\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {Number} x1 X component\r\n * @param {Number} y1 Y component\r\n * @param {Number} z1 Z component\r\n * @param {Number} w1 W component\r\n * @param {Number} x2 X component\r\n * @param {Number} y2 Y component\r\n * @param {Number} z2 Z component\r\n * @param {Number} w2 W component\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function set(out, x1, y1, z1, w1, x2, y2, z2, w2) {\r\n  out[0] = x1;\r\n  out[1] = y1;\r\n  out[2] = z1;\r\n  out[3] = w1;\r\n\r\n  out[4] = x2;\r\n  out[5] = y2;\r\n  out[6] = z2;\r\n  out[7] = w2;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Gets the real part of a dual quat\r\n * @param  {quat} out real part\r\n * @param  {quat2} a Dual Quaternion\r\n * @return {quat} real part\r\n */\r\nexport var getReal = quat.copy;\r\n\r\n/**\r\n * Gets the dual part of a dual quat\r\n * @param  {quat} out dual part\r\n * @param  {quat2} a Dual Quaternion\r\n * @return {quat} dual part\r\n */\r\nexport function getDual(out, a) {\r\n  out[0] = a[4];\r\n  out[1] = a[5];\r\n  out[2] = a[6];\r\n  out[3] = a[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the real component of a dual quat to the given quaternion\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {quat} q a quaternion representing the real part\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport var setReal = quat.copy;\r\n\r\n/**\r\n * Set the dual component of a dual quat to the given quaternion\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {quat} q a quaternion representing the dual part\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function setDual(out, q) {\r\n  out[4] = q[0];\r\n  out[5] = q[1];\r\n  out[6] = q[2];\r\n  out[7] = q[3];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Gets the translation of a normalized dual quat\r\n * @param  {vec3} out translation\r\n * @param  {quat2} a Dual Quaternion to be decomposed\r\n * @return {vec3} translation\r\n */\r\nexport function getTranslation(out, a) {\r\n  var ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3];\r\n  out[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\r\n  out[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\r\n  out[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Translates a dual quat by the given vector\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to translate\r\n * @param {vec3} v vector to translate by\r\n * @returns {quat2} out\r\n */\r\nexport function translate(out, a, v) {\r\n  var ax1 = a[0],\r\n      ay1 = a[1],\r\n      az1 = a[2],\r\n      aw1 = a[3],\r\n      bx1 = v[0] * 0.5,\r\n      by1 = v[1] * 0.5,\r\n      bz1 = v[2] * 0.5,\r\n      ax2 = a[4],\r\n      ay2 = a[5],\r\n      az2 = a[6],\r\n      aw2 = a[7];\r\n  out[0] = ax1;\r\n  out[1] = ay1;\r\n  out[2] = az1;\r\n  out[3] = aw1;\r\n  out[4] = aw1 * bx1 + ay1 * bz1 - az1 * by1 + ax2;\r\n  out[5] = aw1 * by1 + az1 * bx1 - ax1 * bz1 + ay2;\r\n  out[6] = aw1 * bz1 + ax1 * by1 - ay1 * bx1 + az2;\r\n  out[7] = -ax1 * bx1 - ay1 * by1 - az1 * bz1 + aw2;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around the X axis\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {number} rad how far should the rotation be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateX(out, a, rad) {\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      ax1 = ax * bw + aw * bx + ay * bz - az * by,\r\n      ay1 = ay * bw + aw * by + az * bx - ax * bz,\r\n      az1 = az * bw + aw * bz + ax * by - ay * bx,\r\n      aw1 = aw * bw - ax * bx - ay * by - az * bz;\r\n  quat.rotateX(out, a, rad);\r\n  bx = out[0];\r\n  by = out[1];\r\n  bz = out[2];\r\n  bw = out[3];\r\n  out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around the Y axis\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {number} rad how far should the rotation be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateY(out, a, rad) {\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      ax1 = ax * bw + aw * bx + ay * bz - az * by,\r\n      ay1 = ay * bw + aw * by + az * bx - ax * bz,\r\n      az1 = az * bw + aw * bz + ax * by - ay * bx,\r\n      aw1 = aw * bw - ax * bx - ay * by - az * bz;\r\n  quat.rotateY(out, a, rad);\r\n  bx = out[0];\r\n  by = out[1];\r\n  bz = out[2];\r\n  bw = out[3];\r\n  out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around the Z axis\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {number} rad how far should the rotation be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateZ(out, a, rad) {\r\n  var bx = -a[0],\r\n      by = -a[1],\r\n      bz = -a[2],\r\n      bw = a[3],\r\n      ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7],\r\n      ax1 = ax * bw + aw * bx + ay * bz - az * by,\r\n      ay1 = ay * bw + aw * by + az * bx - ax * bz,\r\n      az1 = az * bw + aw * bz + ax * by - ay * bx,\r\n      aw1 = aw * bw - ax * bx - ay * by - az * bz;\r\n  quat.rotateZ(out, a, rad);\r\n  bx = out[0];\r\n  by = out[1];\r\n  bz = out[2];\r\n  bw = out[3];\r\n  out[4] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[5] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[6] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[7] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat by a given quaternion (a * q)\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {quat} q quaternion to rotate by\r\n * @returns {quat2} out\r\n */\r\nexport function rotateByQuatAppend(out, a, q) {\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3],\r\n      ax = a[0],\r\n      ay = a[1],\r\n      az = a[2],\r\n      aw = a[3];\r\n\r\n  out[0] = ax * qw + aw * qx + ay * qz - az * qy;\r\n  out[1] = ay * qw + aw * qy + az * qx - ax * qz;\r\n  out[2] = az * qw + aw * qz + ax * qy - ay * qx;\r\n  out[3] = aw * qw - ax * qx - ay * qy - az * qz;\r\n  ax = a[4];\r\n  ay = a[5];\r\n  az = a[6];\r\n  aw = a[7];\r\n  out[4] = ax * qw + aw * qx + ay * qz - az * qy;\r\n  out[5] = ay * qw + aw * qy + az * qx - ax * qz;\r\n  out[6] = az * qw + aw * qz + ax * qy - ay * qx;\r\n  out[7] = aw * qw - ax * qx - ay * qy - az * qz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat by a given quaternion (q * a)\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat} q quaternion to rotate by\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @returns {quat2} out\r\n */\r\nexport function rotateByQuatPrepend(out, q, a) {\r\n  var qx = q[0],\r\n      qy = q[1],\r\n      qz = q[2],\r\n      qw = q[3],\r\n      bx = a[0],\r\n      by = a[1],\r\n      bz = a[2],\r\n      bw = a[3];\r\n\r\n  out[0] = qx * bw + qw * bx + qy * bz - qz * by;\r\n  out[1] = qy * bw + qw * by + qz * bx - qx * bz;\r\n  out[2] = qz * bw + qw * bz + qx * by - qy * bx;\r\n  out[3] = qw * bw - qx * bx - qy * by - qz * bz;\r\n  bx = a[4];\r\n  by = a[5];\r\n  bz = a[6];\r\n  bw = a[7];\r\n  out[4] = qx * bw + qw * bx + qy * bz - qz * by;\r\n  out[5] = qy * bw + qw * by + qz * bx - qx * bz;\r\n  out[6] = qz * bw + qw * bz + qx * by - qy * bx;\r\n  out[7] = qw * bw - qx * bx - qy * by - qz * bz;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotates a dual quat around a given axis. Does the normalisation automatically\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the dual quaternion to rotate\r\n * @param {vec3} axis the axis to rotate around\r\n * @param {Number} rad how far the rotation should be\r\n * @returns {quat2} out\r\n */\r\nexport function rotateAroundAxis(out, a, axis, rad) {\r\n  //Special case for rad = 0\r\n  if (Math.abs(rad) < glMatrix.EPSILON) {\r\n    return copy(out, a);\r\n  }\r\n  var axisLength = Math.sqrt(axis[0] * axis[0] + axis[1] * axis[1] + axis[2] * axis[2]);\r\n\r\n  rad = rad * 0.5;\r\n  var s = Math.sin(rad);\r\n  var bx = s * axis[0] / axisLength;\r\n  var by = s * axis[1] / axisLength;\r\n  var bz = s * axis[2] / axisLength;\r\n  var bw = Math.cos(rad);\r\n\r\n  var ax1 = a[0],\r\n      ay1 = a[1],\r\n      az1 = a[2],\r\n      aw1 = a[3];\r\n  out[0] = ax1 * bw + aw1 * bx + ay1 * bz - az1 * by;\r\n  out[1] = ay1 * bw + aw1 * by + az1 * bx - ax1 * bz;\r\n  out[2] = az1 * bw + aw1 * bz + ax1 * by - ay1 * bx;\r\n  out[3] = aw1 * bw - ax1 * bx - ay1 * by - az1 * bz;\r\n\r\n  var ax = a[4],\r\n      ay = a[5],\r\n      az = a[6],\r\n      aw = a[7];\r\n  out[4] = ax * bw + aw * bx + ay * bz - az * by;\r\n  out[5] = ay * bw + aw * by + az * bx - ax * bz;\r\n  out[6] = az * bw + aw * bz + ax * by - ay * bx;\r\n  out[7] = aw * bw - ax * bx - ay * by - az * bz;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two dual quat's\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  out[2] = a[2] + b[2];\r\n  out[3] = a[3] + b[3];\r\n  out[4] = a[4] + b[4];\r\n  out[5] = a[5] + b[5];\r\n  out[6] = a[6] + b[6];\r\n  out[7] = a[7] + b[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two dual quat's\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @returns {quat2} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  var ax0 = a[0],\r\n      ay0 = a[1],\r\n      az0 = a[2],\r\n      aw0 = a[3],\r\n      bx1 = b[4],\r\n      by1 = b[5],\r\n      bz1 = b[6],\r\n      bw1 = b[7],\r\n      ax1 = a[4],\r\n      ay1 = a[5],\r\n      az1 = a[6],\r\n      aw1 = a[7],\r\n      bx0 = b[0],\r\n      by0 = b[1],\r\n      bz0 = b[2],\r\n      bw0 = b[3];\r\n  out[0] = ax0 * bw0 + aw0 * bx0 + ay0 * bz0 - az0 * by0;\r\n  out[1] = ay0 * bw0 + aw0 * by0 + az0 * bx0 - ax0 * bz0;\r\n  out[2] = az0 * bw0 + aw0 * bz0 + ax0 * by0 - ay0 * bx0;\r\n  out[3] = aw0 * bw0 - ax0 * bx0 - ay0 * by0 - az0 * bz0;\r\n  out[4] = ax0 * bw1 + aw0 * bx1 + ay0 * bz1 - az0 * by1 + ax1 * bw0 + aw1 * bx0 + ay1 * bz0 - az1 * by0;\r\n  out[5] = ay0 * bw1 + aw0 * by1 + az0 * bx1 - ax0 * bz1 + ay1 * bw0 + aw1 * by0 + az1 * bx0 - ax1 * bz0;\r\n  out[6] = az0 * bw1 + aw0 * bz1 + ax0 * by1 - ay0 * bx1 + az1 * bw0 + aw1 * bz0 + ax1 * by0 - ay1 * bx0;\r\n  out[7] = aw0 * bw1 - ax0 * bx1 - ay0 * by1 - az0 * bz1 + aw1 * bw0 - ax1 * bx0 - ay1 * by0 - az1 * bz0;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Alias for {@link quat2.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Scales a dual quat by a scalar number\r\n *\r\n * @param {quat2} out the receiving dual quat\r\n * @param {quat2} a the dual quat to scale\r\n * @param {Number} b amount to scale the dual quat by\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  out[2] = a[2] * b;\r\n  out[3] = a[3] * b;\r\n  out[4] = a[4] * b;\r\n  out[5] = a[5] * b;\r\n  out[6] = a[6] * b;\r\n  out[7] = a[7] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two dual quat's (The dot product of the real parts)\r\n *\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @returns {Number} dot product of a and b\r\n * @function\r\n */\r\nexport var dot = quat.dot;\r\n\r\n/**\r\n * Performs a linear interpolation between two dual quats's\r\n * NOTE: The resulting dual quaternions won't always be normalized (The error is most noticeable when t = 0.5)\r\n *\r\n * @param {quat2} out the receiving dual quat\r\n * @param {quat2} a the first operand\r\n * @param {quat2} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {quat2} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var mt = 1 - t;\r\n  if (dot(a, b) < 0) t = -t;\r\n\r\n  out[0] = a[0] * mt + b[0] * t;\r\n  out[1] = a[1] * mt + b[1] * t;\r\n  out[2] = a[2] * mt + b[2] * t;\r\n  out[3] = a[3] * mt + b[3] * t;\r\n  out[4] = a[4] * mt + b[4] * t;\r\n  out[5] = a[5] * mt + b[5] * t;\r\n  out[6] = a[6] * mt + b[6] * t;\r\n  out[7] = a[7] * mt + b[7] * t;\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the inverse of a dual quat. If they are normalized, conjugate is cheaper\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a dual quat to calculate inverse of\r\n * @returns {quat2} out\r\n */\r\nexport function invert(out, a) {\r\n  var sqlen = squaredLength(a);\r\n  out[0] = -a[0] / sqlen;\r\n  out[1] = -a[1] / sqlen;\r\n  out[2] = -a[2] / sqlen;\r\n  out[3] = a[3] / sqlen;\r\n  out[4] = -a[4] / sqlen;\r\n  out[5] = -a[5] / sqlen;\r\n  out[6] = -a[6] / sqlen;\r\n  out[7] = a[7] / sqlen;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the conjugate of a dual quat\r\n * If the dual quaternion is normalized, this function is faster than quat2.inverse and produces the same result.\r\n *\r\n * @param {quat2} out the receiving quaternion\r\n * @param {quat2} a quat to calculate conjugate of\r\n * @returns {quat2} out\r\n */\r\nexport function conjugate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  out[2] = -a[2];\r\n  out[3] = a[3];\r\n  out[4] = -a[4];\r\n  out[5] = -a[5];\r\n  out[6] = -a[6];\r\n  out[7] = a[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the length of a dual quat\r\n *\r\n * @param {quat2} a dual quat to calculate length of\r\n * @returns {Number} length of a\r\n * @function\r\n */\r\nexport var length = quat.length;\r\n\r\n/**\r\n * Alias for {@link quat2.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Calculates the squared length of a dual quat\r\n *\r\n * @param {quat2} a dual quat to calculate squared length of\r\n * @returns {Number} squared length of a\r\n * @function\r\n */\r\nexport var squaredLength = quat.squaredLength;\r\n\r\n/**\r\n * Alias for {@link quat2.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Normalize a dual quat\r\n *\r\n * @param {quat2} out the receiving dual quaternion\r\n * @param {quat2} a dual quaternion to normalize\r\n * @returns {quat2} out\r\n * @function\r\n */\r\nexport function normalize(out, a) {\r\n  var magnitude = squaredLength(a);\r\n  if (magnitude > 0) {\r\n    magnitude = Math.sqrt(magnitude);\r\n\r\n    var a0 = a[0] / magnitude;\r\n    var a1 = a[1] / magnitude;\r\n    var a2 = a[2] / magnitude;\r\n    var a3 = a[3] / magnitude;\r\n\r\n    var b0 = a[4];\r\n    var b1 = a[5];\r\n    var b2 = a[6];\r\n    var b3 = a[7];\r\n\r\n    var a_dot_b = a0 * b0 + a1 * b1 + a2 * b2 + a3 * b3;\r\n\r\n    out[0] = a0;\r\n    out[1] = a1;\r\n    out[2] = a2;\r\n    out[3] = a3;\r\n\r\n    out[4] = (b0 - a0 * a_dot_b) / magnitude;\r\n    out[5] = (b1 - a1 * a_dot_b) / magnitude;\r\n    out[6] = (b2 - a2 * a_dot_b) / magnitude;\r\n    out[7] = (b3 - a3 * a_dot_b) / magnitude;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns a string representation of a dual quatenion\r\n *\r\n * @param {quat2} a dual quaternion to represent as a string\r\n * @returns {String} string representation of the dual quat\r\n */\r\nexport function str(a) {\r\n  return 'quat2(' + a[0] + ', ' + a[1] + ', ' + a[2] + ', ' + a[3] + ', ' + a[4] + ', ' + a[5] + ', ' + a[6] + ', ' + a[7] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the dual quaternions have exactly the same elements in the same position (when compared with ===)\r\n *\r\n * @param {quat2} a the first dual quaternion.\r\n * @param {quat2} b the second dual quaternion.\r\n * @returns {Boolean} true if the dual quaternions are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7];\r\n}\r\n\r\n/**\r\n * Returns whether or not the dual quaternions have approximately the same elements in the same position.\r\n *\r\n * @param {quat2} a the first dual quat.\r\n * @param {quat2} b the second dual quat.\r\n * @returns {Boolean} true if the dual quats are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1],\r\n      a2 = a[2],\r\n      a3 = a[3],\r\n      a4 = a[4],\r\n      a5 = a[5],\r\n      a6 = a[6],\r\n      a7 = a[7];\r\n  var b0 = b[0],\r\n      b1 = b[1],\r\n      b2 = b[2],\r\n      b3 = b[3],\r\n      b4 = b[4],\r\n      b5 = b[5],\r\n      b6 = b[6],\r\n      b7 = b[7];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7));\r\n}","import * as glMatrix from \"./common.js\";\r\n\r\n/**\r\n * 2 Dimensional Vector\r\n * @module vec2\r\n */\r\n\r\n/**\r\n * Creates a new, empty vec2\r\n *\r\n * @returns {vec2} a new 2D vector\r\n */\r\nexport function create() {\r\n  var out = new glMatrix.ARRAY_TYPE(2);\r\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\r\n    out[0] = 0;\r\n    out[1] = 0;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec2 initialized with values from an existing vector\r\n *\r\n * @param {vec2} a vector to clone\r\n * @returns {vec2} a new 2D vector\r\n */\r\nexport function clone(a) {\r\n  var out = new glMatrix.ARRAY_TYPE(2);\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Creates a new vec2 initialized with the given values\r\n *\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} a new 2D vector\r\n */\r\nexport function fromValues(x, y) {\r\n  var out = new glMatrix.ARRAY_TYPE(2);\r\n  out[0] = x;\r\n  out[1] = y;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Copy the values from one vec2 to another\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the source vector\r\n * @returns {vec2} out\r\n */\r\nexport function copy(out, a) {\r\n  out[0] = a[0];\r\n  out[1] = a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Set the components of a vec2 to the given values\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} x X component\r\n * @param {Number} y Y component\r\n * @returns {vec2} out\r\n */\r\nexport function set(out, x, y) {\r\n  out[0] = x;\r\n  out[1] = y;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function add(out, a, b) {\r\n  out[0] = a[0] + b[0];\r\n  out[1] = a[1] + b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Subtracts vector b from vector a\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function subtract(out, a, b) {\r\n  out[0] = a[0] - b[0];\r\n  out[1] = a[1] - b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Multiplies two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function multiply(out, a, b) {\r\n  out[0] = a[0] * b[0];\r\n  out[1] = a[1] * b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Divides two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function divide(out, a, b) {\r\n  out[0] = a[0] / b[0];\r\n  out[1] = a[1] / b[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.ceil the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to ceil\r\n * @returns {vec2} out\r\n */\r\nexport function ceil(out, a) {\r\n  out[0] = Math.ceil(a[0]);\r\n  out[1] = Math.ceil(a[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.floor the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to floor\r\n * @returns {vec2} out\r\n */\r\nexport function floor(out, a) {\r\n  out[0] = Math.floor(a[0]);\r\n  out[1] = Math.floor(a[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the minimum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function min(out, a, b) {\r\n  out[0] = Math.min(a[0], b[0]);\r\n  out[1] = Math.min(a[1], b[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the maximum of two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec2} out\r\n */\r\nexport function max(out, a, b) {\r\n  out[0] = Math.max(a[0], b[0]);\r\n  out[1] = Math.max(a[1], b[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Math.round the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to round\r\n * @returns {vec2} out\r\n */\r\nexport function round(out, a) {\r\n  out[0] = Math.round(a[0]);\r\n  out[1] = Math.round(a[1]);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Scales a vec2 by a scalar number\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to scale\r\n * @param {Number} b amount to scale the vector by\r\n * @returns {vec2} out\r\n */\r\nexport function scale(out, a, b) {\r\n  out[0] = a[0] * b;\r\n  out[1] = a[1] * b;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Adds two vec2's after scaling the second operand by a scalar value\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @param {Number} scale the amount to scale b by before adding\r\n * @returns {vec2} out\r\n */\r\nexport function scaleAndAdd(out, a, b, scale) {\r\n  out[0] = a[0] + b[0] * scale;\r\n  out[1] = a[1] + b[1] * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the euclidian distance between two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} distance between a and b\r\n */\r\nexport function distance(a, b) {\r\n  var x = b[0] - a[0],\r\n      y = b[1] - a[1];\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n\r\n/**\r\n * Calculates the squared euclidian distance between two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} squared distance between a and b\r\n */\r\nexport function squaredDistance(a, b) {\r\n  var x = b[0] - a[0],\r\n      y = b[1] - a[1];\r\n  return x * x + y * y;\r\n}\r\n\r\n/**\r\n * Calculates the length of a vec2\r\n *\r\n * @param {vec2} a vector to calculate length of\r\n * @returns {Number} length of a\r\n */\r\nexport function length(a) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n\r\n/**\r\n * Calculates the squared length of a vec2\r\n *\r\n * @param {vec2} a vector to calculate squared length of\r\n * @returns {Number} squared length of a\r\n */\r\nexport function squaredLength(a) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  return x * x + y * y;\r\n}\r\n\r\n/**\r\n * Negates the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to negate\r\n * @returns {vec2} out\r\n */\r\nexport function negate(out, a) {\r\n  out[0] = -a[0];\r\n  out[1] = -a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Returns the inverse of the components of a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to invert\r\n * @returns {vec2} out\r\n */\r\nexport function inverse(out, a) {\r\n  out[0] = 1.0 / a[0];\r\n  out[1] = 1.0 / a[1];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Normalize a vec2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a vector to normalize\r\n * @returns {vec2} out\r\n */\r\nexport function normalize(out, a) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  var len = x * x + y * y;\r\n  if (len > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len = 1 / Math.sqrt(len);\r\n    out[0] = a[0] * len;\r\n    out[1] = a[1] * len;\r\n  }\r\n  return out;\r\n}\r\n\r\n/**\r\n * Calculates the dot product of two vec2's\r\n *\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {Number} dot product of a and b\r\n */\r\nexport function dot(a, b) {\r\n  return a[0] * b[0] + a[1] * b[1];\r\n}\r\n\r\n/**\r\n * Computes the cross product of two vec2's\r\n * Note that the cross product must by definition produce a 3D vector\r\n *\r\n * @param {vec3} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @returns {vec3} out\r\n */\r\nexport function cross(out, a, b) {\r\n  var z = a[0] * b[1] - a[1] * b[0];\r\n  out[0] = out[1] = 0;\r\n  out[2] = z;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation between two vec2's\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the first operand\r\n * @param {vec2} b the second operand\r\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\r\n * @returns {vec2} out\r\n */\r\nexport function lerp(out, a, b, t) {\r\n  var ax = a[0],\r\n      ay = a[1];\r\n  out[0] = ax + t * (b[0] - ax);\r\n  out[1] = ay + t * (b[1] - ay);\r\n  return out;\r\n}\r\n\r\n/**\r\n * Generates a random vector with the given scale\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\r\n * @returns {vec2} out\r\n */\r\nexport function random(out, scale) {\r\n  scale = scale || 1.0;\r\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\r\n  out[0] = Math.cos(r) * scale;\r\n  out[1] = Math.sin(r) * scale;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat2\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat2} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat2(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  out[0] = m[0] * x + m[2] * y;\r\n  out[1] = m[1] * x + m[3] * y;\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat2d\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat2d} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat2d(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  out[0] = m[0] * x + m[2] * y + m[4];\r\n  out[1] = m[1] * x + m[3] * y + m[5];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat3\r\n * 3rd vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat3} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat3(out, a, m) {\r\n  var x = a[0],\r\n      y = a[1];\r\n  out[0] = m[0] * x + m[3] * y + m[6];\r\n  out[1] = m[1] * x + m[4] * y + m[7];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Transforms the vec2 with a mat4\r\n * 3rd vector component is implicitly '0'\r\n * 4th vector component is implicitly '1'\r\n *\r\n * @param {vec2} out the receiving vector\r\n * @param {vec2} a the vector to transform\r\n * @param {mat4} m matrix to transform with\r\n * @returns {vec2} out\r\n */\r\nexport function transformMat4(out, a, m) {\r\n  var x = a[0];\r\n  var y = a[1];\r\n  out[0] = m[0] * x + m[4] * y + m[12];\r\n  out[1] = m[1] * x + m[5] * y + m[13];\r\n  return out;\r\n}\r\n\r\n/**\r\n * Rotate a 2D vector\r\n * @param {vec2} out The receiving vec2\r\n * @param {vec2} a The vec2 point to rotate\r\n * @param {vec2} b The origin of the rotation\r\n * @param {Number} c The angle of rotation\r\n * @returns {vec2} out\r\n */\r\nexport function rotate(out, a, b, c) {\r\n  //Translate point to the origin\r\n  var p0 = a[0] - b[0],\r\n      p1 = a[1] - b[1],\r\n      sinC = Math.sin(c),\r\n      cosC = Math.cos(c);\r\n\r\n  //perform rotation and translate to correct position\r\n  out[0] = p0 * cosC - p1 * sinC + b[0];\r\n  out[1] = p0 * sinC + p1 * cosC + b[1];\r\n\r\n  return out;\r\n}\r\n\r\n/**\r\n * Get the angle between two 2D vectors\r\n * @param {vec2} a The first operand\r\n * @param {vec2} b The second operand\r\n * @returns {Number} The angle in radians\r\n */\r\nexport function angle(a, b) {\r\n  var x1 = a[0],\r\n      y1 = a[1],\r\n      x2 = b[0],\r\n      y2 = b[1];\r\n\r\n  var len1 = x1 * x1 + y1 * y1;\r\n  if (len1 > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len1 = 1 / Math.sqrt(len1);\r\n  }\r\n\r\n  var len2 = x2 * x2 + y2 * y2;\r\n  if (len2 > 0) {\r\n    //TODO: evaluate use of glm_invsqrt here?\r\n    len2 = 1 / Math.sqrt(len2);\r\n  }\r\n\r\n  var cosine = (x1 * x2 + y1 * y2) * len1 * len2;\r\n\r\n  if (cosine > 1.0) {\r\n    return 0;\r\n  } else if (cosine < -1.0) {\r\n    return Math.PI;\r\n  } else {\r\n    return Math.acos(cosine);\r\n  }\r\n}\r\n\r\n/**\r\n * Returns a string representation of a vector\r\n *\r\n * @param {vec2} a vector to represent as a string\r\n * @returns {String} string representation of the vector\r\n */\r\nexport function str(a) {\r\n  return 'vec2(' + a[0] + ', ' + a[1] + ')';\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\r\n *\r\n * @param {vec2} a The first vector.\r\n * @param {vec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function exactEquals(a, b) {\r\n  return a[0] === b[0] && a[1] === b[1];\r\n}\r\n\r\n/**\r\n * Returns whether or not the vectors have approximately the same elements in the same position.\r\n *\r\n * @param {vec2} a The first vector.\r\n * @param {vec2} b The second vector.\r\n * @returns {Boolean} True if the vectors are equal, false otherwise.\r\n */\r\nexport function equals(a, b) {\r\n  var a0 = a[0],\r\n      a1 = a[1];\r\n  var b0 = b[0],\r\n      b1 = b[1];\r\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\r\n}\r\n\r\n/**\r\n * Alias for {@link vec2.length}\r\n * @function\r\n */\r\nexport var len = length;\r\n\r\n/**\r\n * Alias for {@link vec2.subtract}\r\n * @function\r\n */\r\nexport var sub = subtract;\r\n\r\n/**\r\n * Alias for {@link vec2.multiply}\r\n * @function\r\n */\r\nexport var mul = multiply;\r\n\r\n/**\r\n * Alias for {@link vec2.divide}\r\n * @function\r\n */\r\nexport var div = divide;\r\n\r\n/**\r\n * Alias for {@link vec2.distance}\r\n * @function\r\n */\r\nexport var dist = distance;\r\n\r\n/**\r\n * Alias for {@link vec2.squaredDistance}\r\n * @function\r\n */\r\nexport var sqrDist = squaredDistance;\r\n\r\n/**\r\n * Alias for {@link vec2.squaredLength}\r\n * @function\r\n */\r\nexport var sqrLen = squaredLength;\r\n\r\n/**\r\n * Perform some operation over an array of vec2s.\r\n *\r\n * @param {Array} a the array of vectors to iterate over\r\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\r\n * @param {Number} offset Number of elements to skip at the beginning of the array\r\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\r\n * @param {Function} fn Function to call for each vector in the array\r\n * @param {Object} [arg] additional argument to pass to fn\r\n * @returns {Array} a\r\n * @function\r\n */\r\nexport var forEach = function () {\r\n  var vec = create();\r\n\r\n  return function (a, stride, offset, count, fn, arg) {\r\n    var i = void 0,\r\n        l = void 0;\r\n    if (!stride) {\r\n      stride = 2;\r\n    }\r\n\r\n    if (!offset) {\r\n      offset = 0;\r\n    }\r\n\r\n    if (count) {\r\n      l = Math.min(count * stride + offset, a.length);\r\n    } else {\r\n      l = a.length;\r\n    }\r\n\r\n    for (i = offset; i < l; i += stride) {\r\n      vec[0] = a[i];vec[1] = a[i + 1];\r\n      fn(vec, vec, arg);\r\n      a[i] = vec[0];a[i + 1] = vec[1];\r\n    }\r\n\r\n    return a;\r\n  };\r\n}();","import * as glMatrix from \"./gl-matrix/common.js\";\r\nimport * as mat2 from \"./gl-matrix/mat2.js\";\r\nimport * as mat2d from \"./gl-matrix/mat2d.js\";\r\nimport * as mat3 from \"./gl-matrix/mat3.js\";\r\nimport * as mat4 from \"./gl-matrix/mat4.js\";\r\nimport * as quat from \"./gl-matrix/quat.js\";\r\nimport * as quat2 from \"./gl-matrix/quat2.js\";\r\nimport * as vec2 from \"./gl-matrix/vec2.js\";\r\nimport * as vec3 from \"./gl-matrix/vec3.js\";\r\nimport * as vec4 from \"./gl-matrix/vec4.js\";\r\n\r\nexport { glMatrix, mat2, mat2d, mat3, mat4, quat, quat2, vec2, vec3, vec4 };","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    }\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * The unique id is used for unique hashes.\n */\nvar uniqueId = 0;\n/**\n * Tag styles with this string to get unique hashes.\n */\nexports.IS_UNIQUE = '__DO_NOT_DEDUPE_STYLE__';\nvar upperCasePattern = /[A-Z]/g;\nvar msPattern = /^ms-/;\nvar interpolatePattern = /&/g;\nvar escapePattern = /[ !#$%&()*+,./;<=>?@[\\]^`{|}~\"'\\\\]/g;\nvar propLower = function (m) { return \"-\" + m.toLowerCase(); };\n/**\n * CSS properties that are valid unit-less numbers.\n *\n * Ref: https://github.com/facebook/react/blob/master/packages/react-dom/src/shared/CSSProperty.js\n */\nvar CSS_NUMBER = {\n    'animation-iteration-count': true,\n    'border-image-outset': true,\n    'border-image-slice': true,\n    'border-image-width': true,\n    'box-flex': true,\n    'box-flex-group': true,\n    'box-ordinal-group': true,\n    'column-count': true,\n    'columns': true,\n    'counter-increment': true,\n    'counter-reset': true,\n    'flex': true,\n    'flex-grow': true,\n    'flex-positive': true,\n    'flex-shrink': true,\n    'flex-negative': true,\n    'flex-order': true,\n    'font-weight': true,\n    'grid-area': true,\n    'grid-column': true,\n    'grid-column-end': true,\n    'grid-column-span': true,\n    'grid-column-start': true,\n    'grid-row': true,\n    'grid-row-end': true,\n    'grid-row-span': true,\n    'grid-row-start': true,\n    'line-clamp': true,\n    'line-height': true,\n    'opacity': true,\n    'order': true,\n    'orphans': true,\n    'tab-size': true,\n    'widows': true,\n    'z-index': true,\n    'zoom': true,\n    // SVG properties.\n    'fill-opacity': true,\n    'flood-opacity': true,\n    'stop-opacity': true,\n    'stroke-dasharray': true,\n    'stroke-dashoffset': true,\n    'stroke-miterlimit': true,\n    'stroke-opacity': true,\n    'stroke-width': true\n};\n// Add vendor prefixes to all unit-less properties.\nfor (var _i = 0, _a = Object.keys(CSS_NUMBER); _i < _a.length; _i++) {\n    var property = _a[_i];\n    for (var _b = 0, _c = ['-webkit-', '-ms-', '-moz-', '-o-', '']; _b < _c.length; _b++) {\n        var prefix = _c[_b];\n        CSS_NUMBER[prefix + property] = true;\n    }\n}\n/**\n * Escape a CSS class name.\n */\nexports.escape = function (str) { return str.replace(escapePattern, '\\\\$&'); };\n/**\n * Transform a JavaScript property into a CSS property.\n */\nfunction hyphenate(propertyName) {\n    return propertyName\n        .replace(upperCasePattern, propLower)\n        .replace(msPattern, '-ms-'); // Internet Explorer vendor prefix.\n}\nexports.hyphenate = hyphenate;\n/**\n * Generate a hash value from a string.\n */\nfunction stringHash(str) {\n    var value = 5381;\n    var len = str.length;\n    while (len--)\n        value = (value * 33) ^ str.charCodeAt(len);\n    return (value >>> 0).toString(36);\n}\nexports.stringHash = stringHash;\n/**\n * Transform a style string to a CSS string.\n */\nfunction styleToString(key, value) {\n    if (typeof value === 'number' && value !== 0 && !CSS_NUMBER.hasOwnProperty(key)) {\n        return key + \":\" + value + \"px\";\n    }\n    return key + \":\" + value;\n}\n/**\n * Sort an array of tuples by first value.\n */\nfunction sortTuples(value) {\n    return value.sort(function (a, b) { return a[0] > b[0] ? 1 : -1; });\n}\n/**\n * Categorize user styles.\n */\nfunction parseStyles(styles, hasNestedStyles) {\n    var properties = [];\n    var nestedStyles = [];\n    var isUnique = false;\n    // Sort keys before adding to styles.\n    for (var _i = 0, _a = Object.keys(styles); _i < _a.length; _i++) {\n        var key = _a[_i];\n        var value = styles[key];\n        if (value !== null && value !== undefined) {\n            if (key === exports.IS_UNIQUE) {\n                isUnique = true;\n            }\n            else if (typeof value === 'object' && !Array.isArray(value)) {\n                nestedStyles.push([key.trim(), value]);\n            }\n            else {\n                properties.push([hyphenate(key.trim()), value]);\n            }\n        }\n    }\n    return {\n        style: stringifyProperties(sortTuples(properties)),\n        nested: hasNestedStyles ? nestedStyles : sortTuples(nestedStyles),\n        isUnique: isUnique\n    };\n}\n/**\n * Stringify an array of property tuples.\n */\nfunction stringifyProperties(properties) {\n    return properties.map(function (_a) {\n        var name = _a[0], value = _a[1];\n        if (!Array.isArray(value))\n            return styleToString(name, value);\n        return value.map(function (x) { return styleToString(name, x); }).join(';');\n    }).join(';');\n}\n/**\n * Interpolate CSS selectors.\n */\nfunction interpolate(selector, parent) {\n    if (selector.indexOf('&') === -1)\n        return parent + \" \" + selector;\n    return selector.replace(interpolatePattern, parent);\n}\n/**\n * Recursive loop building styles with deferred selectors.\n */\nfunction stylize(selector, styles, rulesList, stylesList, parent) {\n    var _a = parseStyles(styles, selector !== ''), style = _a.style, nested = _a.nested, isUnique = _a.isUnique;\n    var pid = style;\n    if (selector.charCodeAt(0) === 64 /* @ */) {\n        var child = { selector: selector, styles: [], rules: [], style: parent ? '' : style };\n        rulesList.push(child);\n        // Nested styles support (e.g. `.foo > @media > .bar`).\n        if (style && parent)\n            child.styles.push({ selector: parent, style: style, isUnique: isUnique });\n        for (var _i = 0, nested_1 = nested; _i < nested_1.length; _i++) {\n            var _b = nested_1[_i], name = _b[0], value = _b[1];\n            pid += name + stylize(name, value, child.rules, child.styles, parent);\n        }\n    }\n    else {\n        var key = parent ? interpolate(selector, parent) : selector;\n        if (style)\n            stylesList.push({ selector: key, style: style, isUnique: isUnique });\n        for (var _c = 0, nested_2 = nested; _c < nested_2.length; _c++) {\n            var _d = nested_2[_c], name = _d[0], value = _d[1];\n            pid += name + stylize(name, value, rulesList, stylesList, key);\n        }\n    }\n    return pid;\n}\n/**\n * Transform `stylize` tree into style objects.\n */\nfunction composeStylize(cache, pid, rulesList, stylesList, className, isStyle) {\n    for (var _i = 0, stylesList_1 = stylesList; _i < stylesList_1.length; _i++) {\n        var _a = stylesList_1[_i], selector = _a.selector, style = _a.style, isUnique = _a.isUnique;\n        var key = isStyle ? interpolate(selector, className) : selector;\n        var id = isUnique ? \"u\\0\" + (++uniqueId).toString(36) : \"s\\0\" + pid + \"\\0\" + style;\n        var item = new Style(style, id);\n        item.add(new Selector(key, \"k\\0\" + pid + \"\\0\" + key));\n        cache.add(item);\n    }\n    for (var _b = 0, rulesList_1 = rulesList; _b < rulesList_1.length; _b++) {\n        var _c = rulesList_1[_b], selector = _c.selector, style = _c.style, rules = _c.rules, styles = _c.styles;\n        var item = new Rule(selector, style, \"r\\0\" + pid + \"\\0\" + selector + \"\\0\" + style);\n        composeStylize(item, pid, rules, styles, className, isStyle);\n        cache.add(item);\n    }\n}\n/**\n * Cache to list to styles.\n */\nfunction join(arr) {\n    var res = '';\n    for (var i = 0; i < arr.length; i++)\n        res += arr[i];\n    return res;\n}\n/**\n * Noop changes.\n */\nvar noopChanges = {\n    add: function () { return undefined; },\n    change: function () { return undefined; },\n    remove: function () { return undefined; }\n};\n/**\n * Implement a cache/event emitter.\n */\nvar Cache = /** @class */ (function () {\n    function Cache(changes) {\n        if (changes === void 0) { changes = noopChanges; }\n        this.changes = changes;\n        this.sheet = [];\n        this.changeId = 0;\n        this._keys = [];\n        this._children = Object.create(null);\n        this._counters = Object.create(null);\n    }\n    Cache.prototype.add = function (style) {\n        var count = this._counters[style.id] || 0;\n        var item = this._children[style.id] || style.clone();\n        this._counters[style.id] = count + 1;\n        if (count === 0) {\n            this._children[item.id] = item;\n            this._keys.push(item.id);\n            this.sheet.push(item.getStyles());\n            this.changeId++;\n            this.changes.add(item, this._keys.length - 1);\n        }\n        else if (item instanceof Cache && style instanceof Cache) {\n            var curIndex = this._keys.indexOf(style.id);\n            var prevItemChangeId = item.changeId;\n            item.merge(style);\n            if (item.changeId !== prevItemChangeId) {\n                this.sheet.splice(curIndex, 1, item.getStyles());\n                this.changeId++;\n                this.changes.change(item, curIndex, curIndex);\n            }\n        }\n        return item;\n    };\n    Cache.prototype.remove = function (style) {\n        var count = this._counters[style.id];\n        if (count !== undefined && count > 0) {\n            this._counters[style.id] = count - 1;\n            var item = this._children[style.id];\n            var index = this._keys.indexOf(item.id);\n            if (count === 1) {\n                delete this._counters[style.id];\n                delete this._children[style.id];\n                this._keys.splice(index, 1);\n                this.sheet.splice(index, 1);\n                this.changeId++;\n                this.changes.remove(item, index);\n            }\n            else if (item instanceof Cache && style instanceof Cache) {\n                var prevChangeId = item.changeId;\n                item.unmerge(style);\n                if (item.changeId !== prevChangeId) {\n                    this.sheet.splice(index, 1, item.getStyles());\n                    this.changeId++;\n                    this.changes.change(item, index, index);\n                }\n            }\n        }\n    };\n    Cache.prototype.values = function () {\n        var _this = this;\n        return this._keys.map(function (key) { return _this._children[key]; });\n    };\n    Cache.prototype.merge = function (cache) {\n        for (var _i = 0, _a = cache.values(); _i < _a.length; _i++) {\n            var item = _a[_i];\n            this.add(item);\n        }\n        return this;\n    };\n    Cache.prototype.unmerge = function (cache) {\n        for (var _i = 0, _a = cache.values(); _i < _a.length; _i++) {\n            var item = _a[_i];\n            this.remove(item);\n        }\n        return this;\n    };\n    Cache.prototype.clone = function () {\n        return new Cache().merge(this);\n    };\n    return Cache;\n}());\nexports.Cache = Cache;\n/**\n * Selector is a dumb class made to represent nested CSS selectors.\n */\nvar Selector = /** @class */ (function () {\n    function Selector(selector, id) {\n        this.selector = selector;\n        this.id = id;\n    }\n    Selector.prototype.getStyles = function () {\n        return this.selector;\n    };\n    Selector.prototype.clone = function () {\n        return new Selector(this.selector, this.id);\n    };\n    return Selector;\n}());\nexports.Selector = Selector;\n/**\n * The style container registers a style string with selectors.\n */\nvar Style = /** @class */ (function (_super) {\n    __extends(Style, _super);\n    function Style(style, id) {\n        var _this = _super.call(this) || this;\n        _this.style = style;\n        _this.id = id;\n        return _this;\n    }\n    Style.prototype.getStyles = function () {\n        return this.sheet.join(',') + \"{\" + this.style + \"}\";\n    };\n    Style.prototype.clone = function () {\n        return new Style(this.style, this.id).merge(this);\n    };\n    return Style;\n}(Cache));\nexports.Style = Style;\n/**\n * Implement rule logic for style output.\n */\nvar Rule = /** @class */ (function (_super) {\n    __extends(Rule, _super);\n    function Rule(rule, style, id) {\n        var _this = _super.call(this) || this;\n        _this.rule = rule;\n        _this.style = style;\n        _this.id = id;\n        return _this;\n    }\n    Rule.prototype.getStyles = function () {\n        return this.rule + \"{\" + this.style + join(this.sheet) + \"}\";\n    };\n    Rule.prototype.clone = function () {\n        return new Rule(this.rule, this.style, this.id).merge(this);\n    };\n    return Rule;\n}(Cache));\nexports.Rule = Rule;\n/**\n * The FreeStyle class implements the API for everything else.\n */\nvar FreeStyle = /** @class */ (function (_super) {\n    __extends(FreeStyle, _super);\n    function FreeStyle(hash, debug, id, changes) {\n        var _this = _super.call(this, changes) || this;\n        _this.hash = hash;\n        _this.debug = debug;\n        _this.id = id;\n        return _this;\n    }\n    FreeStyle.prototype.registerStyle = function (styles, displayName) {\n        var rulesList = [];\n        var stylesList = [];\n        var pid = stylize('&', styles, rulesList, stylesList);\n        var hash = \"f\" + this.hash(pid);\n        var id = this.debug && displayName ? displayName + \"_\" + hash : hash;\n        composeStylize(this, pid, rulesList, stylesList, \".\" + exports.escape(id), true);\n        return id;\n    };\n    FreeStyle.prototype.registerKeyframes = function (keyframes, displayName) {\n        return this.registerHashRule('@keyframes', keyframes, displayName);\n    };\n    FreeStyle.prototype.registerHashRule = function (prefix, styles, displayName) {\n        var rulesList = [];\n        var stylesList = [];\n        var pid = stylize('', styles, rulesList, stylesList);\n        var hash = \"f\" + this.hash(pid);\n        var id = this.debug && displayName ? displayName + \"_\" + hash : hash;\n        var rule = new Rule(prefix + \" \" + exports.escape(id), '', \"h\\0\" + pid + \"\\0\" + prefix);\n        composeStylize(rule, pid, rulesList, stylesList, '', false);\n        this.add(rule);\n        return id;\n    };\n    FreeStyle.prototype.registerRule = function (rule, styles) {\n        var rulesList = [];\n        var stylesList = [];\n        var pid = stylize(rule, styles, rulesList, stylesList);\n        composeStylize(this, pid, rulesList, stylesList, '', false);\n    };\n    FreeStyle.prototype.registerCss = function (styles) {\n        return this.registerRule('', styles);\n    };\n    FreeStyle.prototype.getStyles = function () {\n        return join(this.sheet);\n    };\n    FreeStyle.prototype.clone = function () {\n        return new FreeStyle(this.hash, this.debug, this.id, this.changes).merge(this);\n    };\n    return FreeStyle;\n}(Cache));\nexports.FreeStyle = FreeStyle;\n/**\n * Exports a simple function to create a new instance.\n */\nfunction create(hash, debug, changes) {\n    if (hash === void 0) { hash = stringHash; }\n    if (debug === void 0) { debug = typeof process !== 'undefined' && process.env.NODE_ENV !== 'production'; }\n    if (changes === void 0) { changes = noopChanges; }\n    return new FreeStyle(hash, debug, \"f\" + (++uniqueId).toString(36), changes);\n}\nexports.create = create;\n//# sourceMappingURL=free-style.js.map","import { Bsp } from './Bsp'\r\nimport { evt } from './Util'\r\nimport * as Time from './Time'\r\nimport { Sound } from './Sound'\r\nimport { Loader } from './Loader'\r\nimport { Config } from './Config'\r\nimport { Mouse } from './Input/Mouse'\r\nimport { Touch } from './Input/Touch'\r\nimport { Replay } from './Replay/Replay'\r\nimport { Camera } from './Graphics/Camera'\r\nimport { Keyboard } from './Input/Keyboard'\r\nimport { SoundSystem } from './SoundSystem'\r\nimport { Context } from './Graphics/Context'\r\nimport { ReplayPlayer } from './ReplayPlayer'\r\nimport { Renderer } from './Graphics/Renderer'\r\nimport { SkyScene } from './Graphics/SkyScene'\r\nimport { WorldScene } from './Graphics/WorldScene'\r\n\r\nexport enum PlayerMode {\r\n  FREE,\r\n  REPLAY\r\n}\r\n\r\ntype GameInitSuccess = { status: 'success'; game: Game }\r\ntype GameInitError = { status: 'error'; message: string }\r\ntype GameInit = GameInitSuccess | GameInitError\r\n\r\nexport class Game extends EventTarget {\r\n  public static init(config: Config): GameInit {\r\n    const status = Context.checkWebGLSupport()\r\n    if (!status.hasSupport) {\r\n      return {\r\n        status: 'error',\r\n        message: 'No WebGL support!'\r\n      }\r\n    }\r\n\r\n    const canvas = document.createElement('canvas')\r\n    if (!canvas) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to create <canvas> element!'\r\n      }\r\n    }\r\n\r\n    const context = Context.init(canvas)\r\n    if (!context) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize WebGL context'\r\n      }\r\n    }\r\n\r\n    const renderer = Renderer.init(context)\r\n    if (!renderer) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize renderer'\r\n      }\r\n    }\r\n\r\n    const worldScene = WorldScene.init(context)\r\n    if (!worldScene) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize world scene'\r\n      }\r\n    }\r\n\r\n    const skyScene = SkyScene.init(context)\r\n    if (!skyScene) {\r\n      return {\r\n        status: 'error',\r\n        message: 'Failed to initialize sky scene'\r\n      }\r\n    }\r\n\r\n    const game = new Game({\r\n      canvas,\r\n      config,\r\n      context,\r\n      renderer,\r\n      worldScene,\r\n      skyScene\r\n    })\r\n\r\n    return {\r\n      status: 'success',\r\n      game\r\n    }\r\n  }\r\n\r\n  config: Config\r\n\r\n  pauseTime: number = 0\r\n  isPaused: boolean = false\r\n  lastTime: number = 0\r\n  accumTime: number = 0\r\n  readonly timeStep: number = 1 / 60\r\n\r\n  title: string = ''\r\n  mode: PlayerMode\r\n  pointerLocked: boolean = false\r\n\r\n  touch: Touch = new Touch()\r\n  mouse: Mouse = new Mouse()\r\n  keyboard: Keyboard = new Keyboard()\r\n\r\n  loader: Loader\r\n  entities: any[] = []\r\n  sounds: Sound[]\r\n  soundSystem: SoundSystem\r\n  player: ReplayPlayer\r\n\r\n  canvas: HTMLCanvasElement\r\n  mapName: string\r\n  context: Context\r\n  camera: Camera\r\n  renderer: Renderer\r\n  worldScene: WorldScene\r\n  skyScene: SkyScene\r\n\r\n  constructor(params: {\r\n    config: Config\r\n    canvas: HTMLCanvasElement\r\n    context: Context\r\n    renderer: Renderer\r\n    worldScene: WorldScene\r\n    skyScene: SkyScene\r\n  }) {\r\n    super();\r\n    this.sounds = []\r\n    this.soundSystem = new SoundSystem()\r\n\r\n    this.config = params.config\r\n    this.loader = new Loader(this.config)\r\n\r\n    this.loader.addEventListener('loadAll', (event) => {\r\n      this.onLoadAll((<CustomEvent>event).detail.loader)\r\n    })\r\n\r\n    document.addEventListener('touchstart', this.onTouchStart, false)\r\n    document.addEventListener('touchend', this.onTouchEnd, false)\r\n    document.addEventListener('touchcancel', this.onTouchEnd, false)\r\n    document.addEventListener('touchmove', this.onTouchMove, false)\r\n    document.addEventListener('mousemove', this.onMouseMove, false)\r\n    window.addEventListener('keydown', this.keyDown)\r\n    window.addEventListener('keyup', this.keyUp)\r\n    window.addEventListener('visibilitychange', this.onVisibilityChange)\r\n\r\n    this.canvas = params.canvas\r\n    this.camera = Camera.init(this.canvas.width / this.canvas.height)\r\n\r\n    this.context = params.context\r\n    this.renderer = params.renderer\r\n    this.worldScene = params.worldScene\r\n    this.skyScene = params.skyScene\r\n\r\n    this.mode = PlayerMode.FREE\r\n\r\n    this.player = new ReplayPlayer(this)\r\n\r\n    this.mapName = ''\r\n  }\r\n\r\n  getCanvas() {\r\n    return this.canvas\r\n  }\r\n\r\n  load(name: string) {\r\n    this.dispatchEvent(evt('loadstart'));\r\n    this.loader.load(name)\r\n  }\r\n\r\n  changeMap(map: Bsp) {\r\n    if (this.mapName.toLowerCase() === map.name.toLowerCase()) {\r\n      return\r\n    }\r\n\r\n    this.mapName = map.name\r\n\r\n    this.worldScene.changeMap(map)\r\n    this.skyScene.changeMap(map)\r\n\r\n    this.entities = map.entities\r\n\r\n    const spawn = map.entities.find(e => e['classname'] === 'info_player_start')\r\n\r\n    if (spawn) {\r\n      this.camera.position[0] = spawn.origin[0]\r\n      this.camera.position[1] = spawn.origin[1]\r\n      this.camera.position[2] = spawn.origin[2]\r\n    } else {\r\n      this.camera.position[0] = 0\r\n      this.camera.position[1] = 0\r\n      this.camera.position[2] = 0\r\n    }\r\n\r\n    this.camera.rotation[0] = 0 // Math.PI / 2\r\n    this.camera.rotation[1] = 0\r\n    this.camera.rotation[2] = 0\r\n  }\r\n\r\n  changeReplay(replay: Replay) {\r\n    //this.events.emit('prereplaychange', this, replay)\r\n\r\n    this.player.changeReplay(replay)\r\n\r\n    //this.events.emit('postreplaychange', this, replay)\r\n  }\r\n\r\n  changeMode(mode: PlayerMode) {\r\n    this.mode = mode\r\n    this.dispatchEvent(evt('modechange'));\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this.title = title\r\n\r\n    this.dispatchEvent(evt('titlechange', { detail: { item: title }}));\r\n  }\r\n\r\n  getTitle() {\r\n    return this.title\r\n  }\r\n\r\n  onLoadAll = (loader: Loader) => {\r\n    if (loader && loader.replay) {\r\n      this.changeReplay(loader.replay.data)\r\n      this.changeMode(PlayerMode.REPLAY)\r\n    }\r\n\r\n    if (!loader.map || !loader.map.data) {\r\n      return\r\n    }\r\n\r\n    const map = loader.map.data\r\n    const skies = loader.skies\r\n    let skiesValid = true\r\n    skies.forEach(sky => {\r\n      skiesValid = skiesValid && sky.isDone()\r\n    })\r\n    if (skiesValid) {\r\n      skies.forEach(sky => (sky.data ? map.skies.push(sky.data) : 0))\r\n    }\r\n\r\n    // add sprites\r\n    Object.entries(loader.sprites).forEach(([name, item]) => {\r\n      if (item.data) {\r\n        map.sprites[name] = item.data\r\n      }\r\n    })\r\n\r\n    if (loader.sounds.length > 0) {\r\n      loader.sounds.forEach(sound => {\r\n        if (sound.data) {\r\n          this.sounds.push(sound.data)\r\n        }\r\n      })\r\n    }\r\n\r\n    this.changeMap(map)\r\n\r\n    this.dispatchEvent(evt('load', { detail: { item: loader } }));\r\n  }\r\n\r\n  draw = () => {\r\n    requestAnimationFrame(this.draw)\r\n\r\n    const canvas = this.canvas\r\n    const parent = canvas.parentElement\r\n    if (parent) {\r\n      const pw = parent.clientWidth\r\n      const ph = parent.clientHeight\r\n      if (canvas.width !== pw || canvas.height !== ph) {\r\n        canvas.width = pw\r\n        canvas.height = ph\r\n        this.camera.aspect = canvas.clientWidth / canvas.clientHeight\r\n        this.camera.updateProjectionMatrix()\r\n        this.context.gl.viewport(\r\n          0,\r\n          0,\r\n          this.context.gl.drawingBufferWidth,\r\n          this.context.gl.drawingBufferHeight\r\n        )\r\n      }\r\n\r\n      if (\r\n        canvas.clientWidth !== canvas.width ||\r\n        canvas.clientHeight !== canvas.height\r\n      ) {\r\n        canvas.width = canvas.clientWidth\r\n        canvas.height = canvas.clientHeight\r\n        this.camera.aspect = canvas.clientWidth / canvas.clientHeight\r\n        this.camera.updateProjectionMatrix()\r\n        this.context.gl.viewport(\r\n          0,\r\n          0,\r\n          this.context.gl.drawingBufferWidth,\r\n          this.context.gl.drawingBufferHeight\r\n        )\r\n      }\r\n    }\r\n\r\n    const currTime = Time.now() / 1000\r\n    const dt = currTime - this.lastTime\r\n    this.accumTime += dt\r\n\r\n    while (this.accumTime > this.timeStep) {\r\n      this.update(this.timeStep)\r\n      this.accumTime -= this.timeStep\r\n    }\r\n\r\n    this.renderer.draw()\r\n    if (this.mapName !== '') {\r\n      this.skyScene.draw(this.camera)\r\n      this.worldScene.draw(this.camera, this.entities)\r\n    }\r\n\r\n    this.lastTime = currTime\r\n  }\r\n\r\n  update(dt: number) {\r\n    this.dispatchEvent(evt('preupdate', { detail: { item: this } }));\r\n\r\n    const camera = this.camera\r\n    const keyboard = this.keyboard\r\n    const mouse = this.mouse\r\n    const touch = this.touch\r\n\r\n    if (this.mode === PlayerMode.REPLAY) {\r\n      this.player.update(dt)\r\n    } else if (this.mode === PlayerMode.FREE) {\r\n      if (this.touch.pressed) {\r\n        camera.rotation[0] = Math.min(\r\n          Math.max(camera.rotation[0] + touch.delta[1] / 100, -Math.PI / 2),\r\n          Math.PI / 2\r\n        )\r\n        camera.rotation[1] -= touch.delta[0] / 100\r\n      } else {\r\n        camera.rotation[0] = Math.min(\r\n          Math.max(camera.rotation[0] + mouse.delta[1] / 100, -Math.PI / 2),\r\n          Math.PI / 2\r\n        )\r\n        camera.rotation[1] -= mouse.delta[0] / 100\r\n      }\r\n\r\n      const speed = 500\r\n      const ds = speed * dt\r\n      const KEY_W = Keyboard.KEYS.W\r\n      const KEY_S = Keyboard.KEYS.S\r\n      const KEY_A = Keyboard.KEYS.A\r\n      const KEY_D = Keyboard.KEYS.D\r\n      const downKey = Keyboard.KEYS.C\r\n      const upKey = Keyboard.KEYS.SPACE\r\n      if (keyboard.keys[KEY_W] !== keyboard.keys[KEY_S]) {\r\n        if (keyboard.keys[KEY_W]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1] + Math.PI / 2) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1] + Math.PI / 2) * ds\r\n        } else if (keyboard.keys[KEY_S]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1] - Math.PI / 2) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1] - Math.PI / 2) * ds\r\n        }\r\n      }\r\n\r\n      if (keyboard.keys[KEY_A] !== keyboard.keys[KEY_D]) {\r\n        if (keyboard.keys[KEY_A]) {\r\n          camera.position[1] += Math.cos(camera.rotation[1]) * ds\r\n          camera.position[0] -= Math.sin(camera.rotation[1]) * ds\r\n        } else if (keyboard.keys[KEY_D]) {\r\n          camera.position[1] -= Math.cos(camera.rotation[1]) * ds\r\n          camera.position[0] += Math.sin(camera.rotation[1]) * ds\r\n        }\r\n      }\r\n\r\n      if (keyboard.keys[upKey] !== keyboard.keys[downKey]) {\r\n        if (keyboard.keys[upKey]) {\r\n          camera.position[2] += ds\r\n        } else if (keyboard.keys[downKey]) {\r\n          camera.position[2] -= ds\r\n        }\r\n      }\r\n    }\r\n\r\n    mouse.delta[0] = 0\r\n    mouse.delta[1] = 0\r\n\r\n    this.dispatchEvent(evt('postupdate', { detail: { item: this } }));\r\n  }\r\n\r\n  on(eventName: string, callback: (...args: any[]) => void) {\r\n    return this.addEventListener(eventName, callback)\r\n  }\r\n\r\n  off(eventName: string, callback: (...args: any[]) => void) {\r\n    return this.removeEventListener(eventName, callback)\r\n  }\r\n\r\n  onTouchStart = (e: TouchEvent) => {\r\n    const touch = e.touches.item(0)\r\n    if (touch) {\r\n      this.touch.pressed = true\r\n      this.touch.position[0] = touch.clientX\r\n      this.touch.position[1] = touch.clientY\r\n    }\r\n  }\r\n\r\n  onTouchEnd = () => {\r\n    this.touch.pressed = false\r\n    this.touch.delta[0] = 0\r\n    this.touch.delta[1] = 0\r\n  }\r\n\r\n  onTouchMove = (e: TouchEvent) => {\r\n    const touch = e.touches.item(0)\r\n    if (touch && this.touch.pressed) {\r\n      this.touch.delta[0]\r\n      this.touch.delta[0] = touch.clientX - this.touch.position[0]\r\n      this.touch.delta[1] = touch.clientY - this.touch.position[1]\r\n\r\n      this.touch.position[0] = touch.clientX\r\n      this.touch.position[1] = touch.clientY\r\n    }\r\n  }\r\n\r\n  onMouseMove = (e: MouseEvent) => {\r\n    if (this.pointerLocked) {\r\n      this.mouse.delta[0] = e.movementX * 0.5 // mul 0.5 to lower sensitivity\r\n      this.mouse.delta[1] = e.movementY * 0.5 //\r\n\r\n      this.mouse.position[0] = e.pageX\r\n      this.mouse.position[1] = e.pageY\r\n    }\r\n  }\r\n\r\n  keyDown = (e: KeyboardEvent) => {\r\n    this.keyboard.keys[e.which] = 1\r\n\r\n    if (this.pointerLocked) {\r\n      e.preventDefault()\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  keyUp = (e: KeyboardEvent) => {\r\n    this.keyboard.keys[e.which] = 0\r\n\r\n    if (this.pointerLocked) {\r\n      e.preventDefault()\r\n      return false\r\n    }\r\n\r\n    return true\r\n  }\r\n\r\n  onVisibilityChange = () => {\r\n    if (document.hidden) {\r\n      if (this.isPaused) {\r\n        return\r\n      }\r\n\r\n      this.pauseTime = Time.now() / 1000\r\n      this.isPaused = true\r\n    } else {\r\n      if (!this.isPaused) {\r\n        return\r\n      }\r\n\r\n      this.lastTime = Time.now() / 1000 - this.pauseTime + this.lastTime\r\n      this.isPaused = false\r\n    }\r\n  }\r\n}\r\n","export function paletteToRGBA(\n  pixels: Uint8Array,\n  palette: Uint8Array\n): Uint8Array {\n  const rgba = new Uint8Array(pixels.length * 4)\n\n  const len = pixels.length\n  for (let i = 0; i < len; ++i) {\n    rgba[i * 4] = palette[pixels[i] * 3]\n    rgba[i * 4 + 1] = palette[pixels[i] * 3 + 1]\n    rgba[i * 4 + 2] = palette[pixels[i] * 3 + 2]\n    rgba[i * 4 + 3] = 255\n  }\n\n  return rgba\n}\n\nexport function paletteWithLastTransToRGBA(\n  pixels: Uint8Array,\n  palette: Uint8Array\n): Uint8Array {\n  const rgba = new Uint8Array(pixels.length * 4)\n\n  const len = pixels.length\n  for (let i = 0; i < len; ++i) {\n    if (pixels[i] === 255) {\n      rgba[i * 4 + 3] = 0\n    } else {\n      rgba[i * 4] = palette[pixels[i] * 3]\n      rgba[i * 4 + 1] = palette[pixels[i] * 3 + 1]\n      rgba[i * 4 + 2] = palette[pixels[i] * 3 + 2]\n      rgba[i * 4 + 3] = 255\n    }\n  }\n\n  return rgba\n}\n","const wnd: any = window\r\n\r\nlet _now\r\nif (typeof performance !== 'undefined') {\r\n  if (performance.now) {\r\n    _now = () => wnd.performance.now()\r\n  } else if (wnd.performance.mozNow) {\r\n    _now = () => wnd.performance.mozNow()\r\n  } else if (wnd.performance.msNow) {\r\n    _now = () => wnd.performance.msNow()\r\n  } else if (wnd.performance.oNow) {\r\n    _now = () => wnd.performance.oNow()\r\n  } else if (wnd.performance.webkitNow) {\r\n    _now = () => wnd.performance.webkitNow()\r\n  } else if (Date.now) {\r\n    _now = () => Date.now()\r\n  }\r\n}\r\n\r\nexport const now = _now || (() => new Date().getTime())\r\n\r\nexport const formatTime = (seconds: number) => {\r\n  const m = Math.floor(seconds / 60)\r\n  const s = Math.floor(seconds - m * 60)\r\n  const mm = m < 10 ? '0' + m : m.toString()\r\n  const ss = s < 10 ? '0' + s : s.toString()\r\n  return mm + ':' + ss\r\n}\r\n","import { evt } from './Util'\r\nimport { Sound } from './Sound'\r\n\r\nconst wnd: any = window\r\n\r\nconst polyfillAudioContext = wnd.AudioContext || wnd.webkitAudioContext\r\nconst audioContext: AudioContext = new polyfillAudioContext()\r\n\r\nexport class SoundSystem extends EventTarget {\r\n  context: AudioContext\r\n  channels: any[]\r\n  masterGain: GainNode\r\n  preMuteVolume: number\r\n\r\n  constructor() {\r\n    super()\r\n    this.context = audioContext\r\n\r\n    const volume = parseFloat(localStorage.getItem('volume') || '0.3')\r\n    localStorage.setItem('volume', volume.toString())\r\n\r\n    this.channels = []\r\n\r\n    this.preMuteVolume = 1\r\n    this.masterGain = this.context.createGain()\r\n    this.masterGain.gain.value = volume\r\n    this.masterGain.connect(this.context.destination)\r\n\r\n    for (let i = 0; i < 8; ++i) {\r\n      this.channels.push({\r\n        source: null,\r\n        gain: this.context.createGain()\r\n      })\r\n      this.channels[i].gain.connect(this.masterGain)\r\n    }\r\n  }\r\n\r\n  static getContext() {\r\n    return audioContext\r\n  }\r\n\r\n  play(sound: Sound, channel: number, volume: number) {\r\n    this.stop(channel)\r\n\r\n    const gain = this.channels[channel].gain\r\n    gain.gain.value = Math.max(0, Math.min(1, volume))\r\n\r\n    const source = this.context.createBufferSource()\r\n    source.buffer = sound.buffer\r\n    source.connect(gain)\r\n    source.start(0)\r\n\r\n    this.channels[channel].source = source\r\n  }\r\n\r\n  stop(channel: number) {\r\n    const source = this.channels[channel].source\r\n    if (source) {\r\n      source.stop(0)\r\n    }\r\n  }\r\n\r\n  getVolume() {\r\n    return this.masterGain.gain.value\r\n  }\r\n\r\n  setVolume(value: number) {\r\n    const current = this.masterGain.gain.value\r\n    if (current > 0 && value === 0) {\r\n      this.preMuteVolume = current\r\n    }\r\n\r\n    this.masterGain.gain.value = value\r\n\r\n    localStorage.setItem('volume', value.toString())\r\n\r\n    this.dispatchEvent(evt('volumeChange', { detail: { item: value } }));\r\n  }\r\n\r\n  toggleMute() {\r\n    if (this.getVolume() === 0) {\r\n      this.setVolume(this.preMuteVolume)\r\n    } else {\r\n      this.setVolume(0)\r\n    }\r\n  }\r\n}\r\n","import { ReplayMap } from './ReplayMap'\nimport { ReplayChunk } from './ReplayChunk'\nimport { ReplayState } from './ReplayState'\nimport { Reader, ReaderDataType } from '../Reader'\nimport { FrameDataReader } from './FrameDataReader'\nimport { getInitialDeltaDecoders } from './readDelta'\n\nconst checkType = (r: Reader) => {\n  let magic = r.nstr(8)\n  return magic === 'HLDEMO'\n}\n\nconst readHeader = (r: Reader) => ({\n  demoProtocol: r.ui(),\n  netProtocol: r.ui(),\n  mapName: r.nstr(260),\n  modName: r.nstr(260),\n  mapCrc: r.i(),\n  dirOffset: r.ui()\n})\n\nconst readDirectories = (r: Reader, offset: number) => {\n  r.seek(offset)\n\n  let count = r.ui()\n  let directories = []\n  for (let i = 0; i < count; ++i) {\n    directories.push({\n      id: r.ui(),\n      name: r.nstr(64),\n      flags: r.ui(),\n      cdTrack: r.i(),\n      time: r.f(),\n      frames: r.ui(),\n      offset: r.ui(),\n      length: r.ui()\n    })\n  }\n\n  return directories\n}\n\nconst readFrameData = (r: Reader, deltaDecoders: any, customMessages: any) => {\n  let length = r.ui()\n  let limit = r.tell() + length\n  let data = []\n  while (r.tell() < limit) {\n    let type = r.ub()\n    if (type === 1) {\n      continue\n    } else if (type >= 64) {\n      if (customMessages[type] && customMessages[type].size > -1) {\n        r.skip(customMessages[type].size)\n      } else {\n        r.skip(r.ub())\n      }\n\n      continue\n    }\n\n    let message = FrameDataReader.read(r, type, deltaDecoders)\n    if (message) {\n      if (type === 39) {\n        customMessages[message.index] = message\n      }\n      data.push({\n        type,\n        data: message\n      })\n    } else {\n      r.seek(limit)\n    }\n  }\n\n  // just in case\n  r.seek(limit)\n\n  return data\n}\n\nconst readFrame = (r: Reader, deltaDecoders: any, customMessages: any) => {\n  let frame: any = {\n    type: r.ub(),\n    time: r.f(),\n    tick: r.ui()\n  }\n\n  switch (frame.type) {\n    case 0:\n    case 1: {\n      r.skip(4)\n      frame.camera = {\n        position: [r.f(), r.f(), r.f()],\n        orientation: [r.f(), r.f(), r.f()]\n      }\n      r.skip(436)\n      frame.data = readFrameData(r, deltaDecoders, customMessages)\n      break\n    }\n    case 2: {\n      break\n    }\n    case 3: {\n      frame.command = r.nstr(64)\n      break\n    }\n    case 4: {\n      r.skip(32)\n      break\n    }\n    case 5: {\n      break\n    }\n    case 6: {\n      r.skip(84)\n      break\n    }\n    case 7: {\n      r.skip(8)\n      break\n    }\n    case 8: {\n      frame.sound = {\n        channel: r.i(),\n        sample: r.nstr(r.ui()),\n        attenuation: r.f(),\n        volume: r.f(),\n        flags: r.ui(),\n        pitch: r.i()\n      }\n      break\n    }\n    case 9: {\n      r.skip(r.ui())\n      break\n    }\n    default: {\n      frame.error = true\n      break\n    }\n  }\n\n  return frame\n}\n\nexport class Replay {\n  header: any\n  mapName: string\n  directories: any\n\n  constructor(header: any, directories: any) {\n    this.header = header\n    this.mapName = this.header.mapName\n    this.directories = directories\n  }\n\n  static parseFromArrayBuffer(buffer: ArrayBuffer) {\n    let r = new Reader(buffer)\n    let magic = r.nstr(8)\n    if (magic !== 'HLDEMO') {\n      throw new Error('Invalid replay format')\n    }\n\n    let header: any = {}\n    header.demoProtocol = r.ui()\n    header.netProtocol = r.ui()\n    header.mapName = r.nstr(260)\n    header.modName = r.nstr(260)\n    header.mapCrc = r.i()\n    header.dirOffset = r.ui()\n\n    r.seek(header.dirOffset)\n    let directoryCount = r.ui()\n    let directories: any[] = []\n    for (let i = 0; i < directoryCount; ++i) {\n      directories.push({\n        id: r.ui(),\n        name: r.nstr(64),\n        flags: r.ui(),\n        cdTrack: r.i(),\n        time: r.f(),\n        frames: r.ui(),\n        offset: r.ui(),\n        length: r.ui(),\n        macros: []\n      })\n    }\n\n    for (let i = 0; i < directories.length; ++i) {\n      r.seek(directories[i].offset)\n\n      let isFinalMacroReached = false\n      while (!isFinalMacroReached) {\n        let macro: any = {\n          type: r.b(),\n          time: r.f(),\n          frame: r.ui()\n        }\n\n        switch (macro.type) {\n          case 0:\n          case 1: {\n            r.skip(4)\n            macro.camera = {\n              position: [r.f(), r.f(), r.f()],\n              orientation: [r.f(), r.f(), r.f()]\n            }\n            r.skip(436)\n            r.skip(r.ui())\n            break\n          }\n\n          case 2: {\n            // empty macro\n            // signals the beginning of directory entry\n            break\n          }\n\n          case 3: {\n            macro.command = r.nstr(64)\n            break\n          }\n\n          case 4: {\n            r.skip(32)\n            break\n          }\n\n          case 5: {\n            // empty macro that signals end of directory entry\n            isFinalMacroReached = true\n            break\n          }\n\n          case 6: {\n            r.skip(84)\n            break\n          }\n\n          case 7: {\n            r.skip(8)\n            break\n          }\n\n          case 8: {\n            r.skip(4)\n            r.skip(r.ui() + 16)\n            break\n          }\n\n          case 9: {\n            r.skip(r.ui())\n            break\n          }\n\n          default: {\n            const offset = Number(r.tell() - 9).toString(16)\n            const msg = [\n              `Unexpected macro (${macro.type})`,\n              ` at offset = ${offset}.`\n            ].join('')\n            throw new Error(msg)\n          }\n        }\n\n        directories[i].macros.push(macro)\n      }\n    }\n\n    return new Replay(header, directories)\n  }\n\n  static parseFullFromArrayBuffer(buffer: ArrayBuffer) {\n    let r = new Reader(buffer)\n    let magic = r.nstr(8)\n    if (magic !== 'HLDEMO') {\n      throw new Error('Invalid replay format')\n    }\n\n    let header: any = {}\n    header.demoProtocol = r.ui()\n    header.netProtocol = r.ui()\n    header.mapName = r.nstr(260)\n    header.modName = r.nstr(260)\n    header.mapCrc = r.i()\n    header.dirOffset = r.ui()\n\n    r.seek(header.dirOffset)\n    let directoryCount = r.ui()\n    let directories: any[] = []\n    for (let i = 0; i < directoryCount; ++i) {\n      directories.push({\n        id: r.ui(),\n        name: r.nstr(64),\n        flags: r.ui(),\n        cdTrack: r.i(),\n        time: r.f(),\n        frames: r.ui(),\n        offset: r.ui(),\n        length: r.ui(),\n        macros: []\n      })\n    }\n\n    let deltaDecoders = getInitialDeltaDecoders()\n\n    let customMessages = []\n\n    for (let i = 0; i < directories.length; ++i) {\n      r.seek(directories[i].offset)\n\n      let isFinalMacroReached = false\n      while (!isFinalMacroReached) {\n        let macro: any = {\n          type: r.b(),\n          time: r.f(),\n          frame: r.ui()\n        }\n        switch (macro.type) {\n          case 0:\n          case 1: {\n            r.skip(4)\n            macro.camera = {\n              position: [r.f(), r.f(), r.f()],\n              orientation: [r.f(), r.f(), r.f()],\n              forward: [r.f(), r.f(), r.f()],\n              right: [r.f(), r.f(), r.f()],\n              up: [r.f(), r.f(), r.f()]\n            }\n\n            macro.RefParams = {\n              frametime: r.f(),\n              time: r.f(),\n              intermission: r.i(),\n              paused: r.i(),\n              spectator: r.i(),\n              onground: r.i(),\n              waterlevel: r.i(),\n              velocity: [r.f(), r.f(), r.f()],\n              origin: [r.f(), r.f(), r.f()],\n              viewHeight: [r.f(), r.f(), r.f()],\n              idealPitch: r.f(),\n              viewAngles: [r.f(), r.f(), r.f()],\n              health: r.i(),\n              crosshairAngle: [r.f(), r.f(), r.f()],\n              viewSize: r.f(),\n              punchAngle: [r.f(), r.f(), r.f()],\n              maxClients: r.i(),\n              viewEntity: r.i(),\n              playerCount: r.i(),\n              maxEntities: r.i(),\n              demoPlayback: r.i(),\n              hardware: r.i(),\n              smoothing: r.i(),\n              ptr_cmd: r.i(),\n              ptr_movevars: r.i(),\n              viewport: [r.i(), r.i(), r.i(), r.i()],\n              nextView: r.i(),\n              onlyClientDraw: r.i()\n            }\n\n            macro.UserCmd = {\n              lerp_msec: r.s(),\n              msec: r.ub(),\n              UNUSED1: r.ub(),\n              viewAngles: [r.f(), r.f(), r.f()],\n              forwardMove: r.f(),\n              sideMove: r.f(),\n              upMove: r.f(),\n              lightLevel: r.b(),\n              UNUSED2: r.ub(),\n              buttons: r.us(),\n              impulse: r.b(),\n              weaponSelect: r.b(),\n              UNUSED: r.s(),\n              impactIndex: r.i(),\n              impactPosition: [r.f(), r.f(), r.f()]\n            }\n\n            macro.MoveVars = {\n              gravity: r.f(),\n              stopSpeed: r.f(),\n              maxSpeed: r.f(),\n              spectatorMaxSpeed: r.f(),\n              acceleration: r.f(),\n              airAcceleration: r.f(),\n              waterAcceleration: r.f(),\n              friction: r.f(),\n              edgeFriction: r.f(),\n              waterFriction: r.f(),\n              entityGravity: r.f(),\n              bounce: r.f(),\n              stepSize: r.f(),\n              maxVelocity: r.f(),\n              zMax: r.f(),\n              waveHeight: r.f(),\n              footsteps: r.i(),\n              skyName: r.nstr(32),\n              rollAngle: r.f(),\n              rollSpeed: r.f(),\n              skyColor: [r.f(), r.f(), r.f()],\n              skyVec: [r.f(), r.f(), r.f()]\n            }\n\n            macro.view = [r.f(), r.f(), r.f()]\n            macro.viewModel = r.i()\n\n            macro.incoming_sequence = r.i()\n            macro.incoming_acknowledged = r.i()\n            macro.incoming_reliable_acknowledged = r.i()\n            macro.incoming_reliable_sequence = r.i()\n            macro.outgoing_sequence = r.i()\n            macro.reliable_sequence = r.i()\n            macro.last_reliable_sequence = r.i()\n\n            let frameDataLength = r.ui()\n            let frameDataEnd = frameDataLength + r.tell()\n            macro.frameData = []\n            while (r.tell() < frameDataEnd) {\n              let type = r.ub()\n              if (type === 1) {\n                continue // skip SVC_NOP\n              } else if (type >= 64) {\n                // TODO: parse custom message\n                if (customMessages[type] && customMessages[type].size > -1) {\n                  r.skip(customMessages[type].size)\n                } else {\n                  r.skip(r.ub())\n                }\n\n                continue\n              }\n\n              let frameData = FrameDataReader.read(r, type, deltaDecoders)\n              if (frameData) {\n                if (type === 39) {\n                  customMessages[frameData.index] = frameData\n                }\n                macro.frameData.push({ type, frameData })\n              } else {\n                r.seek(frameDataEnd)\n              }\n            }\n\n            // if r.tell() > frameDataEnd something wrong happened\n            r.seek(frameDataEnd)\n            break\n          }\n\n          case 2: {\n            // empty macro\n            // signals the beginning of directory entry\n            break\n          }\n\n          case 3: {\n            macro.command = r.nstr(64)\n            break\n          }\n\n          case 4: {\n            macro.clientData = {\n              position: [r.f(), r.f(), r.f()],\n              rotation: [r.f(), r.f(), r.f()],\n              weaponFlags: r.ui(),\n              fov: r.f()\n            }\n            break\n          }\n\n          case 5: {\n            // empty macro that signals end of directory entry\n            isFinalMacroReached = true\n            break\n          }\n\n          case 6: {\n            macro.event = {\n              flags: r.ui(),\n              index: r.ui(),\n              delay: r.f(),\n              args: {\n                flags: r.ui(),\n                entityIndex: r.ui(),\n                position: [r.f(), r.f(), r.f()],\n                rotation: [r.f(), r.f(), r.f()],\n                velocity: [r.f(), r.f(), r.f()],\n                ducking: r.ui(),\n                fparam1: r.f(),\n                fparam2: r.f(),\n                iparam1: r.i(),\n                iparam2: r.i(),\n                bparam1: r.i(),\n                bparam2: r.i()\n              }\n            }\n            break\n          }\n\n          case 7: {\n            macro.weaponAnimation = {\n              animation: r.i(),\n              body: r.i()\n            }\n            break\n          }\n\n          case 8: {\n            macro.sound = {\n              channel: r.i(),\n              sample: r.nstr(r.ui()),\n              attenuation: r.f(),\n              volume: r.f(),\n              flags: r.ui(),\n              pitch: r.i()\n            }\n            break\n          }\n\n          case 9: {\n            r.skip(r.ui())\n            break\n          }\n\n          default: {\n            const offset = Number(r.tell() - 9).toString(16)\n            const msg = `Unexpected macro (${macro.type}) at offset = ${offset}`\n\n            throw new Error(msg)\n          }\n        }\n\n        directories[i].macros.push(macro)\n      }\n    }\n\n    return new Replay(header, directories)\n  }\n\n  static parseIntoChunks(buffer: ArrayBuffer) {\n    let r = new Reader(buffer)\n\n    if (!checkType(r)) {\n      throw new Error('Invalid replay file format')\n    }\n\n    let maps = []\n    let deltaDecoders = getInitialDeltaDecoders()\n    let customMessages: any[] = []\n\n    let header = readHeader(r)\n    let directories = readDirectories(r, header.dirOffset)\n\n    let currentMap: ReplayMap | undefined\n    let currentChunk\n    let lastFrame\n    let lastFrameOffset\n    let state = new ReplayState()\n\n    let directoryEndOffset\n\n    // read loading segment\n    directoryEndOffset = directories[0].offset + directories[0].length\n    r.seek(directories[0].offset)\n    while (r.tell() < directoryEndOffset) {\n      let frame = readFrame(r, deltaDecoders, customMessages)\n      state.feedFrame(frame)\n\n      if (frame.error) {\n        throw new Error('Encountered error while reading replay')\n      }\n\n      if (frame.type < 2 /* 0 or 1 */) {\n        let serverInfo = frame.data.find(\n          (msg: any) => msg.type === FrameDataReader.SVC.SERVERINFO\n        )\n        if (serverInfo) {\n          currentMap = new ReplayMap(serverInfo.data.mapFileName)\n          maps.push(currentMap)\n        }\n\n        let resourceList = frame.data.find(\n          (msg: any) => msg.type === FrameDataReader.SVC.RESOURCELIST\n        )\n        if (resourceList && currentMap) {\n          currentMap.setResources(resourceList.data)\n        }\n      }\n    }\n\n    if (!(currentMap instanceof ReplayMap)) {\n      throw new Error('Error while parsing replay.')\n    }\n\n    lastFrameOffset = r.tell()\n    currentChunk = new ReplayChunk(state, 0)\n    currentMap.addChunk(currentChunk)\n\n    // read playback segment\n    directoryEndOffset = directories[1].offset + directories[1].length\n    r.seek(directories[1].offset)\n    while (true) {\n      let offset = r.tell()\n      if (offset >= directoryEndOffset) {\n        // set last and final chunks data\n        let timeLength = lastFrame.time - currentChunk.startTime\n        currentChunk.timeLength = timeLength\n        let lastFrameLength = offset - lastFrameOffset\n        r.seek(lastFrameOffset)\n        currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\n        r.seek(offset)\n\n        break\n      }\n\n      let frame = readFrame(r, deltaDecoders, customMessages)\n      state.feedFrame(frame)\n      lastFrame = frame\n\n      if (frame.error) {\n        throw new Error('Encountered error while reading replay')\n      }\n\n      if (frame.type < 2) {\n        let serverInfo = frame.data.find(\n          (msg: any) => msg.type === FrameDataReader.SVC.SERVERINFO\n        )\n        if (serverInfo) {\n          // create new map\n          currentMap = new ReplayMap(serverInfo.data.mapFileName)\n          maps.push(currentMap)\n\n          // set last chunks data\n          let timeLength = lastFrame.time - currentChunk.startTime\n          currentChunk.timeLength = timeLength\n          let lastFrameLength = offset - lastFrameOffset\n          let tempOffset = r.tell()\n          r.seek(lastFrameOffset)\n          currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\n          r.seek(tempOffset)\n\n          // create new chunk\n          lastFrameOffset = offset\n          currentChunk = new ReplayChunk(state, frame.time)\n          currentMap.addChunk(currentChunk)\n        }\n\n        let resourceList = frame.data.find(\n          (msg: any) => msg.type === FrameDataReader.SVC.RESOURCELIST\n        )\n        if (resourceList) {\n          currentMap.setResources(resourceList.data)\n        }\n\n        if (serverInfo) {\n          continue\n        }\n\n        for (let i = 0; i < frame.data.length; ++i) {\n          let message = frame.data[i]\n          if (\n            message.type === FrameDataReader.SVC.SOUND ||\n            message.type === FrameDataReader.SVC.SPAWNSTATICSOUND\n          ) {\n            let sound = currentMap.resources.sounds.find(\n              (s: any) => s.index === message.data.soundIndex\n            )\n            if (sound) {\n              sound.used = true\n            }\n          } else if (message.type === FrameDataReader.SVC.STUFFTEXT) {\n            let sounds = currentMap.resources.sounds\n            let commands = message.data.commands\n\n            for (let i = 0; i < commands.length; ++i) {\n              let command = commands[i]\n\n              let func = command.func\n              if (\n                (func === 'speak' || func === 'spk') &&\n                command.params.length === 1\n              ) {\n                let soundName = command.params[0] + '.wav'\n                let sound = sounds.find((s: any) => s.name === soundName)\n                if (sound) {\n                  sound.used = true\n                }\n              }\n            }\n          }\n        }\n      } else if (frame.type === 8) {\n        let sound = currentMap.resources.sounds.find(\n          (s: any) => s.name === frame.sound.sample\n        )\n        if (sound) {\n          sound.used = true\n        }\n      }\n\n      if (currentChunk.startTime + 10 < frame.time) {\n        // set last chunks data\n        let lastFrameLength = offset - lastFrameOffset\n        let tempOffset = r.tell()\n        r.seek(lastFrameOffset)\n        currentChunk.setData(r.arrx(lastFrameLength, ReaderDataType.UByte))\n        r.seek(tempOffset)\n\n        // create new chunk\n        lastFrameOffset = offset\n        currentChunk = new ReplayChunk(state, frame.time)\n        currentMap.addChunk(currentChunk)\n      }\n    }\n\n    return {\n      length: directories[1].time,\n      maps,\n      deltaDecoders,\n      customMessages\n    }\n  }\n\n  static readHeader(r: Reader) {\n    return readHeader(r)\n  }\n\n  static readDirectories(r: Reader, offset: number) {\n    return readDirectories(r, offset)\n  }\n\n  static readFrame(r: Reader, deltaDecoders: any, customMessages: any) {\n    return readFrame(r, deltaDecoders, customMessages)\n  }\n\n  static readFrameData(r: Reader, deltaDecoders: any, customMessages: any) {\n    return readFrame(r, deltaDecoders, customMessages)\n  }\n}\n","export class ReplayState {\n  cameraPos: any[]\n  cameraRot: any[]\n  entities: any[]\n\n  constructor(obj: any | null = null) {\n    if (obj) {\n      this.cameraPos = JSON.parse(JSON.stringify(obj.cameraPos))\n      this.cameraRot = JSON.parse(JSON.stringify(obj.cameraRot))\n      this.entities = JSON.parse(JSON.stringify(obj.entities))\n    } else {\n      this.cameraPos = [0, 0, 0]\n      this.cameraRot = [0, 0, 0]\n      this.entities = []\n    }\n  }\n\n  feedFrame(frame: any) {\n    switch (frame.type) {\n      case 0:\n      case 1: {\n        this.cameraPos[0] = frame.camera.position[0]\n        this.cameraPos[1] = frame.camera.position[1]\n        this.cameraPos[2] = frame.camera.position[2]\n\n        this.cameraRot[0] = frame.camera.orientation[0]\n        this.cameraRot[1] = frame.camera.orientation[1]\n        this.cameraRot[2] = frame.camera.orientation[2]\n\n        // TODO: handle spawnbaseline, clientdata, and similar messages\n\n        break\n      }\n    }\n  }\n\n  // TODO\n  // serialize() {\n  //     return JSON.stringify(this)\n  // }\n\n  // deserialize(data: string) {\n  //     return JSON.parse(data)\n  // }\n\n  clone() {\n    return new ReplayState(this)\n  }\n}\n","import { DeltaType } from './DeltaType'\nimport { BitStream } from '../BitReader'\nimport { DeltaDecoder } from './DeltaDecoder'\n\nexport function readDelta(bs: BitStream, dd: DeltaDecoder) {\n  let data: { [name: string]: any } = {}\n\n  let maskBitCount = bs.readBits(3)\n  let maskBits = []\n  for (let i = 0; i < maskBitCount; ++i) {\n    maskBits.push(bs.readBits(8))\n  }\n\n  let brk = false\n  for (let i = 0; i < maskBitCount; ++i) {\n    for (let j = 0; j < 8; ++j) {\n      let index = j + i * 8\n      if (index === dd.length) {\n        brk = true\n        break\n      }\n\n      if (maskBits[i] & (1 << j)) {\n        if (dd[index].flags & DeltaType.DT_BYTE) {\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\n            let sign = bs.readBits(1) ? -1 : 1\n            let value = bs.readBits(dd[index].bits - 1)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = (sign * value) / divisor\n          } else {\n            let value = bs.readBits(dd[index].bits)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = value / divisor\n          }\n        } else if (dd[index].flags & DeltaType.DT_SHORT) {\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\n            let sign = bs.readBits(1) ? -1 : 1\n            let value = bs.readBits(dd[index].bits - 1)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = (sign * value) / divisor\n          } else {\n            let value = bs.readBits(dd[index].bits)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = value / divisor\n          }\n        } else if (dd[index].flags & DeltaType.DT_INTEGER) {\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\n            let sign = bs.readBits(1) ? -1 : 1\n            let value = bs.readBits(dd[index].bits - 1)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = (sign * value) / divisor\n          } else {\n            let value = bs.readBits(dd[index].bits)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = value / divisor\n          }\n        } else if (\n          dd[index].flags & DeltaType.DT_FLOAT ||\n          dd[index].flags & DeltaType.DT_TIMEWINDOW_8 ||\n          dd[index].flags & DeltaType.DT_TIMEWINDOW_BIG\n        ) {\n          if (dd[index].flags & DeltaType.DT_SIGNED) {\n            let sign = bs.readBits(1) ? -1 : 1\n            let value = bs.readBits(dd[index].bits - 1)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = (sign * value) / divisor\n          } else {\n            let value = bs.readBits(dd[index].bits)\n            let divisor = dd[index].divisor\n            data[dd[index].name] = value / divisor\n          }\n        } else if (dd[index].flags & DeltaType.DT_ANGLE) {\n          let value = bs.readBits(dd[index].bits)\n          let multiplier = 360 / (1 << dd[index].bits)\n          data[dd[index].name] = value * multiplier\n        } else if (dd[index].flags & DeltaType.DT_STRING) {\n          data[dd[index].name] = bs.readString()\n        }\n      }\n    }\n\n    if (brk) {\n      break\n    }\n  }\n\n  return data\n}\n\nconst initialDeltaDecoders = {\n  delta_description_t: [\n    {\n      name: 'flags',\n      bits: 32,\n      divisor: 1,\n      flags: DeltaType.DT_INTEGER\n    },\n    {\n      name: 'name',\n      bits: 8,\n      divisor: 1,\n      flags: DeltaType.DT_STRING\n    },\n    {\n      name: 'offset',\n      bits: 16,\n      divisor: 1,\n      flags: DeltaType.DT_INTEGER\n    },\n    {\n      name: 'size',\n      bits: 8,\n      divisor: 1,\n      flags: DeltaType.DT_INTEGER\n    },\n    {\n      name: 'bits',\n      bits: 8,\n      divisor: 1,\n      flags: DeltaType.DT_INTEGER\n    },\n    {\n      name: 'divisor',\n      bits: 32,\n      divisor: 4000,\n      flags: DeltaType.DT_FLOAT\n    },\n    {\n      name: 'preMultiplier',\n      bits: 32,\n      divisor: 4000,\n      flags: DeltaType.DT_FLOAT\n    }\n  ]\n}\n\nexport const getInitialDeltaDecoders = (): {\n  [name: string]: DeltaDecoder\n} => ({ ...initialDeltaDecoders })\n","import { Reader, ReaderDataType } from '../Reader'\nimport { paletteWithLastTransToRGBA, paletteToRGBA } from './Util'\n\ninterface SpriteHeader {\n  version: number\n  type: SpriteType\n  alphaType: SpriteAlphaType\n  radius: number\n  width: number\n  height: number\n  frameCount: number\n  beamLength: number\n  syncType: SpriteSyncType\n}\n\ninterface SpriteFrame {\n  group: number\n  position: number[]\n  width: number\n  height: number\n  data: Uint8Array\n}\n\nexport enum SpriteType {\n  VP_PARALLEL_UPRIGHT = 0,\n  FACING_UPRIGHT = 1,\n  VP_PARALLEL = 2,\n  ORIENTED = 3,\n  VP_PARALLEL_ORIENTED = 4\n}\n\nexport enum SpriteAlphaType {\n  SPR_NORMAL = 0,\n  SPR_ADDITIVE = 1,\n  SPR_INDEXALPHA = 2,\n  SPR_ALPHTEST = 3\n}\n\nexport enum SpriteSyncType {\n  SYNCHRONIZED = 0,\n  RANDOM = 1\n}\n\nexport class Sprite {\n  header: SpriteHeader\n  frames: SpriteFrame[]\n\n  constructor(header: SpriteHeader, frames: SpriteFrame[]) {\n    this.header = header\n    this.frames = frames\n  }\n\n  static parse(buffer: ArrayBuffer) {\n    const r = new Reader(buffer)\n\n    const magic = r.nstr(4)\n    if (magic !== 'IDSP') {\n      throw new Error('Invalid sprite file format')\n    }\n\n    const header: SpriteHeader = {\n      version: r.i(), // must be 2 (1 = Quake, 2 = Half-Life)\n      type: r.i(),\n      alphaType: r.i(),\n      radius: r.f(),\n      width: r.i(),\n      height: r.i(),\n      frameCount: r.i(),\n      beamLength: r.f(),\n      syncType: r.i()\n    }\n\n    const paletteSize = r.s()\n    const palette = r.arrx(paletteSize * 3, ReaderDataType.UByte)\n\n    const frames: SpriteFrame[] = []\n    for (let i = 0; i < header.frameCount; ++i) {\n      const frame = {\n        group: r.i(),\n        position: [r.i(), r.i()],\n        width: r.i(),\n        height: r.i(),\n        data: new Uint8Array(header.width * header.height * 4)\n      }\n\n      const pixels = r.arrx(header.width * header.height, ReaderDataType.UByte)\n\n      if (header.alphaType === SpriteAlphaType.SPR_ALPHTEST) {\n        frame.data = paletteWithLastTransToRGBA(pixels, palette)\n      } else {\n        frame.data = paletteToRGBA(pixels, palette)\n      }\n\n      frames.push(frame)\n    }\n\n    return new Sprite(header, frames)\n  }\n}\n","import { h, Component } from 'preact'\nimport { classes } from 'typestyle'\nimport { Game, PlayerMode } from '../../../Game'\nimport { SettingsButtonStyle as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\ninterface SettingsButtonProps {\n  game: Game\n}\n\ninterface SettingsButtonState {\n  isOpen: boolean\n}\n\nexport class SettingsButton extends Component<\n  SettingsButtonProps,\n  SettingsButtonState\n> {\n  onFreeModeClick = () => {\n    if (this.props.game.mode === PlayerMode.FREE) {\n      return\n    }\n\n    this.props.game.changeMode(PlayerMode.FREE)\n    this.props.game.player.pause()\n  }\n\n  onReplayModeClick = () => {\n    if (this.props.game.mode === PlayerMode.REPLAY) {\n      return\n    }\n\n    this.props.game.changeMode(PlayerMode.REPLAY)\n  }\n\n  toggleMenu = () => {\n    this.setState({ isOpen: !this.state.isOpen })\n  }\n\n  render() {\n    const hasReplay = !!this.props.game.player.replay\n\n    return (\n      <div class={s.settings}>\n        <div class={classes(cs.button, s.button)} onClick={this.toggleMenu}>\n          <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n            <path\n              fill-rule=\"evenodd\"\n              clip-rule=\"evenodd\"\n              fill=\"#ffffff\"\n              d=\"M23.9 10.7c0-0.3-0.4-0.6-0.8-0.6 -1.1 0-2.1-0.6-2.5-1.6 -0.4-1-0.1-2.2 0.7-3 0.3-0.2 0.3-0.6 0.1-0.9 -0.6-0.7-1.2-1.4-1.9-1.9 -0.3-0.2-0.7-0.2-0.9 0.1 -0.7 0.8-2 1.1-3 0.7 -1-0.4-1.7-1.5-1.6-2.6 0-0.4-0.2-0.7-0.6-0.7 -0.9-0.1-1.8-0.1-2.7 0C10.4 0.1 10.1 0.4 10.1 0.8 10.1 1.9 9.5 2.9 8.5 3.3 7.5 3.7 6.2 3.4 5.5 2.6c-0.2-0.3-0.6-0.3-0.9-0.1 -0.7 0.6-1.4 1.2-1.9 1.9C2.4 4.8 2.5 5.2 2.7 5.4c0.8 0.8 1.1 2 0.7 3 -0.4 1-1.4 1.6-2.6 1.6 -0.4 0-0.7 0.2-0.7 0.6 -0.1 0.9-0.1 1.8 0 2.7 0 0.3 0.4 0.6 0.8 0.6 1 0 2 0.6 2.5 1.6 0.4 1 0.2 2.2-0.7 3 -0.3 0.2-0.3 0.6-0.1 0.9 0.6 0.7 1.2 1.4 1.9 1.9 0.3 0.2 0.7 0.2 0.9-0.1 0.7-0.8 2-1.1 3-0.7 1 0.4 1.7 1.5 1.6 2.6 0 0.4 0.2 0.7 0.6 0.7C11.1 24 11.5 24 12 24c0.4 0 0.9 0 1.3-0.1 0.3 0 0.6-0.3 0.6-0.7 0-1.1 0.6-2.1 1.6-2.6 1-0.4 2.3-0.1 3 0.7 0.2 0.3 0.6 0.3 0.9 0.1 0.7-0.6 1.4-1.2 1.9-1.9 0.2-0.3 0.2-0.7-0.1-0.9 -0.8-0.8-1.1-2-0.7-3 0.4-1 1.4-1.6 2.5-1.6l0.1 0c0.3 0 0.7-0.2 0.7-0.6C24 12.5 24 11.6 23.9 10.7zM12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6c3.3 0 6 2.7 6 6S15.3 18 12 18zM12 16\"\n            />\n          </svg>\n        </div>\n\n        <div class={this.state.isOpen ? s.menuOpen : s.menu}>\n          <span class={s.menuItemTitle}>Mode</span>\n          {hasReplay ? (\n            <span\n              class={\n                this.props.game.mode === PlayerMode.REPLAY\n                  ? s.menuItemSelected\n                  : s.menuItem\n              }\n              onClick={this.onReplayModeClick}\n            >\n              Replay\n            </span>\n          ) : (\n            <span />\n          )}\n          <span\n            class={\n              this.props.game.mode === PlayerMode.FREE\n                ? s.menuItemSelected\n                : s.menuItem\n            }\n            onClick={this.onFreeModeClick}\n          >\n            Free\n          </span>\n        </div>\n      </div>\n    )\n  }\n}\n","import { h, Component } from 'preact'\nimport { classes } from 'typestyle'\nimport { Fullscreen } from '../../../Fullscreen'\nimport { FullscreenButtonStyle as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\ninterface FullscreenButtonProps {\n  active: boolean\n  root: Element\n}\n\ninterface FullscreenButtonState {\n  isInFullscreen: boolean\n}\n\nexport class FullscreenButton extends Component<\n  FullscreenButtonProps,\n  FullscreenButtonState\n> {\n  state: FullscreenButtonState = {\n    isInFullscreen: false\n  }\n\n  componentDidMount() {\n    Fullscreen.onChange(this.onFullscreen)\n  }\n\n  componentWillUnmount() {\n    Fullscreen.onChangeRemove(this.onFullscreen)\n  }\n\n  onClick = () => {\n    if (Fullscreen.isInFullscreen()) {\n      Fullscreen.exit()\n    } else {\n      Fullscreen.enter(this.props.root)\n    }\n  }\n\n  onFullscreen = () => {\n    this.setState({\n      isInFullscreen: Fullscreen.isInFullscreen()\n    })\n  }\n\n  render() {\n    return (\n      <div class={classes(cs.button, s.button)} onClick={this.onClick}>\n        {this.state.isInFullscreen ? (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 64 64\"\n            fill=\"currentcolor\"\n          >\n            <path d=\"M0 22 L22 22 L22 0 L14 0 L14 14 L0 14 M42 0 L42 22 L64 22 L64 14 L50 14 L50 0 M14 50 L0 50 L0 42 L22 42 L22 64 L14 64 M42 64 L42 42 L64 42 L64 50 L50 50 L50 64 Z\" />\n          </svg>\n        ) : (\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            viewBox=\"0 0 64 64\"\n            fill=\"currentcolor\"\n          >\n            <path d=\"M0 22 L8 22 L8 8 L22 8 L22 0 L0 0 M42 0 L42 8 L56 8 L56 22 L64 22 L64 0 M0 64 L0 42 L8 42 L8 56 L22 56 L22 64 M64 64 L42 64 L42 56 L56 56 L56 42 L64 42 Z\" />\n          </svg>\n        )}\n      </div>\n    )\n  }\n}\n","const apis = [\r\n  {\r\n    enabled: 'fullscreenEnabled',\r\n    element: 'fullscreenElement',\r\n    request: 'requestFullscreen',\r\n    exit: 'exitFullscreen',\r\n    change: 'fullscreenchange',\r\n    error: 'fullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'mozFullScreenEnabled',\r\n    element: 'mozFullScreenElement',\r\n    request: 'mozRequestFullScreen',\r\n    exit: 'mozCancelFullScreen',\r\n    change: 'mozfullscreenchange',\r\n    error: 'mozfullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'webkitFullscreenEnabled',\r\n    element: 'webkitCurrentFullScreenElement',\r\n    request: 'webkitRequestFullscreen',\r\n    exit: 'webkitExitFullscreen',\r\n    change: 'webkitfullscreenchange',\r\n    error: 'webkitfullscreenerror'\r\n  },\r\n  {\r\n    enabled: 'msFullscreenEnabled',\r\n    element: 'msFullscreenElement',\r\n    request: 'msRequestFullscreen',\r\n    exit: 'msExitFullscreen',\r\n    change: 'MSFullscreenChange',\r\n    error: 'MSFullscreenError'\r\n  }\r\n]\r\n\r\nlet apiIdx = 0\r\n\r\ninterface Doc {\r\n  [key: string]: any\r\n}\r\nconst doc: Doc = document\r\n\r\nfor (let i = 0; i < apis.length; ++i) {\r\n  if (typeof doc[apis[i].enabled] !== 'undefined') {\r\n    apiIdx = i\r\n    break\r\n  }\r\n}\r\n\r\nexport class Fullscreen {\r\n  static element() {\r\n    return doc[apis[apiIdx].element]\r\n  }\r\n\r\n  static enabled() {\r\n    return doc[apis[apiIdx].enabled]\r\n  }\r\n\r\n  static isInFullscreen() {\r\n    return Fullscreen.element() !== null\r\n  }\r\n\r\n  static enter(node: any) {\r\n    node[apis[apiIdx].request]()\r\n  }\r\n\r\n  static exit() {\r\n    doc[apis[apiIdx].exit]()\r\n  }\r\n\r\n  static onChange(callback: () => void) {\r\n    return window.addEventListener(apis[apiIdx].change, callback)\r\n  }\r\n\r\n  static onChangeRemove(callback: () => void) {\r\n    window.removeEventListener(apis[apiIdx].change, callback)\r\n  }\r\n\r\n  static onError(callback: () => void) {\r\n    return window.addEventListener(apis[apiIdx].error, callback)\r\n  }\r\n}\r\n","import { Game } from './Game'\r\nimport { Config } from './Config'\r\nimport { PlayerInterface } from './PlayerInterface/index'\r\n\r\nconst VERSION = '1'\r\n\r\nclass HLV {\r\n  public static readonly VERSION = VERSION\r\n\r\n  private game: Game\r\n\r\n  constructor(game: Game) {\r\n    this.game = game\r\n  }\r\n\r\n  load(name: string) {\r\n    this.game.load(name)\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this.game.setTitle(title)\r\n  }\r\n\r\n  getTitle() {\r\n    return this.game.getTitle()\r\n  }\r\n}\r\n\r\nnamespace HLViewer {\r\n  export function init(rootSelector: string, params: { paths: { replays: string; maps: string; sounds: string; skies: string; wads: string; base: string } }) {\r\n    const node = document.querySelector(rootSelector)\r\n    if (!node) {\r\n      return null\r\n    }\r\n\r\n    const config = Config.init(params)\r\n    const result = Game.init(config)\r\n    if (result.status === 'success') {\r\n      const game = result.game\r\n      const ui = new PlayerInterface(game, node)\r\n\r\n      ui.draw()\r\n      game.draw()\r\n\r\n      return new HLV(game)\r\n    }\r\n\r\n    return null\r\n  }\r\n}\r\n\r\nexport default HLViewer\r\n","import { Bsp } from './Bsp'\nimport { Sound } from './Sound'\nimport { Config } from './Config'\nimport { Tga } from './Parsers/Tga'\nimport { Wad } from './Parsers/Wad'\nimport { extname, evt } from './Util'\nimport { Replay } from './Replay/Replay'\nimport { Sprite } from './Parsers/Sprite'\nimport { ProgressCallback, xhr } from './Xhr'\nimport { BspParser } from './Parsers/BspParser'\n\nenum LoadItemStatus {\n  Loading = 1,\n  Skipped = 2,\n  Error = 3,\n  Done = 4\n}\n\nclass LoadItemBase<T> {\n  name: string\n  progress: number\n  status: LoadItemStatus\n  data: T | null\n\n  constructor(name: string) {\n    this.name = name\n    this.progress = 0\n    this.status = LoadItemStatus.Loading\n    this.data = null\n  }\n\n  isLoading() {\n    return this.status === LoadItemStatus.Loading\n  }\n\n  skip() {\n    this.status = LoadItemStatus.Skipped\n  }\n\n  isSkipped() {\n    return this.status === LoadItemStatus.Skipped\n  }\n\n  // TODO: Add error reason\n  error() {\n    this.status = LoadItemStatus.Error\n  }\n\n  isError() {\n    return this.status === LoadItemStatus.Error\n  }\n\n  done(data: T) {\n    this.status = LoadItemStatus.Done\n    this.data = data\n  }\n\n  isDone() {\n    return this.status === LoadItemStatus.Done\n  }\n}\n\nclass LoadItemReplay extends LoadItemBase<any> {\n  type: 'replay' = 'replay'\n}\n\nclass LoadItemBsp extends LoadItemBase<Bsp> {\n  type: 'bsp' = 'bsp'\n}\n\nclass LoadItemSky extends LoadItemBase<Tga> {\n  type: 'sky' = 'sky'\n}\n\nclass LoadItemWad extends LoadItemBase<Wad> {\n  type: 'wad' = 'wad'\n}\n\nclass LoadItemSound extends LoadItemBase<Sound> {\n  type: 'sound' = 'sound'\n}\n\nclass LoadItemSprite extends LoadItemBase<Sprite> {\n  type: 'sprite' = 'sprite'\n}\n\nexport type LoadItem =\n  | LoadItemReplay\n  | LoadItemBsp\n  | LoadItemSky\n  | LoadItemWad\n  | LoadItemSound\n  | LoadItemSprite\n\nexport class Loader extends EventTarget {\n  config: Config\n\n  replay?: LoadItemReplay\n  map?: LoadItemBsp\n  skies: LoadItemSky[]\n  wads: LoadItemWad[]\n  sounds: LoadItemSound[]\n  sprites: { [name: string]: LoadItemSprite } = {}\n\n  constructor(config: Config) {\n    super()\n    this.config = config\n\n    this.replay = undefined\n    this.map = undefined\n    this.skies = []\n    this.wads = []\n    this.sounds = []\n  }\n\n  clear() {\n    this.replay = undefined\n    this.map = undefined\n    this.skies.length = 0\n    this.wads.length = 0\n    this.sounds.length = 0\n    this.sprites = {}\n  }\n\n  checkStatus() {\n    if (this.replay && !this.replay.isDone()) {\n      return\n    }\n\n    if (this.map && !this.map.isDone()) {\n      return\n    }\n\n    for (let i = 0; i < this.skies.length; ++i) {\n      if (this.skies[i].isLoading()) {\n        return\n      }\n    }\n\n    for (let i = 0; i < this.wads.length; ++i) {\n      if (this.wads[i].isLoading()) {\n        return\n      }\n    }\n\n    for (let i = 0; i < this.sounds.length; ++i) {\n      if (this.sounds[i].isLoading()) {\n        return\n      }\n    }\n\n    const sprites = Object.entries(this.sprites)\n    for (let i = 0; i < sprites.length; ++i) {\n      if (sprites[i][1].isLoading()) {\n        return\n      }\n    }\n\n    this.dispatchEvent(evt('loadAll', { detail: { loader: this }  }));\n  }\n\n  load(name: string) {\n    const extension = extname(name)\n    if (extension === '.dem') {\n      this.loadReplay(name)\n    } else if (extension === '.bsp') {\n      this.loadMap(name)\n    } else {\n      console.error('Invalid file extension', name)\n    }\n  }\n\n  async loadReplay(name: string) {\n    this.replay = new LoadItemReplay(name)\n\n    this.dispatchEvent(evt('loadstart', { detail: { item: this.replay }  }))\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      if (this.replay) {\n        this.replay.progress = progress\n      }\n\n      this.dispatchEvent(evt('progress', { detail: { item: this.replay }  }))\n    }\n\n    const replayPath = this.config.getReplaysPath()\n    const buffer = await xhr(`${replayPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      if (this.replay) {\n        this.replay.error()\n      }\n      console.error(err, this.replay)\n    })\n\n    if (this.replay.isError()) {\n      return\n    }\n\n    const replay = await Replay.parseIntoChunks(buffer)\n    this.replay.done(replay)\n\n    this.loadMap(replay.maps[0].name + '.bsp')\n\n    const sounds = replay.maps[0].resources.sounds\n    sounds.forEach((sound: any) => {\n      if (sound.used) {\n        this.loadSound(sound.name, sound.index)\n      }\n    })\n\n    this.dispatchEvent(evt('load', { detail: { item: this.replay }  }))\n    this.checkStatus()\n  }\n\n  async loadMap(name: string) {\n    this.map = new LoadItemBsp(name)\n    this.dispatchEvent(evt('loadstart', { detail: { item: this.map }  }))\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      if (this.map) {\n        this.map.progress = progress\n      }\n\n      this.dispatchEvent(evt('progress', { detail: { item: this.map }  }))\n    }\n\n    const mapsPath = this.config.getMapsPath()\n    const buffer = await xhr(`${mapsPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch(err => {\n      if (this.map) {\n        this.map.error()\n      }\n\n      console.error(err, this.map)\n    })\n\n    if (this.map.isError()) {\n      return\n    }\n\n    const map = await BspParser.parse(name, buffer)\n    this.map.done(map)\n\n    map.entities\n      .map((e: any) => {\n        if (typeof e.model === 'string' && e.model.indexOf('.spr') > -1) {\n          return e.model as string\n        }\n        return undefined\n      })\n      .filter(\n        (a: string | undefined, pos: number, arr: (string | undefined)[]) =>\n          a && arr.indexOf(a) === pos\n      )\n      .forEach(a => a && this.loadSprite(a))\n\n    const skyname = map.entities[0].skyname\n    if (skyname) {\n      const sides = ['bk', 'dn', 'ft', 'lf', 'rt', 'up']\n      sides.map(a => `${skyname}${a}`).forEach(a => this.loadSky(a))\n    }\n\n    // check if there is at least one missing texture\n    // if yes then load wad files (textures should be there)\n    if (map.textures.find(a => a.isExternal)) {\n      const wads = map.entities[0].wad\n      const wadPromises = wads.map((w: string) => this.loadWad(w))\n      await Promise.all(wadPromises)\n    }\n\n    this.dispatchEvent(evt('load', { detail: { item: this.map }  }))\n    this.checkStatus()\n  }\n\n  async loadSprite(name: string) {\n    const item = new LoadItemSprite(name)\n    this.sprites[name] = item\n\n    this.dispatchEvent(evt('loadstart', { detail: { item }  }))\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      item.progress = progress\n\n      this.dispatchEvent(evt('progress', { detail: { item }  }))\n    }\n\n    const buffer = await xhr(`${this.config.getBasePath()}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      item.error()\n      console.error(err, item)\n      this.checkStatus()\n    })\n\n    if (item.isError()) {\n      return\n    }\n\n    const sprite = Sprite.parse(buffer)\n    item.done(sprite)\n\n    this.dispatchEvent(evt('load', { detail: { item }  }))\n    this.checkStatus()\n  }\n\n  async loadSky(name: string) {\n    const item = new LoadItemSky(name)\n    this.skies.push(item)\n    this.dispatchEvent(evt('loadstart', { detail: { item }  }))\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      item.progress = progress\n      this.dispatchEvent(evt('progress', { detail: { item }  }))\n    }\n\n    const skiesPath = this.config.getSkiesPath()\n    const buffer = await xhr(`${skiesPath}/${name}.tga`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      item.error()\n      console.error(err, item)\n      this.checkStatus()\n    })\n\n    if (item.isError()) {\n      return\n    }\n\n    const skyImage = Tga.parse(buffer, name)\n    item.done(skyImage)\n\n    this.dispatchEvent(evt('load', { detail: { item }  }))\n    this.checkStatus()\n  }\n\n  async loadWad(name: string) {\n    const wadItem = new LoadItemWad(name)\n    this.wads.push(wadItem)\n    this.dispatchEvent(evt('loadstart', { detail: { item: wadItem }  }))\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      wadItem.progress = progress\n      this.dispatchEvent(evt('progress', { detail: { item: wadItem }  }))\n    }\n\n    const wadsPath = this.config.getWadsPath()\n    const buffer = await xhr(`${wadsPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      wadItem.error()\n      console.error(err, wadItem)\n      this.checkStatus()\n    })\n\n    if (wadItem.isError()) {\n      return\n    }\n\n    const wad = await Wad.parse(buffer)\n    wadItem.done(wad)\n\n    if (!this.map || !this.map.data) {\n      return\n    }\n\n    const map = this.map.data\n    const cmp = (a: any, b: any) => a.toLowerCase() === b.toLowerCase()\n    wad.entries.forEach(entry => {\n      if (entry.type !== 'texture') {\n        return\n      }\n\n      map.textures.forEach(texture => {\n        if (cmp(entry.name, texture.name)) {\n          texture.width = entry.width\n          texture.height = entry.height\n          texture.data = entry.data\n        }\n      })\n    })\n\n    this.dispatchEvent(evt('loadstart', { detail: { item: wadItem }  }))\n    this.checkStatus()\n  }\n\n  async loadSound(name: string, index: number) {\n    const sound = new LoadItemSound(name)\n    this.sounds.push(sound)\n\n    this.dispatchEvent(evt('loadstart', { detail: { item: sound }  }))\n\n    const progressCallback: ProgressCallback = (_1, progress) => {\n      sound.progress = progress\n\n      this.dispatchEvent(evt('loadstart', { detail: { item: sound }  }))\n    }\n\n    const soundsPath = this.config.getSoundsPath()\n    const buffer = await xhr(`${soundsPath}/${name}`, {\n      method: 'GET',\n      isBinary: true,\n      progressCallback\n    }).catch((err: any) => {\n      sound.error()\n      console.error(err, sound)\n      this.checkStatus()\n    })\n\n    if (sound.isError()) {\n      return\n    }\n\n    const data = await Sound.create(buffer).catch((err: any) => {\n      sound.error()\n      console.error(err, sound)\n      this.checkStatus()\n    })\n\n    if (!data || sound.isError()) {\n      return\n    }\n\n    data.index = index\n    data.name = name\n    sound.done(data)\n\n    this.dispatchEvent(evt('loadstart', { detail: { item: sound }  }))\n    this.checkStatus()\n  }\n}\n","import { SoundSystem } from './SoundSystem'\r\n\r\nexport class Sound {\r\n  index: number\r\n  name: string\r\n  buffer: AudioBuffer\r\n\r\n  constructor(buffer: AudioBuffer) {\r\n    this.index = -1\r\n    this.name = ''\r\n    this.buffer = buffer\r\n  }\r\n\r\n  static create(buffer: ArrayBuffer): Promise<Sound> {\r\n    return new Promise<Sound>((resolve, reject) => {\r\n      SoundSystem.getContext().decodeAudioData(\r\n        buffer,\r\n        (buffer: AudioBuffer) => {\r\n          resolve(new Sound(buffer))\r\n        },\r\n        (err: any) => {\r\n          reject(err)\r\n        }\r\n      )\r\n    })\r\n  }\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\n\r\nexport class Tga {\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n\r\n  constructor(name: string, width: number, height: number, data: Uint8Array) {\r\n    this.name = name\r\n    this.width = width\r\n    this.height = height\r\n    this.data = data\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer, name: string) {\r\n    let r = new Reader(buffer)\r\n\r\n    let header = {\r\n      idLength: r.ub(),\r\n      colorMapType: r.ub(),\r\n      imageType: r.ub(),\r\n      colorMap: {\r\n        firstEntryIndex: r.us(),\r\n        length: r.us(),\r\n        size: r.ub()\r\n      },\r\n      image: {\r\n        xOrigin: r.us(),\r\n        yOrigin: r.us(),\r\n        width: r.us(),\r\n        height: r.us(),\r\n        depth: r.ub(),\r\n        descriptor: r.ub()\r\n      }\r\n    }\r\n\r\n    // let imageId\r\n    if (header.idLength) {\r\n      // imageId = r.arrx(header.idLength, Reader.Type.UByte)\r\n      r.arrx(header.idLength, ReaderDataType.UByte)\r\n    }\r\n\r\n    if (header.colorMapType) {\r\n      throw new Error('Not implemented')\r\n    }\r\n\r\n    let w = header.image.width\r\n    let h = header.image.height\r\n    let pixelCount = w * h\r\n    let imageData\r\n\r\n    if (header.imageType === 0x02) {\r\n      let byteCount = (pixelCount * header.image.depth) / 8\r\n      imageData = r.arrx(byteCount, ReaderDataType.UByte)\r\n      if (header.image.depth === 24) {\r\n        let temp = new Uint8Array(pixelCount * 4)\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w; ++j) {\r\n            let dst = (h - 1 - i) * w + j\r\n            temp[dst * 4] = imageData[(i * w + j) * 3 + 2]\r\n            temp[dst * 4 + 1] = imageData[(i * w + j) * 3 + 1]\r\n            temp[dst * 4 + 2] = imageData[(i * w + j) * 3]\r\n            temp[dst * 4 + 3] = 255\r\n          }\r\n        }\r\n        imageData = temp\r\n      } else if (header.image.depth === 32) {\r\n        let temp = new Uint8Array(pixelCount * 4)\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w; ++j) {\r\n            let dst = (h - 1 - i) * w + j\r\n            temp[dst * 4] = imageData[(i * w + j) * 4 + 2]\r\n            temp[dst * 4 + 1] = imageData[(i * w + j) * 4 + 1]\r\n            temp[dst * 4 + 2] = imageData[(i * w + j) * 4]\r\n            temp[dst * 4 + 3] = 255\r\n          }\r\n        }\r\n        imageData = temp\r\n      }\r\n    } else if (header.imageType === 0x0a) {\r\n      imageData = new Uint8Array(pixelCount * 4)\r\n      if (header.image.depth === 24) {\r\n        for (let i = 0; i < h; ++i) {\r\n          for (let j = 0; j < w /*++j*/; ) {\r\n            let repCount = r.ub()\r\n            if (repCount & 0x80) {\r\n              repCount = (repCount & 0x7f) + 1\r\n              let bl = r.ub()\r\n              let gr = r.ub()\r\n              let rd = r.ub()\r\n              while (j < w && repCount) {\r\n                let dst = (h - 1 - i) * w + j\r\n                imageData[dst * 4] = rd\r\n                imageData[dst * 4 + 1] = gr\r\n                imageData[dst * 4 + 2] = bl\r\n                imageData[dst * 4 + 3] = 255\r\n                ++j\r\n                --repCount\r\n              }\r\n            } else {\r\n              repCount = (repCount & 0x7f) + 1\r\n              while (j < w && repCount) {\r\n                let dst = (h - 1 - i) * w + j\r\n                imageData[dst * 4 + 2] = r.ub()\r\n                imageData[dst * 4 + 1] = r.ub()\r\n                imageData[dst * 4] = r.ub()\r\n                imageData[dst * 4 + 3] = 255\r\n                ++j\r\n                --repCount\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return new Tga(name, header.image.width, header.image.height, imageData)\r\n  }\r\n}\r\n","import { Reader, ReaderDataType } from '../Reader'\r\nimport { paletteToRGBA, paletteWithLastTransToRGBA } from './Util'\r\n\r\nfunction parseDecal(r: Reader): WadDecal {\r\n  const name = r.nstr(16)\r\n\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n\r\n  r.skip(4 * 4) // skip mipmap offsets\r\n\r\n  // read largest mipmap data\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  // skip other 3 mipmaps\r\n  r.skip(21 * (pixelCount / 64))\r\n\r\n  r.skip(2) // skip padding bytes\r\n\r\n  const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n  const data =\r\n    name[0] === '{'\r\n      ? paletteWithLastTransToRGBA(pixels, palette)\r\n      : paletteToRGBA(pixels, palette)\r\n\r\n  return {\r\n    type: 'decal',\r\n    name,\r\n    width,\r\n    height,\r\n    data\r\n  }\r\n}\r\n\r\nconst parseCache = (_r: Reader, metadata: WadEntryMetadata): WadCache => ({\r\n  type: 'cache',\r\n  name: metadata.name\r\n})\r\n\r\nfunction parseTexture(r: Reader): WadTexture {\r\n  const name = r.nstr(16)\r\n\r\n  const width = r.ui()\r\n  const height = r.ui()\r\n\r\n  r.skip(4 * 4) // skip mipmap offsets\r\n\r\n  // read largest mipmap data\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  // skip other 3 mipmaps\r\n  r.skip(21 * (pixelCount / 64))\r\n\r\n  r.skip(2) // skip padding bytes\r\n\r\n  const palette = r.arrx(768, ReaderDataType.UByte)\r\n\r\n  const data =\r\n    name[0] === '{'\r\n      ? paletteWithLastTransToRGBA(pixels, palette)\r\n      : paletteToRGBA(pixels, palette)\r\n\r\n  return {\r\n    type: 'texture',\r\n    name,\r\n    width,\r\n    height,\r\n    data\r\n  }\r\n}\r\n\r\nfunction parseFont(r: Reader, metadata: WadEntryMetadata): WadFont {\r\n  // TODO: figure out why width is incorrect\r\n  const width = r.ui() && 256 // NOTE: fonts are lying about their width\r\n  const height = r.ui()\r\n  const rowCount = r.ui()\r\n  const rowHeight = r.ui()\r\n\r\n  const glyphs = []\r\n  // hardcoded 256 number of glyphs\r\n  for (let i = 0; i < 256; ++i) {\r\n    const glyphOffset = r.us()\r\n    const glyphWidth = r.us()\r\n\r\n    glyphs.push({\r\n      x: glyphOffset % width,\r\n      y: (Math.floor(glyphOffset / width) / rowHeight) * rowHeight,\r\n      width: glyphWidth,\r\n      height: rowHeight\r\n    })\r\n  }\r\n\r\n  const pixelCount = width * height\r\n  const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\r\n\r\n  r.skip(2)\r\n\r\n  const palette = r.arrx(256 * 3, ReaderDataType.UByte)\r\n\r\n  return {\r\n    type: 'font',\r\n    name: metadata.name,\r\n    width,\r\n    height,\r\n    rowCount,\r\n    rowHeight,\r\n    glyphs,\r\n    data: paletteWithLastTransToRGBA(pixels, palette)\r\n  }\r\n}\r\n\r\nconst parseUnknown = (r: Reader, metadata: WadEntryMetadata): WadUnknown => ({\r\n  type: 'unknown',\r\n  name: metadata.name,\r\n  data: r.arrx(metadata.length, ReaderDataType.UByte)\r\n})\r\n\r\nfunction parseEntry(r: Reader, metadata: WadEntryMetadata): WadEntry {\r\n  r.seek(metadata.offset)\r\n  switch (metadata.type) {\r\n    case 0x40: {\r\n      return parseDecal(r)\r\n    }\r\n    case 0x42: {\r\n      return parseCache(r, metadata)\r\n    }\r\n    case 0x43: {\r\n      return parseTexture(r)\r\n    }\r\n    case 0x46: {\r\n      return parseFont(r, metadata)\r\n    }\r\n\r\n    default: {\r\n      // unknown data type; return array of bytes\r\n      return parseUnknown(r, metadata)\r\n    }\r\n  }\r\n}\r\n\r\nexport interface WadTexture {\r\n  type: 'texture'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadDecal {\r\n  type: 'decal'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadCache {\r\n  type: 'cache'\r\n  name: string\r\n}\r\n\r\nexport interface WadFont {\r\n  type: 'font'\r\n  name: string\r\n  width: number\r\n  height: number\r\n  rowCount: number\r\n  rowHeight: number\r\n  glyphs: {\r\n    x: number\r\n    y: number\r\n    width: number\r\n    height: number\r\n  }[]\r\n  data: Uint8Array\r\n}\r\n\r\nexport interface WadUnknown {\r\n  type: 'unknown'\r\n  name: string\r\n  data: Uint8Array\r\n}\r\n\r\nexport type WadEntry = WadTexture | WadDecal | WadCache | WadFont | WadUnknown\r\n\r\ninterface WadEntryMetadata {\r\n  offset: number\r\n  diskLength: number\r\n  length: number\r\n  type: number\r\n  isCompressed: number\r\n  name: string\r\n}\r\n\r\nexport class Wad {\r\n  entries: WadEntry[]\r\n\r\n  constructor(entries: WadEntry[]) {\r\n    this.entries = entries\r\n  }\r\n\r\n  static parse(buffer: ArrayBuffer) {\r\n    const r = new Reader(buffer)\r\n\r\n    const magic = r.nstr(4)\r\n    if (magic !== 'WAD3') {\r\n      throw new Error('Invalid WAD file format')\r\n    }\r\n\r\n    const entryCount = r.ui()\r\n    const directoryOffset = r.ui()\r\n    r.seek(directoryOffset)\r\n    const entriesMetadata: WadEntryMetadata[] = []\r\n    for (let i = 0; i < entryCount; ++i) {\r\n      const entry: WadEntryMetadata = {\r\n        offset: r.ui(),\r\n        diskLength: r.ui(),\r\n        length: r.ui(),\r\n        type: r.b(),\r\n        isCompressed: r.b(),\r\n        name: ''\r\n      }\r\n      r.skip(2)\r\n      entry.name = r.nstr(16)\r\n      entriesMetadata.push(entry)\r\n    }\r\n\r\n    const entries: WadEntry[] = entriesMetadata.map(e => parseEntry(r, e))\r\n\r\n    return new Wad(entries)\r\n  }\r\n}\r\n","import { ReplayChunk } from './ReplayChunk'\n\nexport class ReplayMap {\n  name: string\n  chunks: ReplayChunk[]\n  resources: any\n\n  constructor(mapFilePath: string) {\n    this.name = mapFilePath.split('/').reverse()[0].split('.')[0]\n    this.chunks = []\n    this.resources = {\n      sounds: [],\n      skins: [],\n      models: [],\n      decals: [],\n      custom: [],\n      events: []\n    }\n  }\n\n  setResources(resources: any[]) {\n    resources.forEach(res => {\n      switch (res.type) {\n        case 0: {\n          res.used = false\n          this.resources.sounds.push(res)\n          break\n        }\n        case 1: {\n          this.resources.skins.push(res)\n          break\n        }\n        case 2: {\n          this.resources.models.push(res)\n          break\n        }\n        case 3: {\n          this.resources.decals.push(res)\n          break\n        }\n        case 4: {\n          this.resources.custom.push(res)\n          break\n        }\n        case 5: {\n          this.resources.events.push(res)\n          break\n        }\n      }\n    })\n  }\n\n  addChunk(chunk: ReplayChunk) {\n    this.chunks.push(chunk)\n  }\n}\n","import { Reader } from '../Reader'\nimport { ReplayState } from './ReplayState'\n\nexport class ReplayChunk {\n  state: ReplayState\n  startTime: number\n  timeLength: number\n  data: Uint8Array | null\n  reader: Reader | null\n\n  constructor(initialState: ReplayState, startTime: number) {\n    this.state = initialState.clone()\n    this.startTime = startTime\n    this.timeLength = 10\n    this.data = null\n    this.reader = null\n  }\n\n  setData(data: Uint8Array) {\n    this.data = new Uint8Array(data.length)\n    for (let i = 0; i < data.length; ++i) {\n      this.data[i] = data[i]\n    }\n\n    this.reader = new Reader(this.data.buffer as ArrayBuffer)\n  }\n}\n","import { readCoord } from './readCoord'\nimport { readDelta } from './readDelta'\nimport { BitStream } from '../BitReader'\nimport { DeltaDecoderTable } from './DeltaDecoder'\nimport { Reader, ReaderDataType } from '../Reader'\n\ntype FrameDataHandler = (r: Reader, deltaDecoder: DeltaDecoderTable) => any\n\nexport class FrameDataReader {\n  static bad() {\n    throw new Error('Invalid message type')\n  }\n\n  static nop(): null {\n    return null\n  }\n\n  static disconnect(r: Reader) {\n    return {\n      reason: r.str()\n    }\n  }\n\n  static event(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    type Event = {\n      index: number\n      packetIndex?: number\n      fireTime?: number\n      delta?: { [name: string]: any }\n    }\n\n    let events: Event[] = []\n    let eventCount = bs.readBits(5)\n    for (let i = 0; i < eventCount; ++i) {\n      let event: Event = {\n        index: bs.readBits(10)\n      }\n      let packetIndexBit = bs.readBits(1)\n      if (packetIndexBit) {\n        event.packetIndex = bs.readBits(11)\n        let deltaBit = bs.readBits(1)\n        if (deltaBit) {\n          event.delta = readDelta(bs, deltaDecoders['event_t'])\n        }\n      }\n      let fireTimeBit = bs.readBits(1)\n      if (fireTimeBit) {\n        event.fireTime = bs.readBits(16)\n      }\n\n      events.push(event)\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return { events }\n  }\n\n  static version(r: Reader) {\n    return {\n      version: r.ui()\n    }\n  }\n\n  static setView(r: Reader) {\n    return {\n      entityIndex: r.s()\n    }\n  }\n\n  static sound(r: Reader) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    let flags = bs.readBits(9)\n\n    let volume = 1\n    if ((flags & 1) !== 0) {\n      volume = bs.readBits(8) / 255\n    }\n\n    let attenuation = 1\n    if ((flags & 2) !== 0) {\n      attenuation = bs.readBits(8) / 64\n    }\n\n    let channel = bs.readBits(3)\n    let entityIndex = bs.readBits(11)\n\n    let soundIndex\n    if ((flags & 4) !== 0) {\n      soundIndex = bs.readBits(16)\n    } else {\n      soundIndex = bs.readBits(8)\n    }\n\n    let xFlag = bs.readBits(1)\n    let yFlag = bs.readBits(1)\n    let zFlag = bs.readBits(1)\n    let xPosition\n    let yPosition\n    let zPosition\n    if (xFlag) {\n      xPosition = readCoord(bs)\n    }\n    if (yFlag) {\n      yPosition = readCoord(bs)\n    }\n    if (zFlag) {\n      zPosition = readCoord(bs)\n    }\n\n    let pitch = 1\n    if ((flags & 8) !== 0) {\n      pitch = bs.readBits(8)\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return {\n      flags,\n      volume,\n      attenuation,\n      channel,\n      entityIndex,\n      soundIndex,\n      xPosition,\n      yPosition,\n      zPosition,\n      pitch\n    }\n  }\n\n  static time(r: Reader) {\n    return {\n      time: r.f()\n    }\n  }\n\n  static print(r: Reader) {\n    return {\n      message: r.str()\n    }\n  }\n\n  static stuffText(r: Reader) {\n    let message = r.str()\n    let commands = message.split(';').map(command => {\n      let args = command\n        .split(/\\s*(\"[^\"]+\"|[^\\s\"]+)/)\n        .map(arg => arg.replace(/^\"(.*)\"$/, '$1').trim())\n        .filter(arg => arg)\n\n      let func = args[0]\n      let params = args.slice(1)\n\n      return { func, params }\n    })\n\n    return { commands }\n  }\n\n  static setAngle(r: Reader) {\n    return {\n      pitch: r.s(),\n      yaw: r.s(),\n      roll: r.s()\n    }\n  }\n\n  static serverInfo(r: Reader) {\n    let info = {\n      protocol: r.i(),\n      spawnCount: r.i(), // map change count\n      mapCrc: r.i(),\n      clientDllHash: r.arrx(16, ReaderDataType.UByte),\n      maxPlayers: r.ub(),\n      playerIndex: r.ub(),\n      isDeathmatch: r.ub(),\n      gameDir: r.str(),\n      hostName: r.str(),\n      mapFileName: r.str(), // path to map relative in mod directory\n      mapCycle: r.str()\n    }\n    r.skip(1) // skip padding\n\n    return info\n  }\n\n  static lightStyle(r: Reader) {\n    return {\n      index: r.ub(),\n      lightInfo: r.str()\n    }\n  }\n\n  static updateUserInfo(r: Reader) {\n    return {\n      clientIndex: r.ub(),\n      clientUserId: r.ui(),\n      clientUserInfo: r.str(),\n      clientCdKeyHash: r.arrx(16, ReaderDataType.UByte)\n    }\n  }\n\n  static deltaDescription(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let data: {\n      name: string\n      fields: { [name: string]: any }[]\n    } = {\n      name: r.str(),\n      fields: []\n    }\n\n    let bs = new BitStream(r.data.buffer)\n    let fieldCount = r.us()\n    bs.index = r.tell() * 8\n    for (let i = 0; i < fieldCount; ++i) {\n      data.fields.push(readDelta(bs, deltaDecoders['delta_description_t']))\n    }\n    deltaDecoders[data.name] = data.fields as any\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return data\n  }\n\n  static clientData(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    let deltaSequence = bs.readBits(1)\n    if (deltaSequence) {\n      // delta update mask\n      bs.index += 8\n    }\n\n    let clientDataDecoder = deltaDecoders['clientdata_t']\n    let clientData = readDelta(bs, clientDataDecoder)\n\n    // TODO: weapon data\n    let weaponDataDecoder = deltaDecoders['weapon_data_t']\n    while (bs.readBits(1)) {\n      bs.index += 6 // weapon index\n      readDelta(bs, weaponDataDecoder) // weapon data\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return {\n      clientData\n    }\n  }\n\n  static stopSound(r: Reader) {\n    return {\n      entityIndex: r.s()\n    }\n  }\n\n  static pings(r: Reader) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    let pings = []\n    while (bs.readBits(1)) {\n      pings.push({\n        slot: bs.readBits(8),\n        ping: bs.readBits(8),\n        loss: bs.readBits(8)\n      })\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return pings\n  }\n\n  static particle(r: Reader) {\n    return {\n      position: [r.s() / 8, r.s() / 8, r.s() / 8],\n      direction: [r.b(), r.b(), r.b()],\n      count: r.ub(),\n      color: r.ub()\n    }\n  }\n\n  static damage(): null {\n    // unused\n    return null\n  }\n\n  static spawnStatic(r: Reader) {\n    let data: any = {\n      modelIndex: r.s(),\n      sequence: r.b(),\n      frame: r.b(),\n      colorMap: r.s(),\n      skin: r.b(),\n      position: [],\n      rotation: []\n    }\n    data.position[0] = r.s() / 8\n    data.rotation[0] = r.b() * (360 / 256)\n    data.position[1] = r.s() / 8\n    data.rotation[1] = r.b() * (360 / 256)\n    data.position[2] = r.s() / 8\n    data.rotation[2] = r.b() * (360 / 256)\n    data.renderMode = r.b()\n    if (data.renderMode) {\n      data.renderAmt = r.b()\n      data.renderColor = [r.ub(), r.ub(), r.ub()]\n      data.renderFx = r.b()\n    }\n\n    return data\n  }\n\n  static eventReliable(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    let eventIndex = bs.readBits(10)\n    let eventData = readDelta(bs, deltaDecoders['event_t'])\n    let delayBit = bs.readBits(1)\n    let delay\n    if (delayBit) {\n      delay = bs.readBits(16)\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return {\n      eventIndex,\n      eventData,\n      delayBit,\n      delay\n    }\n  }\n\n  static spawnBaseLine(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    let entities = []\n    while (true) {\n      let entityIdx = bs.readBits(11)\n      if (entityIdx === (1 << 11) - 1) {\n        break\n      }\n\n      let entityType = bs.readBits(2)\n      let entityTypeString\n      if (entityType & 1) {\n        if (entityIdx > 0 && entityIdx <= 32) {\n          entityTypeString = 'entity_state_player_t'\n        } else {\n          entityTypeString = 'entity_state_t'\n        }\n      } else {\n        entityTypeString = 'custom_entity_state_t'\n      }\n\n      entities[entityIdx] = readDelta(bs, deltaDecoders[entityTypeString])\n    }\n\n    let footer = bs.readBits(5)\n    if (footer !== (1 << 5) - 1) {\n      throw new Error('Bad spawnbaseline')\n    }\n\n    let nExtraData = bs.readBits(6)\n    let extraData = []\n    for (let i = 0; i < nExtraData; ++i) {\n      extraData.push(readDelta(bs, deltaDecoders['entity_state_t']))\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return {\n      entities,\n      extraData\n    }\n  }\n\n  static tempEntity(r: Reader) {\n    const TE_BEAMPOINTS = 0 // Beam effect between two points\n    const TE_BEAMENTPOINT = 1 // Beam effect between point and entity\n    const TE_GUNSHOT = 2 // Particle effect plus ricochet sound\n    const TE_EXPLOSION = 3 // Additive sprite, 2 dynamic lights, flickering particles, explosion sound, move vertically 8 pps\n    const TE_TAREXPLOSION = 4 // Quake1 \"tarbaby\" explosion with sound\n    const TE_SMOKE = 5 // Alphablend sprite, move vertically 30 pps\n    const TE_TRACER = 6 // Tracer effect from point to point\n    const TE_LIGHTNING = 7 // TE_BEAMPOINTS with simplified parameters\n    const TE_BEAMENTS = 8\n    const TE_SPARKS = 9 // 8 random tracers with gravity, ricochet sprite\n    const TE_LAVASPLASH = 10 // Quake1 lava splash\n    const TE_TELEPORT = 11 // Quake1 teleport splash\n    const TE_EXPLOSION2 = 12 // Quake1 colormaped (base palette) particle explosion with sound\n    const TE_BSPDECAL = 13 // Decal from the .BSP file\n    const TE_IMPLOSION = 14 // Tracers moving toward a point\n    const TE_SPRITETRAIL = 15 // Line of moving glow sprites with gravity, fadeout, and collisions\n    const TE_SPRITE = 17 // Additive sprite, plays 1 cycle\n    const TE_BEAMSPRITE = 18 // A beam with a sprite at the end\n    const TE_BEAMTORUS = 19 // Screen aligned beam ring, expands to max radius over lifetime\n    const TE_BEAMDISK = 20 // Disk that expands to max radius over lifetime\n    const TE_BEAMCYLINDER = 21 // Cylinder that expands to max radius over lifetime\n    const TE_BEAMFOLLOW = 22 // Create a line of decaying beam segments until entity stops moving\n    const TE_GLOWSPRITE = 23\n    const TE_BEAMRING = 24 // Connect a beam ring to two entities\n    const TE_STREAK_SPLASH = 25 // Oriented shower of tracers\n    const TE_DLIGHT = 27 // Dynamic light, effect world, minor entity effect\n    const TE_ELIGHT = 28 // Point entity light, no world effect\n    const TE_TEXTMESSAGE = 29\n    const TE_LINE = 30\n    const TE_BOX = 31\n    const TE_KILLBEAM = 99 // Kill all beams attached to entity\n    const TE_LARGEFUNNEL = 100\n    const TE_BLOODSTREAM = 101 // Particle spray\n    const TE_SHOWLINE = 102 // Line of particles every 5 units, dies in 30 seconds\n    const TE_BLOOD = 103 // Particle spray\n    const TE_DECAL = 104 // Decal applied to a brush entity (not the world)\n    const TE_FIZZ = 105 // Create alpha sprites inside of entity, float upwards\n    const TE_MODEL = 106 // Create a moving model that bounces and makes a sound when it hits\n    const TE_EXPLODEMODEL = 107 // Spherical shower of models, picks from set\n    const TE_BREAKMODEL = 108 // Box of models or sprites\n    const TE_GUNSHOTDECAL = 109 // Decal and ricochet sound\n    const TE_SPRITE_SPRAY = 110 // Spray of alpha sprites\n    const TE_ARMOR_RICOCHET = 111 // Quick spark sprite, client ricochet sound.\n    const TE_PLAYERDECAL = 112\n    const TE_BUBBLES = 113 // Create alpha sprites inside of box, float upwards\n    const TE_BUBBLETRAIL = 114 // Create alpha sprites along a line, float upwards\n    const TE_BLOODSPRITE = 115 // Spray of opaque sprite1's that fall, single sprite2 for 1..2 secs (this is a high-priority tent)\n    const TE_WORLDDECAL = 116 // Decal applied to the world brush\n    const TE_WORLDDECALHIGH = 117 // Decal (with texture index > 256) applied to world brush\n    const TE_DECALHIGH = 118 // Same as TE_DECAL, but the texture index was greater than 256\n    const TE_PROJECTILE = 119 // Makes a projectile (like a nail) (this is a high-priority tent)\n    const TE_SPRAY = 120 // Throws a shower of sprites or models\n    const TE_PLAYERSPRITES = 121 // Sprites emit from a player's bounding box (ONLY use for players!)\n    const TE_PARTICLEBURST = 122 // Very similar to lavasplash\n    const TE_FIREFIELD = 123 // Makes a field of fire\n    const TE_PLAYERATTACHMENT = 124 // Attaches a TENT to a player (this is a high-priority tent)\n    const TE_KILLPLAYERATTACHMENTS = 125 // Will expire all TENTS attached to a player.\n    const TE_MULTIGUNSHOT = 126 // Much more compact shotgun message\n    const TE_USERTRACER = 127 // Larger message than the standard tracer, but allows some customization.\n\n    let type = r.ub()\n    let data: any = {}\n    switch (type) {\n      case TE_BEAMPOINTS: {\n        r.skip(24)\n        break\n      }\n\n      case TE_BEAMENTPOINT: {\n        r.skip(20)\n        break\n      }\n\n      case TE_GUNSHOT: {\n        r.skip(6)\n        break\n      }\n\n      case TE_EXPLOSION: {\n        r.skip(11)\n        break\n      }\n\n      case TE_TAREXPLOSION: {\n        r.skip(6)\n        break\n      }\n\n      case TE_SMOKE: {\n        r.skip(10)\n        break\n      }\n\n      case TE_TRACER: {\n        r.skip(12)\n        break\n      }\n\n      case TE_LIGHTNING: {\n        r.skip(17)\n        break\n      }\n\n      case TE_BEAMENTS: {\n        r.skip(16)\n        break\n      }\n\n      case TE_SPARKS: {\n        r.skip(6)\n        break\n      }\n\n      case TE_LAVASPLASH: {\n        r.skip(6)\n        break\n      }\n\n      case TE_TELEPORT: {\n        r.skip(6)\n        break\n      }\n\n      case TE_EXPLOSION2: {\n        r.skip(8)\n        break\n      }\n\n      case TE_BSPDECAL: {\n        r.skip(8)\n        let entityIndex = r.s()\n        if (entityIndex) {\n          r.skip(2)\n        }\n        break\n      }\n\n      case TE_IMPLOSION: {\n        r.skip(9)\n        break\n      }\n\n      case TE_SPRITETRAIL: {\n        r.skip(19)\n        break\n      }\n\n      case TE_SPRITE: {\n        r.skip(10)\n        break\n      }\n\n      case TE_BEAMSPRITE: {\n        r.skip(16)\n        break\n      }\n\n      case TE_BEAMTORUS: {\n        r.skip(24)\n        break\n      }\n\n      case TE_BEAMDISK: {\n        r.skip(24)\n        break\n      }\n\n      case TE_BEAMCYLINDER: {\n        r.skip(24)\n        break\n      }\n\n      case TE_BEAMFOLLOW: {\n        r.skip(10)\n        break\n      }\n\n      case TE_GLOWSPRITE: {\n        r.skip(11)\n        break\n      }\n\n      case TE_BEAMRING: {\n        r.skip(16)\n        break\n      }\n\n      case TE_STREAK_SPLASH: {\n        r.skip(19)\n        break\n      }\n\n      case TE_DLIGHT: {\n        r.skip(12)\n        break\n      }\n\n      case TE_ELIGHT: {\n        r.skip(16)\n        break\n      }\n\n      case TE_TEXTMESSAGE: {\n        data.channel = r.b()\n        data.x = r.s()\n        data.y = r.s()\n        data.effect = r.b()\n        data.textColor = [r.ub(), r.ub(), r.ub(), r.ub()]\n        data.effectColor = [r.ub(), r.ub(), r.ub(), r.ub()]\n        data.fadeInTime = r.s()\n        data.fadeOutTime = r.s()\n        data.holdTime = r.s()\n        if (data.effect) {\n          data.effectTime = r.s()\n        }\n        data.message = r.str()\n        break\n      }\n\n      case TE_LINE: {\n        r.skip(17)\n        break\n      }\n\n      case TE_BOX: {\n        r.skip(17)\n        break\n      }\n\n      case TE_KILLBEAM: {\n        r.skip(2)\n        break\n      }\n\n      case TE_LARGEFUNNEL: {\n        r.skip(10)\n        break\n      }\n\n      case TE_BLOODSTREAM: {\n        r.skip(14)\n        break\n      }\n\n      case TE_SHOWLINE: {\n        r.skip(12)\n        break\n      }\n\n      case TE_BLOOD: {\n        r.skip(14)\n        break\n      }\n\n      case TE_DECAL: {\n        r.skip(9)\n        break\n      }\n\n      case TE_FIZZ: {\n        r.skip(5)\n        break\n      }\n\n      case TE_MODEL: {\n        r.skip(17)\n        break\n      }\n\n      case TE_EXPLODEMODEL: {\n        r.skip(13)\n        break\n      }\n\n      case TE_BREAKMODEL: {\n        r.skip(24)\n        break\n      }\n\n      case TE_GUNSHOTDECAL: {\n        r.skip(9)\n        break\n      }\n\n      case TE_SPRITE_SPRAY: {\n        r.skip(17)\n        break\n      }\n\n      case TE_ARMOR_RICOCHET: {\n        r.skip(7)\n        break\n      }\n\n      case TE_PLAYERDECAL: {\n        r.skip(10)\n        break\n      }\n\n      case TE_BUBBLES: {\n        r.skip(19)\n        break\n      }\n\n      case TE_BUBBLETRAIL: {\n        r.skip(19)\n        break\n      }\n\n      case TE_BLOODSPRITE: {\n        r.skip(12)\n        break\n      }\n\n      case TE_WORLDDECAL: {\n        r.skip(7)\n        break\n      }\n\n      case TE_WORLDDECALHIGH: {\n        r.skip(7)\n        break\n      }\n\n      case TE_DECALHIGH: {\n        r.skip(9)\n        break\n      }\n\n      case TE_PROJECTILE: {\n        r.skip(16)\n        break\n      }\n\n      case TE_SPRAY: {\n        r.skip(18)\n        break\n      }\n\n      case TE_PLAYERSPRITES: {\n        r.skip(5)\n        break\n      }\n\n      case TE_PARTICLEBURST: {\n        r.skip(10)\n        break\n      }\n\n      case TE_FIREFIELD: {\n        r.skip(9)\n        break\n      }\n\n      case TE_PLAYERATTACHMENT: {\n        r.skip(7)\n        break\n      }\n\n      case TE_KILLPLAYERATTACHMENTS: {\n        r.skip(1)\n        break\n      }\n\n      case TE_MULTIGUNSHOT: {\n        r.skip(18)\n        break\n      }\n\n      case TE_USERTRACER: {\n        r.skip(15)\n        break\n      }\n\n      default: {\n        throw new Error('Unknown temp entity type')\n      }\n    }\n\n    return data\n  }\n\n  static setPause(r: Reader) {\n    return {\n      isPaused: r.b()\n    }\n  }\n\n  static signOnNum(r: Reader) {\n    return {\n      sign: r.b()\n    }\n  }\n\n  static centerPrint(r: Reader) {\n    return {\n      message: r.str()\n    }\n  }\n\n  static killedMonster(): null {\n    // unused\n    return null\n  }\n\n  static foundSecret(): null {\n    // unused\n    return null\n  }\n\n  static spawnStaticSound(r: Reader) {\n    return {\n      position: [r.s() / 8, r.s() / 8, r.s() / 8],\n      soundIndex: r.us(),\n      volume: r.ub() / 255,\n      attenuation: r.ub() / 64,\n      entityIndex: r.us(),\n      pitch: r.ub(),\n      flags: r.ub()\n    }\n  }\n\n  static intermission(): null {\n    // has no arguments\n    return null\n  }\n\n  static finale(r: Reader) {\n    return {\n      text: r.str()\n    }\n  }\n\n  static cdTrack(r: Reader) {\n    return {\n      track: r.b(),\n      loopTrack: r.b()\n    }\n  }\n\n  static restore(r: Reader) {\n    let saveName = r.str()\n    let mapCount = r.ub()\n    let maps = []\n    for (let i = 0; i < mapCount; ++i) {\n      maps.push(r.str())\n    }\n\n    return { saveName, maps }\n  }\n\n  static cutscene(r: Reader) {\n    return {\n      text: r.str()\n    }\n  }\n\n  static weaponAnim(r: Reader) {\n    return {\n      sequenceNumber: r.b(),\n      weaponModelBodyGroup: r.b()\n    }\n  }\n\n  static decalName(r: Reader) {\n    return {\n      positionIndex: r.ub(),\n      decalName: r.str()\n    }\n  }\n\n  static roomType(r: Reader) {\n    return {\n      type: r.us()\n    }\n  }\n\n  static addAngle(r: Reader) {\n    // NOTE: not sure if (360/65536) or (65536/360)\n    return {\n      angleToAdd: r.s() / (360 / 65536)\n    }\n  }\n\n  static newUserMsg(r: Reader) {\n    return {\n      index: r.ub(),\n      size: r.b(),\n      name: r.nstr(16)\n    }\n  }\n\n  static packetEntities(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    let entityStates = []\n    bs.readBits(16) // skip entity count (unreliable)\n    let entityNumber = 0\n    while (true) {\n      let footer = bs.readBits(16)\n      if (footer === 0) {\n        break\n      }\n\n      bs.index -= 16\n\n      let entityNumberIncrement = bs.readBits(1)\n      if (!entityNumberIncrement) {\n        let absoluteEntityNumber = bs.readBits(1)\n        if (absoluteEntityNumber) {\n          entityNumber = bs.readBits(11)\n        } else {\n          entityNumber += bs.readBits(6)\n        }\n      } else {\n        entityNumber++\n      }\n\n      let custom = bs.readBits(1)\n      let useBaseline = bs.readBits(1)\n      if (useBaseline) {\n        bs.index += 6 // baseline index\n      }\n\n      let entityType = 'entity_state_t'\n      if (entityNumber > 0 && entityNumber <= 32) {\n        entityType = 'entity_state_player_t'\n      } else if (custom) {\n        entityType = 'custom_entity_state_t'\n      }\n\n      entityStates.push(readDelta(bs, deltaDecoders[entityType]))\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return { entityStates }\n  }\n\n  static deltaPacketEntities(r: Reader, deltaDecoders: DeltaDecoderTable) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    bs.readBits(16) // skip entity count (unreliable)\n    bs.index += 8 // either updatemask or delta sequence number\n\n    let entityStates = []\n    let entityIdx = 0\n    while (true) {\n      let footer = bs.readBits(16)\n      if (footer === 0) {\n        break\n      }\n\n      bs.index -= 16\n\n      let removeEntity = bs.readBits(1)\n      let absoluteEntityNumber = bs.readBits(1)\n      if (absoluteEntityNumber) {\n        entityIdx = bs.readBits(11)\n      } else {\n        entityIdx += bs.readBits(6)\n      }\n\n      if (removeEntity) {\n        continue\n      }\n\n      let custom = bs.readBits(1)\n      let entityType = 'entity_state_t'\n      if (entityIdx > 0 && entityIdx < 32) {\n        entityType = 'entity_state_player_t'\n      } else if (custom) {\n        entityType = 'custom_entity_state_t'\n      }\n\n      entityStates[entityIdx] = readDelta(bs, deltaDecoders[entityType])\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return { entityStates }\n  }\n\n  static choke(): null {\n    // no arguments\n    return null\n  }\n\n  static resourceList(r: Reader) {\n    let bs = new BitStream(r.data.buffer)\n    bs.index = r.tell() * 8\n\n    // TODO: extract more data???\n\n    let entries = []\n    let entryCount = bs.readBits(12)\n    for (let i = 0; i < entryCount; ++i) {\n      let entry: any = {}\n      entry.type = bs.readBits(4)\n      entry.name = bs.readString()\n      entry.index = bs.readBits(12)\n      entry.size = bs.readBits(24)\n\n      let flags = bs.readBits(3)\n      if (flags & 4) {\n        // TODO: entry.md5hash = read 128 bits\n        bs.index += 128\n      }\n\n      // 1 bit = boolean hasExtraInfo\n      if (bs.readBits(1)) {\n        // 32 bytes extraInfo\n        bs.index += 256\n      }\n\n      entries.push(entry)\n    }\n\n    if (bs.readBits(1)) {\n      while (bs.readBits(1)) {\n        let nBits = bs.readBits(1) ? 5 : 10\n        bs.index += nBits\n      }\n    }\n\n    if (bs.index % 8 > 0) {\n      r.seek(Math.floor(bs.index / 8) + 1)\n    } else {\n      r.seek(bs.index / 8)\n    }\n\n    return entries\n  }\n\n  static newMoveVars(r: Reader) {\n    return {\n      gravity: r.f(),\n      stopSpeed: r.f(),\n      maxSpeed: r.f(),\n      spectatorMaxSpeed: r.f(),\n      acceleration: r.f(),\n      airAcceleration: r.f(),\n      waterAcceleration: r.f(),\n      friction: r.f(),\n      edgeFriction: r.f(),\n      waterFriction: r.f(),\n      entityGravity: r.f(),\n      bounce: r.f(),\n      stepSize: r.f(),\n      maxVelocity: r.f(),\n      zMax: r.f(),\n      waveHeight: r.f(),\n      footsteps: r.b(),\n      rollAngle: r.f(),\n      rollSpeed: r.f(),\n      skyColor: [r.f(), r.f(), r.f()],\n      skyVec: [r.f(), r.f(), r.f()],\n      skyName: r.str()\n    }\n  }\n\n  static resourceRequest(r: Reader) {\n    let data = {\n      spawnCount: r.i()\n    }\n    r.skip(4) // unknown (always 0)\n\n    return data\n  }\n\n  static customization(r: Reader) {\n    let playerIndex = r.ub()\n    let type = r.ub()\n    let name = r.str()\n    let index = r.us()\n    let downloadSize = r.ui()\n    let flags = r.ub()\n    let md5hash\n    if (flags & 4) {\n      md5hash = [r.i(), r.i(), r.i(), r.i()]\n    }\n\n    return {\n      playerIndex,\n      type,\n      name,\n      index,\n      downloadSize,\n      flags,\n      md5hash\n    }\n  }\n\n  static crosshairAngle(r: Reader) {\n    return {\n      pitch: r.b(),\n      yaw: r.b()\n    }\n  }\n\n  static soundFade(r: Reader) {\n    return {\n      initialPercent: r.ub(),\n      holdTime: r.ub(),\n      fadeOutTime: r.ub(),\n      fadeInTime: r.ub()\n    }\n  }\n\n  static fileTxferFailed(r: Reader) {\n    return {\n      filename: r.str()\n    }\n  }\n\n  static hltv(r: Reader) {\n    return {\n      mode: r.ub()\n    }\n  }\n\n  static director(r: Reader) {\n    let length = r.ub()\n    return {\n      flag: r.ub(),\n      message: r.nstr(length - 1)\n    }\n  }\n\n  static voiceInit(r: Reader) {\n    return {\n      codecName: r.str(),\n      quality: r.b()\n    }\n  }\n\n  static voiceData(r: Reader) {\n    let playerIndex = r.ub()\n    let size = r.us()\n    let data = r.arrx(size, ReaderDataType.UByte)\n    return { playerIndex, data }\n  }\n\n  static sendExtraInfo(r: Reader) {\n    return {\n      fallbackDir: r.str(),\n      canCheat: r.ub()\n    }\n  }\n\n  static timeScale(r: Reader) {\n    return {\n      timeScale: r.f()\n    }\n  }\n\n  static resourceLocation(r: Reader) {\n    return {\n      url: r.str()\n    }\n  }\n\n  static sendCvarValue(r: Reader) {\n    // deprecated\n    return {\n      name: r.str()\n    }\n  }\n\n  static sendCvarValue2(r: Reader) {\n    return {\n      requestId: r.ui(),\n      name: r.str()\n    }\n  }\n\n  static read(r: Reader, type: number, deltaDecoders: DeltaDecoderTable) {\n    if (type === 0) {\n      // SVC_BAD shouldn't happen\n      return null\n    }\n\n    const handler = FrameDataReader.handlers[type]\n    if (handler) {\n      return handler(r, deltaDecoders)\n    } else {\n      return null\n    }\n  }\n\n  // prettier-ignore\n  static readonly handlers: FrameDataHandler[] = [\n    FrameDataReader.bad,                 // SVC_BAD                      0\n    FrameDataReader.nop,                 // SVC_NOP                      1\n    FrameDataReader.disconnect,          // SVC_DISCONNECT               2\n    FrameDataReader.event,               // SVC_EVENT                    3\n    FrameDataReader.version,             // SVC_VERSION                  4\n    FrameDataReader.setView,             // SVC_SETVIEW                  5\n    FrameDataReader.sound,               // SVC_SOUND                    6\n    FrameDataReader.time,                // SVC_TIME                     7\n    FrameDataReader.print,               // SVC_PRINT                    8\n    FrameDataReader.stuffText,           // SVC_STUFFTEXT                9\n    FrameDataReader.setAngle,            // SVC_SETANGLE                10\n    FrameDataReader.serverInfo,          // SVC_SERVERINFO              11\n    FrameDataReader.lightStyle,          // SVC_LIGHTSTYLE              12\n    FrameDataReader.updateUserInfo,      // SVC_UPDATEUSERINFO          13\n    FrameDataReader.deltaDescription,    // SVC_DELTADESCRIPTION        14\n    FrameDataReader.clientData,          // SVC_CLIENTDATA              15\n    FrameDataReader.stopSound,           // SVC_STOPSOUND               16\n    FrameDataReader.pings,               // SVC_PINGS                   17\n    FrameDataReader.particle,            // SVC_PARTICLE                18\n    FrameDataReader.damage,              // SVC_DAMAGE                  19\n    FrameDataReader.spawnStatic,         // SVC_SPAWNSTATIC             20\n    FrameDataReader.eventReliable,       // SVC_EVENT_RELIABLE          21\n    FrameDataReader.spawnBaseLine,       // SVC_SPAWNBASELINE           22\n    FrameDataReader.tempEntity,          // SVC_TEMPENTITY              23\n    FrameDataReader.setPause,            // SVC_SETPAUSE                24\n    FrameDataReader.signOnNum,           // SVC_SIGNONNUM               25\n    FrameDataReader.centerPrint,         // SVC_CENTERPRINT             26\n    FrameDataReader.killedMonster,       // SVC_KILLEDMONSTER           27\n    FrameDataReader.foundSecret,         // SVC_FOUNDSECRET             28\n    FrameDataReader.spawnStaticSound,    // SVC_SPAWNSTATICSOUND        29\n    FrameDataReader.intermission,        // SVC_INTERMISSION            30\n    FrameDataReader.finale,              // SVC_FINALE                  31\n    FrameDataReader.cdTrack,             // SVC_CDTRACK                 32\n    FrameDataReader.restore,             // SVC_RESTORE                 33\n    FrameDataReader.cutscene,            // SVC_CUTSCENE                34\n    FrameDataReader.weaponAnim,          // SVC_WEAPONANIM              35\n    FrameDataReader.decalName,           // SVC_DECALNAME               36\n    FrameDataReader.roomType,            // SVC_ROOMTYPE                37\n    FrameDataReader.addAngle,            // SVC_ADDANGLE                38\n    FrameDataReader.newUserMsg,          // SVC_NEWUSERMSG              39\n    FrameDataReader.packetEntities,      // SVC_PACKETENTITIES          40\n    FrameDataReader.deltaPacketEntities, // SVC_DELTAPACKETENTITIES     41\n    FrameDataReader.choke,               // SVC_CHOKE                   42\n    FrameDataReader.resourceList,        // SVC_RESOURCELIST            43\n    FrameDataReader.newMoveVars,         // SVC_NEWMOVEVARS             44\n    FrameDataReader.resourceRequest,     // SVC_RESOURCEREQUEST         45\n    FrameDataReader.customization,       // SVC_CUSTOMIZATION           46\n    FrameDataReader.crosshairAngle,      // SVC_CROSSHAIRANGLE          47\n    FrameDataReader.soundFade,           // SVC_SOUNDFADE               48\n    FrameDataReader.fileTxferFailed,     // SVC_FILETXFERFAILED         49\n    FrameDataReader.hltv,                // SVC_HLTV                    50\n    FrameDataReader.director,            // SVC_DIRECTOR                51\n    FrameDataReader.voiceInit,           // SVC_VOICEINIT               52\n    FrameDataReader.voiceData,           // SVC_VOICEDATA               53\n    FrameDataReader.sendExtraInfo,       // SVC_SENDEXTRAINFO           54\n    FrameDataReader.timeScale,           // SVC_TIMESCALE               55\n    FrameDataReader.resourceLocation,    // SVC_RESOURCELOCATION        56\n    FrameDataReader.sendCvarValue,       // SVC_SENDCVARVALUE           57\n    FrameDataReader.sendCvarValue2       // SVC_SENDCVARVALUE2          58\n  ]\n}\n\nexport namespace FrameDataReader {\n  export enum SVC {\n    BAD = 0,\n    NOP = 1,\n    DISCONNECT = 2,\n    EVENT = 3,\n    VERSION = 4,\n    SETVIEW = 5,\n    SOUND = 6,\n    TIME = 7,\n    PRINT = 8,\n    STUFFTEXT = 9,\n    SETANGLE = 10,\n    SERVERINFO = 11,\n    LIGHTSTYLE = 12,\n    UPDATEUSERINFO = 13,\n    DELTADESCRIPTION = 14,\n    CLIENTDATA = 15,\n    STOPSOUND = 16,\n    PINGS = 17,\n    PARTICLE = 18,\n    DAMAGE = 19,\n    SPAWNSTATIC = 20,\n    EVENT_RELIABLE = 21,\n    SPAWNBASELINE = 22,\n    TEMPENTITY = 23,\n    SETPAUSE = 24,\n    SIGNONNUM = 25,\n    CENTERPRINT = 26,\n    KILLEDMONSTER = 27,\n    FOUNDSECRET = 28,\n    SPAWNSTATICSOUND = 29,\n    INTERMISSION = 30,\n    FINALE = 31,\n    CDTRACK = 32,\n    RESTORE = 33,\n    CUTSCENE = 34,\n    WEAPONANIM = 35,\n    DECALNAME = 36,\n    ROOMTYPE = 37,\n    ADDANGLE = 38,\n    NEWUSERMSG = 39,\n    PACKETENTITIES = 40,\n    DELTAPACKETENTITIES = 41,\n    CHOKE = 42,\n    RESOURCELIST = 43,\n    NEWMOVEVARS = 44,\n    RESOURCEREQUEST = 45,\n    CUSTOMIZATION = 46,\n    CROSSHAIRANGLE = 47,\n    SOUNDFADE = 48,\n    FILETXFERFAILED = 49,\n    HLTV = 50,\n    DIRECTOR = 51,\n    VOICEINIT = 52,\n    VOICEDATA = 53,\n    SENDEXTRAINFO = 54,\n    TIMESCALE = 55,\n    RESOURCELOCATION = 56,\n    SENDCVARVALUE = 57,\n    SENDCVARVALUE2 = 58\n  }\n}\n","import { BitStream } from '../BitReader'\n\nexport function readCoord(bs: BitStream) {\n  let intFlag = bs.readBits(1)\n  let fractionFlag = bs.readBits(1)\n\n  if (!intFlag && !fractionFlag) {\n    return 0\n  }\n\n  let sign = bs.readBits(1)\n  let intValue = 0\n  let fractionValue = 0\n  if (intFlag) {\n    intValue = bs.readBits(12)\n  }\n  if (fractionFlag) {\n    fractionValue = bs.readBits(3)\n  }\n\n  let value = intValue + fractionValue / 32\n  if (sign) {\n    value = -value\n  }\n\n  return value\n}\n","export enum DeltaType {\n  DT_BYTE = 1,\n  DT_SHORT = 1 << 1,\n  DT_FLOAT = 1 << 2,\n  DT_INTEGER = 1 << 3,\n  DT_ANGLE = 1 << 4,\n  DT_TIMEWINDOW_8 = 1 << 5,\n  DT_TIMEWINDOW_BIG = 1 << 6,\n  DT_STRING = 1 << 7,\n  DT_SIGNED = 1 << 31\n}\n","export class BitView {\r\n  static scratch = new DataView(new ArrayBuffer(8))\r\n\r\n  private view: Uint8Array\r\n\r\n  constructor(buffer: ArrayBuffer) {\r\n    this.view = new Uint8Array(buffer, 0, buffer.byteLength)\r\n  }\r\n\r\n  getBits(offset: number, bits: number, signed = false) {\r\n    const available = this.view.length * 8 - offset\r\n\r\n    if (bits > available) {\r\n      throw new Error('Bits out of bounds')\r\n    }\r\n\r\n    let value = 0\r\n    for (let i = 0; i < bits; ) {\r\n      const remaining = bits - i\r\n      const bitOffset = offset & 7\r\n      const currentByte = this.view[offset >> 3]\r\n\r\n      // the max number of bits we can read from the current byte\r\n      const read = Math.min(remaining, 8 - bitOffset)\r\n\r\n      // create a mask with the correct bit width\r\n      const mask = (1 << read) - 1\r\n      // shift bits we want to the start of the byte and mask of the rest\r\n      const readBits = (currentByte >> bitOffset) & mask\r\n      value |= readBits << i\r\n\r\n      offset += read\r\n      i += read\r\n    }\r\n\r\n    if (signed) {\r\n      // If we're not working with a full 32 bits, check the\r\n      // imaginary MSB for this bit count and convert to a\r\n      // valid 32-bit signed value if set.\r\n      if (bits !== 32 && value & (1 << (bits - 1))) {\r\n        value |= -1 ^ ((1 << bits) - 1)\r\n      }\r\n\r\n      return value\r\n    }\r\n\r\n    return value >>> 0\r\n  }\r\n\r\n  getInt8(offset: number) {\r\n    return this.getBits(offset, 8, true)\r\n  }\r\n\r\n  getUint8(offset: number) {\r\n    return this.getBits(offset, 8, false)\r\n  }\r\n\r\n  getInt16(offset: number) {\r\n    return this.getBits(offset, 16, true)\r\n  }\r\n\r\n  getUint16(offset: number) {\r\n    return this.getBits(offset, 16, false)\r\n  }\r\n\r\n  getInt32(offset: number) {\r\n    return this.getBits(offset, 32, true)\r\n  }\r\n\r\n  getUint32(offset: number) {\r\n    return this.getBits(offset, 32, false)\r\n  }\r\n\r\n  getFloat32(offset: number) {\r\n    BitView.scratch.setUint32(0, this.getUint32(offset))\r\n    return BitView.scratch.getFloat32(0)\r\n  }\r\n\r\n  getFloat64(offset: number) {\r\n    BitView.scratch.setUint32(0, this.getUint32(offset))\r\n    // DataView offset is in bytes.\r\n    BitView.scratch.setUint32(4, this.getUint32(offset + 32))\r\n    return BitView.scratch.getFloat64(0)\r\n  }\r\n}\r\n\r\nexport class BitStream {\r\n  private view: BitView\r\n  index: number\r\n\r\n  constructor(source: ArrayBuffer) {\r\n    this.view = new BitView(source)\r\n    this.index = 0\r\n  }\r\n\r\n  readBits(bits: number, signed = false) {\r\n    const val = this.view.getBits(this.index, bits, signed)\r\n    this.index += bits\r\n    return val\r\n  }\r\n\r\n  readInt8() {\r\n    const val = this.view.getInt8(this.index)\r\n    this.index += 8\r\n    return val\r\n  }\r\n\r\n  readUint8() {\r\n    const val = this.view.getUint8(this.index)\r\n    this.index += 8\r\n    return val\r\n  }\r\n\r\n  readInt16() {\r\n    const val = this.view.getInt16(this.index)\r\n    this.index += 16\r\n    return val\r\n  }\r\n\r\n  readUint16() {\r\n    const val = this.view.getUint16(this.index)\r\n    this.index += 16\r\n    return val\r\n  }\r\n\r\n  readInt32() {\r\n    const val = this.view.getInt32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readUint32() {\r\n    const val = this.view.getUint32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readFloat32() {\r\n    const val = this.view.getFloat32(this.index)\r\n    this.index += 32\r\n    return val\r\n  }\r\n\r\n  readFloat64() {\r\n    const val = this.view.getFloat64(this.index)\r\n    this.index += 64\r\n    return val\r\n  }\r\n\r\n  readString(bytes = 0, utf8 = false) {\r\n    let i = 0\r\n    const chars = []\r\n    let append = true\r\n\r\n    // Read while we still have space available, or until we've\r\n    // hit the fixed byte length passed in.\r\n    while (!bytes || (bytes && i < bytes)) {\r\n      const c = this.readUint8()\r\n\r\n      // Stop appending chars once we hit 0x00\r\n      if (c === 0x00) {\r\n        append = false\r\n\r\n        // If we don't have a fixed length to read, break out now.\r\n        if (!bytes) {\r\n          break\r\n        }\r\n      }\r\n      if (append) {\r\n        chars.push(c)\r\n      }\r\n\r\n      i++\r\n    }\r\n\r\n    const string = String.fromCharCode.apply(null, chars)\r\n    if (utf8) {\r\n      try {\r\n        // https://stackoverflow.com/a/17192845\r\n        return decodeURIComponent(string)\r\n      } catch (e) {\r\n        return string\r\n      }\r\n    } else {\r\n      return string\r\n    }\r\n  }\r\n}\r\n\r\n","export interface ProgressCallback {\r\n  (request: XMLHttpRequest, progress: number): void\r\n}\r\n\r\nexport interface XhrParams {\r\n  method: string\r\n  isBinary: boolean\r\n  progressCallback: ProgressCallback\r\n}\r\n\r\nexport function xhr(url: string, params: XhrParams): Promise<any> {\r\n  let method = params.method || 'GET'\r\n  let isBinary = params.isBinary\r\n  let progressCallback = params.progressCallback\r\n\r\n  if (!url) {\r\n    throw new Error('Url parameter missing')\r\n  }\r\n\r\n  return new Promise<string>((resolve, reject) => {\r\n    let request = new XMLHttpRequest()\r\n\r\n    if (isBinary) {\r\n      request.responseType = 'arraybuffer'\r\n    }\r\n\r\n    if (isBinary && progressCallback) {\r\n      request.addEventListener('progress', event => {\r\n        if (event.lengthComputable) {\r\n          progressCallback(request, event.loaded / event.total)\r\n        } else {\r\n          // HACK!\r\n          let totalStr = request.getResponseHeader('content-length')\r\n          let total = 0\r\n          if (totalStr) {\r\n            total = parseFloat(totalStr)\r\n          }\r\n          let encoding = request.getResponseHeader('content-encoding')\r\n          if (total && encoding && encoding.indexOf('gzip') > -1) {\r\n            // assuming average gzip compression ratio to be 25%\r\n            total *= 4\r\n            let loadedPercent = Math.min(0.99, event.loaded / total)\r\n            progressCallback(request, loadedPercent)\r\n            // END OF HACK\r\n          } else {\r\n            progressCallback(request, 0)\r\n          }\r\n        }\r\n      })\r\n    }\r\n\r\n    request.addEventListener('readystatechange', (event: any) => {\r\n      if (event.target.readyState !== 4) {\r\n        return\r\n      }\r\n\r\n      if (event.target.status === 200) {\r\n        if (progressCallback) {\r\n          progressCallback(request, 1)\r\n        }\r\n\r\n        resolve(event.target.response)\r\n      } else {\r\n        reject({\r\n          status: event.target.status\r\n        })\r\n      }\r\n    })\r\n\r\n    request.open(method, url, true)\r\n    request.send()\r\n  })\r\n}\r\n","import { basename } from '../Util'\nimport { vdf } from '../Parsers/Vdf'\nimport { BspTexture, Bsp } from '../Bsp'\nimport { Reader, ReaderDataType } from '../Reader'\nimport { BspLightmapParser } from '../Parsers/BspLightmapParser'\nimport { paletteWithLastTransToRGBA, paletteToRGBA } from './Util'\n\nexport function parseModels(\n  models: BspLumpModel[],\n  faces: BspLumpFace[],\n  edges: BspLumpEdge[],\n  surfEdges: BspLumpSurfedge[],\n  vertices: BspLumpVertex[],\n  texinfo: BspLumpTexInfo[],\n  textures: BspTexture[],\n  lightmap: BspLightmapParser\n) {\n  const parsedModels = []\n\n  for (let i = 0; i < models.length; ++i) {\n    const model = models[i]\n\n    const _faces: {\n      buffer: Float32Array\n      textureIndex: number\n    }[] = []\n\n    const v0 = new Float32Array(3)\n    const v1 = new Float32Array(3)\n    const v2 = new Float32Array(3)\n    const uv0 = new Float32Array(2)\n    const uv1 = new Float32Array(2)\n    const uv2 = new Float32Array(2)\n    const luv0 = new Float32Array(2)\n    const luv1 = new Float32Array(2)\n    const luv2 = new Float32Array(2)\n\n    let origin =\n      i === 0\n        ? [0, 0, 0]\n        : [0, 0, 0].map(\n            (_, i) => (model.maxs[i] - model.mins[i]) / 2 + model.mins[i]\n          )\n\n    for (let i = model.firstFace; i < model.firstFace + model.faceCount; ++i) {\n      const faceData = {\n        // 3 floats vertices | 2 floats uvs | 2 floats luvs\n        buffer: new Float32Array((faces[i].edgeCount - 2) * 21),\n        textureIndex: -1\n      }\n\n      const faceTexInfo = texinfo[faces[i].textureInfo]\n      const faceTexture = textures[faceTexInfo.textureIndex]\n      const faceSurfEdges = surfEdges.slice(\n        faces[i].firstEdge,\n        faces[i].firstEdge + faces[i].edgeCount\n      )\n\n      const v0idx =\n        edges[Math.abs(faceSurfEdges[0])][faceSurfEdges[0] > 0 ? 0 : 1]\n      v0[0] = vertices[v0idx][0]\n      v0[1] = vertices[v0idx][1]\n      v0[2] = vertices[v0idx][2]\n\n      uv0[0] =\n        v0[0] * faceTexInfo.s[0] +\n        v0[1] * faceTexInfo.s[1] +\n        v0[2] * faceTexInfo.s[2] +\n        faceTexInfo.sShift\n      uv0[1] =\n        v0[0] * faceTexInfo.t[0] +\n        v0[1] * faceTexInfo.t[1] +\n        v0[2] * faceTexInfo.t[2] +\n        faceTexInfo.tShift\n\n      luv0[0] = 0\n      luv0[1] = 0\n\n      const v1idx =\n        edges[Math.abs(faceSurfEdges[1])][faceSurfEdges[1] > 0 ? 0 : 1]\n      v1[0] = vertices[v1idx][0]\n      v1[1] = vertices[v1idx][1]\n      v1[2] = vertices[v1idx][2]\n\n      uv1[0] =\n        v1[0] * faceTexInfo.s[0] +\n        v1[1] * faceTexInfo.s[1] +\n        v1[2] * faceTexInfo.s[2] +\n        faceTexInfo.sShift\n      uv1[1] =\n        v1[0] * faceTexInfo.t[0] +\n        v1[1] * faceTexInfo.t[1] +\n        v1[2] * faceTexInfo.t[2] +\n        faceTexInfo.tShift\n      luv1[0] = 0\n      luv1[1] = 0.999\n\n      let compIndex = 0\n      for (let j = 2; j < faces[i].edgeCount; ++j) {\n        const v2idx =\n          edges[Math.abs(faceSurfEdges[j])][faceSurfEdges[j] > 0 ? 0 : 1]\n        v2[0] = vertices[v2idx][0]\n        v2[1] = vertices[v2idx][1]\n        v2[2] = vertices[v2idx][2]\n        uv2[0] =\n          v2[0] * faceTexInfo.s[0] +\n          v2[1] * faceTexInfo.s[1] +\n          v2[2] * faceTexInfo.s[2] +\n          faceTexInfo.sShift\n        uv2[1] =\n          v2[0] * faceTexInfo.t[0] +\n          v2[1] * faceTexInfo.t[1] +\n          v2[2] * faceTexInfo.t[2] +\n          faceTexInfo.tShift\n        luv2[0] = 0.999\n        luv2[1] = 0.999\n\n        // vert1: coord, uv and luv\n        faceData.buffer[compIndex++] = v0[0]\n        faceData.buffer[compIndex++] = v0[1]\n        faceData.buffer[compIndex++] = v0[2]\n        faceData.buffer[compIndex++] = uv0[0]\n        faceData.buffer[compIndex++] = uv0[1]\n        faceData.buffer[compIndex++] = luv0[0]\n        faceData.buffer[compIndex++] = luv0[1]\n\n        // vert2\n        faceData.buffer[compIndex++] = v1[0]\n        faceData.buffer[compIndex++] = v1[1]\n        faceData.buffer[compIndex++] = v1[2]\n        faceData.buffer[compIndex++] = uv1[0]\n        faceData.buffer[compIndex++] = uv1[1]\n        faceData.buffer[compIndex++] = luv1[0]\n        faceData.buffer[compIndex++] = luv1[1]\n\n        // vert2\n        faceData.buffer[compIndex++] = v2[0]\n        faceData.buffer[compIndex++] = v2[1]\n        faceData.buffer[compIndex++] = v2[2]\n        faceData.buffer[compIndex++] = uv2[0]\n        faceData.buffer[compIndex++] = uv2[1]\n        faceData.buffer[compIndex++] = luv2[0]\n        faceData.buffer[compIndex++] = luv2[1]\n\n        v1[0] = v2[0]\n        v1[1] = v2[1]\n        v1[2] = v2[2]\n        uv1[0] = uv2[0]\n        uv1[1] = uv2[1]\n        luv1[0] = luv2[0]\n        luv1[1] = luv2[1]\n      }\n\n      // face has a lightmap if flag is equal to 0\n      if (faceTexInfo.flags === 0 || faceTexInfo.flags === -65536) {\n        lightmap.processFace(\n          faceData.buffer,\n          faceTexInfo,\n          faces[i].lightmapOffset\n        )\n      }\n\n      faceData.textureIndex = faceTexInfo.textureIndex\n\n      for (let j = 0; j < faceData.buffer.length / 7; ++j) {\n        faceData.buffer[j * 7] -= origin[0]\n        faceData.buffer[j * 7 + 1] -= origin[1]\n        faceData.buffer[j * 7 + 2] -= origin[2]\n        faceData.buffer[j * 7 + 3] /= faceTexture.width\n        faceData.buffer[j * 7 + 4] /= faceTexture.height\n      }\n\n      _faces.push(faceData)\n    }\n\n    parsedModels.push({\n      origin,\n      faces: _faces\n    })\n  }\n\n  return parsedModels\n}\n\nexport enum BspLumpIndex {\n  Entities = 0,\n  Planes = 1,\n  Textures = 2,\n  Vertices = 3,\n  Visibility = 4,\n  Nodes = 5,\n  TexInfo = 6,\n  Faces = 7,\n  Lighting = 8,\n  ClipNodes = 9,\n  Leaves = 10,\n  MarkSurfaces = 11,\n  Edges = 12,\n  SurfEdges = 13,\n  Models = 14\n}\n\nexport interface BspLump {\n  offset: number\n  length: number\n}\n\nexport interface BspLumpFace {\n  plane: number\n  planeSide: number\n  firstEdge: number\n  edgeCount: number\n  textureInfo: number\n  styles: number[]\n  lightmapOffset: number\n}\n\nexport interface BspLumpModel {\n  mins: number[]\n  maxs: number[]\n  origin: number[]\n  headNodes: number[]\n  visLeaves: number\n  firstFace: number\n  faceCount: number\n}\n\nexport type BspLumpEdge = number[]\n\nexport type BspLumpSurfedge = number\n\nexport type BspLumpVertex = number[]\n\nexport interface BspLumpTexInfo {\n  s: number[]\n  sShift: number\n  t: number[]\n  tShift: number\n  textureIndex: number\n  flags: number\n}\n\nexport type BspLumpLightmap = Uint8Array\n\nexport class BspParser {\n  static parse(name: string, buffer: ArrayBuffer): Bsp {\n    const r = new Reader(buffer)\n    const version = r.ui()\n    if (version !== 30) {\n      throw new Error('Invalid map version')\n    }\n\n    const lumps: BspLump[] = []\n    for (let i = 0; i < 15; ++i) {\n      lumps.push({\n        offset: r.ui(),\n        length: r.ui()\n      })\n    }\n\n    const entities = this.loadEntities(\n      r,\n      lumps[BspLumpIndex.Entities].offset,\n      lumps[BspLumpIndex.Entities].length\n    )\n\n    const textures = this.loadTextures(r, lumps[BspLumpIndex.Textures].offset)\n\n    const models = this.loadModels(\n      r,\n      lumps[BspLumpIndex.Models].offset,\n      lumps[BspLumpIndex.Models].length\n    )\n\n    const faces = this.loadFaces(\n      r,\n      lumps[BspLumpIndex.Faces].offset,\n      lumps[BspLumpIndex.Faces].length\n    )\n\n    const edges = this.loadEdges(\n      r,\n      lumps[BspLumpIndex.Edges].offset,\n      lumps[BspLumpIndex.Edges].length\n    )\n\n    const surfEdges = this.loadSurfEdges(\n      r,\n      lumps[BspLumpIndex.SurfEdges].offset,\n      lumps[BspLumpIndex.SurfEdges].length\n    )\n\n    const vertices = this.loadVertices(\n      r,\n      lumps[BspLumpIndex.Vertices].offset,\n      lumps[BspLumpIndex.Vertices].length\n    )\n\n    const texinfo = this.loadTexInfo(\n      r,\n      lumps[BspLumpIndex.TexInfo].offset,\n      lumps[BspLumpIndex.TexInfo].length\n    )\n\n    const lightmap = this.loadLightmap(\n      r,\n      lumps[BspLumpIndex.Lighting].offset,\n      lumps[BspLumpIndex.Lighting].length\n    )\n\n    const parsedLightmap = BspLightmapParser.init(lightmap)\n\n    const parsedModels = parseModels(\n      models,\n      faces,\n      edges,\n      surfEdges,\n      vertices,\n      texinfo,\n      textures,\n      parsedLightmap\n    )\n\n    return new Bsp(name, entities, textures, parsedModels, {\n      width: BspLightmapParser.TEXTURE_SIZE,\n      height: BspLightmapParser.TEXTURE_SIZE,\n      data: parsedLightmap.getTexture()\n    })\n  }\n\n  private static loadFaces(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpFace[] {\n    r.seek(offset)\n\n    const faces = []\n    for (let i = 0; i < length / 20; ++i) {\n      faces.push({\n        plane: r.us(),\n        planeSide: r.us(),\n        firstEdge: r.ui(),\n        edgeCount: r.us(),\n        textureInfo: r.us(),\n        styles: [r.ub(), r.ub(), r.ub(), r.ub()],\n        lightmapOffset: r.ui()\n      })\n    }\n    return faces\n  }\n\n  private static loadModels(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpModel[] {\n    r.seek(offset)\n\n    const models = []\n    for (let i = 0; i < length / 64; ++i) {\n      models.push({\n        mins: [r.f(), r.f(), r.f()],\n        maxs: [r.f(), r.f(), r.f()],\n        origin: [r.f(), r.f(), r.f()],\n        headNodes: [r.i(), r.i(), r.i(), r.i()],\n        visLeaves: r.i(),\n        firstFace: r.i(),\n        faceCount: r.i()\n      })\n    }\n    return models\n  }\n\n  private static loadEdges(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpEdge[] {\n    r.seek(offset)\n\n    const edges = []\n    for (let i = 0; i < length / 4; ++i) {\n      edges.push([r.us(), r.us()])\n    }\n    return edges\n  }\n\n  private static loadSurfEdges(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpSurfedge[] {\n    r.seek(offset)\n\n    const surfEdges = []\n    for (let i = 0; i < length / 4; ++i) {\n      surfEdges.push(r.i())\n    }\n    return surfEdges\n  }\n\n  private static loadVertices(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpVertex[] {\n    r.seek(offset)\n\n    const vertices = []\n    for (let i = 0; i < length / 12; ++i) {\n      vertices.push([r.f(), r.f(), r.f()])\n    }\n    return vertices\n  }\n\n  private static loadTexInfo(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpTexInfo[] {\n    r.seek(offset)\n\n    const texinfo: BspLumpTexInfo[] = []\n    for (let i = 0; i < length / 40; ++i) {\n      texinfo.push({\n        s: [r.f(), r.f(), r.f()],\n        sShift: r.f(),\n        t: [r.f(), r.f(), r.f()],\n        tShift: r.f(),\n        textureIndex: r.i(),\n        flags: r.i()\n      })\n    }\n    return texinfo\n  }\n\n  private static loadLightmap(\n    r: Reader,\n    offset: number,\n    length: number\n  ): BspLumpLightmap {\n    r.seek(offset)\n    return r.arrx(length, ReaderDataType.UByte)\n  }\n\n  private static loadTextureData(r: Reader) {\n    const name = r.nstr(16)\n    const width = r.ui()\n    const height = r.ui()\n\n    const isExternal = !r.ui() // if mipmap offset == 0\n    if (isExternal) {\n      const data = new Uint8Array(4)\n      data[0] = data[1] = data[2] = data[3] = 255\n\n      return { name, width, height, data, isExternal }\n    } else {\n      r.skip(3 * 4) // skip mipmap offsets\n\n      // read largest mipmap data\n      const pixelCount = width * height\n      const pixels = r.arrx(pixelCount, ReaderDataType.UByte)\n\n      // skip other 3 mipmaps\n      r.skip(21 * (pixelCount / 64))\n\n      r.skip(2) // skip padding bytes\n\n      const palette = r.arrx(768, ReaderDataType.UByte)\n\n      const data =\n        name[0] === '{'\n          ? paletteWithLastTransToRGBA(pixels, palette)\n          : paletteToRGBA(pixels, palette)\n\n      return { name, width, height, data, isExternal }\n    }\n  }\n\n  private static loadTextures(r: Reader, offset: number) {\n    r.seek(offset)\n\n    const count = r.ui()\n    const offsets = []\n    for (let i = 0; i < count; ++i) {\n      offsets.push(r.ui())\n    }\n\n    const textures: BspTexture[] = []\n    for (let i = 0; i < count; ++i) {\n      if (offsets[i] === 0xffffffff) {\n        textures.push({\n          name: 'ERROR404',\n          width: 1,\n          height: 1,\n          data: new Uint8Array([0, 255, 0, 255]),\n          isExternal: false\n        })\n      } else {\n        r.seek(offset + offsets[i])\n        textures.push(this.loadTextureData(r))\n      }\n    }\n\n    return textures\n  }\n\n  private static loadEntities(r: Reader, offset: number, length: number) {\n    r.seek(offset)\n    const entities: any[] = vdf(r.nstr(length)) as any\n\n    const VECTOR_ATTRS = [\n      'origin',\n      'angles',\n      '_diffuse_light',\n      '_light',\n      'rendercolor',\n      'avelocity'\n    ]\n    const NUMBER_ATTRS = ['renderamt', 'rendermode', 'scale']\n\n    const worldSpawn = entities[0]\n    if (worldSpawn.classname === 'worldspawn') {\n      worldSpawn.model = '*0'\n      worldSpawn.wad = worldSpawn.wad || ''\n      worldSpawn.wad = worldSpawn.wad\n        .split(';')\n        .filter((w: string) => w.length)\n        .map((w: string) => w.replace(/\\\\/g, '/'))\n        .map((w: string) => basename(w))\n    }\n\n    entities.forEach(e => {\n      if (e.model) {\n        if (typeof e.renderamt === 'undefined') {\n          e.renderamt = 0\n        }\n\n        if (typeof e.rendermode === 'undefined') {\n          e.rendermode = 0\n        }\n\n        if (typeof e.renderfx === 'undefined') {\n          e.renderfx = 0\n        }\n\n        if (typeof e.rendercolor === 'undefined') {\n          e.rendercolor = '0 0 0'\n        }\n      }\n\n      VECTOR_ATTRS.forEach(attr => {\n        if (e[attr]) {\n          e[attr] = e[attr].split(' ').map((v: string) => Number.parseFloat(v))\n        }\n      })\n\n      NUMBER_ATTRS.forEach(attr => {\n        if (e[attr]) {\n          e[attr] = Number.parseFloat(e[attr])\n        }\n      })\n    })\n\n    return entities\n  }\n}\n","export function vdf(input: string): {[name: string]: any}[] {\r\n  let state = 0\r\n  let key: string = ''\r\n  let val: string = ''\r\n  const objects: any[] = []\r\n\r\n  for (let i = 0; i < input.length; ++i) {\r\n    const c = input[i]\r\n\r\n    switch (state) {\r\n      case 0: {\r\n        // ROOT\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        } else if (c === '{') {\r\n          objects.push({})\r\n          state = 1\r\n        } else {\r\n          return []\r\n        }\r\n        break\r\n      }\r\n\r\n      case 1: {\r\n        // OBJECT\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        } else if (c === '}') {\r\n          state = 0\r\n        } else if (c === '\"') {\r\n          key = ''\r\n          state = 2\r\n        } else {\r\n          return []\r\n        }\r\n        break\r\n      }\r\n\r\n      case 2: {\r\n        // KEY\r\n        if (c === '\"') {\r\n          state = 3\r\n        } else {\r\n          key += c\r\n        }\r\n        break\r\n      }\r\n\r\n      case 3: {\r\n        // BETWEEN KEY AND VALUE\r\n        if (/\\s/.test(c)) {\r\n          continue\r\n        } else if (c === '\"') {\r\n          val = ''\r\n          state = 4\r\n        }\r\n        break\r\n      }\r\n\r\n      case 4: {\r\n        // VALUE\r\n        if (c === '\"') {\r\n          objects[objects.length - 1][key] = val\r\n          state = 1\r\n        } else {\r\n          val += c\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n\r\n  return objects\r\n}\r\n","import { Tga } from './Parsers/Tga'\nimport { Sprite } from './Parsers/Sprite'\nimport { BspLightmap } from './BspLightmap'\n\nexport interface BspTexture {\n  name: string\n  width: number\n  height: number\n  data: Uint8Array\n  isExternal: boolean\n}\n\nexport interface BspModel {\n  origin: number[]\n  faces: {\n    buffer: Float32Array\n    textureIndex: number\n  }[]\n}\n\nexport class Bsp {\n  name: string\n  entities: any[]\n  textures: BspTexture[]\n  models: BspModel[]\n  lightmap: BspLightmap\n  skies: Tga[] = []\n  sprites: { [name: string]: Sprite } = {}\n\n  constructor(\n    name: string,\n    entities: any[],\n    textures: BspTexture[],\n    models: BspModel[],\n    lightmap: BspLightmap\n  ) {\n    this.name = name\n    this.entities = entities\n    this.textures = textures\n    this.models = models\n    this.lightmap = lightmap\n  }\n}\n","export interface BspLightmapNode {\n  children: BspLightmapNode[]\n  isFilled: boolean\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\nexport class BspLightmapParser {\n  static TEXTURE_SIZE = 1024\n\n  static init(lightmap: Uint8Array) {\n    return new BspLightmapParser(lightmap)\n  }\n\n  private lightmap: Uint8Array // entire lightmap of the bsp map\n  private texture: Uint8Array\n  private block = new Uint16Array(BspLightmapParser.TEXTURE_SIZE)\n\n  private constructor(lightmap: Uint8Array) {\n    this.lightmap = lightmap\n\n    this.texture = new Uint8Array(\n      BspLightmapParser.TEXTURE_SIZE * BspLightmapParser.TEXTURE_SIZE * 4\n    )\n    this.texture[this.texture.length - 4] = 255\n    this.texture[this.texture.length - 3] = 255\n    this.texture[this.texture.length - 2] = 255\n    this.texture[this.texture.length - 1] = 255\n  }\n\n  getTexture() {\n    return this.texture\n  }\n\n  processFace(\n    faceData: Float32Array,\n    texinfo: {\n      // TODO: MapTexInfo interface\n      s: number[]\n      sShift: number\n      t: number[]\n      tShift: number\n      textureIndex: number\n      flags: number\n    },\n    offset: number\n  ) {\n    const size = this.getDimensions(faceData)\n    const rect = this.readLightmap(offset, size.width, size.height)\n    if (rect) {\n      // Determine the correct TexCoords for the lightmap (I think this bit is bugged too)\n      for (let i = 0; i < faceData.length / 7; ++i) {\n        let lu =\n          faceData[i * 7] * texinfo.s[0] +\n          faceData[i * 7 + 1] * texinfo.s[1] +\n          faceData[i * 7 + 2] * texinfo.s[2] +\n          texinfo.sShift -\n          size.minU\n        lu += rect.x * 16 + 8\n        lu /= BspLightmapParser.TEXTURE_SIZE * 16\n\n        let lv =\n          faceData[i * 7] * texinfo.t[0] +\n          faceData[i * 7 + 1] * texinfo.t[1] +\n          faceData[i * 7 + 2] * texinfo.t[2] +\n          texinfo.tShift -\n          size.minV\n        lv += rect.y * 16 + 8\n        lv /= BspLightmapParser.TEXTURE_SIZE * 16\n\n        faceData[i * 7 + 5] = lu\n        faceData[i * 7 + 6] = lv\n      }\n    }\n  }\n\n  private getDimensions(faceData: Float32Array) {\n    // find the min and max UV's for a face\n    let minU = Math.floor(faceData[3])\n    let minV = Math.floor(faceData[4])\n    let maxU = Math.floor(faceData[3])\n    let maxV = Math.floor(faceData[4])\n\n    for (let i = 1; i < faceData.length / 7; ++i) {\n      if (Math.floor(faceData[i * 7 + 3]) < minU) {\n        minU = Math.floor(faceData[i * 7 + 3])\n      }\n      if (Math.floor(faceData[i * 7 + 4]) < minV) {\n        minV = Math.floor(faceData[i * 7 + 4])\n      }\n      if (Math.floor(faceData[i * 7 + 3]) > maxU) {\n        maxU = Math.floor(faceData[i * 7 + 3])\n      }\n      if (Math.floor(faceData[i * 7 + 4]) > maxV) {\n        maxV = Math.floor(faceData[i * 7 + 4])\n      }\n    }\n\n    // calculate the lightmap dimensions\n    return {\n      width: Math.ceil(maxU / 16) - Math.floor(minU / 16) + 1,\n      height: Math.ceil(maxV / 16) - Math.floor(minV / 16) + 1,\n      minU: Math.floor(minU),\n      minV: Math.floor(minV)\n    }\n  }\n\n  private readLightmap(\n    offset: number,\n    width: number,\n    height: number\n  ): {x: number, y: number} | null {\n    if (height <= 0 || width <= 0) {\n      return null\n    }\n\n    const block = this.findFreeSpace(width, height)\n\n    if (block) {\n      const o = [block.x, block.y]\n      const s = [width, height]\n      const d = [BspLightmapParser.TEXTURE_SIZE, BspLightmapParser.TEXTURE_SIZE]\n      const count = width * height\n      for (let i = 0; i < count; ++i) {\n        const p = o[1] * d[0] + o[0] + d[0] * Math.floor(i / s[0]) + (i % s[0])\n        this.texture[p * 4] = Math.min(255, this.lightmap[offset + i * 3] * 2)\n        this.texture[p * 4 + 1] = Math.min(\n          255,\n          this.lightmap[offset + i * 3 + 1] * 2\n        )\n        this.texture[p * 4 + 2] = Math.min(\n          255,\n          this.lightmap[offset + i * 3 + 2] * 2\n        )\n        this.texture[p * 4 + 3] = 255\n      }\n    }\n\n    return block\n  }\n\n  private findFreeSpace(w: number, h: number): { x: number; y: number } | null {\n    let x = 0\n    let y = 0\n\n    let bestHeight = BspLightmapParser.TEXTURE_SIZE\n    for (let i = 0; i < this.block.length - w; ++i) {\n      let tentativeHeight = 0\n\n      let j\n      for (j = 0; j < w; ++j) {\n        if (this.block[i + j] >= bestHeight) {\n          break\n        }\n        if (this.block[i + j] > tentativeHeight) {\n          tentativeHeight = this.block[i + j]\n        }\n      }\n\n      if (j === w) {\n        x = i\n        y = bestHeight = tentativeHeight\n      }\n    }\n\n    if (bestHeight + h > BspLightmapParser.TEXTURE_SIZE) {\n      return null\n    }\n\n    for (let i = 0; i < w; ++i) {\n      this.block[x + i] = bestHeight + h\n    }\n\n    return { x, y }\n  }\n}\n","import { vec2 } from 'gl-matrix'\n\nexport class Mouse {\n  click: boolean = false\n  leftClick: boolean = false\n  rightClick: boolean = false\n  position: vec2 = vec2.create()\n  delta: vec2 = vec2.create()\n}\n","import { vec2 } from 'gl-matrix'\n\nexport class Touch {\n  pressed: boolean = false\n  position: vec2 = vec2.create()\n  delta: vec2 = vec2.create()\n}\n","import { glMatrix, vec3, mat4 } from 'gl-matrix'\n\nexport class Camera {\n  static init(aspect: number) {\n    return new Camera(aspect)\n  }\n\n  projectionMatrix: mat4 = mat4.create()\n  aspect: number\n  fov: number = glMatrix.toRadian(60)\n  near: number = 1.0\n  far: number = 8192.0\n\n  viewMatrix: mat4 = mat4.create()\n  position = vec3.create()\n  rotation = vec3.create()\n\n  private constructor(aspect: number) {\n    this.aspect = aspect\n    this.updateProjectionMatrix()\n  }\n\n  updateProjectionMatrix() {\n    mat4.perspective(\n      this.projectionMatrix,\n      this.fov,\n      this.aspect,\n      this.near,\n      this.far\n    )\n  }\n\n  updateViewMatrix() {\n    mat4.identity(this.viewMatrix)\n    mat4.rotateX(\n      this.viewMatrix,\n      this.viewMatrix,\n      this.rotation[0] - Math.PI / 2\n    )\n    mat4.rotateZ(\n      this.viewMatrix,\n      this.viewMatrix,\n      Math.PI / 2 - this.rotation[1]\n    )\n    mat4.translate(this.viewMatrix, this.viewMatrix, [\n      -this.position[0],\n      -this.position[1],\n      -this.position[2]\n    ])\n  }\n}\n","export class Keyboard {\n  keys: Uint8Array\n\n  constructor() {\n    this.keys = new Uint8Array(256)\n    for (let i = 0; i < 256; ++i) {\n      this.keys[0] = 0\n    }\n  }\n}\n\nexport namespace Keyboard {\n  export enum KEYS {\n    A = 'A'.charCodeAt(0),\n    B = 'B'.charCodeAt(0),\n    C = 'C'.charCodeAt(0),\n    D = 'D'.charCodeAt(0),\n    E = 'E'.charCodeAt(0),\n    F = 'F'.charCodeAt(0),\n    G = 'G'.charCodeAt(0),\n    H = 'H'.charCodeAt(0),\n    I = 'I'.charCodeAt(0),\n    J = 'J'.charCodeAt(0),\n    K = 'K'.charCodeAt(0),\n    L = 'L'.charCodeAt(0),\n    M = 'M'.charCodeAt(0),\n    N = 'N'.charCodeAt(0),\n    O = 'O'.charCodeAt(0),\n    P = 'P'.charCodeAt(0),\n    Q = 'Q'.charCodeAt(0),\n    R = 'R'.charCodeAt(0),\n    S = 'S'.charCodeAt(0),\n    T = 'T'.charCodeAt(0),\n    U = 'U'.charCodeAt(0),\n    V = 'V'.charCodeAt(0),\n    W = 'W'.charCodeAt(0),\n    X = 'X'.charCodeAt(0),\n    Y = 'Y'.charCodeAt(0),\n    Z = 'Z'.charCodeAt(0),\n    CTRL = 17,\n    ALT = 18,\n    SPACE = 32\n  }\n}\n","export interface Program {\n  handle: WebGLProgram\n  attributes: { [name: string]: number }\n  uniforms: { [name: string]: WebGLUniformLocation }\n}\n\nexport enum ShaderType {\n  VERTEX,\n  FRAGMENT\n}\n\nexport class Context {\n  public static init(canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext('webgl', {\n      alpha: false\n    })\n    if (!gl) {\n      console.error('Failed to get WebGL context')\n      return null\n    }\n    return new Context(gl)\n  }\n\n  public static checkWebGLSupport() {\n    const MESSAGES = {\n      BAD_BROWSER: 'Your browser does not seem to support WebGL',\n      BAD_GPU: 'Your graphics card does not seem to support WebGL'\n    }\n\n    const wnd: any = window\n    if (!wnd.WebGLRenderingContext) {\n      return {\n        hasSupport: false,\n        message: MESSAGES.BAD_BROWSER\n      }\n    }\n\n    const c = document.createElement('canvas')\n    try {\n      const ctx = c.getContext('webgl') || c.getContext('experimental-webgl')\n      if (ctx) {\n        return {\n          hasSupport: true,\n          message: ''\n        }\n      } else {\n        return {\n          hasSupport: false,\n          message: MESSAGES.BAD_GPU\n        }\n      }\n    } catch (e) {\n      return {\n        hasSupport: false,\n        message: MESSAGES.BAD_GPU\n      }\n    }\n  }\n\n  readonly gl: WebGLRenderingContext\n\n  private constructor(gl: WebGLRenderingContext) {\n    this.gl = gl\n  }\n\n  createProgram(params: {\n    vertexShaderSrc: string\n    fragmentShaderSrc: string\n    attributeNames: string[]\n    uniformNames: string[]\n  }): Program | null {\n    const gl = this.gl\n    var program = gl.createProgram()\n    if (!program) {\n      console.error('Failed to create WebGL program')\n      return null\n    }\n\n    const vertexShader = this.createShader({\n      source: params.vertexShaderSrc,\n      type: ShaderType.VERTEX\n    })\n    if (!vertexShader) {\n      console.error('Failed to compile vertex shader')\n      return null\n    }\n    const fragmentShader = this.createShader({\n      source: params.fragmentShaderSrc,\n      type: ShaderType.FRAGMENT\n    })\n    if (!fragmentShader) {\n      console.error('Failed to compile fragment shader')\n      return null\n    }\n\n    gl.attachShader(program, vertexShader)\n    gl.attachShader(program, fragmentShader)\n    gl.linkProgram(program)\n    gl.validateProgram(program)\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      gl.deleteProgram(program)\n      gl.deleteShader(vertexShader)\n      gl.deleteShader(fragmentShader)\n\n      const reason = gl.getProgramInfoLog(program)\n      console.error(`Could not initialize shader: ${reason}`)\n      return null\n    }\n\n    if (!gl.getProgramParameter(program, gl.VALIDATE_STATUS)) {\n      gl.deleteProgram(program)\n      gl.deleteShader(vertexShader)\n      gl.deleteShader(fragmentShader)\n\n      const reason = gl.getProgramInfoLog(program)\n      console.error(`Could not initialize shader: ${reason}`)\n      return null\n    }\n\n    gl.useProgram(program)\n\n    const attributes: { [name: string]: number } = {}\n    for (let i = 0; i < params.attributeNames.length; ++i) {\n      const name = params.attributeNames[i]\n      const attr = gl.getAttribLocation(program, name)\n      if (attr === -1) {\n        console.error(`gl.getAttribLocation failed for attrib named \"${name}\"`)\n        gl.deleteProgram(program)\n        return null\n      }\n      attributes[name] = attr\n    }\n\n    const uniforms: { [name: string]: WebGLUniformLocation } = {}\n    for (let i = 0; i < params.uniformNames.length; ++i) {\n      const name = params.uniformNames[i]\n      const uniform = gl.getUniformLocation(program, name)\n      if (uniform === null) {\n        console.error(\n          `gl.getUniformLocation failed for uniform named \"${name}\"`\n        )\n        gl.deleteProgram(program)\n        return null\n      }\n      uniforms[name] = uniform\n    }\n\n    return {\n      handle: program,\n      attributes,\n      uniforms\n    }\n  }\n\n  createShader(params: { source: string; type: ShaderType }) {\n    const gl = this.gl\n    const shader =\n      params.type === ShaderType.VERTEX\n        ? gl.createShader(gl.VERTEX_SHADER)\n        : gl.createShader(gl.FRAGMENT_SHADER)\n    if (!shader) {\n      console.error('Failed to create shader program')\n      return null\n    }\n    gl.shaderSource(shader, params.source)\n    gl.compileShader(shader)\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.error(gl.getShaderInfoLog(shader))\n      gl.deleteShader(shader)\n      return null\n    }\n\n    return shader\n  }\n\n  getAnisotropyExtension(): EXT_texture_filter_anisotropic | null {\n    return (\n      this.gl.getExtension('EXT_texture_filter_anisotropic') ||\n      this.gl.getExtension('MOZ_EXT_texture_filter_anisotropic') ||\n      this.gl.getExtension('WEBKIT_EXT_texture_filter_anisotropic')\n    )\n  }\n\n  getMaxAnisotropy(extension: EXT_texture_filter_anisotropic) {\n    return this.gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)\n  }\n}\n","import { evt } from './Util'\r\nimport { Game } from './Game'\r\nimport { glMatrix } from 'gl-matrix'\r\nimport { Replay } from './Replay/Replay'\r\nimport { ReplayState } from './Replay/ReplayState'\r\n\r\nconst updateGame = (game: Game, state: ReplayState) => {\r\n  game.camera.position[0] = state.cameraPos[0]\r\n  game.camera.position[1] = state.cameraPos[1]\r\n  game.camera.position[2] = state.cameraPos[2]\r\n  game.camera.rotation[0] = glMatrix.toRadian(state.cameraRot[0])\r\n  game.camera.rotation[1] = glMatrix.toRadian(state.cameraRot[1])\r\n  game.camera.rotation[2] = glMatrix.toRadian(state.cameraRot[2])\r\n}\r\n\r\nexport class ReplayPlayer extends EventTarget{\r\n  game: Game\r\n  state: ReplayState\r\n  replay: any\r\n\r\n  currentMap: number = 0\r\n  currentChunk: number = 0\r\n  currentTime: number = 0\r\n  currentTick: number = 0\r\n  isPlaying: boolean = false\r\n  isPaused: boolean = false\r\n  speed: number = 1\r\n\r\n  constructor(game: Game) {\r\n    super();\r\n    this.reset()\r\n    this.game = game\r\n    this.state = new ReplayState()\r\n    this.replay = null\r\n  }\r\n\r\n  reset() {\r\n    this.currentMap = 0\r\n    this.currentChunk = 0\r\n    this.currentTime = 0\r\n    this.currentTick = 0\r\n\r\n    this.isPlaying = false\r\n    this.isPaused = false\r\n    this.speed = 1\r\n\r\n    if (this.replay) {\r\n      let firstChunk = this.replay.maps[0].chunks[0]\r\n      firstChunk.reader.seek(0)\r\n      this.state = firstChunk.state.clone()\r\n    }\r\n  }\r\n\r\n  on(eventName: string, callback: any) {\r\n    return this.addEventListener(eventName, callback)\r\n  }\r\n\r\n  off(eventName: string, callback: any) {\r\n    this.removeEventListener(eventName, callback)\r\n  }\r\n\r\n  changeReplay(replay: Replay) {\r\n    this.replay = replay\r\n    this.reset()\r\n  }\r\n\r\n  play() {\r\n    if (!this.isPlaying) {\r\n      this.isPlaying = true\r\n    } else if (this.isPaused) {\r\n      this.isPaused = false\r\n    }\r\n\r\n    this.dispatchEvent(evt('play'));\r\n  }\r\n\r\n  pause() {\r\n    if (this.isPlaying) {\r\n      this.isPaused = true\r\n    }\r\n\r\n    this.dispatchEvent(evt('pause'));\r\n  }\r\n\r\n  stop() {\r\n    this.reset()\r\n    this.dispatchEvent(evt('stop'));\r\n  }\r\n\r\n  speedUp() {\r\n    this.speed = Math.min(this.speed * 2, 4)\r\n  }\r\n\r\n  speedDown() {\r\n    this.speed = Math.max(this.speed / 2, 0.25)\r\n  }\r\n\r\n  seek(value: number) {\r\n    let t = Math.max(0, Math.min(this.replay.length, value))\r\n\r\n    let maps = this.replay.maps\r\n    for (let i = 0; i < maps.length; ++i) {\r\n      let chunks = maps[i].chunks\r\n      for (let j = 0; j < chunks.length; ++j) {\r\n        let chunk = chunks[j]\r\n        let startTime = chunk.startTime\r\n        let timeLimit = startTime + chunk.timeLength\r\n        if (t >= startTime && t < timeLimit) {\r\n          this.currentMap = i\r\n          this.currentChunk = j\r\n          this.currentTime = t\r\n\r\n          this.state = chunk.state.clone()\r\n          let deltaDecoders = this.replay.deltaDecoders\r\n          let customMessages = this.replay.customMessages\r\n          let r = chunk.reader\r\n          r.seek(0)\r\n          while (true) {\r\n            let offset = r.tell()\r\n            let frame = Replay.readFrame(r, deltaDecoders, customMessages)\r\n            if (frame.time <= t) {\r\n              this.state.feedFrame(frame)\r\n              this.currentTick = frame.tick\r\n            } else {\r\n              r.seek(offset)\r\n              break\r\n            }\r\n          }\r\n\r\n          updateGame(this.game, this.state)\r\n\r\n          return\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  seekByPercent(value: number) {\r\n    value = Math.max(0, Math.min(value, 100)) / 100\r\n    value *= this.replay.length\r\n    this.seek(value)\r\n  }\r\n\r\n  update(dt: number) {\r\n    if (!this.isPlaying || this.isPaused) {\r\n      return\r\n    }\r\n\r\n    let deltaDecoders = this.replay.deltaDecoders\r\n    let customMessages = this.replay.customMessages\r\n\r\n    let map = this.replay.maps[this.currentMap]\r\n    let chunk = map.chunks[this.currentChunk]\r\n    let r = chunk.reader\r\n\r\n    let endTime = this.currentTime + dt * this.speed\r\n\r\n    let hitStop = false\r\n\r\n    while (true) {\r\n      let offset = r.tell()\r\n      if (offset >= chunk.data.length) {\r\n        if (this.currentChunk === map.chunks.length - 1) {\r\n          if (this.currentMap === this.replay.maps.length - 1) {\r\n            hitStop = true\r\n            break\r\n          } else {\r\n            this.currentChunk = 0\r\n            this.currentMap++\r\n            map = this.replay.maps[this.currentMap]\r\n            chunk = map.chunks[this.currentChunk]\r\n          }\r\n        } else {\r\n          this.currentChunk++\r\n          chunk = map.chunks[this.currentChunk]\r\n        }\r\n\r\n        r = chunk.reader\r\n        r.seek(0)\r\n        offset = 0\r\n\r\n        continue\r\n      }\r\n\r\n      let sounds: any[] = this.game.sounds\r\n      let frame: any = Replay.readFrame(r, deltaDecoders, customMessages)\r\n      if (frame.type < 2) {\r\n        for (let i = 0; i < frame.data.length; ++i) {\r\n          let message = frame.data[i]\r\n          if (message.type === 6) {\r\n            // TODO: Magic number SVC_SOUND\r\n            let msgSound = message.data\r\n            let sound = sounds.find((s: any) => s.index === msgSound.soundIndex)\r\n            if (sound && sound.name !== 'common/null.wav') {\r\n              let channel = msgSound.channel\r\n              let volume = msgSound.volume\r\n              // TODO: Positional audio\r\n              this.game.soundSystem.play(sound, channel, volume)\r\n            }\r\n          } else if (message.type === 29) {\r\n            // TODO: Magic number\r\n            let msgSound = message.data\r\n            let sound = sounds.find((s: any) => s.index === msgSound.soundIndex)\r\n            if (sound && sound.name !== 'common/null.wav') {\r\n              // TODO: Use after implementing positional audio\r\n              // let volume = msgSound.volume\r\n              // this.game.soundSystem.play(sound, 6, volume)\r\n            }\r\n          } else if (message.type === 9) {\r\n            message.data.commands.forEach((command: any) => {\r\n              switch (command.func) {\r\n                case 'speak':\r\n                case 'spk':\r\n                case 'play': {\r\n                  let soundName = command.params[0] + '.wav'\r\n                  let sound = sounds.find((s: any) => s.name === soundName)\r\n                  if (!sound) {\r\n                    return\r\n                  }\r\n\r\n                  this.game.soundSystem.play(sound, 1, 0.7)\r\n                  break\r\n                }\r\n                case 'playvol': {\r\n                  let soundName = command.params[0] + '.wav'\r\n                  let volume\r\n                  if (isNaN(command.params[1])) {\r\n                    volume = 1\r\n                  } else {\r\n                    volume = parseFloat(command.params[1])\r\n                  }\r\n                  let sound = sounds.find((s: any) => s.name === soundName)\r\n                  if (!sound) {\r\n                    return\r\n                  }\r\n\r\n                  this.game.soundSystem.play(sound, 1, volume)\r\n                  break\r\n                }\r\n              }\r\n            })\r\n          }\r\n        }\r\n      } else if (frame.type === 8) {\r\n        let sample = frame.sound.sample\r\n        let sound = sounds.find(s => s.name === sample)\r\n        if (sound && sound.name !== 'common/null.wav') {\r\n          let channel = frame.sound.channel\r\n          let volume = frame.sound.volume\r\n          this.game.soundSystem.play(sound, channel, volume)\r\n        }\r\n      }\r\n      if (frame.time <= endTime) {\r\n        this.state.feedFrame(frame)\r\n        this.currentTick = frame.tick\r\n      } else {\r\n        r.seek(offset)\r\n        break\r\n      }\r\n    }\r\n\r\n    updateGame(this.game, this.state)\r\n\r\n    this.currentTime = endTime\r\n\r\n    if (hitStop) {\r\n      this.stop()\r\n    }\r\n  }\r\n}\r\n","import { Context } from './Context'\n\nexport class Renderer {\n  static init(context: Context): Renderer | null {\n    const gl = context.gl\n\n    gl.clearColor(0.0, 0.0, 0.0, 1.0)\n    gl.clearDepth(1.0)\n    gl.enable(gl.DEPTH_TEST)\n    gl.depthFunc(gl.LEQUAL)\n\n    gl.enable(gl.BLEND)\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n\n    gl.enable(gl.CULL_FACE)\n    gl.cullFace(gl.FRONT)\n\n    return new Renderer({ context })\n  }\n\n  private context: Context\n\n  private constructor(params: { context: Context }) {\n    this.context = params.context\n  }\n\n  draw = () => {\n    const gl = this.context.gl\n\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n  }\n}\n","import { Bsp } from '../Bsp'\nimport { Tga } from '../Parsers/Tga'\nimport { Camera } from './Camera'\nimport { Context } from './Context'\nimport { SkyShader } from './SkyShader/SkyShader'\n\nexport class SkyScene {\n  static init(context: Context): SkyScene | null {\n    const shader = SkyShader.init(context)\n    if (!shader) {\n      console.error(\"skyscenen't\")\n      return null\n    }\n\n    return new SkyScene({ context, shader })\n  }\n\n  private context: Context\n  private shader: SkyShader\n  private vertexBuffer: WebGLBuffer | null = null\n  private indexBuffer: WebGLBuffer | null = null\n  private texture: WebGLTexture | null = null\n  private isReady: boolean = false\n\n  private constructor(params: { context: Context; shader: SkyShader }) {\n    this.context = params.context\n    this.shader = params.shader\n  }\n\n  changeMap(bsp: Bsp) {\n    if (bsp.skies.length !== 6) {\n      this.isReady = false\n      return\n    }\n\n    const gl = this.context.gl\n    const vertexBuffer = gl.createBuffer()\n    const indexBuffer = gl.createBuffer()\n    const texture = gl.createTexture()\n    if (!vertexBuffer || !indexBuffer || !texture) {\n      // TODO\n      throw new Error('shouldnt happen')\n    }\n\n    // prettier-ignore\n    const indices = new Uint8Array([\n      0,  1,  2,      0,  2,  3,    // front\n      4,  5,  6,      4,  6,  7,    // back\n      8,  9,  10,     8,  10, 11,   // top\n      12, 13, 14,     12, 14, 15,   // bottom\n      16, 17, 18,     16, 18, 19,   // right\n      20, 21, 22,     20, 22, 23,   // left\n    ])\n    // prettier-ignore\n    const vertices = new Float32Array([\n      // Top face\n      -1.0, -1.0,  1.0, 0.499, 0.001,\n       1.0, -1.0,  1.0, 0.499, 0.249,\n       1.0,  1.0,  1.0, 0.001, 0.249,\n      -1.0,  1.0,  1.0, 0.001, 0.001,\n\n      // Bottom face\n      -1.0, -1.0, -1.0, 0.499, 0.749,\n      -1.0,  1.0, -1.0, 0.001, 0.749,\n       1.0,  1.0, -1.0, 0.001, 0.501,\n       1.0, -1.0, -1.0, 0.499, 0.501,\n\n      // Front face\n      -1.0,  1.0, -1.0, 0.501, 0.749,\n      -1.0,  1.0,  1.0, 0.501, 0.501,\n       1.0,  1.0,  1.0, 0.999, 0.501,\n       1.0,  1.0, -1.0, 0.999, 0.749,\n\n      // Back face\n      -1.0, -1.0, -1.0, 0.999, 0.249,\n       1.0, -1.0, -1.0, 0.501, 0.249,\n       1.0, -1.0,  1.0, 0.501, 0.001,\n      -1.0, -1.0,  1.0, 0.999, 0.001,\n\n      // Right face\n       1.0, -1.0, -1.0, 0.499, 0.499,\n       1.0,  1.0, -1.0, 0.001, 0.499,\n       1.0,  1.0,  1.0, 0.001, 0.251,\n       1.0, -1.0,  1.0, 0.499, 0.251,\n\n      // Left face\n      -1.0, -1.0, -1.0, 0.501, 0.499,\n      -1.0, -1.0,  1.0, 0.501, 0.251,\n      -1.0,  1.0,  1.0, 0.999, 0.251,\n      -1.0,  1.0, -1.0, 0.999, 0.499\n    ].map((a, i) => ((i % 5) < 3) ? a * 4096 : a))\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer)\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW)\n    gl.enableVertexAttribArray(0)\n\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer)\n    gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, indices, gl.STATIC_DRAW)\n\n    const canvas = document.createElement('canvas')\n    canvas.width = 512\n    canvas.height = 1024\n    const ctx = canvas.getContext('2d')\n    if (!ctx) {\n      throw new Error('sky ctx fail')\n    }\n\n    const coords: { [name: string]: number[] } = {\n      up: [0, 0],\n      rt: [0, 256],\n      dn: [0, 512],\n      ft: [256, 0],\n      lf: [256, 256],\n      bk: [256, 512]\n    }\n\n    bsp.skies.forEach((sky: Tga) => {\n      const smc = document.createElement('canvas')\n      const smctx = smc.getContext('2d')\n      if (!smctx) {\n        throw new Error('Runtime error.')\n      }\n      smc.width = sky.width\n      smc.height = sky.height\n      const imageData = smctx.getImageData(0, 0, smc.width, smc.height)\n      for (let i = 0; i < sky.data.length; ++i) {\n        imageData.data[i] = sky.data[i]\n      }\n      smctx.putImageData(imageData, 0, 0)\n\n      const side = sky.name.slice(-2)\n      const c = coords[side] ? coords[side] : []\n\n      // TODO: remove this check\n      if (!ctx) {\n        throw new Error('Runtime error.')\n      }\n      ctx.drawImage(smc, c[0], c[1])\n    })\n\n    const pixelData = ctx.getImageData(0, 0, 512, 1024).data\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      512,\n      1024,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      new Uint8Array(pixelData)\n    )\n    gl.generateMipmap(gl.TEXTURE_2D)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n    gl.texParameteri(\n      gl.TEXTURE_2D,\n      gl.TEXTURE_MIN_FILTER,\n      gl.LINEAR_MIPMAP_LINEAR\n    )\n    gl.texParameterf(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n    const anisotropy = this.context.getAnisotropyExtension()\n    if (anisotropy) {\n      gl.texParameteri(\n        gl.TEXTURE_2D,\n        anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\n        this.context.getMaxAnisotropy(anisotropy)\n      )\n    }\n\n    this.vertexBuffer = vertexBuffer\n    this.indexBuffer = indexBuffer\n    this.texture = texture\n    this.isReady = true\n  }\n\n  draw(camera: Camera) {\n    if (!this.isReady) {\n      return\n    }\n\n    const gl = this.context.gl\n    const shader = this.shader\n\n    shader.useProgram(gl)\n    gl.bindTexture(gl.TEXTURE_2D, this.texture)\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexBuffer)\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer)\n    shader.enableVertexAttribs(gl)\n    shader.setVertexAttribPointers(gl)\n    shader.setDiffuse(gl, 0)\n\n    const x = camera.position[0]\n    const y = camera.position[1]\n    const z = camera.position[2]\n    camera.position[0] = 0\n    camera.position[1] = 0\n    camera.position[2] = 0\n    camera.updateViewMatrix()\n    camera.position[0] = x\n    camera.position[1] = y\n    camera.position[2] = z\n\n    shader.setViewMatrix(gl, camera.viewMatrix)\n    shader.setProjectionMatrix(gl, camera.projectionMatrix)\n\n    gl.drawElements(gl.TRIANGLES, 36, gl.UNSIGNED_BYTE, 0)\n    gl.clear(gl.DEPTH_BUFFER_BIT)\n  }\n}\n","import { mat4 } from 'gl-matrix'\nimport { Context, Program } from '../Context'\n\nconst fragmentSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  gl_FragColor = vec4(diffuseColor.rgb, 1.0);\n}`\n\nconst vertexSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\n\nvarying vec2 vTexCoord;\n\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  gl_Position = projectionMatrix * viewMatrix * vec4(position, 1);\n}`\n\nexport class SkyShader {\n  static init(context: Context): SkyShader | null {\n    const attributeNames = ['position', 'texCoord']\n    const uniformNames: string[] = ['viewMatrix', 'projectionMatrix', 'diffuse']\n    const program = context.createProgram({\n      vertexShaderSrc: vertexSrc,\n      fragmentShaderSrc: fragmentSrc,\n      attributeNames,\n      uniformNames\n    })\n    if (!program) {\n      console.error(`Failed to create sky shader program`)\n      return null\n    }\n\n    return new SkyShader(program)\n  }\n\n  private program: WebGLProgram\n  private aPosition: number\n  private aTexCoord: number\n  private uViewMx: WebGLUniformLocation\n  private uProjectionMx: WebGLUniformLocation\n  private uDiffuse: WebGLUniformLocation\n\n  private constructor(program: Program) {\n    this.program = program.handle\n    this.aPosition = program.attributes['position']\n    this.aTexCoord = program.attributes['texCoord']\n    this.uViewMx = program.uniforms['viewMatrix']\n    this.uProjectionMx = program.uniforms['projectionMatrix']\n    this.uDiffuse = program.uniforms['diffuse']\n  }\n\n  useProgram(gl: WebGLRenderingContext) {\n    gl.useProgram(this.program)\n  }\n\n  setViewMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uViewMx, false, matrix)\n  }\n\n  setProjectionMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uProjectionMx, false, matrix)\n  }\n\n  setDiffuse(gl: WebGLRenderingContext, value: number) {\n    gl.uniform1i(this.uDiffuse, value)\n  }\n\n  enableVertexAttribs(gl: WebGLRenderingContext) {\n    gl.enableVertexAttribArray(this.aPosition)\n    gl.enableVertexAttribArray(this.aTexCoord)\n  }\n\n  setVertexAttribPointers(gl: WebGLRenderingContext) {\n    gl.vertexAttribPointer(this.aPosition, 3, gl.FLOAT, false, 5 * 4, 0)\n    gl.vertexAttribPointer(this.aTexCoord, 2, gl.FLOAT, false, 5 * 4, 3 * 4)\n  }\n}\n","import { mat4, vec3 } from 'gl-matrix'\nimport { Bsp } from '../Bsp'\nimport { Camera } from './Camera'\nimport { Context } from './Context'\nimport { MainShader } from './WorldShader/WorldShader'\nimport { RenderMode } from '../Parsers/BspEntityParser'\nimport { Sprite, SpriteType } from '../Parsers/Sprite'\nimport { isPowerOfTwo, nextPowerOfTwo, resizeTexture } from './Util'\n\ntype FaceInfo = {\n  offset: number\n  length: number\n  textureIndex: number\n}\ntype ModelInfo = {\n  origin: number[]\n  offset: number\n  length: number\n  isTransparent: boolean\n  faces: FaceInfo[]\n}\ntype SceneInfo = {\n  length: number\n  data: Float32Array\n  models: ModelInfo[]\n}\n\nexport class WorldScene {\n  static init(context: Context) {\n    const shader = MainShader.init(context)\n    if (!shader) {\n      console.error('Failed to init MainShader')\n      return null\n    }\n\n    shader.useProgram(context.gl)\n\n    const buffer = context.gl.createBuffer()\n    if (!buffer) {\n      console.error('Failed to create WebGL buffer')\n      return null\n    }\n\n    return new WorldScene({ buffer, context, shader })\n  }\n\n  private buffer: WebGLBuffer\n  private context: Context\n  private shader: MainShader\n  private modelMatrix: mat4 = mat4.create()\n\n  private sceneInfo: SceneInfo = {\n    length: 0,\n    data: new Float32Array(0),\n    models: []\n  }\n  private bsp: Bsp | null = null\n  private textures: {\n    name: string\n    width: number\n    height: number\n    data: Uint8Array\n    handle: WebGLTexture\n  }[] = []\n  private sprites: { [name: string]: Sprite } = {}\n  private lightmap: {\n    data: Uint8Array\n    handle: WebGLTexture\n  } | null = null\n  private constructor(params: {\n    context: Context\n    buffer: WebGLBuffer\n    shader: MainShader\n  }) {\n    this.buffer = params.buffer\n    this.context = params.context\n    this.shader = params.shader\n  }\n\n  changeMap(bsp: Bsp) {\n    this.fillBuffer(bsp)\n    this.loadTextures(bsp)\n    this.loadSpriteTextures(bsp)\n    this.loadLightmap(bsp)\n    this.bsp = bsp\n  }\n\n  private fillBuffer(bsp: Bsp) {\n    const gl = this.context.gl\n    const models = bsp.models\n\n    const INVISIBLE_TEXTURES = [\n      'aaatrigger',\n      'clip',\n      'null',\n      'hint',\n      'nodraw',\n      'invisible',\n      'skip',\n      'trigger',\n      'sky',\n      'fog'\n    ]\n\n    // get total buffer size\n    let size = 0\n    for (let i = 0; i < models.length; ++i) {\n      const model = models[i]\n      for (let j = 0; j < model.faces.length; ++j) {\n        const texture = bsp.textures[model.faces[j].textureIndex]\n        if (INVISIBLE_TEXTURES.indexOf(texture.name) > -1) {\n          continue\n        }\n\n        size += model.faces[j].buffer.length\n      }\n    }\n\n    // add 6 vertex for a single quad that will be used to render sprites\n    size += 7 * 6\n\n    // init scene info structure and buffer with the appropriate size\n    const sceneInfo: SceneInfo = {\n      length: size,\n      data: new Float32Array(size),\n      models: []\n    }\n\n    // fill the scene info structure\n    let currentVertex = 0\n    for (let i = 0; i < bsp.models.length; ++i) {\n      const model = bsp.models[i]\n      const modelInfo: ModelInfo = {\n        origin: model.origin,\n        offset: currentVertex,\n        length: 0,\n        isTransparent: false,\n        faces: []\n      }\n\n      for (let j = 0; j < model.faces.length; ++j) {\n        const texture = bsp.textures[model.faces[j].textureIndex]\n        if (INVISIBLE_TEXTURES.indexOf(texture.name) > -1) {\n          continue\n        }\n\n        const faceInfo: FaceInfo = {\n          offset: currentVertex,\n          length: 0,\n          textureIndex: -1\n        }\n\n        for (let k = 0; k < model.faces[j].buffer.length; ++k) {\n          sceneInfo.data[currentVertex++] = model.faces[j].buffer[k]\n        }\n\n        if (\n          !modelInfo.isTransparent &&\n          bsp.textures[model.faces[j].textureIndex].name[0] === '{'\n        ) {\n          modelInfo.isTransparent = true\n        }\n\n        faceInfo.textureIndex = model.faces[j].textureIndex\n        faceInfo.length = currentVertex - faceInfo.offset\n        modelInfo.faces.push(faceInfo)\n      }\n\n      modelInfo.length = currentVertex - modelInfo.offset\n      sceneInfo.models.push(modelInfo)\n    }\n\n    // set data of the last quad used for rendering sprites\n    sceneInfo.models.push({\n      origin: [0, 0, 0],\n      offset: currentVertex,\n      length: 4,\n      isTransparent: false, // unused\n      faces: [\n        {\n          offset: currentVertex,\n          length: 4,\n          textureIndex: 0 // unused\n        }\n      ]\n    })\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = -0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 1\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0.5\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n    sceneInfo.data[currentVertex++] = 0\n\n    // sort each model's face in scene info structure by texture index\n    // and merge faces with same texture to lower draw calls\n    currentVertex = 0\n    const sortedSceneInfo: SceneInfo = {\n      data: new Float32Array(sceneInfo.data),\n      length: sceneInfo.length,\n      models: sceneInfo.models.map(model => ({\n        origin: [...model.origin],\n        offset: model.offset,\n        length: model.length,\n        isTransparent: model.isTransparent,\n        faces: model.faces.map(face => ({\n          offset: face.offset,\n          length: face.length,\n          textureIndex: face.textureIndex\n        }))\n      }))\n    }\n    for (let i = 0; i < sortedSceneInfo.models.length; ++i) {\n      const model = sortedSceneInfo.models[i]\n      model.faces.sort((a, b) => a.textureIndex - b.textureIndex)\n\n      for (let j = 0; j < model.faces.length; ++j) {\n        const face = model.faces[j]\n        const newOffset = currentVertex\n\n        for (let k = 0; k < face.length; ++k) {\n          sortedSceneInfo.data[currentVertex] = sceneInfo.data[face.offset + k]\n          currentVertex += 1\n        }\n\n        face.offset = newOffset\n      }\n\n      const newFaces: FaceInfo[] = []\n      let currentTextureIndex = -1\n      for (let j = 0; j < model.faces.length; ++j) {\n        const face = model.faces[j]\n\n        if (face.textureIndex === currentTextureIndex) {\n          newFaces[newFaces.length - 1].length += face.length\n        } else {\n          // merge\n          newFaces.push({\n            offset: face.offset,\n            length: face.length,\n            textureIndex: face.textureIndex\n          })\n          currentTextureIndex = face.textureIndex\n        }\n      }\n      model.faces = newFaces\n    }\n    this.sceneInfo = sortedSceneInfo\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer)\n    gl.bufferData(gl.ARRAY_BUFFER, this.sceneInfo.data, gl.STATIC_DRAW)\n  }\n\n  private loadTextures(bsp: Bsp) {\n    const gl = this.context.gl\n\n    for (let i = 0; i < bsp.textures.length; ++i) {\n      const glTexture = gl.createTexture()\n      if (!glTexture) {\n        // shouldnt happen\n        // TODO: handle better\n        throw new Error('fatal error')\n      }\n\n      const texture = bsp.textures[i]\n      if (!isPowerOfTwo(texture.width) || !isPowerOfTwo(texture.height)) {\n        const w = texture.width\n        const h = texture.height\n        const nw = nextPowerOfTwo(texture.width)\n        const nh = nextPowerOfTwo(texture.height)\n        texture.data = resizeTexture(texture.data, w, h, nw, nh)\n        texture.width = nw\n        texture.height = nh\n      }\n\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        texture.width,\n        texture.height,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        texture.data\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n      gl.texParameteri(\n        gl.TEXTURE_2D,\n        gl.TEXTURE_MIN_FILTER,\n        gl.LINEAR_MIPMAP_LINEAR\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n      gl.generateMipmap(gl.TEXTURE_2D)\n\n      const anisotropy = this.context.getAnisotropyExtension()\n      if (anisotropy) {\n        gl.texParameteri(\n          gl.TEXTURE_2D,\n          anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\n          this.context.getMaxAnisotropy(anisotropy)\n        )\n      }\n\n      this.textures.push({\n        name: texture.name,\n        width: texture.width,\n        height: texture.height,\n        data: texture.data,\n        handle: glTexture\n      })\n    }\n  }\n\n  private loadSpriteTextures(bsp: Bsp) {\n    const gl = this.context.gl\n\n    for (const [name, sprite] of Object.entries(bsp.sprites)) {\n      const glTexture = gl.createTexture()\n      if (!glTexture) {\n        // shouldnt happen\n        // TODO: handle better\n        throw new Error('fatal error')\n      }\n\n      const texture = sprite.frames[0]\n      if (!isPowerOfTwo(texture.width) || !isPowerOfTwo(texture.height)) {\n        const w = texture.width\n        const h = texture.height\n        const nw = nextPowerOfTwo(texture.width)\n        const nh = nextPowerOfTwo(texture.height)\n        texture.data = resizeTexture(texture.data, w, h, nw, nh)\n        texture.width = nw\n        texture.height = nh\n      }\n\n      gl.bindTexture(gl.TEXTURE_2D, glTexture)\n      gl.texImage2D(\n        gl.TEXTURE_2D,\n        0,\n        gl.RGBA,\n        texture.width,\n        texture.height,\n        0,\n        gl.RGBA,\n        gl.UNSIGNED_BYTE,\n        texture.data\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n      gl.texParameteri(\n        gl.TEXTURE_2D,\n        gl.TEXTURE_MIN_FILTER,\n        gl.LINEAR_MIPMAP_LINEAR\n      )\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n      gl.generateMipmap(gl.TEXTURE_2D)\n\n      const anisotropy = this.context.getAnisotropyExtension()\n      if (anisotropy) {\n        gl.texParameteri(\n          gl.TEXTURE_2D,\n          anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,\n          this.context.getMaxAnisotropy(anisotropy)\n        )\n      }\n\n      this.textures.push({\n        name: name,\n        width: texture.width,\n        height: texture.height,\n        data: texture.data,\n        handle: glTexture\n      })\n      this.sprites[name] = sprite\n    }\n  }\n\n  private loadLightmap(bsp: Bsp) {\n    const gl = this.context.gl\n\n    const glLightmap = gl.createTexture()\n    if (!glLightmap) {\n      // shouldnt happen\n      // TODO: handle better\n      throw new Error('fatal error')\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, glLightmap)\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGBA,\n      bsp.lightmap.width,\n      bsp.lightmap.height,\n      0,\n      gl.RGBA,\n      gl.UNSIGNED_BYTE,\n      bsp.lightmap.data\n    )\n    gl.generateMipmap(gl.TEXTURE_2D)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n    gl.texParameteri(\n      gl.TEXTURE_2D,\n      gl.TEXTURE_MIN_FILTER,\n      gl.LINEAR_MIPMAP_LINEAR\n    )\n\n    this.lightmap = {\n      data: bsp.lightmap.data,\n      handle: glLightmap\n    }\n  }\n\n  draw(camera: Camera, entities: any[]) {\n    if (!this.bsp || !this.lightmap) {\n      return\n    }\n\n    const gl = this.context.gl\n    const shader = this.shader\n\n    shader.useProgram(gl)\n\n    camera.updateProjectionMatrix()\n    camera.updateViewMatrix()\n\n    shader.setViewMatrix(gl, camera.viewMatrix)\n    shader.setProjectionMatrix(gl, camera.projectionMatrix)\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer)\n    shader.enableVertexAttribs(gl)\n    shader.setVertexAttribPointers(gl)\n\n    shader.setDiffuse(gl, 0)\n    shader.setLightmap(gl, 1)\n\n    gl.activeTexture(gl.TEXTURE1)\n    gl.bindTexture(gl.TEXTURE_2D, this.lightmap.handle)\n\n    gl.activeTexture(gl.TEXTURE0)\n\n    const opaqueEntities = []\n    const transparentEntities = []\n    for (let i = 1; i < entities.length; ++i) {\n      const e = entities[i]\n      if (e.model) {\n        if (\n          !e.rendermode ||\n          e.rendermode == RenderMode.Normal ||\n          e.rendermode == RenderMode.Solid\n        ) {\n          if (e.model[0] === '*') {\n            const model = this.sceneInfo.models[parseInt(e.model.substr(1))]\n            if (model.isTransparent) {\n              transparentEntities.push(e)\n              continue\n            }\n          } else if (e.model.indexOf('.spr') > -1) {\n            transparentEntities.push(e)\n            continue\n          }\n\n          opaqueEntities.push(e)\n        } else if (e.rendermode == RenderMode.Additive) {\n          transparentEntities.push(e)\n        } else {\n          transparentEntities.push(e)\n        }\n      }\n    }\n\n    shader.setOpacity(gl, 1.0)\n    this.renderWorldSpawn()\n    this.renderOpaqueEntities(camera, opaqueEntities)\n\n    if (transparentEntities.length) {\n      gl.depthMask(false)\n      this.renderTransparentEntities(transparentEntities, camera)\n      gl.depthMask(true)\n    }\n  }\n\n  private renderWorldSpawn() {\n    const model = this.sceneInfo.models[0]\n    const gl = this.context.gl\n\n    mat4.identity(this.modelMatrix)\n    this.shader.setModelMatrix(gl, this.modelMatrix)\n\n    for (let j = 0; j < model.faces.length; ++j) {\n      const face = model.faces[j]\n      gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\n      gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n    }\n  }\n\n  private renderOpaqueEntities(camera: Camera, entities: any[]) {\n    const gl = this.context.gl\n    const shader = this.shader\n    const mmx = this.modelMatrix\n\n    for (let i = 0; i < entities.length; ++i) {\n      const entity = entities[i]\n      const modelIndex = parseInt(entity.model.substr(1))\n      const model = this.sceneInfo.models[modelIndex]\n      if (model) {\n        const angles = entity.angles || [0, 0, 0]\n        const origin = entity.origin\n          ? vec3.fromValues(\n              entity.origin[0],\n              entity.origin[1],\n              entity.origin[2]\n            )\n          : vec3.create()\n        vec3.add(origin, origin, model.origin)\n\n        // TODO: this seems to work, but needs further research\n        mat4.identity(mmx)\n        mat4.translate(mmx, mmx, origin)\n        // mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180) // dunno this\n        mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180)\n        mat4.rotateX(\n          this.modelMatrix,\n          this.modelMatrix,\n          (angles[2] * Math.PI) / 180\n        )\n        shader.setModelMatrix(gl, this.modelMatrix)\n\n        for (let j = 0; j < model.faces.length; ++j) {\n          const face = model.faces[j]\n          gl.bindTexture(gl.TEXTURE_2D, this.textures[face.textureIndex].handle)\n          gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n        }\n      } else if (entity.model.indexOf('.spr') > -1) {\n        const texture = this.textures.find(a => a.name === entity.model)\n        const sprite = this.sprites[entity.model]\n        if (texture && sprite) {\n          const origin = entity.origin\n            ? vec3.fromValues(\n                entity.origin[0],\n                entity.origin[1],\n                entity.origin[2]\n              )\n            : vec3.create()\n          const scale = vec3.fromValues(texture.width, 1, texture.height)\n          const angles = entity.angles\n            ? vec3.fromValues(\n                entity.angles[0],\n                entity.angles[2],\n                entity.angles[1]\n              )\n            : vec3.create()\n          vec3.scale(scale, scale, entity.scale || 1)\n\n          mat4.identity(mmx)\n          mat4.translate(mmx, mmx, origin)\n\n          switch (sprite.header.type) {\n            case SpriteType.VP_PARALLEL_UPRIGHT: {\n              // TODO: incorrect, but will do for now\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.FACING_UPRIGHT: {\n              // TODO: fix incorrect\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL: {\n              mat4.rotateZ(\n                mmx,\n                mmx,\n                Math.atan2(\n                  origin[1] - camera.position[1],\n                  origin[0] - camera.position[0]\n                ) +\n                  Math.PI / 2\n              )\n              mat4.rotateX(\n                mmx,\n                mmx,\n                Math.atan2(\n                  camera.position[2] - origin[2],\n                  Math.sqrt(\n                    Math.pow(camera.position[0] - origin[0], 2) +\n                      Math.pow(camera.position[1] - origin[1], 2)\n                  )\n                )\n              )\n\n              break\n            }\n            case SpriteType.ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              mat4.rotateX(mmx, mmx, (angles[2] * Math.PI) / 180 - Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL_ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              break\n            }\n            default: {\n              throw new Error('Invalid sprite type')\n            }\n          }\n\n          mat4.scale(mmx, mmx, scale)\n          shader.setModelMatrix(gl, mmx)\n          shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n\n          const renderMode = entity.rendermode || RenderMode.Normal\n          switch (renderMode) {\n            case RenderMode.Normal: {\n              shader.setOpacity(gl, 1)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Color: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Texture: {\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Glow: {\n              // TODO: not properly implemented\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n            case RenderMode.Solid: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Additive: {\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n          }\n        }\n      }\n    }\n  }\n\n  private renderTransparentEntities(entities: any[], camera: Camera) {\n    const gl = this.context.gl\n    const shader = this.shader\n    const mmx = this.modelMatrix\n\n    // distances of all entities from the camera\n    const entityDistances: {\n      index: number\n      distance: number\n    }[] = entities\n      .map((e, i) => ({\n        index: i,\n        distance: vec3.dist(camera.position, e.origin || [0, 0, 0])\n      }))\n      .sort((a, b) => a.distance - b.distance)\n\n    for (let i = 0; i < entityDistances.length; ++i) {\n      const entity = entities[entityDistances[i].index]\n\n      const modelIndex = parseInt(entity.model.substr(1))\n      const model = this.sceneInfo.models[modelIndex]\n      if (model) {\n        const angles = entity.angles || [0, 0, 0]\n        const origin = entity.origin || [0, 0, 0]\n        origin[0] += model.origin[0]\n        origin[1] += model.origin[1]\n        origin[2] += model.origin[2]\n\n        // TODO: this seems to work, but needs further research\n        mat4.identity(mmx)\n        mat4.translate(mmx, mmx, origin)\n        mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180)\n        // mat4.rotateY(mmx, mmx, (angles[2] * Math.PI) / 180) // dunno this\n        mat4.rotateX(\n          this.modelMatrix,\n          this.modelMatrix,\n          (angles[2] * Math.PI) / 180\n        )\n        shader.setModelMatrix(gl, this.modelMatrix)\n\n        const renderMode = entity.rendermode || RenderMode.Normal\n        switch (renderMode) {\n          case RenderMode.Normal: {\n            shader.setOpacity(gl, 1)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Color: {\n            // TODO: not properly implemented\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Texture: {\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Glow: {\n            // TODO: not properly implemented\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Solid: {\n            // TODO: not properly implemented\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            break\n          }\n          case RenderMode.Additive: {\n            gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n            shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n            for (let j = 0; j < model.faces.length; ++j) {\n              const face = model.faces[j]\n              gl.bindTexture(\n                gl.TEXTURE_2D,\n                this.textures[face.textureIndex].handle\n              )\n              gl.drawArrays(gl.TRIANGLES, face.offset / 7, face.length / 7)\n            }\n            gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n            break\n          }\n        }\n      } else if (entity.model.indexOf('.spr') > -1) {\n        const texture = this.textures.find(a => a.name === entity.model)\n        const sprite = this.sprites[entity.model]\n        if (texture && sprite) {\n          const origin = entity.origin\n            ? vec3.fromValues(\n                entity.origin[0],\n                entity.origin[1],\n                entity.origin[2]\n              )\n            : vec3.create()\n          const scale = vec3.fromValues(texture.width, 1, texture.height)\n          const angles = entity.angles\n            ? vec3.fromValues(\n                entity.angles[0],\n                entity.angles[2],\n                entity.angles[1]\n              )\n            : vec3.create()\n          vec3.scale(scale, scale, entity.scale || 1)\n\n          mat4.identity(mmx)\n          mat4.translate(mmx, mmx, origin)\n\n          switch (sprite.header.type) {\n            case SpriteType.VP_PARALLEL_UPRIGHT: {\n              // TODO: incorrect, but will do for now\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.FACING_UPRIGHT: {\n              // TODO: fix incorrect\n              mat4.rotateZ(mmx, mmx, camera.rotation[1] + Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL: {\n              mat4.rotateZ(\n                mmx,\n                mmx,\n                Math.atan2(\n                  origin[1] - camera.position[1],\n                  origin[0] - camera.position[0]\n                ) +\n                  Math.PI / 2\n              )\n              mat4.rotateX(\n                mmx,\n                mmx,\n                Math.atan2(\n                  camera.position[2] - origin[2],\n                  Math.sqrt(\n                    Math.pow(camera.position[0] - origin[0], 2) +\n                      Math.pow(camera.position[1] - origin[1], 2)\n                  )\n                )\n              )\n\n              break\n            }\n            case SpriteType.ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              mat4.rotateX(mmx, mmx, (angles[2] * Math.PI) / 180 - Math.PI / 2)\n              break\n            }\n            case SpriteType.VP_PARALLEL_ORIENTED: {\n              mat4.rotateY(mmx, mmx, (angles[0] * Math.PI) / 180 + Math.PI)\n              mat4.rotateZ(mmx, mmx, (angles[1] * Math.PI) / 180 + Math.PI)\n              break\n            }\n            default: {\n              throw new Error('Invalid sprite type')\n            }\n          }\n\n          mat4.scale(mmx, mmx, scale)\n          shader.setModelMatrix(gl, mmx)\n          shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n\n          const renderMode = entity.rendermode || RenderMode.Normal\n          switch (renderMode) {\n            case RenderMode.Normal: {\n              shader.setOpacity(gl, 1)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Color: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Texture: {\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Glow: {\n              // TODO: not properly implemented\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n            case RenderMode.Solid: {\n              // TODO: not properly implemented\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              break\n            }\n            case RenderMode.Additive: {\n              gl.blendFunc(gl.SRC_ALPHA, gl.DST_ALPHA)\n              shader.setOpacity(gl, (entity.renderamt || 255) / 255)\n              gl.bindTexture(gl.TEXTURE_2D, texture.handle)\n              gl.drawArrays(\n                gl.TRIANGLES,\n                this.sceneInfo.models[this.sceneInfo.models.length - 1].offset /\n                  7,\n                6\n              )\n              gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\n              break\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","import { mat4 } from 'gl-matrix'\nimport { Context, Program } from '../Context'\n\nconst fragmentSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D diffuse;\nuniform sampler2D lightmap;\nuniform float opacity;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nvoid main(void) {\n  vec4 diffuseColor = texture2D(diffuse, vTexCoord);\n  vec4 lightColor = texture2D(lightmap, vLightmapCoord);\n\n  gl_FragColor = vec4(diffuseColor.rgb * lightColor.rgb, diffuseColor.a * opacity);\n}`\n\nconst vertexSrc = `#ifdef GL_ES\nprecision highp float;\n#endif\n\nattribute vec3 position;\nattribute vec2 texCoord;\nattribute vec2 texCoord2;\n\nvarying vec2 vTexCoord;\nvarying vec2 vLightmapCoord;\n\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void) {\n  vTexCoord = texCoord;\n  vLightmapCoord = texCoord2;\n\n  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1);\n}`\n\nexport class MainShader {\n  static init(context: Context): MainShader | null {\n    const attributeNames = ['position', 'texCoord', 'texCoord2']\n    const uniformNames: string[] = [\n      'modelMatrix',\n      'viewMatrix',\n      'projectionMatrix',\n      'diffuse',\n      'lightmap',\n      'opacity'\n    ]\n    const program = context.createProgram({\n      vertexShaderSrc: vertexSrc,\n      fragmentShaderSrc: fragmentSrc,\n      attributeNames,\n      uniformNames\n    })\n    if (!program) {\n      console.error('Failed to create MainShader program')\n      return null\n    }\n\n    return new MainShader(program)\n  }\n\n  private program: WebGLProgram\n  private aPosition: number\n  private aTexCoord: number\n  private aTexCoord2: number\n  private uModelMx: WebGLUniformLocation\n  private uViewMx: WebGLUniformLocation\n  private uProjectionMx: WebGLUniformLocation\n  private uDiffuse: WebGLUniformLocation\n  private uLightmap: WebGLUniformLocation\n  private uOpacity: WebGLUniformLocation\n\n  private constructor(program: Program) {\n    this.program = program.handle\n    this.aPosition = program.attributes['position']\n    this.aTexCoord = program.attributes['texCoord']\n    this.aTexCoord2 = program.attributes['texCoord2']\n    this.uModelMx = program.uniforms['modelMatrix']\n    this.uViewMx = program.uniforms['viewMatrix']\n    this.uProjectionMx = program.uniforms['projectionMatrix']\n    this.uDiffuse = program.uniforms['diffuse']\n    this.uLightmap = program.uniforms['lightmap']\n    this.uOpacity = program.uniforms['opacity']\n  }\n\n  useProgram(gl: WebGLRenderingContext) {\n    gl.useProgram(this.program)\n  }\n\n  setModelMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uModelMx, false, matrix)\n  }\n\n  setViewMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uViewMx, false, matrix)\n  }\n\n  setProjectionMatrix(gl: WebGLRenderingContext, matrix: mat4) {\n    gl.uniformMatrix4fv(this.uProjectionMx, false, matrix)\n  }\n\n  setDiffuse(gl: WebGLRenderingContext, value: number) {\n    gl.uniform1i(this.uDiffuse, value)\n  }\n\n  setLightmap(gl: WebGLRenderingContext, val: number) {\n    gl.uniform1i(this.uLightmap, val)\n  }\n\n  setOpacity(gl: WebGLRenderingContext, val: number) {\n    gl.uniform1f(this.uOpacity, val)\n  }\n\n  enableVertexAttribs(gl: WebGLRenderingContext) {\n    gl.enableVertexAttribArray(this.aPosition)\n    gl.enableVertexAttribArray(this.aTexCoord)\n    gl.enableVertexAttribArray(this.aTexCoord2)\n  }\n\n  setVertexAttribPointers(gl: WebGLRenderingContext) {\n    gl.vertexAttribPointer(this.aPosition, 3, gl.FLOAT, false, 7 * 4, 0)\n    gl.vertexAttribPointer(this.aTexCoord, 2, gl.FLOAT, false, 7 * 4, 3 * 4)\n    gl.vertexAttribPointer(this.aTexCoord2, 2, gl.FLOAT, false, 7 * 4, 5 * 4)\n  }\n}\n","export interface WorldSpawn {\n  classname: 'worldspawn'\n  wad: string[]\n  mapversion: number\n  skyname: string\n  maxRange: number\n  message: string\n  sounds: number\n  light: number\n  waveHeight: number\n  startDark: WorldSpawnStartDark\n  newUnit: WorldSpawnNewUnit\n  gameTitle: WorldSpawnGameTitle\n  defaultTeam: WorldSpawnDefaultTeam\n}\nexport enum WorldSpawnStartDark {\n  No = 0,\n  Yes = 1 // the level will start black with fade in\n}\nexport enum WorldSpawnGameTitle {\n  No = 0,\n  Yes = 1 // \"Half-Life\" will be displayed after the map loads\n}\nexport enum WorldSpawnNewUnit {\n  No = 0,\n  Yes = 1 // All previous global triggers will be removed\n}\nexport enum WorldSpawnDefaultTeam {\n  FewestPlayers = 0,\n  FirstTeam = 1\n}\n\nexport interface AiScriptedSequence {\n  classname: 'aiscripted_sequence'\n  m_iszEntity: string\n\tm_iszPlay: string\n\tm_flRadius: number\n\tm_flRepeat: number\n\tm_fMoveTo: AiScriptedSequenceMoveTo\n\tm_iFinishSchedule: AiScriptedSequenceFinishSchedule\n\tspawnflags: AiScriptedSequenceSpawnflags\n}\nexport enum AiScriptedSequenceMoveTo {\n  No = 0,\n  Walk = 1,\n  Run = 2,\n  Instantaneous = 4,\n  No_TurnToFace = 5\n}\nexport enum AiScriptedSequenceFinishSchedule {\n  DefaultAI = 0,\n  Ambush = 1\n}\nexport enum AiScriptedSequenceSpawnflags {\n  Repeatable = 4,\n  LeaveCorpse = 8\n}\n\nexport interface AmbientGeneric {\n  classname: 'ambient_generic'\n  origin: number[]\n  targetName: string\n  message: string\n  health: number\n  preset: AmbientGenericPreset\n  startVolume: number\n  fadeIn: number\n  fadeOut: number\n  pitch: number\n  pitchStart: number\n  spinUp: number\n  spinDown: number\n  lfoType: number\n  lfoRate: number\n  lfoModPitch: number\n  lfoModVolume: number\n  cSpinUp: number\n  spawnFlags: AmbientGenericSpawnFlags\n}\nexport enum AmbientGenericPreset {\n  None = 0,\n  HugeMachine = 1,\n  BigMachine = 2,\n  Machine = 3,\n  SlowFadeIn = 4,\n  FadeIn = 5,\n  QuickFadeIn = 6,\n  SlowPulse = 7,\n  Pulse = 8,\n  QuickPulse = 9,\n  SlowOscillator = 10,\n  Oscillator = 11,\n\tQuickOscillator = 12,\n\tGrungePitch = 13,\n\tVeryLowPitch = 14,\n\tLowPitch = 15,\n\tHighPitch = 16,\n\tVeryHighPitch = 17,\n\tScreamingPitch = 18,\n\tOscillateSpinUpDown = 19,\n\tPulseSpinUpDown = 20,\n\tRandomPitch = 21,\n\tRandomPitchFast = 22,\n\tIncrementalSpinup = 23,\n\tAlien = 24,\n\tBizzare = 25,\n\tPlanetX = 26,\n\tHaunted = 27\n}\nexport enum AmbientGenericSpawnFlags {\n  PlayEverywhere = 1,\n  SmallRadius = 2,\n  MediumRadius = 4,\n  LargeRadius = 8,\n  StartSilent = 16,\n  NotToggled = 32\n}\n\nexport interface Ammo357 {\n  classname: 'ammo_357'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface Ammo9mmAR {\n  classname: 'ammo_9mmAR'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface Ammo9mmBox {\n  classname: 'ammo_9mmbox'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface Ammo9mmClip {\n  classname: 'ammo_9mmclip'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoARGrenades {\n  classname: 'ammo_ARgrenades'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoBuckShot {\n  classname: 'ammo_buckshot'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoCrossBox {\n  classname: 'ammo_crossbow'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoGaussClip {\n  classname: 'ammo_gaussclip'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface AmmoRPGClip {\n  classname: 'ammo_rpgclip'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  delay: number\n  killTarget: string\n  spawnFlags: number\n}\n\nexport interface ButtonTarget {\n  classname: 'button_target'\n  target: string\n  master: string\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n  zhltLightFlags: ZHLTLightFlags\n  lightOrigin: string\n  spawnFlags: ButtonTargetSpawnFlags\n}\nexport enum ButtonTargetSpawnFlags {\n  UseActivates = 1,\n  StartOn = 2\n}\n\nexport interface Cycler {\n  classname: 'cycler'\n  origin: number[]\n  angles: number[]\n  targetName: string\n  model: string\n  sequence: string\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport interface CyclerSprite {\n  classname: 'cycler_sprite'\n  origin: number[]\n  angles: number[]\n  targetName: string\n  model: string\n  framerate: number\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport interface CyclerWeapon {\n  classname: 'cycler_weapon'\n  origin: number[]\n  angles: number[]\n  target: string\n  targetName: string\n  triggerTarget: string\n  triggerCondition: CyclerWeaponTriggerCondition\n  model: string\n  sequence: string\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport enum CyclerWeaponTriggerCondition {\n  NoTrigger = 0,\n  SeePlayerMadAtPlayer = 1,\n  TakeDamage = 2,\n  HalfHealthRemaining = 3,\n  Death = 4,\n  HearWorld = 7,\n  HearPlayer = 8,\n  HearCombat = 9,\n  SeePlayerUnconditional = 10,\n  SeePlayerNotInCombat = 11\n}\n\nexport interface CyclerWreckage {\n  classname: 'cycler_wreckage'\n  origin: number[]\n  angles: number[]\n  targetName: string\n  model: string\n  framerate: number\n  scale: number\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n}\n\nexport interface EnvBeam {\n  classname: 'env_beam',\n  renderEffect: RenderEffect\n  renderMode: RenderMode\n  renderAmmount: number\n  renderColor: number[]\n  radius: number\n\tlife: number\n\tboltWidth: number\n\tnoiseAmplitude: number\n\ttexture: string\n\ttextureScroll: number\n\tframeRate: number\n\tframeStart: number\n\tstrikeTime: number\n\tdamage: number\n\tspawnFlags: EnvBeamSpawnFlags\n}\n\nexport enum EnvBeamSpawnFlags {\n  StartOn = 1,\n  Toggle = 2,\n  RandomStrike = 4,\n  Ring = 8,\n  StartSparks = 16,\n  EndSparks = 32,\n  DecalEnd = 64,\n  FadeStart = 128,\n  FadeEnd = 256\n}\n\nexport enum ZHLTLightFlags {\n  Normal = 0,\n  EmbeddedFix = 1,\n  OpaqueBlockLight = 2,\n  OpaqueEmbeddedFix = 3,\n  OpaqueConcaveFix = 6\n}\n\nexport enum RenderEffect {\n  Normal = 0,\n\tSlowPulse = 1, //* Additive or Texture mode only.\n  FastPulse = 2, //* Additive or Texture mode only.\n  SlowWidePulse = 3, //* Additive or Texture mode only.\n  FastWidePulse = 4,  //* Additive or Texture mode only.\n  SlowFadeAway = 5,\n\tFastFadeAway = 6,\n  SlowBecomeSolid = 7,\n  FastBecomeSolid = 8,\n  SlowStrobe = 9,\n  FastStrobe = 10,\n  FasterStrobe = 11,\n  SlowFlicker = 12,\n  FastFlicker = 13,\n  //* Constant Glow only affects the Glow rendermode. With this setting, Glow mode behaves\n  //* exactly like Additive mode - except that (as is usual for Glow mode) the sprite isn't\n  //* obscured by intervening sprites or models.\n  ConstantGlow = 14,\n  DistortModels = 15,\n  HologramDistort = 16\n}\n\nexport enum RenderMode {\n  Normal = 0,\n  Color = 1,\n  Texture = 2,\n  Glow = 3,\n  Solid = 4,\n  Additive = 5\n}\n\nconst parseNumberArray = (a: string) => a.split(' ').map(b => parseFloat(b))\n\nconst parsers: {\n  worldspawn: (entityData: {[name: string]: any}) => WorldSpawn\n  aiscripted_sequence: (entityData: {[name: string]: any}) => AiScriptedSequence\n  ambient_generic: (entityData: {[name: string]: any}) => AmbientGeneric\n  ammo_357: (entityData: {[name: string]: any}) => Ammo357\n  ammo_9mmAR: (entityData: {[name: string]: any}) => Ammo9mmAR\n  ammo_9mmbox: (entityData: {[name: string]: any}) => Ammo9mmBox\n  ammo_9mmclip: (entityData: {[name: string]: any}) => Ammo9mmClip\n  ammo_ARgrenades: (entityData: {[name: string]: any}) => AmmoARGrenades\n  ammo_buckshot: (entityData: {[name: string]: any}) => AmmoBuckShot\n  ammo_crossbow: (entityData: {[name: string]: any}) => AmmoCrossBox\n  ammo_gaussclip: (entityData: {[name: string]: any}) => AmmoGaussClip\n  ammo_rpgclip: (entityData: {[name: string]: any}) => AmmoRPGClip\n  button_target: (entityData: {[name: string]: any}) => ButtonTarget\n  cycler: (entityData: {[name: string]: any}) => Cycler\n  cycler_sprite: (entityData: {[name: string]: any}) => CyclerSprite\n  cyclear_weapon: (entityData: {[name: string]: any}) => CyclerWeapon\n  cyclear_wreckage: (entityData: {[name: string]: any}) => CyclerWreckage\n  env_beam: (entityData: {[name: string]: any}) => EnvBeam\n} = {\n  worldspawn: (e) => ({\n    classname: 'worldspawn',\n    wad: e.wad\n      .split(';')\n      .filter((a: string) => a.length)\n      .map((w: string) => w.replace(/\\\\/g, '/')),\n    mapversion: parseInt(e.mapversion),\n    skyname: e.skyname,\n    maxRange: parseFloat(e.MaxRange) || 8192,\n    message: e.message || '',\n    sounds: parseInt(e.sounds) || 0,\n    light: parseInt(e.light) || 0,\n    waveHeight: parseFloat(e.WaveHeight) || 0,\n    startDark: parseInt(e.startdark) || 0,\n    newUnit: parseInt(e.newunit) || 0,\n    defaultTeam: parseInt(e.defaultteam) || 0,\n    gameTitle: parseInt(e.gametitle) || 0\n  }),\n  aiscripted_sequence: (e) => ({\n    classname: 'aiscripted_sequence',\n    spawnflags: parseInt(e.spawnflags),\n    m_iszEntity: e.m_iszEntity,\n    m_iszPlay: e.m_iszPlay || '',\n    m_flRadius: parseInt(e.m_flRadius) || 512,\n    m_flRepeat: parseInt(e.m_flRepeat) || 0,\n    m_fMoveTo: parseInt(e.m_fMoveTo) || 0,\n    m_iFinishSchedule: parseInt(e.m_iFinishSchedule) || 0,\n  }),\n  ambient_generic: (e) => ({\n    classname: 'ambient_generic',\n    origin: parseNumberArray(e.origin),\n    targetName: e.targetname,\n    message: e.message,\n    health: parseInt(e.health) || 10,\n    preset: parseInt(e.preset) || 0,\n    startVolume: parseInt(e.volstart) || 0,\n    fadeIn: parseInt(e.fadein),\n    fadeOut: parseInt(e.fadeout),\n    pitch: parseInt(e.pitch),\n    pitchStart: parseInt(e.pitchstart),\n    spinUp: parseInt(e.spinup),\n    spinDown: parseInt(e.spindown),\n    lfoType: parseInt(e.lfotype),\n    lfoRate: parseInt(e.lforate),\n    lfoModPitch: parseInt(e.lfomodpitch),\n    lfoModVolume: parseInt(e.lfomodvolume),\n    cSpinUp: parseInt(e.cspinup),\n    spawnFlags: parseInt(e.spawnflags)\n  }),\n  ammo_357: (e) => ({\n    classname: 'ammo_357',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_9mmAR: (e) => ({\n    classname: 'ammo_9mmAR',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_9mmbox: (e) => ({\n    classname: 'ammo_9mmbox',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_9mmclip: (e) => ({\n    classname: 'ammo_9mmclip',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_ARgrenades: (e) => ({\n    classname: 'ammo_ARgrenades',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_buckshot: (e) => ({\n    classname: 'ammo_buckshot',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_crossbow: (e) => ({\n    classname: 'ammo_crossbow',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_gaussclip: (e) => ({\n    classname: 'ammo_gaussclip',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  ammo_rpgclip: (e) => ({\n    classname: 'ammo_rpgclip',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname || '',\n    delay: parseInt(e.delay) || 0,\n    killTarget: e.killtarget || '',\n    spawnFlags: e.spawnflags || 0\n  }),\n  button_target: (e) => ({\n    classname: 'button_target',\n    target: e.target,\n    master: e.master,\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0'),\n    zhltLightFlags: parseInt(e.zhlt_lightflags) || 0,\n    lightOrigin: e.light_origin,\n    spawnFlags: parseInt(e.spawnflags) || 1\n  }),\n  cycler: (e) => ({\n    classname: 'cycler',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    targetName: e.targetname,\n    model: e.model,\n    sequence: e.sequence || '',\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  cycler_sprite: (e) => ({\n    classname: 'cycler_sprite',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    targetName: e.targetname,\n    model: e.model,\n    framerate: parseInt(e.framerate || '10'),\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  cyclear_weapon: (e) => ({\n    classname: 'cycler_weapon',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    target: e.target,\n    targetName: e.targetname,\n    triggerTarget: e.TriggerTarget || '',\n    triggerCondition: parseInt(e.TriggerCondition) || 0,\n    model: e.model,\n    sequence: e.sequence,\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  cyclear_wreckage: (e) => ({\n    classname: 'cycler_wreckage',\n    origin: parseNumberArray(e.origin),\n    angles: parseNumberArray(e.angles),\n    targetName: e.targetname,\n    model: e.model,\n    framerate: parseInt(e.framerate) || 10,\n    scale: parseFloat(e.scale) || 1.0,\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0')\n  }),\n  env_beam: (e) => ({\n    classname: 'env_beam',\n    renderEffect: parseInt(e.renderfx) || 0,\n    renderMode: parseInt(e.rendermode) || 0,\n    renderAmmount: parseInt(e.renderamt) || 255,\n    renderColor: parseNumberArray(e.rendercolor || '0 0 0'),\n    radius: parseFloat(e.Radius) || 256,\n    life: parseInt(e.life) || 1,\n    boltWidth: parseInt(e.BoltWidth) || 20,\n    noiseAmplitude: parseInt(e.NoiseAmplitude) || 0,\n    texture: e.texture || 'sprites/laserbeam.spr',\n    textureScroll: parseInt(e.TextureScroll) || 35,\n    frameRate: parseInt(e.framerate) || 0,\n    frameStart: parseInt(e.framestart) || 0,\n    strikeTime: parseInt(e.StrikeTime) || 1,\n    damage: parseInt(e.damage) || 1,\n    spawnFlags: parseInt(e.spawnflags)\n  })\n}\n\n// env_beverage (Half-Life)\n// env_blood (Half-Life)\n// env_bubbles (Half-Life)\n// env_explosion (Half-Life)\n// env_fade (Half-Life)\n// env_funnel (Half-Life)\n// env_global (Half-Life)\n// env_glow (Half-Life)\n// env_laser (Half-Life)\n// env_message (Half-Life)\n// env_render (Half-Life)\n// env_shake (Half-Life)\n// env_shooter (Half-Life)\n// env_sound (Half-Life)\n// env_spark (Half-Life)\n// env_sprite (Half-Life)\n// func_breakable (Half-Life)\n// func_button (Half-Life)\n// func_conveyor (Half-Life)\n// func_door (Half-Life)\n// func_door_rotating (Half-Life)\n// func_friction (Half-Life)\n// func_guntarget (Half-Life)\n// func_healthcharge (Half-Life)\n// func_illusionary (Half-Life)\n// func_ladder (Half-Life)\n// func_minicompo (Half-Life)\n// func_monsterclip (Half-Life)\n// func_mortar_field (Half-Life)\n// func_pendulum (Half-Life)\n// func_plat (Half-Life)\n// func_platrot (Half-Life)\n// func_pushable (Half-Life)\n// func_recharge (Half-Life)\n// func_rot_button (Half-Life)\n// func_rotating (Half-Life)\n// func_tank (Half-Life)\n// func_tankcontrols (Half-Life)\n// func_tanklaser (Half-Life)\n// func_tankmortar (Half-Life)\n// func_tankrocket (Half-Life)\n// func_trackautochange (Half-Life)\n// func_trackchange (Half-Life)\n// func_tracktrain (Half-Life)\n// func_train (Half-Life)\n// func_traincontrols (Half-Life)\n// func_wall (Half-Life)\n// func_wall_toggle (Half-Life)\n// func_water (Half-Life)\n// game_counter (Half-Life)\n// game_counter_set (Half-Life)\n// game_end (Half-Life)\n// game_player_equip (Half-Life)\n// game_player_hurt (Half-Life)\n// game_player_team (Half-Life)\n// game_score (Half-Life)\n// game_team_master (Half-Life)\n// game_team_set (Half-Life)\n// game_text (Half-Life)\n// game_zone_player (Half-Life)\n// gibshooter (Half-Life)\n// info_bigmomma (Half-Life)\n// info_intermission (Half-Life)\n// info_landmark (Half-Life)\n// info_node (Half-Life)\n// info_node_air (Half-Life)\n// info_null (Half-Life)\n// info_player_coop (Half-Life)\n// info_player_deathmatch (Half-Life)\n// info_player_start (Half-Life)\n// info_target (Half-Life)\n// info_teleport_destination (Half-Life)\n// info_texlights (Half-Life)\n// infodecal (Half-Life)\n// item_airtank (Half-Life)\n// item_antidote (Half-Life)\n// item_battery (Half-Life)\n// item_healthkit (Half-Life)\n// item_longjump (Half-Life)\n// item_security (Half-Life)\n// item_sodacan (Half-Life)\n// item_suit (Half-Life)\n// light (Half-Life)\n// light_environment (Half-Life)\n// light_spot (Half-Life)\n// momentary_door (Half-Life)\n// momentary_rot_button (Half-Life)\n// monster_alien_controller (Half-Life)\n// monster_alien_grunt (Half-Life)\n// monster_alien_slave (Half-Life)\n// monster_apache (Half-Life)\n// monster_babycrab (Half-Life)\n// monster_barnacle (Half-Life)\n// monster_barney (Half-Life)\n// monster_barney_dead (Half-Life)\n// monster_bigmomma (Half-Life)\n// monster_bloater (Half-Life)\n// monster_bullchicken (Half-Life)\n// monster_cockroach (Half-Life)\n// monster_flyer_flock (Half-Life)\n// monster_furniture (Half-Life)\n// monster_gargantua (Half-Life)\n// monster_generic (Half-Life)\n// monster_gman (Half-Life)\n// monster_grunt_repel (Half-Life)\n// monster_handgrenade (Half-Life)\n// monster_headcrab (Half-Life)\n// monster_hevsuit_dead (Half-Life)\n// monster_hgrunt_dead (Half-Life)\n// monster_houndeye (Half-Life)\n// monster_human_assassin (Half-Life)\n// monster_human_grunt (Half-Life)\n// monster_ichthyosaur (Half-Life)\n// monster_leech (Half-Life)\n// monster_miniturret (Half-Life)\n// monster_nihilanth (Half-Life)\n// monster_osprey (Half-Life)\n// monster_rat (Half-Life)\n// monster_satchelcharge (Half-Life)\n// monster_scientist (Half-Life)\n// monster_scientist_dead (Half-Life)\n// monster_sentry (Half-Life)\n// monster_sitting_scientist (Half-Life)\n// monster_snark (Half-Life)\n// monster_tentacle (Half-Life)\n// monster_tripmine (Half-Life)\n// monster_turret (Half-Life)\n// monster_zombie (Half-Life)\n// monstermaker (Half-Life)\n// multi_manager (Half-Life)\n// multisource (Half-Life)\n// path_corner (Half-Life)\n// path_track (Half-Life)\n// player_loadsaved (Half-Life)\n// player_weaponstrip (Half-Life)\n// scripted_sentence (Half-Life)\n// scripted_sequence (Half-Life)\n// speaker (Half-Life)\n// target_cdaudio (Half-Life)\n// trigger_auto (Half-Life)\n// trigger_autosave (Half-Life)\n// trigger_camera (Half-Life)\n// trigger_cdaudio (Half-Life)\n// trigger_changelevel (Half-Life)\n// trigger_changetarget (Half-Life)\n// trigger_counter (Half-Life)\n// trigger_endsection (Half-Life)\n// trigger_gravity (Half-Life)\n// trigger_hurt (Half-Life)\n// trigger_monsterjump (Half-Life)\n// trigger_multiple (Half-Life)\n// trigger_once (Half-Life)\n// trigger_push (Half-Life)\n// trigger_relay (Half-Life)\n// trigger_teleport (Half-Life)\n// trigger_transition (Half-Life)\n// weapon_357 (Half-Life)\n// weapon_9mmAR (Half-Life)\n// weapon_9mmhandgun (Half-Life)\n// weapon_crossbow (Half-Life)\n// weapon_crowbar (Half-Life)\n// weapon_egon (Half-Life)\n// weapon_gauss (Half-Life)\n// weapon_handgrenade (Half-Life)\n// weapon_hornetgun (Half-Life)\n// weapon_rpg (Half-Life)\n// weapon_satchel (Half-Life)\n// weapon_shotgun (Half-Life)\n// weapon_snark (Half-Life)\n// weapon_tripmine (Half-Life)\n// weaponbox (Half-Life)\n// world_items (Half-Life)\n// worldspawn (Half-Life)\n// xen_hair (Half-Life)\n// xen_plantlight (Half-Life)\n// xen_spore_large (Half-Life)\n// xen_spore_medium (Half-Life)\n// xen_spore_small (Half-Life)\n// xen_tree (Half-Life)\n\nexport interface FuncBreakable {\n  classname: 'func_breakable'\n}\n\nexport interface BadEntity {\n  classname: '!'\n  data: any\n}\n\nexport interface UnknownEntity {\n  classname: '?'\n  originalClassname: string\n  data: any\n}\n\nexport type Entity = WorldSpawn | FuncBreakable | BadEntity | UnknownEntity\n\nexport class BspEntityParser {\n  static parse(entities: any[]): Entity[] {\n    const arr: Entity[] = []\n\n    for (let i = 0; i < entities.length; ++i) {\n      const e = entities[i]\n\n      if (!e.classname) {\n        arr.push({\n          classname: '!',\n          data: e\n        })\n      }\n\n      if ((parsers as any)[e.classname]) {\n        arr.push((parsers as any)[e.classname](e))\n      } else {\n        arr.push({\n          classname: '?',\n          originalClassname: e.classname,\n          data: e\n        })\n      }\n    }\n\n    return arr\n  }\n}\n","export const resizeTexture = (\n  pixels: Uint8Array,\n  width: number,\n  height: number,\n  newWidth: number,\n  newHeight: number\n) => {\n  const canvas = document.createElement('canvas')\n  const ctx = canvas.getContext('2d')\n  if (!ctx) {\n    throw new Error('Runtime error.')\n  }\n  canvas.width = width\n  canvas.height = height\n\n  const nc = document.createElement('canvas')\n  const nctx = nc.getContext('2d')\n  if (!nctx) {\n    throw new Error('Runtime error.')\n  }\n  nc.width = newWidth\n  nc.height = newHeight\n\n  const cid = ctx.createImageData(width, height)\n  for (let i = 0, size = width * height * 4; i < size; i += 4) {\n    cid.data[i] = pixels[i]\n    cid.data[i + 1] = pixels[i + 1]\n    cid.data[i + 2] = pixels[i + 2]\n    cid.data[i + 3] = pixels[i + 3]\n  }\n  ctx.putImageData(cid, 0, 0)\n\n  nctx.drawImage(canvas, 0, 0, newWidth, newHeight)\n\n  return new Uint8Array(nctx.getImageData(0, 0, newWidth, newHeight).data)\n}\n\nexport const isPowerOfTwo = (n: number) => (n & (n - 1)) === 0\n\nexport const nextPowerOfTwo = (n: number) => {\n  --n\n  for (let i = 1; i < 32; i <<= 1) {\n    n = n | (n >> i)\n  }\n  return n + 1\n}","type ConfigPaths = {\n  base: string\n  replays: string\n  maps: string\n  wads: string\n  skies: string\n  sounds: string\n}\n\nexport class Config {\n  public static init(params: any): Config {\n    if (typeof params === 'string') {\n      return new Config({\n        paths: {\n          base: params,\n          replays: `${params}/replays`,\n          maps: `${params}/maps`,\n          wads: `${params}/wads`,\n          skies: `${params}/skies`,\n          sounds: `${params}/sounds`\n        }\n      })\n    } else {\n      return new Config({\n        paths: {\n          base: (params && params.paths && params.paths.base) || '',\n          replays: (params && params.paths && params.paths.replays) || '/demos',\n          maps: (params && params.paths && params.paths.maps) || '/maps',\n          wads: (params && params.paths && params.paths.wads) || '/wads',\n          skies: (params && params.paths && params.paths.skies) || '/skies',\n          sounds: (params && params.paths && params.paths.sounds) || '/sounds'\n        }\n      })\n    }\n  }\n\n  private paths: ConfigPaths\n\n  constructor(params: { paths: ConfigPaths }) {\n    this.paths = { ...params.paths }\n  }\n\n  getBasePath() {\n    return this.paths.base\n  }\n  getReplaysPath() {\n    return this.paths.replays\n  }\n  getMapsPath() {\n    return this.paths.maps\n  }\n  getWadsPath() {\n    return this.paths.wads\n  }\n  getSkiesPath() {\n    return this.paths.skies\n  }\n  getSoundsPath() {\n    return this.paths.sounds\n  }\n}\n","import { h, render } from 'preact'\nimport { Game } from '../Game'\nimport { Root } from './Root'\n\nexport class PlayerInterface {\n  private game: Game\n  private rootNode: Element\n\n  constructor(game: Game, rootNode: Element) {\n    this.game = game\n    this.rootNode = rootNode\n  }\n\n  getRootNode() {\n    return this.rootNode\n  }\n\n  draw() {\n    render(<Root game={this.game} root={this.rootNode} />, this.rootNode)\n  }\n}\n","import { h, Component } from 'preact'\nimport { Loading } from './Loading'\nimport { FreeMode } from './FreeMode'\nimport { ReplayMode } from './ReplayMode'\nimport { Fullscreen } from '../Fullscreen'\nimport { Game, PlayerMode } from '../Game'\nimport { RootStyle as s } from './Root.style'\n\ninterface RootProps {\n  game: Game\n  root: Element\n}\n\ninterface RootState {\n  title: string\n  isActive: boolean\n  isLoading: boolean\n  isMouseOver: boolean\n  isVisible: boolean\n}\n\nexport class Root extends Component<RootProps, RootState> {\n  private node: HTMLDivElement | null = null\n  private fadeOut: any = 0\n\n  constructor(props: RootProps) {\n    super(props)\n\n    this.state = {\n      title: props.game.title,\n      isActive: false,\n      isLoading: false,\n      isMouseOver: false,\n      isVisible: false\n    }\n  }\n\n  componentDidMount() {\n    if (!this.node) {\n      return\n    }\n\n    const game = this.props.game\n    const root = this.props.root\n\n    this.node.appendChild(game.getCanvas())\n\n    game.on('loadstart', this.onLoadStart)\n    game.on('load', this.onLoadEnd)\n    game.on('modechange', this.onModeChange)\n    game.on('titlechange', this.onTitleChange)\n\n    root.addEventListener('click', this.onRootClick)\n    window.addEventListener('click', this.onWindowClick)\n    window.addEventListener('keydown', this.onKeyDown)\n    document.addEventListener(\n      'pointerlockchange',\n      this.onPointerLockChange,\n      false\n    )\n\n    root.addEventListener('mouseover', this.onMouseEnter)\n    root.addEventListener('mousemove', this.onMouseMove)\n    root.addEventListener('mouseout', this.onMouseLeave)\n    root.addEventListener('contextmenu', this.onContextMenu)\n  }\n\n  componentWillUnmount() {\n    const game = this.props.game\n    const root = this.props.root\n\n    game.off('loadstart', this.onLoadStart)\n    game.off('load', this.onLoadEnd)\n    game.off('modechange', this.onModeChange)\n    game.off('titlechange', this.onTitleChange)\n\n    root.removeEventListener('click', this.onRootClick)\n    window.removeEventListener('click', this.onWindowClick)\n    window.removeEventListener('keydown', this.onKeyDown)\n    document.removeEventListener(\n      'pointerlockchange',\n      this.onPointerLockChange,\n      false\n    )\n\n    root.removeEventListener('mouseover', this.onMouseEnter)\n    root.removeEventListener('mousemove', this.onMouseMove)\n    root.removeEventListener('mouseout', this.onMouseLeave)\n    root.removeEventListener('contextmenu', this.onContextMenu)\n  }\n\n  onPointerLockChange = () => {\n    if (document.pointerLockElement === this.props.root) {\n      this.props.game.pointerLocked = true\n    } else {\n      this.props.game.pointerLocked = false\n    }\n  }\n\n  onContextMenu = (e: Event) => {\n    e.preventDefault()\n  }\n\n  onWindowClick = () => {\n    this.setState({ isActive: false })\n  }\n\n  onRootClick = (e: Event) => {\n    e.stopPropagation()\n    this.setState({ isActive: true })\n    this.fadeReset()\n  }\n\n  onKeyDown = (e: KeyboardEvent) => {\n    if (!this.state.isActive) {\n      return\n    }\n\n    const game = this.props.game\n\n    switch (e.which) {\n      case 70: {\n        // F\n        if (Fullscreen.isInFullscreen()) {\n          Fullscreen.exit()\n        } else {\n          Fullscreen.enter(this.props.root)\n        }\n        this.fadeReset()\n        break\n      }\n\n      case 77: {\n        // M\n        game.soundSystem.toggleMute()\n        this.fadeReset()\n        break\n      }\n\n      case 38: {\n        // arrow up\n        game.soundSystem.setVolume(game.soundSystem.getVolume() + 0.05)\n        this.fadeReset()\n        break\n      }\n      case 40: {\n        // arrow down\n        game.soundSystem.setVolume(game.soundSystem.getVolume() - 0.05)\n        this.fadeReset()\n        break\n      }\n\n      case 74: // J\n      case 37: {\n        // arrow left\n        game.player.seek(game.player.currentTime - 5)\n        this.fadeReset()\n        break\n      }\n      case 76: // L\n      case 39: {\n        // arrow right\n        game.player.seek(game.player.currentTime + 5)\n        this.fadeReset()\n        break\n      }\n\n      case 75: // K\n      case 32: {\n        // space\n        if (this.props.game.mode !== PlayerMode.REPLAY) {\n          return\n        }\n\n        if (!game.player.isPlaying || game.player.isPaused) {\n          game.player.play()\n        } else {\n          game.player.pause()\n        }\n        break\n      }\n    }\n  }\n\n  onModeChange = () => {\n    this.forceUpdate()\n  }\n\n  onLoadStart = () => {\n    this.setState({ isLoading: true })\n  }\n\n  onLoadEnd = () => {\n    this.setState({ isLoading: false })\n  }\n\n  onTitleChange = (title: string) => {\n    this.setState({ title })\n  }\n\n  onMouseEnter = () => {\n    this.setState({ isMouseOver: true })\n    this.fadeReset()\n  }\n\n  onMouseMove = () => {\n    if (this.state.isMouseOver && !Fullscreen.isInFullscreen()) {\n      this.fadeReset()\n    }\n  }\n\n  onMouseLeave = () => {\n    this.setState({\n      isMouseOver: false,\n      isVisible: false\n    })\n\n    clearTimeout(this.fadeOut)\n    this.fadeOut = 0\n  }\n\n  fadeReset = () => {\n    if (!this.state.isVisible) {\n      this.setState({ isVisible: true })\n    }\n\n    clearTimeout(this.fadeOut)\n    this.fadeOut = setTimeout(() => {\n      this.setState({ isVisible: false })\n      this.fadeOut = 0\n    }, 5000)\n  }\n\n  onScreenClick = () => {\n    switch (this.props.game.mode) {\n      case PlayerMode.REPLAY: {\n        const player = this.props.game.player\n        if (!player.isPlaying || player.isPaused) {\n          player.play()\n        } else {\n          player.pause()\n        }\n        break\n      }\n\n      case PlayerMode.FREE: {\n        this.props.root.requestPointerLock()\n\n        break\n      }\n    }\n  }\n\n  onScreenDblClick = () => {\n    if (Fullscreen.isInFullscreen()) {\n      Fullscreen.exit()\n    } else {\n      Fullscreen.enter(this.props.root)\n    }\n  }\n\n  render() {\n    const game = this.props.game\n    const isVisible = this.state.isVisible\n\n    return (\n      <div class={isVisible ? s.rootVisible : s.root}>\n        <div class={isVisible ? s.titleVisible : s.title}>\n          {this.state.title}\n        </div>\n\n        <Loading game={game} visible={this.state.isLoading} />\n\n        <div\n          class={s.screen}\n          ref={node => (this.node = node)}\n          onClick={this.onScreenClick}\n          onDblClick={this.onScreenDblClick}\n        />\n\n        {game.mode === PlayerMode.FREE ? (\n          <FreeMode\n            class={isVisible ? s.controlsVisible : s.controls}\n            game={game}\n            root={this.props.root}\n          />\n        ) : (\n          <ReplayMode\n            class={isVisible ? s.controlsVisible : s.controls}\n            game={game}\n            root={this.props.root}\n            visible={this.state.isMouseOver}\n          />\n        )}\n      </div>\n    )\n  }\n}\n","import { h, Component } from 'preact'\nimport { Game } from '../../Game'\nimport { LoadItem } from '../../Loader'\nimport { LoadingStyle as s } from './style'\n\ninterface LoadingProps {\n  game: Game\n  visible: boolean\n}\n\ninterface LoadingState {\n  items: {\n    [name: string]: {\n      name: string\n      progress: number\n    }[]\n  }\n}\n\nconst itemTypeGroupName: { [name: string]: string } = {\n  replay: 'Replay',\n  bsp: 'Map',\n  sound: 'Sounds',\n  sky: 'Skybox',\n  sprite: 'Sprites',\n  wad: 'Wads'\n}\n\nexport class Loading extends Component<LoadingProps, LoadingState> {\n  state: LoadingState = {\n    items: {}\n  }\n\n  componentDidMount() {\n    const loader = this.props.game.loader\n    loader.addEventListener('loadstart', (event: any) => {\n      this.onItemLoad(event.detail.item)\n    })\n    loader.addEventListener('progress', (event: any) => {\n      this.onItemProgress(event.detail.item)\n    })\n  }\n\n  componentWillUnmount() {\n    const loader = this.props.game.loader\n    loader.removeEventListener('loadstart', this.onItemLoad as any)\n    loader.removeEventListener('progress', this.onItemProgress)\n  }\n\n  onItemLoad = (item: LoadItem) => {\n    const items = this.state.items[item.type] ? this.state.items[item.type] : []\n\n    for (let i = 0; i < items.length; ++i) {\n      if (items[i] === item) {\n        return\n      }\n    }\n\n    items.push({\n      name: item.name,\n      progress: 0\n    })\n\n    this.setState({\n      items: {\n        ...this.state.items,\n        [item.type]: items\n      }\n    })\n  }\n\n  onItemProgress = (item: any) => {\n    if (!this.state.items[item.type]) {\n      return\n    }\n\n    const items = this.state.items[item.type]\n\n    for (let i = 0; i < items.length; ++i) {\n      if (items[i].name === item.name) {\n        items[i].progress = item.progress\n        break\n      }\n    }\n\n    this.forceUpdate()\n  }\n\n  formatItem(name: string, progress: number) {\n    name = itemTypeGroupName[name]\n    const status = Math.round(progress * 100) + '%'\n\n    let length = 29 - name.length - status.length\n    if (length < 2) {\n      length = 9 - status.length\n    }\n\n    const dots = Array(length).join('.')\n\n    return `${name}${dots}${status}`\n  }\n\n  render() {\n    return (\n      <div class={this.props.visible ? s.loading : s.loadingHidden}>\n        <div class={s.spinner}>\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            x=\"0px\"\n            y=\"0px\"\n            width=\"80px\"\n            height=\"80px\"\n            viewBox=\"0 0 80 80\"\n            xmlSpace=\"preserve\"\n          >\n            <path\n              fill=\"#ffffff\"\n              width=\"10px\"\n              d=\"M40,72C22.4,72,8,57.6,8,40C8,22.4,22.4,8,40,8c17.6,0,32,14.4,32,32c0,1.1-0.9,2-2,2s-2-0.9-2-2c0-15.4-12.6-28-28-28S12,24.6,12,40s12.6,28,28,28c1.1,0,2,0.9,2,2S41.1,72,40,72z\"\n            />\n          </svg>\n        </div>\n\n        <ul class={s.log}>\n          {Object.entries(this.state.items).map(([name, items]) => (\n            <li key={name} class={s.logItem}>\n              {this.formatItem(\n                name,\n                items.reduce((prev, cur) => prev + cur.progress, 0) /\n                  items.length\n              )}\n            </li>\n          ))}\n        </ul>\n      </div>\n    )\n  }\n}\n","import { stylesheet, keyframes } from 'typestyle'\n\nconst loadingStyle = () => ({\n  position: 'relative' as 'relative',\n  width: '100%',\n  height: '100%',\n  opacity: 1,\n  transition: 'opacity 2s ease, z-index 1s linear',\n  zIndex: 30\n})\n\nexport const LoadingStyle = stylesheet({\n  loading: {\n    ...loadingStyle()\n  },\n  loadingHidden: {\n    ...loadingStyle(),\n    opacity: 0,\n    userSelect: 'none',\n    zIndex: 0\n  },\n  spinner: {\n    position: 'absolute',\n    left: '50%',\n    top: '50%',\n    marginLeft: '-40px',\n    marginTop: '-40px',\n    animation: 'rotate 1s linear 0s infinite',\n    height: '80px',\n    width: '80px',\n    animationName: keyframes({\n      from: { transform: 'rotate(0deg)' },\n      to: { transform: 'rotate(360deg)' }\n    })\n  },\n  log: {\n    position: 'absolute',\n    background: 'rgba(0,0,0,0.4)',\n    padding: '10px',\n    fontFamily: 'monospace',\n    margin: '0',\n    top: '16px',\n    right: 0,\n    paddingLeft: '16px',\n    listStyle: 'none'\n  },\n  logItem: {\n    display: 'block'\n  }\n})\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import { h } from 'preact'\nimport { classes } from 'typestyle'\nimport { Game } from '../../Game'\nimport { FreeModeStyle as s } from './style'\nimport { ControlsStyle as cs } from '../Controls.style'\nimport { SettingsButton } from '../Buttons/SettingsButton'\nimport { FullscreenButton } from '../Buttons/FullscreenButton'\n\nexport function FreeMode(props: { class: string; game: Game; root: Element }) {\n  return (\n    <div class={classes(props.class, s.controls)}>\n      <div class={cs.buttons}>\n        <div class={cs.left} />\n        <div class={cs.right}>\n          <SettingsButton game={props.game} />\n          <FullscreenButton active={false} root={props.root} />\n        </div>\n      </div>\n    </div>\n  )\n}\n","import { stylesheet } from 'typestyle'\n\nexport const FreeModeStyle = stylesheet({\n  controls: {\n    height: '44px'\n  }\n})\n","import { stylesheet } from 'typestyle'\n\nconst menuStyle = () => ({\n  display: 'none',\n  position: 'absolute' as 'absolute',\n  left: '-38px',\n  bottom: '48px',\n  padding: '2px 6px',\n  fontSize: '14px',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  flexFlow: 'column',\n  minWidth: '100px'\n})\n\nconst menuItemStyle = () => ({\n  cursor: 'pointer',\n  margin: '4px 0',\n  padding: '4px',\n  $nest: {\n    '&:last-child': {\n      marginTop: 0\n    },\n    '&:hover': {\n      backgroundColor: 'rgba(255, 255, 255, 0.1)'\n    }\n  }\n})\n\nexport const SettingsButtonStyle = stylesheet({\n  settings: {\n    position: 'relative'\n  },\n  menu: {\n    ...menuStyle()\n  },\n  menuOpen: {\n    ...menuStyle(),\n    display: 'flex'\n  },\n  menuItemTitle: {\n    padding: '6px 4px',\n    borderBottom: '1px solid white',\n    fontWeight: 'bold'\n  },\n  menuItem: {\n    ...menuItemStyle()\n  },\n  menuItemSelected: {\n    ...menuItemStyle(),\n    backgroundColor: 'rgba(255, 255, 255, 0.2) !important'\n  },\n  button: {\n    width: '32px',\n    height: '32px',\n    padding: '5px'\n  }\n})\n","import { stylesheet } from 'typestyle'\n\nexport const FullscreenButtonStyle = stylesheet({\n  button: {\n    width: '30px',\n    minWidth: '30px',\n    height: '30px',\n    padding: '5px'\n  }\n})\n","import { h, Component } from 'preact'\nimport { Time } from '../Time'\nimport { Game } from '../../Game'\nimport { TimeLine } from '../TimeLine'\nimport { VolumeControl } from '../VolumeControl'\nimport { PlayButton } from '../Buttons/PlayButton'\nimport { PauseButton } from '../Buttons/PauseButton'\nimport { VolumeButton } from '../Buttons/VolumeButton'\nimport { SpeedUpButton } from '../Buttons/SpeedUpButton'\nimport { SpeedDownButton } from '../Buttons/SpeedDownButton'\nimport { SettingsButton } from '../Buttons/SettingsButton'\nimport { FullscreenButton } from '../Buttons/FullscreenButton'\nimport { ControlsStyle as cs } from '../Controls.style'\n\ninterface ReplayModeProps {\n  class: string\n  game: Game\n  root: Element\n  visible: boolean\n}\n\nexport class ReplayMode extends Component<ReplayModeProps> {\n  componentDidMount() {\n    this.props.game.player.on('play', this.onPlayStateChange)\n    this.props.game.player.on('pause', this.onPlayStateChange)\n    this.props.game.player.on('stop', this.onPlayStateChange)\n  }\n\n  componentWillUnmount() {\n    this.props.game.player.off('play', this.onPlayStateChange)\n    this.props.game.player.off('pause', this.onPlayStateChange)\n    this.props.game.player.off('stop', this.onPlayStateChange)\n  }\n\n  onPlayClick = () => {\n    this.props.game.player.play()\n  }\n\n  onPauseClick = () => {\n    this.props.game.player.pause()\n  }\n\n  onSpeedDown = () => {\n    this.props.game.player.speedDown()\n  }\n\n  onSpeedUp = () => {\n    this.props.game.player.speedUp()\n  }\n\n  onVolumeClick = () => {\n    this.props.game.soundSystem.toggleMute()\n  }\n\n  onPlayStateChange = () => {\n    this.forceUpdate()\n  }\n\n  render() {\n    const game = this.props.game\n    const player = game.player\n    const playing = player.isPlaying\n    const paused = player.isPaused\n\n    return (\n      <div class={this.props.class}>\n        <TimeLine game={game} />\n\n        <div class={cs.buttons}>\n          <div class={cs.left}>\n            <SpeedDownButton onClick={this.onSpeedDown} />\n            {paused || !playing ? (\n              <PlayButton onClick={this.onPlayClick} />\n            ) : (\n              <PauseButton onClick={this.onPauseClick} />\n            )}\n            <SpeedUpButton onClick={this.onSpeedUp} />\n            <VolumeButton onClick={this.onVolumeClick} />\n            <VolumeControl game={game} />\n            <Time player={player} />\n          </div>\n\n          <div class={cs.right}>\n            <SettingsButton game={game} />\n            <FullscreenButton active={true} root={this.props.root} />\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n","import { h, Component } from 'preact'\nimport { formatTime } from '../../Time'\nimport { ReplayPlayer } from '../../ReplayPlayer'\nimport { Time as s } from './style'\n\ninterface TimeProps {\n  player: ReplayPlayer\n}\n\ninterface TimeState {\n  isPlaying: boolean\n}\n\nexport class Time extends Component<TimeProps, TimeState> {\n  componentDidMount() {\n    this.props.player.on('play', this.onPlay)\n    this.props.player.on('pause', this.onPauseOrStop)\n    this.props.player.on('stop', this.onPauseOrStop)\n  }\n\n  componentWillUnmount() {\n    this.props.player.off('play', this.onPlay)\n    this.props.player.off('pause', this.onPauseOrStop)\n    this.props.player.off('stop', this.onPauseOrStop)\n  }\n\n  onPlay = () => {\n    this.setState(\n      {\n        isPlaying: true\n      },\n      this.update\n    )\n  }\n\n  onPauseOrStop = () => {\n    this.setState({\n      isPlaying: false\n    })\n  }\n\n  update = () => {\n    if (!this.state.isPlaying) {\n      return\n    }\n\n    this.forceUpdate()\n    setTimeout(this.update, 100)\n  }\n\n  render() {\n    const current = formatTime(this.props.player.currentTime)\n    const total = formatTime(this.props.player.replay.length)\n\n    return (\n      <div class={s.time}>\n        {current} / {total}\n      </div>\n    )\n  }\n}\n","import { stylesheet } from 'typestyle'\n\nexport const Time = stylesheet({\n  time: {\n    fontFamily: `'Roboto', Arial, Helvetica, sans-serif`,\n    fontSize: '10pt'\n  }\n})\n","import { h, Component } from 'preact'\nimport { Game } from '../../Game'\nimport { TimeLine as s } from './style'\n\ninterface TimeLineProps {\n  game: Game\n}\n\ninterface TimeLineState {\n  progress: number\n  ghostKnobActive: boolean\n  ghostKnobPos: string\n}\n\nexport class TimeLine extends Component<TimeLineProps, TimeLineState> {\n  constructor(props: TimeLineProps) {\n    super(props)\n\n    this.state = {\n      progress: 0,\n      ghostKnobActive: false,\n      ghostKnobPos: '0%'\n    }\n  }\n\n  componentDidMount() {\n    this.props.game.on('postupdate', this.onPostUpdate)\n  }\n\n  componentWillUnmount() {\n    this.props.game.off('postupdate', this.onPostUpdate)\n  }\n\n  onPostUpdate = () => {\n    const player = this.props.game.player\n    this.setState({\n      progress: player.currentTime / player.replay.length\n    })\n  }\n\n  onClick = (e: any) => {\n    const rects = e.currentTarget.getClientRects()[0]\n    const progress = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    this.props.game.player.seekByPercent(progress * 100)\n    this.props.game.player.pause()\n  }\n\n  onMouseEnter = () => {\n    this.setState({\n      ghostKnobActive: true\n    })\n  }\n\n  onMouseMove = (e: any) => {\n    if (!this.state.ghostKnobActive) {\n      return\n    }\n\n    const rects = e.currentTarget.getClientRects()[0]\n    const progressPos = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    const pos = progressPos * 100 + '%'\n    this.setState({\n      ghostKnobPos: pos\n    })\n  }\n\n  onMouseLeave = () => {\n    this.setState({\n      ghostKnobActive: false\n    })\n  }\n\n  render() {\n    const timePos = this.state.progress * 100\n    const knobOff = timePos + '%'\n    const lineOff = 100 - timePos + '%'\n\n    return (\n      <div\n        class={s.timeline}\n        onClick={this.onClick}\n        onMouseEnter={this.onMouseEnter}\n        onMouseMove={this.onMouseMove}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <div class={s.ghostLine} />\n        <div class={s.line} style={{ right: lineOff }} />\n        <div class={s.knob} style={{ left: knobOff }} />\n        <div class={s.ghostKnob} style={{ left: this.state.ghostKnobPos }} />\n      </div>\n    )\n  }\n}\n","import { stylesheet } from 'typestyle'\n\nexport const TimeLine = stylesheet({\n  timeline: {\n    display: 'flex',\n    alignItems: 'center',\n    position: 'relative',\n    height: '26px',\n    cursor: 'pointer'\n  },\n  line: {\n    height: '4px',\n    backgroundColor: '#fff',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  ghostLine: {\n    height: '4px',\n    backgroundColor: 'rgba(255, 255, 255, 0.5)',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  knob: {\n    position: 'absolute',\n    width: '12px',\n    height: '12px',\n    backgroundColor: '#fff',\n    borderRadius: '6px',\n    left: '100%',\n    marginLeft: '-6px'\n  },\n  ghostKnob: {\n    position: 'absolute',\n    width: '8px',\n    height: '8px',\n    backgroundColor: '#fff',\n    boxSizing: 'border-box',\n    borderRadius: '8px',\n    left: '0',\n    marginLeft: '-4px',\n    display: 'none',\n    $nest: {\n      '&:hover': {\n        display: 'block'\n      }\n    }\n  }\n})\n","import { h, Component } from 'preact'\nimport { Game } from '../../Game'\nimport { VolumeControl as s } from './style'\n\ninterface VolumeControlProps {\n  game: Game\n}\n\ninterface VolumeControlState {\n  volume: number\n  ghostKnobActive: boolean\n  ghostKnobPos: string\n}\n\nexport class VolumeControl extends Component<\n  VolumeControlProps,\n  VolumeControlState\n> {\n  constructor(props: VolumeControlProps) {\n    super(props)\n\n    this.state = {\n      volume: props.game.soundSystem.getVolume(),\n      ghostKnobActive: false,\n      ghostKnobPos: '5%'\n    }\n  }\n\n  componentDidMount() {\n    this.props.game.soundSystem.addEventListener('volumeChange',() => {\n      this.onVolumeChange()\n    })\n  }\n\n  componentWillUnmount() {\n    this.props.game.soundSystem.removeEventListener(\n      'volumeChange',\n      this.onVolumeChange\n    )\n  }\n\n  onVolumeChange = () => {\n    this.setState({\n      volume: this.props.game.soundSystem.getVolume()\n    })\n  }\n\n  onClick = (e: any) => {\n    const rects = e.currentTarget.getClientRects()[0]\n    const volume = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    this.props.game.soundSystem.setVolume(volume)\n  }\n\n  onMouseEnter = () => {\n    this.setState({\n      ghostKnobActive: true\n    })\n  }\n\n  onMouseMove = (e: any) => {\n    if (!this.state.ghostKnobActive) {\n      return\n    }\n\n    const rects = e.currentTarget.getClientRects()[0]\n    const volumePos = 1 - (rects.right - e.pageX) / (rects.right - rects.left)\n    const pos = Math.min(95, Math.max(5, volumePos * 100)) + '%'\n    this.setState({\n      ghostKnobPos: pos\n    })\n  }\n\n  onMouseLeave = () => {\n    this.setState({\n      ghostKnobActive: false\n    })\n  }\n\n  render() {\n    const volumePos = this.state.volume * 100\n    const knobOff = Math.min(95, Math.max(5, volumePos)) + '%'\n    const lineOff = Math.min(95, Math.max(5, 100 - volumePos)) + '%'\n\n    return (\n      <div\n        class={s.control}\n        onClick={this.onClick}\n        onMouseEnter={this.onMouseEnter}\n        onMouseMove={this.onMouseMove}\n        onMouseLeave={this.onMouseLeave}\n      >\n        <div class={s.ghostLine} />\n        <div class={s.line} style={{ right: lineOff }} />\n        <div class={s.knob} style={{ left: knobOff }} />\n        <div class={s.ghostKnob} style={{ left: this.state.ghostKnobPos }} />\n      </div>\n    )\n  }\n}\n","import { stylesheet } from 'typestyle'\n\nexport const VolumeControl = stylesheet({\n  control: {\n    display: 'flex',\n    alignItems: 'center',\n    position: 'relative',\n    width: '80px',\n    height: '26px',\n    marginLeft: '6px',\n    marginRight: '14px',\n    cursor: 'pointer'\n  },\n  line: {\n    height: '4px',\n    backgroundColor: '#fff',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  ghostLine: {\n    height: '4px',\n    backgroundColor: 'rgba(255, 255, 255, 0.5)',\n    position: 'absolute',\n    left: '0',\n    right: '0',\n    borderRadius: '2px'\n  },\n  knob: {\n    position: 'absolute',\n    width: '12px',\n    height: '12px',\n    backgroundColor: '#fff',\n    borderRadius: '6px',\n    left: '100%',\n    marginLeft: '-6px'\n  },\n  ghostKnob: {\n    position: 'absolute',\n    width: '8px',\n    height: '8px',\n    backgroundColor: '#fff',\n    boxSizing: 'border-box',\n    borderRadius: '8px',\n    left: '0',\n    marginLeft: '-4px',\n    display: 'none',\n    $nest: {\n      '&:hover': {\n        display: 'block'\n      }\n    }\n  }\n})\n","import { h } from 'preact'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function PlayButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={cs.button} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L64 32 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { h } from 'preact'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function PauseButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={cs.button} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L20 64 L20 0 M44 0 L64 0 L64 64 L44 64 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { h } from 'preact'\nimport { classes } from 'typestyle'\nimport { VolumeButton as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function VolumeButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={classes(cs.button, s.button)} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 48 48\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M6 18v12h8l10 10V8L14 18H6zm27 6c0-3.53-2.04-6.58-5-8.05v16.11c2.96-1.48 5-4.53 5-8.06zM28 6.46v4.13c5.78 1.72 10 7.07 10 13.41s-4.22 11.69-10 13.41v4.13c8.01-1.82 14-8.97 14-17.54S36.01 8.28 28 6.46z\" />\n      </svg>\n    </div>\n  )\n}\n","import { stylesheet } from 'typestyle'\n\nexport const VolumeButton = stylesheet({\n  button: {\n    width: '28px',\n    height: '28px',\n    padding: '2px',\n    marginRight: '5px'\n  }\n})\n","import { h } from 'preact'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function SpeedUpButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={cs.button} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { h } from 'preact'\nimport { classes } from 'typestyle'\nimport { SpeedDownButtonStyle as s } from './style'\nimport { ControlsStyle as cs } from '../../Controls.style'\n\nexport function SpeedDownButton(props: { onClick?: (e: any) => void }) {\n  return (\n    <div class={classes(cs.button, s.button)} onClick={props.onClick}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 64 64\"\n        fill=\"currentcolor\"\n      >\n        <path d=\"M0 0 L0 64 L32 32 L32 64 L64 32 L32 0 L32 32 Z\" />\n      </svg>\n    </div>\n  )\n}\n","import { stylesheet } from 'typestyle'\n\nexport const SpeedDownButtonStyle = stylesheet({\n  button: {\n    transform: 'rotate(180deg)'\n  }\n})\n","import { stylesheet } from 'typestyle'\n\nconst rootStyle = () => ({\n  position: 'relative' as 'relative',\n  color: 'white',\n  width: '100%',\n  height: '100%',\n  cursor: 'none',\n  userSelect: 'none' as 'none'\n})\n\nconst titleStyle = () => ({\n  position: 'absolute' as 'absolute',\n  top: '20px',\n  left: '0',\n  zIndex: 20,\n  padding: '10px 10px 10px 20px',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  fontSize: '13pt',\n  fontFamily: `'Roboto', Arial, Helvetica, sans-serif`,\n  opacity: 0,\n  transition: 'opacity 0.2s'\n})\n\nconst controlsStyle = () => ({\n  zIndex: 30,\n  position: 'absolute' as 'absolute',\n  width: '100%',\n  bottom: 0,\n  padding: '0 16px',\n  boxSizing: 'border-box' as 'border-box',\n  backgroundColor: 'rgba(0, 0, 0, 0.4)',\n  userSelect: 'none' as 'none',\n  opacity: 0,\n  transition: 'opacity 0.2s'\n})\n\nexport const RootStyle = stylesheet({\n  root: {\n    ...rootStyle()\n  },\n  rootVisible: {\n    ...rootStyle(),\n    cursor: 'default'\n  },\n\n  title: {\n    ...titleStyle()\n  },\n  titleVisible: {\n    ...titleStyle(),\n    opacity: 1\n  },\n\n  controls: {\n    ...controlsStyle()\n  },\n  controlsVisible: {\n    ...controlsStyle(),\n    opacity: 1\n  },\n\n  screen: {\n    position: 'absolute' as 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: '100%',\n    zIndex: 10\n  }\n})\n"],"sourceRoot":""}